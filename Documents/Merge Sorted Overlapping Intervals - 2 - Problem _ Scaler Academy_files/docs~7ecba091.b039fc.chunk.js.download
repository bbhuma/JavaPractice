!function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=(new Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="0d6b9d5e-b348-4d9c-98bc-4cfff5ff32c2",t._sentryDebugIdIdentifier="sentry-dbid-0d6b9d5e-b348-4d9c-98bc-4cfff5ff32c2")}catch(t){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"45b1623a66627e98e287afefe78e27a34cb416a0"},(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{"+DcE":function(t,e,n){var r=n("4DXW"),i=n("6OdY"),s=n("mlf9"),o=Math.max,a=Math.min;t.exports=function(t,e,n){var l=null==t?0:t.length;if(!l)return-1;var u=l-1;return void 0!==n&&(u=s(n),u=n<0?o(l+u,0):a(u,l-1)),r(t,i(e,3),u,!0)}},"+h67":function(t,e,n){var r=n("4shy"),i=n("8aHw"),s=n("6OdY");t.exports=function(t,e){return t&&t.length?r(t,s(e,2),i):void 0}},"/RDW":function(t,e,n){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},"0Wg4":function(t,e,n){var r=n("MWAu")(n("+DcE"));t.exports=r},"1APN":function(t,e,n){var r=n("mPWW"),i=n("nKYX"),s=n("6OdY");t.exports=function(t,e){var n={};return e=s(e,3),i(t,(function(t,i,s){r(n,i,e(t,i,s))})),n}},"2iYa":function(t,e){t.exports=function(t,e){return t<e}},"3cf4":function(t,e,n){},"4shy":function(t,e,n){var r=n("yI95");t.exports=function(t,e,n){for(var i=-1,s=t.length;++i<s;){var o=t[i],a=e(o);if(null!=a&&(void 0===l?a==a&&!r(a):n(a,l)))var l=a,u=o}return u}},"5PnP":function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n("Tt6i");function i(t,e,n){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=Object(r.a)(t,e);if(i){var s=Object.getOwnPropertyDescriptor(i,e);return s.get?s.get.call(n):s.value}})(t,e,n||t)}},"66Ri":function(t,e,n){var r=n("2B1T"),i=n("1mK8"),s=n("cOv8"),o=n("NtC2");t.exports=function(t,e,n){if(!o(n))return!1;var a=typeof e;return!!("number"==a?i(n)&&s(e,n.length):"string"==a&&e in n)&&r(n[e],t)}},"7Sz/":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=(t,e)=>(class{constructor(){this._listeners=new WeakMap,this._nativeEventTarget=t()}addEventListener(t,n,r){if(null!==n){let i=this._listeners.get(n);void 0===i&&(i=e(this,n),"function"==typeof n&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(t,i,r)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const r=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===r?null:r,n)}})},"8aHw":function(t,e){t.exports=function(t,e){return t>e}},"9haP":function(t,e,n){"use strict";n("Fnjp"),n("VrfG"),n("emll"),n("b6Ed"),n("txOa"),n("odD/")},AN8w:function(t,e,n){},Bn6e:function(t,e,n){},CfyL:function(t,e,n){var r=n("12cv"),i=n("66Ri"),s=n("mlf9"),o=Math.ceil,a=Math.max;t.exports=function(t,e,n){e=(n?i(t,e,n):void 0===e)?1:a(s(e),0);var l=null==t?0:t.length;if(!l||e<1)return[];for(var u=0,c=0,h=Array(o(l/e));u<l;)h[c++]=r(t,u,u+=e);return h}},DzzY:function(t,e,n){},F9FU:function(t,e,n){"use strict";function r(){return(r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}n.d(e,"a",(function(){return r}))},Fnjp:function(t,e,n){},IIuo:function(t,e,n){var r;t.exports=(r=n("gbB/"),function(){var t={378:function(t){"use strict";t.exports=function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;var r,i,s;if(Array.isArray(e)){if((r=e.length)!=n.length)return!1;for(i=r;0!=i--;)if(!t(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((r=(s=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,s[i]))return!1;for(i=r;0!=i--;){var o=s[i];if(!t(e[o],n[o]))return!1}return!0}return e!=e&&n!=n}},145:function(t,e,n){"use strict";n.r(e),e.default='@keyframes spin{to{transform:rotate(360deg)}}.tf-v1-popover{bottom:96px;position:fixed;right:16px;z-index:10001}.tf-v1-popover.open{max-width:100%;min-height:360px;min-width:360px}.tf-v1-popover-wrapper{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%;opacity:0;transition:opacity .25s ease-in-out;border-radius:4px;box-shadow:rgba(0,0,0,.08) 0 2px 4px,rgba(0,0,0,.06) 0 2px 12px}.tf-v1-popover-wrapper iframe{width:100%;height:100%;border:none;overflow:hidden;border-radius:8px}.tf-v1-popover-close{display:none}.tf-v1-popover-button{width:54px;height:54px;position:fixed;box-shadow:0 2px 12px rgba(0,0,0,.06),0 2px 4px rgba(0,0,0,.08);color:#fff;right:26px;bottom:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;background:#3a7685;line-height:0;border:none;padding:0}.tf-v1-popover-button-icon{width:54px;height:54px;font-size:24px;border-radius:50%;overflow:hidden;display:flex;justify-content:center;align-items:center}.tf-v1-popover-button-icon svg.default{margin-top:6px}.tf-v1-popover-button-icon svg,.tf-v1-popover-button-icon img{max-width:54px;max-height:54px}.tf-v1-popover-button-icon img{width:100%;height:100%;object-fit:cover;border-radius:50%}.tf-v1-popover-tooltip{position:fixed;right:94px;bottom:33px;max-width:240px;padding:10px 25px 10px 10px;border-radius:8px;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,.08),0 2px 12px rgba(0,0,0,.06);font-size:14px;font-family:Helvetica,Arial,sans-serif;line-height:22px}.tf-v1-popover-tooltip::before{background-color:#fff;content:"";display:block;width:12px;height:12px;position:absolute;right:-4px;bottom:15px;transform:rotate(45deg);box-shadow:2px -2px 2px 0 rgba(0,0,0,.06)}.tf-v1-popover-tooltip-text{overflow:hidden}.tf-v1-popover-tooltip-close{color:rgba(0,0,0,.2);cursor:pointer;margin-left:4px;display:inline-block;width:20px;height:20px;font-size:18px;text-align:center;position:absolute;top:8px;right:6px}.tf-v1-popover-tooltip-close:hover{color:rgba(0,0,0,.3)}.tf-v1-popover-tooltip.closing{transition:opacity .25s ease-in-out;opacity:0}.tf-v1-popover-unread-dot{width:8px;height:8px;border-radius:50%;background-color:#fa6b05;border:2px solid #fff;position:absolute;top:2px;right:2px}.tf-v1-popover-unread-dot.closing{transition:opacity .25s ease-in-out;opacity:0}.tf-v1-spinner{border:3px solid #aaa;font-size:40px;width:1em;height:1em;border-radius:.5em;box-sizing:border-box;animation:spin 1s linear infinite;border-top-color:#fff;position:absolute;top:50%;left:50%;margin:-20px 0 0 -20px}@media(max-width: 480px){.tf-v1-popover.open{top:0;left:0;bottom:0;right:0;width:100% !important;height:100% !important;width:100vw !important;height:100vh !important;max-height:stretch}.tf-v1-popover.open .tf-v1-popover-close{display:block}.tf-v1-popover-wrapper{border-radius:0;box-shadow:none}.tf-v1-popover-wrapper iframe{border-radius:0}.tf-v1-popover-close{position:absolute;font-size:32px;line-height:24px;width:24px;height:24px;text-align:center;cursor:pointer;opacity:.75;transition:opacity .25s ease-in-out;text-decoration:none;color:#000;top:6px;right:8px;background:none;border:none;z-index:1;opacity:0}.tf-v1-popover-close:hover{opacity:1}}@media(max-width: 480px)and (min-width: 481px){.tf-v1-popover-close{color:#fff !important}}@media(max-width: 480px){.tf-v1-popover-button{width:44px;height:44px;right:8px;bottom:8px}.tf-v1-popover-button-icon{font-size:20px}.tf-v1-popover-button-icon svg{margin-top:4px;max-height:24px;max-width:24px}.tf-v1-popover-button-icon img{max-width:44px;max-height:44px}.tf-v1-popover-tooltip{position:fixed;right:66px;bottom:8px;left:auto;font-size:12px}.tf-v1-popover-tooltip::before{bottom:14px}.tf-v1-popover-unread-dot{top:0;right:0}.tf-v1-spinner{border:3px solid #aaa;font-size:32px;width:1em;height:1em;border-radius:.5em;box-sizing:border-box;animation:spin 1s linear infinite;border-top-color:#fff;position:absolute;top:50%;left:50%;margin:-16px 0 0 -16px}}'},792:function(t,e,n){"use strict";n.r(e),e.default="@keyframes spin{to{transform:rotate(360deg)}}.tf-v1-popup{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.75);transition:opacity .25s ease-in-out;z-index:10001;display:flex;align-items:center;justify-content:center}.tf-v1-popup .tf-v1-iframe-wrapper{position:relative;transition:opacity .25s ease-in-out;min-width:360px;min-height:360px}.tf-v1-popup .tf-v1-iframe-wrapper iframe{width:100%;height:100%;border:none;overflow:hidden;border-radius:8px}.tf-v1-popup .tf-v1-close{position:absolute;font-size:32px;line-height:24px;width:24px;height:24px;text-align:center;cursor:pointer;opacity:.75;transition:opacity .25s ease-in-out;text-decoration:none;color:#000;top:-34px;right:0;background:none;border:none}.tf-v1-popup .tf-v1-close:hover{opacity:1}@media(min-width: 481px){.tf-v1-popup .tf-v1-close{color:#fff !important}}.tf-v1-popup .tf-v1-spinner{border:3px solid #aaa;font-size:40px;width:1em;height:1em;border-radius:.5em;box-sizing:border-box;animation:spin 1s linear infinite;border-top-color:#fff;position:absolute;top:50%;left:50%;margin:-20px 0 0 -20px}@media(max-width: 480px){.tf-v1-popup{width:100% !important;height:100% !important;width:100vw !important;height:100vh !important;max-height:stretch}.tf-v1-popup .tf-v1-iframe-wrapper{position:relative;transition:opacity .25s ease-in-out;min-width:100%;min-height:100%}.tf-v1-popup .tf-v1-iframe-wrapper iframe{border-radius:0}.tf-v1-popup .tf-v1-close{position:absolute;font-size:32px;line-height:24px;width:24px;height:24px;text-align:center;cursor:pointer;opacity:.75;transition:opacity .25s ease-in-out;text-decoration:none;color:#000;top:6px;right:8px;background:none;border:none}.tf-v1-popup .tf-v1-close:hover{opacity:1}}@media(max-width: 480px)and (min-width: 481px){.tf-v1-popup .tf-v1-close{color:#fff !important}}"},838:function(t,e,n){"use strict";n.r(e),e.default="@keyframes spin{to{transform:rotate(360deg)}}.tf-v1-sidetab{position:fixed;top:50%;right:0;width:400px;height:580px;transform:translate(100%, -50%);box-shadow:0 2px 4px rgba(0,0,0,.08),0 2px 12px rgba(0,0,0,.06);z-index:10001;will-change:transform}.tf-v1-sidetab.ready{transition:transform 400ms cubic-bezier(0.5, 0, 0.75, 0)}.tf-v1-sidetab iframe{width:100%;height:100%;border:none;overflow:hidden;border-radius:8px 0 0 8px}.tf-v1-sidetab.open{transform:translate(0, -50%)}.tf-v1-sidetab-wrapper{position:relative;height:100%}.tf-v1-sidetab-button{position:absolute;top:50%;left:-48px;transform:rotate(-90deg) translateX(-50%);transform-origin:left top;min-width:100px;max-width:540px;height:48px;display:flex;align-items:center;padding:12px 16px;border-radius:8px 8px 0 0;color:#fff;box-shadow:0 2px 4px rgba(0,0,0,.08),0 2px 12px rgba(0,0,0,.06);background-color:#3a7685;cursor:pointer;border:0;text-decoration:none;outline:none}.tf-v1-sidetab-button-text{flex:1;font-size:18px;font-family:Helvetica,Arial,sans-serif;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.tf-v1-sidetab-button-icon{width:24px;height:24px;font-size:24px;transform:rotate(90deg);margin-right:12px;position:relative;order:-1}.tf-v1-sidetab-button-icon>img{width:100%;height:100%;object-fit:contain}.tf-v1-sidetab-close{display:none}.tf-v1-sidetab .tf-v1-spinner{border:3px solid #aaa;font-size:24px;width:1em;height:1em;border-radius:.5em;box-sizing:border-box;animation:spin 1s linear infinite;border-top-color:#fff;position:absolute;top:50%;left:50%;margin:-12px 0 0 -12px;top:0;left:0;margin:0}@media(max-width: 480px){.tf-v1-sidetab{transition:unset}.tf-v1-sidetab.ready{transition:unset}.tf-v1-sidetab.open{top:0;left:0;right:0;bottom:0;transform:translate(0, 0);width:100% !important;height:100% !important;width:100vw !important;height:100vh !important;max-height:stretch}.tf-v1-sidetab-close{position:absolute;font-size:32px;line-height:24px;width:24px;height:24px;text-align:center;cursor:pointer;opacity:.75;transition:opacity .25s ease-in-out;text-decoration:none;color:#000;top:6px;right:8px;background:none;border:none;display:block;z-index:1}.tf-v1-sidetab-close:hover{opacity:1}}@media(max-width: 480px)and (min-width: 481px){.tf-v1-sidetab-close{color:#fff !important}}"},630:function(t,e,n){"use strict";n.r(e),e.default="@keyframes spin{to{transform:rotate(360deg)}}.tf-v1-slider{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.75);transition:opacity .25s ease-in-out;z-index:10001}.tf-v1-slider .tf-v1-iframe-wrapper{max-width:calc(100vw - 26px);height:100%;position:absolute;top:0;transition:right .5s ease-in-out,left .5s ease-in-out}.tf-v1-slider .tf-v1-iframe-wrapper iframe{width:100%;height:100%;border:none;overflow:hidden;border-radius:0}@media(min-width: 481px){.tf-v1-slider .tf-v1-iframe-wrapper iframe{border-radius:8px 0 0 8px}}.tf-v1-slider .tf-v1-close{position:absolute;font-size:32px;line-height:24px;width:24px;height:24px;text-align:center;cursor:pointer;opacity:.75;transition:opacity .25s ease-in-out;text-decoration:none;color:#000;top:6px;right:8px;background:none;border:none}.tf-v1-slider .tf-v1-close:hover{opacity:1}@media(min-width: 481px){.tf-v1-slider .tf-v1-close{color:#fff !important}}@media(min-width: 481px){.tf-v1-slider .tf-v1-close{top:4px;left:-26px}}.tf-v1-slider .tf-v1-close:hover{opacity:1}.tf-v1-slider .tf-v1-spinner{border:3px solid #aaa;font-size:40px;width:1em;height:1em;border-radius:.5em;box-sizing:border-box;animation:spin 1s linear infinite;border-top-color:#fff;position:absolute;top:50%;left:50%;margin:-20px 0 0 -20px}@media(min-width: 481px){.tf-v1-slider.left .tf-v1-iframe-wrapper iframe{border-radius:0 8px 8px 0}.tf-v1-slider.left .tf-v1-close{left:auto;right:-24px}}@media(max-width: 480px){.tf-v1-slider{width:100% !important;height:100% !important;width:100vw !important;height:100vh !important;max-height:stretch}.tf-v1-slider .tf-v1-iframe-wrapper{width:100% !important;max-width:100vw;height:100%;transition:unset}.tf-v1-slider .tf-v1-iframe-wrapper iframe{border-radius:none}.tf-v1-slider .tf-v1-close{position:absolute;font-size:32px;line-height:24px;width:24px;height:24px;text-align:center;cursor:pointer;opacity:.75;transition:opacity .25s ease-in-out;text-decoration:none;color:#000;top:6px;right:8px;background:none;border:none;left:auto}.tf-v1-slider .tf-v1-close:hover{opacity:1}}@media(max-width: 480px)and (min-width: 481px){.tf-v1-slider .tf-v1-close{color:#fff !important}}"},684:function(t,e,n){"use strict";n.r(e),e.default=".tf-v1-widget{width:100%;height:100%;position:relative}.tf-v1-widget iframe{width:100%;height:100%;border:none;overflow:hidden;border-radius:8px}.tf-v1-widget-close{display:none}.tf-v1-widget-iframe-overlay{width:100%;height:100%;border:none;overflow:hidden;border-radius:8px;position:absolute;top:0;left:0}.tf-v1-widget-fullscreen{position:fixed;top:0;left:0;right:0;bottom:0;z-index:10001;width:100% !important;height:100% !important;width:100vw !important;height:100vh !important;max-height:stretch}.tf-v1-widget-fullscreen .tf-v1-widget-close{display:block;position:absolute;font-size:32px;line-height:24px;width:24px;height:24px;text-align:center;cursor:pointer;opacity:.75;transition:opacity .25s ease-in-out;text-decoration:none;color:#000;top:6px;right:8px;background:none;border:none;z-index:1}.tf-v1-widget-fullscreen .tf-v1-widget-close:hover{opacity:1}@media(min-width: 481px){.tf-v1-widget-fullscreen .tf-v1-widget-close{color:#fff !important}}.tf-v1-widget-fullscreen iframe{border-radius:0}"},281:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(11),e),i(n(739),e),i(n(860),e)},794:function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.InlineStyle=void 0;var s=i(n(156)),o=i(n(52));e.InlineStyle=function(t){var e=t.filename,i=n(367)("./".concat(e,".css")),a=(0,o.default)();return s.default.createElement("style",r({},a?{nonce:a}:{}),i.default)}},11:function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&i(e,t,n);return s(e,t),e},a=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.makeButtonComponent=e.emptyEmbed=void 0;var l=o(n(156)),u=n(794);e.emptyEmbed={unmount:function(){},open:function(){}},e.makeButtonComponent=function(t,n){return l.default.forwardRef((function(i,s){var o=i.id,c=i.children,h=i.as,d=void 0===h?"button":h,f=i.style,p=void 0===f?{}:f,g=i.className,m=void 0===g?"":g,v=i.buttonProps,y=a(i,["id","children","as","style","className","buttonProps"]),b=(0,l.useRef)(e.emptyEmbed),E=s||b;(0,l.useEffect)((function(){return E.current=t(o,y),function(){return E.current.unmount()}}),[o,y,E]);var T=(0,l.useMemo)((function(){return function(){return E.current.open()}}),[E]),S=l.default.createElement(d,r({style:p,className:m,onClick:T,"data-testid":"tf-v1-".concat(n),children:c},v));return l.default.createElement(l.default.Fragment,null,l.default.createElement(u.InlineStyle,{filename:n}),S)}))}},739:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&r(e,t,n);return i(e,t),e},o=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.makeInitializerComponent=void 0;var a=s(n(156)),l=n(794),u={unmount:function(){}};e.makeInitializerComponent=function(t,e){return a.default.forwardRef((function(n,r){var i=n.id,s=o(n,["id"]),c=(0,a.useRef)(u),h=r||c;return(0,a.useEffect)((function(){return h.current=t(i,s),function(){h.current.unmount()}}),[i,s,h]),a.default.createElement(l.InlineStyle,{filename:e})}))}},860:function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&i(e,t,n);return s(e,t),e},a=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.Widget=void 0;var l=o(n(156)),u=n(611),c=n(794);e.Widget=function(t){var e=t.id,n=t.style,i=void 0===n?{}:n,s=t.className,o=void 0===s?"":s,h=a(t,["id","style","className"]),d=(0,l.useRef)(null);return(0,l.useEffect)((function(){if(d.current){var t=(0,u.createWidget)(e,r(r({},h),{container:d.current}));return function(){t.unmount()}}}),[e,h]),l.default.createElement(l.default.Fragment,null,l.default.createElement(c.InlineStyle,{filename:"widget"}),l.default.createElement("div",{style:i,className:o,ref:d}))}},797:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(553),e)},553:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.memoComponent=e.propsAreEqual=void 0;var i=n(156),s=r(n(378));e.propsAreEqual=function(t,e){return(0,s.default)(t,e)},e.memoComponent=function(t){return(0,i.memo)(t,e.propsAreEqual)}},52:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return void 0!==n.g.__webpack_nonce__?n.g.__webpack_nonce__:null}},367:function(t,e,n){var r={"./popover.css":145,"./popup.css":792,"./sidetab.css":838,"./slider.css":630,"./widget.css":684};function i(t){var e=s(t);return n(e)}function s(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}i.keys=function(){return Object.keys(r)},i.resolve=s,t.exports=i,i.id=367},611:function(t){t.exports=function(){"use strict";var t={8027:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_DOMAIN=e.POPUP_SIZE=e.SLIDER_WIDTH=e.SLIDER_POSITION=e.LIVE_EMBED_ATTRIBUTE=e.SIDETAB_ATTRIBUTE=e.WIDGET_ATTRIBUTE=e.SLIDER_ATTRIBUTE=e.POPUP_ATTRIBUTE=e.POPOVER_ATTRIBUTE=void 0,e.POPOVER_ATTRIBUTE="data-tf-popover",e.POPUP_ATTRIBUTE="data-tf-popup",e.SLIDER_ATTRIBUTE="data-tf-slider",e.WIDGET_ATTRIBUTE="data-tf-widget",e.SIDETAB_ATTRIBUTE="data-tf-sidetab",e.LIVE_EMBED_ATTRIBUTE="data-tf-live",e.SLIDER_POSITION="right",e.SLIDER_WIDTH=800,e.POPUP_SIZE=100,e.DEFAULT_DOMAIN="form.typeform.com"},7528:function(t,e,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.createPopover=void 0;var s=n(6797),o=n(1320),a=function(t,e){var n=t.parentNode;n&&(n.removeChild(t),n.appendChild(e))},l=function(t,e){void 0===t&&(t="span"),void 0===e&&(e="tf-v1-popover-button-icon");var n=document.createElement(t);return n.className="".concat(e," tf-v1-close-icon"),n.innerHTML="&times;",n.dataset.testid=e,n},u={buttonColor:"#3a7685"};e.createPopover=function(t,e){void 0===e&&(e={});var n,c,h,d=r(r({},u),e),f=d.domain,p=i(d,["domain"]),g=(0,s.createIframe)("popover",{formId:t,domain:f,options:p}),m=g.iframe,v=g.embedId,y=g.refresh,b=g.focus,E=function(t,e){var n=document.createElement("div");return n.className="tf-v1-popover",n.dataset.testid="tf-v1-popover",(0,s.setElementSize)(n,{width:t,height:e})}(p.width,p.height),T=function(){var t=document.createElement("div");return t.className="tf-v1-popover-wrapper",t.dataset.testid="tf-v1-popover-wrapper",t}(),S=function(t,e){var n=(0,s.getTextColor)(e),r=document.createElement("div");r.className="tf-v1-popover-button-icon";var i='<svg class="default" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M21 0H0V9L10.5743 24V16.5H21C22.6567 16.5 24 15.1567 24 13.5V3C24 1.34325 22.6567 0 21 0ZM7.5\n    9.75C6.672 9.75 6 9.07875 6 8.25C6 7.42125 6.672 6.75 7.5 6.75C8.328 6.75 9 7.42125 9 8.25C9 9.07875 8.328 9.75\n    7.5 9.75ZM12.75 9.75C11.922 9.75 11.25 9.07875 11.25 8.25C11.25 7.42125 11.922 6.75 12.75 6.75C13.578 6.75 14.25\n    7.42125 14.25 8.25C14.25 9.07875 13.578 9.75 12.75 9.75ZM18 9.75C17.172 9.75 16.5 9.07875 16.5 8.25C16.5 7.42125\n    17.172 6.75 18 6.75C18.828 6.75 19.5 7.42125 19.5 8.25C19.5 9.07875 18.828 9.75 18 9.75Z" fill="'.concat(n,'"></path>\n  </svg>'),o=null==t?void 0:t.startsWith("http");return r.innerHTML=o?"<img alt='popover trigger icon button' src='".concat(t,"'/>"):null!=t?t:i,r.dataset.testid="default-icon",r}(p.customIcon,p.buttonColor||u.buttonColor),_=function(){var t=document.createElement("div");t.className="tf-v1-spinner";var e=document.createElement("div");return e.className="tf-v1-popover-button-icon",e.dataset.testid="spinner-icon",e.append(t),e}(),w=l(),A=l("button","tf-v1-popover-close"),L=function(t){var e=(0,s.getTextColor)(t),n=document.createElement("button");return n.className="tf-v1-popover-button",n.dataset.testid="tf-v1-popover-button",n.style.backgroundColor=t,n.style.color=e,n}(p.buttonColor||u.buttonColor);(p.container||document.body).append(E),T.append(m),E.append(L),E.append(A),L.append(S);var R=function(){c&&c.parentNode&&(c.classList.add("closing"),setTimeout((function(){(0,s.unmountElement)(c)}),250))};p.tooltip&&p.tooltip.length>0&&(c=function(t,e){var n=document.createElement("span");n.className="tf-v1-popover-tooltip-close",n.dataset.testid="tf-v1-popover-tooltip-close",n.innerHTML="&times;",n.onclick=e;var r=document.createElement("div");r.className="tf-v1-popover-tooltip-text",r.innerHTML=t;var i=document.createElement("div");return i.className="tf-v1-popover-tooltip",i.dataset.testid="tf-v1-popover-tooltip",i.appendChild(r),i.appendChild(n),i}(p.tooltip,R),E.append(c)),p.notificationDays&&(p.enableSandbox||(0,o.canBuildNotificationDot)(t))&&(h=(0,o.buildNotificationDot)(),L.append(h)),m.onload=function(){E.classList.add("open"),T.style.opacity="1",A.style.opacity="1",a(_,w),(0,s.addCustomKeyboardListener)(x)};var I=(0,s.makeAutoResize)(E),D=function(){(0,s.isOpen)(T)||(R(),h&&(h.classList.add("closing"),p.notificationDays&&!p.enableSandbox&&(0,o.saveNotificationDotHideUntilTime)(t,p.notificationDays),setTimeout((function(){(0,s.unmountElement)(h)}),250)),I(),window.addEventListener("resize",I),setTimeout((function(){(0,s.isInPage)(T)?(T.style.opacity="0",A.style.opacity="0",T.style.display="flex",setTimeout((function(){E.classList.add("open"),T.style.opacity="1",A.style.opacity="1"})),a(S,w)):(E.append(T),a(S,_),T.style.opacity="0",A.style.opacity="0")})))},x=function(){var t;(0,s.isOpen)(E)&&(null===(t=e.onClose)||void 0===t||t.call(e),setTimeout((function(){p.keepSession?T.style.display="none":(0,s.unmountElement)(T),E.classList.remove("open"),a(w,S)}),250))};(0,s.setAutoClose)(v,p.autoClose,x);var k=function(){(0,s.isOpen)(T)?x():D()};return L.onclick=(0,s.invokeWithoutDefault)(k),A.onclick=(0,s.invokeWithoutDefault)(x),p.open&&!(0,s.isOpen)(T)&&(n=(0,s.handleCustomOpen)(D,p.open,p.openValue)),{open:D,close:x,toggle:k,refresh:y,focus:b,unmount:function(){(0,s.unmountElement)(E),window.removeEventListener("resize",I),p.open&&(null==n?void 0:n.remove)&&n.remove()}}}},1797:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(7528),e),i(n(6100),e)},1320:function(t,e){var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.buildNotificationDot=e.canBuildNotificationDot=e.saveNotificationDotHideUntilTime=void 0;var r="tfNotificationData",i=function(){var t=localStorage.getItem(r);return t?JSON.parse(t):{}},s=function(t){t&&localStorage.setItem(r,JSON.stringify(t))};e.saveNotificationDotHideUntilTime=function(t,e){var r,o=new Date;o.setDate(o.getDate()+e),s(n(n({},i()),((r={})[t]={hideUntilTime:o.getTime()},r)))},e.canBuildNotificationDot=function(t){var e=function(t){var e;return(null===(e=i()[t])||void 0===e?void 0:e.hideUntilTime)||0}(t);return(new Date).getTime()>e&&(e&&function(t){var e=i();delete e[t],s(e)}(t),!0)},e.buildNotificationDot=function(){var t=document.createElement("span");return t.className="tf-v1-popover-unread-dot",t.dataset.testid="tf-v1-popover-unread-dot",t}},6100:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},9630:function(t,e,n){var r=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.createPopup=void 0;var i=n(6797),s=n(8027),o=n(6797);e.createPopup=function(t,e){if(void 0===e&&(e={}),!(0,i.hasDom)())return{open:function(){},close:function(){},toggle:function(){},refresh:function(){},focus:function(){},unmount:function(){}};var n,a=e.width,l=e.height,u=e.size,c=void 0===u?s.POPUP_SIZE:u,h=e.onClose,d=e.domain,f=r(e,["width","height","size","onClose","domain"]),p=(0,i.createIframe)("popup",{formId:t,domain:d,options:f}),g=p.iframe,m=p.embedId,v=p.refresh,y=p.focus,b=document.body.style.overflow,E=function(){var t=document.createElement("div");return t.className="tf-v1-popup",t.dataset.testid="tf-v1-popup",t.style.opacity="0",t}(),T=function(){var t=document.createElement("div");return t.className="tf-v1-spinner",t}(),S=function(t,e,n){var r=document.createElement("div");return r.className="tf-v1-iframe-wrapper",r.style.opacity="0",(0,i.isDefined)(t)&&(0,i.isDefined)(e)?(0,i.setElementSize)(r,{width:t,height:e}):(r.style.width="calc(".concat(n,"% - 80px)"),r.style.height="calc(".concat(n,"% - 80px)"),r)}(a,l,c);S.append(g),E.append(T),E.append(S);var _=f.container||document.body;g.onload=function(){S.style.opacity="1",setTimeout((function(){T.style.display="none"}),250),(0,i.addCustomKeyboardListener)(L)};var w=(0,o.makeAutoResize)(E),A=function(){(0,o.isOpen)(E)||((0,o.isInPage)(E)?E.style.display="flex":(T.style.display="block",_.append(E)),document.body.style.overflow="hidden",w(),window.addEventListener("resize",w),setTimeout((function(){E.style.opacity="1"})))},L=function(){(0,o.isOpen)(E)&&(null==h||h(),E.style.opacity="0",document.body.style.overflow=b,setTimeout((function(){f.keepSession?E.style.display="none":R()}),250))};S.append(function(t){var e=document.createElement("button");return e.className="tf-v1-close tf-v1-close-icon",e.innerHTML="&times;",e.onclick=(0,i.invokeWithoutDefault)(t),e}(L)),(0,i.setAutoClose)(m,f.autoClose,L),f.open&&!(0,o.isOpen)(E)&&(n=(0,i.handleCustomOpen)(A,f.open,f.openValue));var R=function(){(0,i.unmountElement)(E),window.removeEventListener("resize",w),f.open&&(null==n?void 0:n.remove)&&n.remove()};return{open:A,close:L,toggle:function(){(0,o.isOpen)(E)?L():A()},refresh:v,focus:y,unmount:R}}},5970:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(9630),e),i(n(7394),e)},7394:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},382:function(t,e,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.createSidetab=void 0;var s=n(6797),o={buttonColor:"#3a7685",buttonText:"Launch me"},a=function(t,e){void 0===t&&(t="div"),void 0===e&&(e="tf-v1-sidetab-button-icon");var n=document.createElement(t);return n.className="".concat(e," tf-v1-close-icon"),n.innerHTML="&times;",n.dataset.testid=e,n},l=function(t,e){var n=t.parentNode;n&&(n.removeChild(t),n.appendChild(e))};e.createSidetab=function(t,e){void 0===e&&(e={});var n,u=r(r({},o),e),c=u.domain,h=i(u,["domain"]),d=(0,s.createIframe)("side-tab",{formId:t,domain:c,options:h}),f=d.iframe,p=d.embedId,g=d.refresh,m=d.focus,v=function(t,e){var n=document.createElement("div");return n.className="tf-v1-sidetab",n.dataset.testid="tf-v1-sidetab",(0,s.setElementSize)(n,{width:t,height:e})}(h.width,h.height),y=function(){var t=document.createElement("div");return t.className="tf-v1-sidetab-wrapper",t.dataset.testid="tf-v1-sidetab-wrapper",t}(),b=function(){var t=document.createElement("div");t.className="tf-v1-spinner";var e=document.createElement("div");return e.className="tf-v1-sidetab-button-icon",e.dataset.testid="spinner-icon",e.append(t),e}(),E=function(t){var e=(0,s.getTextColor)(t),n=document.createElement("button");return n.className="tf-v1-sidetab-button",n.style.backgroundColor=t,n.style.color=e,n}(h.buttonColor||o.buttonColor),T=function(t){var e=document.createElement("span");return e.className="tf-v1-sidetab-button-text",e.innerHTML=t,e}(h.buttonText||o.buttonText),S=function(t,e){var n=(0,s.getTextColor)(e),r=document.createElement("div");r.className="tf-v1-sidetab-button-icon";var i='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M21 0H0V9L10.5743 24V16.5H21C22.6567 16.5 24 15.1567 24 13.5V3C24 1.34325 22.6567 0 21 0ZM7.5 9.75C6.672 9.75 6 9.07875 6 8.25C6 7.42125 6.672 6.75 7.5 6.75C8.328 6.75 9 7.42125 9 8.25C9 9.07875 8.328 9.75 7.5 9.75ZM12.75 9.75C11.922 9.75 11.25 9.07875 11.25 8.25C11.25 7.42125 11.922 6.75 12.75 6.75C13.578 6.75 14.25 7.42125 14.25 8.25C14.25 9.07875 13.578 9.75 12.75 9.75ZM18 9.75C17.172 9.75 16.5 9.07875 16.5 8.25C16.5 7.42125 17.172 6.75 18 6.75C18.828 6.75 19.5 7.42125 19.5 8.25C19.5 9.07875 18.828 9.75 18 9.75Z" fill="'.concat(n,'"></path>\n  </svg>'),o=null==t?void 0:t.startsWith("http");return r.innerHTML=o?"<img alt='popover trigger icon button' src='".concat(t,"'/>"):null!=t?t:i,r.dataset.testid="default-icon",r}(h.customIcon,h.buttonColor||o.buttonColor),_=a(),w=a("button","tf-v1-sidetab-close");(h.container||document.body).append(v),y.append(f),v.append(E),v.append(w),E.append(S),E.append(T),setTimeout((function(){v.classList.add("ready")}),250),f.onload=function(){v.classList.add("open"),l(b,_),(0,s.addCustomKeyboardListener)(R)};var A=(0,s.makeAutoResize)(v),L=function(){(0,s.isOpen)(y)||(A(),window.addEventListener("resize",A),(0,s.isInPage)(y)?(y.style.display="flex",v.classList.add("open"),l(S,_)):(v.append(y),l(S,b)))},R=function(){var t;(0,s.isOpen)(y)&&(null===(t=h.onClose)||void 0===t||t.call(h),v.classList.remove("open"),setTimeout((function(){h.keepSession?y.style.display="none":(0,s.unmountElement)(y),l(_,S)}),250))};(0,s.setAutoClose)(p,h.autoClose,R);var I=function(){(0,s.isOpen)(y)?R():L()};return E.onclick=(0,s.invokeWithoutDefault)(I),w.onclick=(0,s.invokeWithoutDefault)(R),h.open&&!(0,s.isOpen)(y)&&(n=(0,s.handleCustomOpen)(L,h.open,h.openValue)),{open:L,close:R,toggle:I,refresh:g,focus:m,unmount:function(){(0,s.unmountElement)(v),window.removeEventListener("resize",A),h.open&&(null==n?void 0:n.remove)&&n.remove()}}}},1434:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(382),e),i(n(7668),e)},7668:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},2603:function(t,e,n){var r=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};Object.defineProperty(e,"__esModule",{value:!0}),e.createSlider=void 0;var i=n(6797),s=n(8027);e.createSlider=function(t,e){if(void 0===e&&(e={}),!(0,i.hasDom)())return{open:function(){},close:function(){},toggle:function(){},refresh:function(){},focus:function(){},unmount:function(){}};var n,o=e.position,a=void 0===o?s.SLIDER_POSITION:o,l=e.width,u=void 0===l?s.SLIDER_WIDTH:l,c=e.onClose,h=e.domain,d=r(e,["position","width","onClose","domain"]),f=(0,i.createIframe)("slider",{formId:t,domain:h,options:d}),p=f.iframe,g=f.embedId,m=f.refresh,v=f.focus,y=document.body.style.overflow,b=function(t){var e=document.createElement("div");return e.className="tf-v1-slider ".concat(t),e.dataset.testid="tf-v1-slider",e.style.opacity="0",e}(a),E=function(){var t=document.createElement("div");return t.className="tf-v1-spinner",t}(),T=function(t,e){var n=document.createElement("div");return n.className="tf-v1-iframe-wrapper",n.style[t]="-100%",(0,i.setElementSize)(n,{width:e})}(a,u);T.append(p),b.append(E),b.append(T);var S=d.container||document.body;p.onload=function(){T.style[a]="0",setTimeout((function(){E.style.display="none"}),500),(0,i.addCustomKeyboardListener)(A)};var _=(0,i.makeAutoResize)(b),w=function(){(0,i.isOpen)(b)||(_(),window.addEventListener("resize",_),(0,i.isInPage)(b)?(b.style.display="flex",setTimeout((function(){T.style[a]="0"}))):(S.append(b),E.style.display="block"),document.body.style.overflow="hidden",setTimeout((function(){b.style.opacity="1"})))},A=function(){(0,i.isOpen)(b)&&(null==c||c(),b.style.opacity="0",T.style[a]="-100%",document.body.style.overflow=y,setTimeout((function(){d.keepSession?b.style.display="none":L()}),500))};(0,i.setAutoClose)(g,d.autoClose,A),T.append(function(t){var e=document.createElement("button");return e.className="tf-v1-close tf-v1-close-icon",e.innerHTML="&times;",e.onclick=(0,i.invokeWithoutDefault)(t),e}(A)),d.open&&!(0,i.isOpen)(b)&&(n=(0,i.handleCustomOpen)(w,d.open,d.openValue));var L=function(){(0,i.unmountElement)(b),window.removeEventListener("resize",_),d.open&&(null==n?void 0:n.remove)&&n.remove()};return{open:w,close:A,toggle:function(){(0,i.isOpen)(b)?A():w()},refresh:m,focus:v,unmount:L}}},4071:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(2603),e),i(n(3162),e)},3162:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},718:function(t,e,n){var r=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(e,"__esModule",{value:!0}),e.createWidget=void 0;var s=n(6797),o=n(8554),a=n(2313),l=n(1126);e.createWidget=function(t,e){if(!(0,s.hasDom)())return{refresh:function(){},focus:function(){},unmount:function(){}};var n=e.domain,u=r(e,["domain"]);u.inlineOnMobile=e.inlineOnMobile||e.fullScreen,u.inlineOnMobile||!u.forceTouch&&!(0,s.isFullscreen)()||(u.displayAsFullScreenModal=!0,u.forceTouch=!0);var c,h=(0,s.createIframe)("widget",{formId:t,domain:n,options:u}),d=h.embedId,f=h.iframe,p=h.refresh,g=h.focus,m=(0,a.buildWidget)(f,u.width,u.height);if(u.fullScreen&&((0,l.overrideFullScreenStyles)(e.container,f),c=(0,s.makeAutoResize)(e.container,!0),window.addEventListener("resize",c),c()),u.autoResize){var v=i("string"==typeof u.autoResize?u.autoResize.split(",").map((function(t){return parseInt(t)})):[],2),y=v[0],b=v[1];window.addEventListener("message",(0,o.getFormHeightChangedHandler)(d,(function(t){var n=Math.max(t.height,y||0);b&&(n=Math.min(n,b)),e.container.style.height="".concat(n,"px")})))}u.autoFocus&&window.addEventListener("message",(0,o.getFormReadyHandler)(d,(function(){setTimeout((function(){g()}),1e3)})));var E,T=function(){return e.container.append(m)};if(e.container.innerHTML="",e.lazy?(0,s.lazyInitialize)(e.container,T):T(),u.displayAsFullScreenModal){var S="",_=e.container;c=(0,s.makeAutoResize)(_);var w=_.style.height;window.addEventListener("message",(0,o.getWelcomeScreenHiddenHandler)(d,(function(){_.classList.add("tf-v1-widget-fullscreen"),void 0!==e.opacity&&(_.style.backgroundColor=S),c(),window.addEventListener("resize",c)}))),window.addEventListener("message",(0,o.getFormThemeHandler)(d,(function(t){var e;S=(0,s.changeColorOpacity)(null===(e=null==t?void 0:t.theme)||void 0===e?void 0:e.backgroundColor)})));var A=((E=document.createElement("button")).className="tf-v1-widget-close tf-v1-close-icon",E.innerHTML="&times;",E);A.onclick=(0,s.invokeWithoutDefault)((function(){var t;if(window.removeEventListener("resize",c),_.style.height=w,null===(t=e.onClose)||void 0===t||t.call(e),_.classList.remove("tf-v1-widget-fullscreen"),_.style.backgroundColor="",e.keepSession){var n=document.createElement("div");n.className="tf-v1-widget-iframe-overlay",n.onclick=function(){_.classList.add("tf-v1-widget-fullscreen"),(0,s.unmountElement)(n)},m.append(n)}else e.container.innerHTML="",T(),_.append(A)})),_.append(A)}return{refresh:p,focus:g,unmount:function(){c&&window.removeEventListener("resize",c),(0,s.unmountElement)(m)}}}},1419:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.buildWidget=void 0;var r=n(6797);e.buildWidget=function(t,e,n){var i=document.createElement("div");return i.className="tf-v1-widget",i.dataset.testid="tf-v1-widget",i.append(t),(0,r.setElementSize)(i,{width:e,height:n})}},2313:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(1419),e)},1126:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.overrideFullScreenStyles=void 0,e.overrideFullScreenStyles=function(t,e){Object.assign(t.style,{zIndex:"10001",position:"absolute",top:"0",left:"0",width:"100%",height:"100%"}),e.style.borderRadius="0",Object.assign(document.body.style,{overflow:"hidden"})}},9321:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(718),e),i(n(4058),e)},4058:function(t,e){Object.defineProperty(e,"__esModule",{value:!0})},1920:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(1797),e),i(n(5970),e),i(n(4071),e),i(n(9321),e),i(n(1434),e)},3626:function(t,e,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(e,"__esModule",{value:!0}),e.buildIframeSrc=void 0;var s=n(8027),o=n(4527),a=n(2346),l=n(2698),u=n(863),c={widget:"embed-widget",popup:"popup-blank",slider:"popup-drawer",popover:"popup-popover","side-tab":"popup-side-panel"};e.buildIframeSrc=function(t){var e=t.domain,n=t.formId,h=t.type,d=t.embedId,f=t.options,p=function(t,e,n){var i=n.transitiveSearchParams,s=n.source,o=n.medium,a=n.mediumVersion,u=n.hideFooter,h=n.hideHeaders,d=n.opacity,f=n.disableTracking,p=n.enableSandbox,g=n.shareGaInstance,m=n.forceTouch,v=n.displayAsFullScreenModal,y=n.tracking,b=n.redirectTarget,E=n.autoResize,T=n.disableScroll,S=n.onEndingButtonClick,_=n.noHeading,w=(0,l.getTransitiveSearchParams)(i);return r(r(r({},{"typeform-embed-id":e,"typeform-embed":c[t],"typeform-source":s,"typeform-medium":o,"typeform-medium-version":a,"embed-hide-footer":u?"true":void 0,"embed-hide-headers":h?"true":void 0,"embed-opacity":d,"disable-tracking":f||p?"true":void 0,"__dangerous-disable-submissions":p?"true":void 0,"share-ga-instance":g?"true":void 0,"force-touch":m?"true":void 0,"add-placeholder-ws":"widget"===t&&v?"true":void 0,"typeform-embed-redirect-target":b,"typeform-embed-auto-resize":E?"true":void 0,"typeform-embed-disable-scroll":T?"true":void 0,"typeform-embed-handle-ending-button-click":S?"true":void 0,"typeform-embed-no-heading":_?"true":void 0}),w),y)}(h,d,function(t){return t.noHeading||(t.noHeading=document.querySelectorAll("h1").length>0),r(r({},{source:null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.hostname.replace(/^www\./,""),medium:"embed-sdk",mediumVersion:"next"}),(0,o.removeUndefinedKeys)(t));var e}(f)),g=function(t,e,n){if(void 0===e&&(e=s.DEFAULT_DOMAIN),void 0===n&&(n=!1),t.startsWith("http://")||t.startsWith("https://"))return new URL(t);var r=n?"c":"to";return new URL("https://".concat(e,"/").concat(r,"/").concat(t))}(n,e,f.chat);if(Object.entries(p).filter((function(t){var e=i(t,2)[1];return(0,a.isDefined)(e)})).forEach((function(t){var e=i(t,2),n=e[0],r=e[1];g.searchParams.set(n,r)})),f.hubspot){var m=(0,u.getHubspotHiddenFields)();f.hidden=r(r({},f.hidden),m)}if(f.hidden){var v=new URLSearchParams;Object.entries(f.hidden).filter((function(t){var e=i(t,2)[1];return(0,a.isDefined)(e)&&""!==e})).forEach((function(t){var e=i(t,2),n=e[0],r=e[1];"boolean"==typeof f.transitiveSearchParams&&g.searchParams.delete(n),v.set(n,r)}));var y=v.toString();y&&(g.hash=y)}return g.href}},2391:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.changeColorOpacity=void 0,e.changeColorOpacity=function(t,e){return void 0===t&&(t=""),void 0===e&&(e=255),t.startsWith("rgba(")?null==t?void 0:t.replace(/, [\d.]+\)$/,", ".concat(e,")")):t}},8972:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.handleCustomOpen=void 0;var n={remove:function(){}};e.handleCustomOpen=function(t,e,r){switch(e){case"load":return t(),n;case"exit":return r?function(t,e){var n=0,r=function(i){i.clientY<t&&i.clientY<n?(document.removeEventListener("mousemove",r,!0),e()):n=i.clientY};return document.addEventListener("mousemove",r,!0),{remove:function(){return document.removeEventListener("mousemove",r,!0)}}}(r,t):n;case"time":return setTimeout((function(){t()}),r),n;case"scroll":return r?function(t,e){function n(){var r=window.pageYOffset||document.documentElement.scrollTop,i=document.documentElement.clientTop||0,s=document.documentElement.scrollHeight,o=r-i,a=o/s*100,l=o+window.innerHeight>=s;(a>=t||l)&&(e(),document.removeEventListener("scroll",n))}return document.addEventListener("scroll",n),{remove:function(){return document.removeEventListener("scroll",n)}}}(r,t):n;default:return n}}},1553:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.createIframe=void 0;var r=n(3626),i=n(6797),s=n(8866),o=n(8554),a=n(2256),l=n(7144),u=n(5511);e.createIframe=function(t,e){var n=e.formId,c=e.domain,h=e.options,d=(0,s.generateEmbedId)(),f=h.iframeProps,p=void 0===f?{}:f,g=h.onReady,m=h.onQuestionChanged,v=h.onHeightChanged,y=h.onSubmit,b=h.onEndingButtonClick,E=h.shareGaInstance,T=(0,r.buildIframeSrc)({formId:n,domain:c,embedId:d,type:t,options:h}),S=document.createElement("iframe");return S.src=T,S.dataset.testid="iframe",S.style.border="0px",S.allow="microphone; camera",Object.keys(p).forEach((function(t){S.setAttribute(t,p[t])})),S.addEventListener("load",a.triggerIframeRedraw,{once:!0}),window.addEventListener("message",(0,o.getFormReadyHandler)(d,g)),window.addEventListener("message",(0,o.getFormQuestionChangedHandler)(d,m)),window.addEventListener("message",(0,o.getFormHeightChangedHandler)(d,v)),window.addEventListener("message",(0,o.getFormSubmitHandler)(d,y)),window.addEventListener("message",(0,o.getFormThemeHandler)(d,(function(t){var e;if(null==t?void 0:t.theme){var n=document.querySelector(".tf-v1-close-icon");n&&(n.style.color=null===(e=t.theme)||void 0===e?void 0:e.color)}}))),window.addEventListener("message",(0,o.getThankYouScreenButtonClickHandler)(d,b)),"widget"!==t&&window.addEventListener("message",l.dispatchCustomKeyEventFromIframe),E&&window.addEventListener("message",(0,o.getFormReadyHandler)(d,(function(){(0,i.setupGaInstance)(S,d,E)}))),{iframe:S,embedId:d,refresh:function(){return(0,u.refreshIframe)(S)},focus:function(){var t;null===(t=S.contentWindow)||void 0===t||t.postMessage("embed-focus","*")}}}},8866:function(t,e){var n=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(e,"__esModule",{value:!0}),e.generateEmbedId=void 0,e.generateEmbedId=function(){var t=Math.random();return n(String(t).split("."),2)[1]}},8554:function(t,e){var n=this&&this.__rest||function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n};function r(t,e,r){return function(i){var s=i.data,o=s.type,a=s.embedId,l=n(s,["type","embedId"]);o===t&&a===e&&(null==r||r(l))}}Object.defineProperty(e,"__esModule",{value:!0}),e.getThankYouScreenButtonClickHandler=e.getFormThemeHandler=e.getWelcomeScreenHiddenHandler=e.getFormSubmitHandler=e.getFormHeightChangedHandler=e.getFormQuestionChangedHandler=e.getFormReadyHandler=void 0,e.getFormReadyHandler=function(t,e){return r("form-ready",t,e)},e.getFormQuestionChangedHandler=function(t,e){return r("form-screen-changed",t,e)},e.getFormHeightChangedHandler=function(t,e){return r("form-height-changed",t,e)},e.getFormSubmitHandler=function(t,e){return r("form-submit",t,e)},e.getWelcomeScreenHiddenHandler=function(t,e){return r("welcome-screen-hidden",t,e)},e.getFormThemeHandler=function(t,e){return r("form-theme",t,e)},e.getThankYouScreenButtonClickHandler=function(t,e){return r("thank-you-screen-button-click",t,e)}},339:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(1553),e),i(n(7144),e)},5511:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.refreshIframe=void 0,e.refreshIframe=function(t){if(t){var e=t.src;if(e.includes("&refresh")){var n=e.split("&refresh#");t.src=n.join("#")}else(n=e.split("#"))[0]="".concat(n[0],"&refresh"),t.src=n.join("#")}}},7144:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.dispatchCustomKeyEventFromIframe=e.removeCustomKeyboardListener=e.addCustomKeyboardListener=void 0;var i="Escape",s=function(t,s){return n(void 0,void 0,void 0,(function(){return r(this,(function(n){return t.code===i&&"function"==typeof s&&(s(),(0,e.removeCustomKeyboardListener)()),[2]}))}))};e.addCustomKeyboardListener=function(t){return window.document.addEventListener("keydown",(function(e){return s(e,t)}))},e.removeCustomKeyboardListener=function(){return window.document.removeEventListener("keydown",s)},e.dispatchCustomKeyEventFromIframe=function(t){"form-close"===t.data.type&&window.document.dispatchEvent(new KeyboardEvent("keydown",{code:i}))}},2256:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.triggerIframeRedraw=void 0,e.triggerIframeRedraw=function(){this.style.transform="translateZ(0)"}},8939:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.getTextColor=void 0;var r=n(2938);e.getTextColor=function(t){if(!t)return"#FFFFFF";var e=t.startsWith("#")?(0,r.hexRgb)(t):function(t){var e={red:0,green:0,blue:0},n=t.match(/\d+/g);return n&&(e.red=parseInt(n[0],10),e.green=parseInt(n[0],10),e.blue=parseInt(n[0],10)),e}(t),n=e.red,i=e.green,s=e.blue;return Math.round((299*n+587*i+114*s)/1e3)>150?"#000000":"#FFFFFF"}},2698:function(t,e){var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.getTransitiveSearchParams=void 0,e.getTransitiveSearchParams=function(t){var e=new URL(window.location.href);return"boolean"==typeof t&&t?Object.fromEntries(e.searchParams.entries()):Array.isArray(t)&&t.length>0?t.reduce((function(t,r){var i,s=e.searchParams.get(r);return s?n(n({},t),((i={})[r]=s,i)):t}),{}):{}}},8252:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.hasDom=void 0,e.hasDom=function(){return"undefined"!=typeof document&&"undefined"!=typeof window}},2938:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.hexRgb=void 0;var n="a-f\\d",r="#?[".concat(n,"]{3}[").concat(n,"]?"),i="#?[".concat(n,"]{6}([").concat(n,"]{2})?"),s=new RegExp("[^#".concat(n,"]"),"gi"),o=new RegExp("^".concat(r,"$|^").concat(i,"$"),"i");e.hexRgb=function(t){if("string"!=typeof t||s.test(t)||!o.test(t))throw new TypeError("Expected a valid hex string");8===(t=t.replace(/^#/,"")).length&&(t=t.slice(0,6)),4===t.length&&(t=t.slice(0,3)),3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var e=Number.parseInt(t,16);return{red:e>>16,green:e>>8&255,blue:255&e}}},863:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.waitForHubspotCookie=e.getHubspotHiddenFields=e.getHubspotCookieValue=void 0;var s=n(4623);e.getHubspotCookieValue=function(){var t=document.cookie.match(new RegExp("(^| )".concat("hubspotutk","=([^;]+)")));return t&&t[2]||void 0},e.getHubspotHiddenFields=function(){return{hubspot_page_name:document.title,hubspot_page_url:window.location.href,hubspot_utk:(0,e.getHubspotCookieValue)()}},e.waitForHubspotCookie=function(){return r(void 0,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:t=10,n=0,r.label=1;case 1:return!(0,e.getHubspotCookieValue)()&&n<t?[4,(0,s.sleep)(250)]:[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))}},9071:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.includeCss=void 0,e.includeCss=function(t){var e=function(t){return"".concat("https://embed.typeform.com/next/css/").concat(t)}(t);if(!document.querySelector('link[href="'.concat(e,'"]'))){var n=document.createElement("link");n.rel="stylesheet",n.href=e,document.head.append(n)}}},6797:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),i=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),i(n(3626),e),i(n(339),e),i(n(8252),e),i(n(9071),e),i(n(2346),e),i(n(7377),e),i(n(6563),e),i(n(4527),e),i(n(9533),e),i(n(1451),e),i(n(8972),e),i(n(4748),e),i(n(4392),e),i(n(8939),e),i(n(9917),e),i(n(1987),e),i(n(318),e),i(n(2391),e),i(n(863),e),i(n(6890),e)},6890:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.invokeWithoutDefault=void 0,e.invokeWithoutDefault=function(t){return function(e){null==e||e.preventDefault(),t()}}},2346:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isDefined=void 0,e.isDefined=function(t){return null!=t}},1987:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isVisible=e.isInPage=e.isOpen=void 0,e.isOpen=function(t){return(0,e.isInPage)(t)&&(0,e.isVisible)(t)},e.isInPage=function(t){return!!t.parentNode},e.isVisible=function(t){return"none"!==t.style.display}},9917:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.lazyInitialize=void 0,e.lazyInitialize=function(t,e){var n=new IntersectionObserver((function(t){t.forEach((function(t){t.isIntersecting&&(e(),n.unobserve(t.target))}))}));n.observe(t)}},7377:function(t,e){var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(e,"__esModule",{value:!0}),e.loadOptionsFromAttributes=e.transformAttributeValue=e.camelCaseToKebabCase=void 0,e.camelCaseToKebabCase=function(t){return t.split("").map((function(t,e){return t.toUpperCase()===t?"".concat(0!==e?"-":"").concat(t.toLowerCase()):t})).join("")};var i=function(t){return t||void 0},s=function(t){return""===t||"yes"===t||"true"===t},o=function(t){var e=t?parseInt(t,10):NaN;return isNaN(e)?void 0:e},a="%ESCAPED_COMMA%",l=function(t){if(t)return t.replace(/\s/g,"").replace(/\\,/g,a).split(",").filter((function(t){return!!t})).map((function(t){return t.replace(a,",")}))};e.transformAttributeValue=function(t,e){var u,c,h;switch(e){case"string":return i(t);case"boolean":return s(t);case"integer":return o(t);case"function":return function(t){var e=t&&t in window?window[t]:void 0;return"function"==typeof e?e:void 0}(t);case"array":return l(t);case"record":return function(t){if(t)return t.replace(/\\,/g,a).split(",").filter((function(t){return!!t})).map((function(t){return t.replace(a,",")})).reduce((function(t,e){var i,s=e.match(/^([^=]+)=(.*)$/);if(s){var o=r(s,3),a=o[1],l=o[2];return n(n({},t),((i={})[a.trim()]=l,i))}return t}),{})}(t);case"integerOrBoolean":return null!==(u=o(t))&&void 0!==u?u:s(t);case"stringOrBoolean":return null!==(c=i(t))&&void 0!==c?c:s(t);case"arrayOrBoolean":return null!==(h=l(t))&&void 0!==h?h:s(t);default:throw new Error("Invalid attribute transformation ".concat(e))}},e.loadOptionsFromAttributes=function(t,r){return Object.keys(r).reduce((function(i,s){var o;return n(n({},i),((o={})[s]=(0,e.transformAttributeValue)(t.getAttribute("data-tf-".concat((0,e.camelCaseToKebabCase)(s))),r[s]),o))}),{})}},318:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.makeAutoResize=void 0;var r=n(6563);e.makeAutoResize=function(t,e){return void 0===e&&(e=!1),function(){var n=e||(0,r.isMobile)();t&&n&&t.style.setProperty("height","".concat(window.innerHeight,"px"),"important")}}},6563:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isFullscreen=e.isMobile=e.isBigScreen=void 0,e.isBigScreen=function(){return window.screen.width>=1024&&window.screen.height>=768},e.isMobile=function(){return/mobile|tablet|android/i.test(navigator.userAgent.toLowerCase())},e.isFullscreen=function(){return(0,e.isMobile)()&&!(0,e.isBigScreen)()}},4527:function(t,e,n){var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o};Object.defineProperty(e,"__esModule",{value:!0}),e.removeUndefinedKeys=void 0;var s=n(2346);e.removeUndefinedKeys=function(t){return Object.entries(t).filter((function(t){var e=i(t,2)[1];return(0,s.isDefined)(e)})).reduce((function(t,e){var n,s=i(e,2),o=s[0],a=s[1];return r(r({},t),((n={})[o]=a,n))}),{})}},4748:function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0}),e.setAutoClose=void 0;var r=n(8554);e.setAutoClose=function(t,e,n){if(e&&n){var i="number"==typeof e?e:0;window.addEventListener("message",(0,r.getFormSubmitHandler)(t,(function(){return setTimeout(n,i)})))}}},9533:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.setElementSize=void 0,e.setElementSize=function(t,e){var n=e.width,r=e.height;return n&&(t.style.width="".concat(n,"px")),r&&(t.style.height="".concat(r,"px")),t}},4392:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.setupGaInstance=e.sendGaIdMessage=void 0,e.sendGaIdMessage=function(t,e,n){var r={embedId:t,gaClientId:e};setTimeout((function(){n&&n.contentWindow&&n.contentWindow.postMessage({type:"ga-client-id",data:r},"*")}),0)};var n=function(t){console.error(t)},r=function(t){n("Whoops! You enabled the shareGaInstance feature in your typeform embed but ".concat(t,".\n\n")+"Make sure to include Google Analytics Javascript code before the Typeform Embed Javascript code in your page and use correct tracker ID.\n\nIt is also possible the Google Analytics was blocked by your adblock plugin.")};e.setupGaInstance=function(t,i,s){var o="string"==typeof s?s:void 0;if(window.gtag){if(o||(o=function(){if(window.dataLayer){var t=window.dataLayer.find((function(t){return t.length>1&&"config"===t[0]}));return t&&t[1]}}()),!o)return void r("the tracking ID could not be retrieved");var a=!1;window.gtag("get",o,"client_id",(function(n){a=!0,(0,e.sendGaIdMessage)(i,n,t)})),setTimeout((function(){a||r("the tracker with ID ".concat(o," was not found"))}),3e3)}else try{var l=function(t,e){return e?t.find((function(t){return t.get("trackingId")===e})):t[0]}(window.ga.getAll(),o);l?(0,e.sendGaIdMessage)(i,l.get("clientId"),t):r("the tracker with ID ".concat(o," was not found"))}catch(t){r("the Google Analytics object was not found"),n(t)}}},4623:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.sleep=void 0,e.sleep=function(t){return new Promise((function(e){return setTimeout(e,t)}))}},1451:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.unmountElement=void 0,e.unmountElement=function(t){var e;null===(e=t.parentNode)||void 0===e||e.removeChild(t)}}},e={};return function n(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={exports:{}};return t[r].call(s.exports,s,s.exports,n),s.exports}(1920)}()},156:function(t){"use strict";t.exports=r}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={exports:{}};return t[r].call(s.exports,s,s.exports,n),s.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return function(){"use strict";var t=i;Object.defineProperty(t,"__esModule",{value:!0}),t.Sidetab=t.Popover=t.SliderButton=t.PopupButton=t.Widget=void 0;var e=n(611),r=n(281),s=n(797),o=(0,s.memoComponent)(r.Widget);t.Widget=o;var a=(0,s.memoComponent)((0,r.makeButtonComponent)(e.createPopup,"popup"));t.PopupButton=a;var l=(0,s.memoComponent)((0,r.makeButtonComponent)(e.createSlider,"slider"));t.SliderButton=l;var u=(0,s.memoComponent)((0,r.makeInitializerComponent)(e.createPopover,"popover"));t.Popover=u;var c=(0,s.memoComponent)((0,r.makeInitializerComponent)(e.createSidetab,"sidetab"));t.Sidetab=c}(),i}())},Jtpf:function(t,e,n){t.exports=function(){var t=[],e=[],n={},r={},i={};function s(t){return"string"==typeof t?new RegExp("^"+t+"$","i"):t}function o(t,e){return t===e?e:t===t.toLowerCase()?e.toLowerCase():t===t.toUpperCase()?e.toUpperCase():t[0]===t[0].toUpperCase()?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():e.toLowerCase()}function a(t,e){return t.replace(/\$(\d{1,2})/g,(function(t,n){return e[n]||""}))}function l(t,e){return t.replace(e[0],(function(n,r){var i=a(e[1],arguments);return o(""===n?t[r-1]:n,i)}))}function u(t,e,r){if(!t.length||n.hasOwnProperty(t))return e;for(var i=r.length;i--;){var s=r[i];if(s[0].test(e))return l(e,s)}return e}function c(t,e,n){return function(r){var i=r.toLowerCase();return e.hasOwnProperty(i)?o(r,i):t.hasOwnProperty(i)?o(r,t[i]):u(i,r,n)}}function h(t,e,n,r){return function(r){var i=r.toLowerCase();return!!e.hasOwnProperty(i)||!t.hasOwnProperty(i)&&u(i,i,n)===i}}function d(t,e,n){return(n?e+" ":"")+(1===e?d.singular(t):d.plural(t))}return d.plural=c(i,r,t),d.isPlural=h(i,r,t),d.singular=c(r,i,e),d.isSingular=h(r,i,e),d.addPluralRule=function(e,n){t.push([s(e),n])},d.addSingularRule=function(t,n){e.push([s(t),n])},d.addUncountableRule=function(t){"string"!=typeof t?(d.addPluralRule(t,"$0"),d.addSingularRule(t,"$0")):n[t.toLowerCase()]=!0},d.addIrregularRule=function(t,e){e=e.toLowerCase(),t=t.toLowerCase(),i[t]=e,r[e]=t},[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["is","are"],["was","were"],["has","have"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["looey","looies"],["thief","thieves"],["groove","grooves"],["pickaxe","pickaxes"],["passerby","passersby"]].forEach((function(t){return d.addIrregularRule(t[0],t[1])})),[[/s?$/i,"s"],[/[^\u0000-\u007F]$/i,"$0"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|t[lm]as|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[ejzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(kni|wi|li)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/\b((?:tit)?m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"],["thou","you"]].forEach((function(t){return d.addPluralRule(t[0],t[1])})),[[/s$/i,""],[/(ss)$/i,"$1"],[/(wi|kni|(?:after|half|high|low|mid|non|night|[^\w]|^)li)ves$/i,"$1fe"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/ies$/i,"y"],[/\b([pl]|zomb|(?:neck|cross)?t|coll|faer|food|gen|goon|group|lass|talk|goal|cut)ies$/i,"$1ie"],[/\b(mon|smil)ies$/i,"$1ey"],[/\b((?:tit)?m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|t[lm]as|gas|(?:her|at|gr)o|[aeiou]ris)(?:es)?$/i,"$1"],[/(analy|diagno|parenthe|progno|synop|the|empha|cri|ne)(?:sis|ses)$/i,"$1sis"],[/(movie|twelve|abuse|e[mn]u)s$/i,"$1"],[/(test)(?:is|es)$/i,"$1is"],[/(alumn|syllab|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|hedr|automat)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach((function(t){return d.addSingularRule(t[0],t[1])})),["adulthood","advice","agenda","aid","aircraft","alcohol","ammo","analytics","anime","athletics","audio","bison","blood","bream","buffalo","butter","carp","cash","chassis","chess","clothing","cod","commerce","cooperation","corps","debris","diabetes","digestion","elk","energy","equipment","excretion","expertise","firmware","flounder","fun","gallows","garbage","graffiti","hardware","headquarters","health","herpes","highjinks","homework","housework","information","jeans","justice","kudos","labour","literature","machinery","mackerel","mail","media","mews","moose","music","mud","manga","news","only","personnel","pike","plankton","pliers","police","pollution","premises","rain","research","rice","salmon","scissors","series","sewage","shambles","shrimp","software","species","staff","swine","tennis","traffic","transportation","trout","tuna","wealth","welfare","whiting","wildebeest","wildlife","you",/pok[e]mon$/i,/[^aeiou]ese$/i,/deer$/i,/fish$/i,/measles$/i,/o[iu]s$/i,/pox$/i,/sheep$/i].forEach(d.addUncountableRule),d}()},Kmig:function(t,e,n){"use strict";n.d(e,"a",(function(){return Lt})),n.d(e,"b",(function(){return _t}));var r=n("gbB/"),i=n.n(r),s=function(t,e){return Number(t.toFixed(e))},o=function(t,e){return"number"==typeof t?t:e},a=function(t,e,n){n&&"function"==typeof n&&n(t,e)},l={easeOut:function(t){return-Math.cos(t*Math.PI)/2+.5},linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}},u=function(t){"number"==typeof t&&cancelAnimationFrame(t)},c=function(t){t.mounted&&(u(t.animation),t.animate=!1,t.animation=null,t.velocity=null)};function h(t,e,n,r){if(t.mounted){var i=(new Date).getTime();c(t),t.animation=function(){if(!t.mounted)return u(t.animation);var s=(new Date).getTime()-i,o=s/n,a=(0,l[e])(o);s>=n?(r(1),t.animation=null):t.animation&&(r(a),requestAnimationFrame(t.animation))},requestAnimationFrame(t.animation)}}function d(t,e,n,r){var i=function(t){var e=t.scale,n=t.positionX,r=t.positionY;return!(Number.isNaN(e)||Number.isNaN(n)||Number.isNaN(r))}(e);if(t.mounted&&i){var s=t.setTransformState,o=t.transformState,a=o.scale,l=o.positionX,u=o.positionY,c=e.scale-a,d=e.positionX-l,f=e.positionY-u;0===n?s(e.scale,e.positionX,e.positionY):h(t,r,n,(function(t){s(a+c*t,l+d*t,u+f*t)}))}}var f=function(t,e){var n=t.wrapperComponent,r=t.contentComponent,i=t.setup.centerZoomedOut;if(!n||!r)throw new Error("Components are not mounted");var s=function(t,e,n){var r=t.offsetWidth,i=t.offsetHeight,s=e.offsetWidth*n,o=e.offsetHeight*n;return{wrapperWidth:r,wrapperHeight:i,newContentWidth:s,newDiffWidth:r-s,newContentHeight:o,newDiffHeight:i-o}}(n,r,e),o=s.wrapperWidth,a=s.wrapperHeight;return function(t,e,n,r,i,s,o){var a=t>e?n*(o?1:.5):0,l=r>i?s*(o?1:.5):0;return{minPositionX:t-e-a,maxPositionX:a,minPositionY:r-i-l,maxPositionY:l}}(o,s.newContentWidth,s.newDiffWidth,a,s.newContentHeight,s.newDiffHeight,Boolean(i))},p=function(t,e,n,r){return s(r?t<e?e:t>n?n:t:t,2)},g=function(t,e){var n=f(t,e);return t.bounds=n,n};function m(t,e,n,r,i,s,o){var a=n.minPositionX,l=n.minPositionY,u=n.maxPositionX,c=n.maxPositionY,h=0,d=0;return o&&(h=i,d=s),{x:p(t,a-h,u+h,r),y:p(e,l-d,c+d,r)}}function v(t,e,n,r,i,s){var o=t.transformState,a=o.scale,l=o.positionX,u=o.positionY,c=r-a;return"number"!=typeof e||"number"!=typeof n?(console.error("Mouse X and Y position were not provided!"),{x:l,y:u}):m(l-e*c,u-n*c,i,s,0,0,null)}function y(t,e,n,r,i){var s=e-(i?r:0);return!Number.isNaN(n)&&t>=n?n:!Number.isNaN(e)&&t<=s?s:t}var b=function(t,e){var n=t.setup.panning.excluded,r=t.isInitialized,i=t.wrapperComponent,s=e.target,o=null==i?void 0:i.contains(s);return!!(r&&s&&o)&&!nt(s,n)},E=function(t){var e=t.isInitialized,n=t.isPanning,r=t.setup.panning.disabled;return!(!e||!n||r)},T=function(t,e){var n=t.transformState,r=n.positionX,i=n.positionY;t.isPanning=!0;var s=e.clientX,o=e.clientY;t.startCoords={x:s-r,y:o-i}},S=function(t,e){var n=e.touches,r=t.transformState,i=r.positionX,s=r.positionY;if(t.isPanning=!0,1===n.length){var o=n[0].clientX,a=n[0].clientY;t.startCoords={x:o-i,y:a-s}}};var _=function(t,e,n){var r=t.startCoords,i=t.transformState,s=t.setup.panning,o=s.lockAxisX,a=s.lockAxisY,l=i.positionX,u=i.positionY;if(!r)return{x:l,y:u};var c=e-r.x,h=n-r.y;return{x:o?l:c,y:a?u:h}},w=function(t,e){var n=t.setup,r=t.transformState.scale,i=n.minScale,s=n.disablePadding;return e>0&&r>=i&&!s?e:0},A=function(t){var e=t.mounted,n=t.setup,r=n.disabled,i=n.velocityAnimation,s=t.transformState.scale;return!(i.disabled&&!(s>1)&&r&&!e)},L=function(t){var e=t.mounted,n=t.velocity,r=t.bounds,i=t.setup,s=i.disabled,o=i.velocityAnimation,a=t.transformState.scale;return!(o.disabled&&!(a>1)&&s&&!e)&&!(!n||!r)};function R(t,e,n,r,i,s,o,a,l,u){if(i){var c;if(e>o&&n>o)return(c=o+(t-o)*u)>l?l:c<o?o:c;if(e<s&&n<s)return(c=s+(t-s)*u)<a?a:c>s?s:c}return r?e:p(t,s,o,i)}function I(t,e){if(A(t)){var n=t.lastMousePosition,r=t.velocityTime,i=t.setup,s=t.wrapperComponent,o=i.velocityAnimation.equalToMove,a=Date.now();if(n&&r&&s){var l=function(t,e){return e?Math.min(1,t.offsetWidth/window.innerWidth):1}(s,o),u=e.x-n.x,c=e.y-n.y,h=u/l,d=c/l,f=a-r,p=u*u+c*c,g=Math.sqrt(p)/f;t.velocity={velocityX:h,velocityY:d,total:g}}t.lastMousePosition=e,t.velocityTime=a}}function D(t,e){var n=t.transformState.scale;c(t),g(t,n),void 0!==window.TouchEvent&&e instanceof TouchEvent?S(t,e):T(t,e)}function x(t){var e=t.transformState.scale,n=t.setup,r=n.minScale,i=n.alignmentAnimation,s=i.disabled,o=i.sizeX,a=i.sizeY,l=i.animationTime,u=i.animationType;if(!(s||e<r||!o&&!a)){var c=function(t){var e=t.transformState,n=e.positionX,r=e.positionY,i=e.scale,s=t.setup,o=s.disabled,a=s.limitToBounds,l=s.centerZoomedOut,u=t.wrapperComponent;if(!o&&u&&t.bounds){var c=t.bounds,h=c.maxPositionX,d=c.minPositionX,f=c.maxPositionY,p=c.minPositionY,g=n>h||n<d,m=r>f||r<p,y=v(t,n>h?u.offsetWidth:t.setup.minPositionX||0,r>f?u.offsetHeight:t.setup.minPositionY||0,i,t.bounds,a||l),b=y.x,E=y.y;return{scale:i,positionX:g?b:n,positionY:m?E:r}}}(t);c&&d(t,c,l,u)}}function k(t,e,n){var r=t.startCoords,i=t.setup.alignmentAnimation,s=i.sizeX,o=i.sizeY;if(r){var a=_(t,e,n),l=a.x,u=a.y,c=w(t,s),h=w(t,o);I(t,{x:l,y:u}),function(t,e,n,r,i){var s=t.setup.limitToBounds,o=t.wrapperComponent,a=t.bounds,l=t.transformState,u=l.scale,c=l.positionX,h=l.positionY;if(null!==o&&null!==a&&(e!==c||n!==h)){var d=m(e,n,a,s,r,i,o),f=d.x,p=d.y;t.setTransformState(u,f,p)}}(t,l,u,c,h)}}function O(t){if(t.isPanning){var e=t.setup.panning.velocityDisabled,n=t.velocity,r=t.wrapperComponent,i=t.contentComponent;t.isPanning=!1,t.animate=!1,t.animation=null;var s=null==r?void 0:r.getBoundingClientRect(),o=null==i?void 0:i.getBoundingClientRect(),a=(null==s?void 0:s.width)||0,u=(null==s?void 0:s.height)||0,c=(null==o?void 0:o.width)||0,d=(null==o?void 0:o.height)||0,f=a<c||u<d;!e&&n&&(null==n?void 0:n.total)>.1&&f?function(t){var e=t.velocity,n=t.bounds,r=t.setup,i=t.wrapperComponent;if(L(t)&&e&&n&&i){var s=e.velocityX,o=e.velocityY,a=e.total,u=n.maxPositionX,c=n.minPositionX,d=n.maxPositionY,f=n.minPositionY,p=r.limitToBounds,g=r.alignmentAnimation,m=r.zoomAnimation,v=r.panning,y=v.lockAxisY,b=v.lockAxisX,E=m.animationType,T=g.sizeX,S=g.sizeY,_=g.velocityAlignmentTime,A=function(t,e){var n=t.setup.velocityAnimation,r=n.equalToMove,i=n.animationTime,s=n.sensitivity;return r?i*e*s:i}(t,a),I=Math.max(A,_),D=w(t,T),x=w(t,S),k=D*i.offsetWidth/100,O=x*i.offsetHeight/100,C=u+k,P=c-k,M=d+O,F=f-O,N=t.transformState,U=(new Date).getTime();h(t,E,I,(function(e){var n=t.transformState,r=n.scale,i=n.positionX,a=n.positionY,h=((new Date).getTime()-U)/_,m=1-(0,l[g.animationType])(Math.min(1,h)),v=1-e,E=i+s*v,T=a+o*v,S=R(E,N.positionX,i,b,p,c,u,P,C,m),w=R(T,N.positionY,a,y,p,f,d,F,M,m);i===E&&a===T||t.setTransformState(r,S,w)}))}}(t):x(t)}}function C(t,e,n,r){var i=t.setup,o=i.minScale,a=i.maxScale,l=i.limitToBounds,u=y(s(e,2),o,a,0,!1),c=v(t,n,r,u,g(t,u),l);return{scale:u,positionX:c.x,positionY:c.y}}function P(t,e,n){var r=t.transformState.scale,i=t.wrapperComponent,s=t.setup,o=s.minScale,a=s.limitToBounds,l=s.zoomAnimation,u=l.disabled,c=l.animationTime,h=l.animationType,f=u||r>=o;if((r>=1||a)&&x(t),!f&&i&&t.mounted){var p=C(t,o,e||i.offsetWidth/2,n||i.offsetHeight/2);p&&d(t,p,c,h)}}var M=function(){return(M=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function F(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}var N=1,U=0,B=0,$={disabled:!1,minPositionX:null,maxPositionX:null,minPositionY:null,maxPositionY:null,minScale:1,maxScale:8,limitToBounds:!0,centerZoomedOut:!1,centerOnInit:!1,disablePadding:!1,smooth:!0,wheel:{step:.2,disabled:!1,smoothStep:.001,wheelDisabled:!1,touchPadDisabled:!1,activationKeys:[],excluded:[]},panning:{disabled:!1,velocityDisabled:!1,lockAxisX:!1,lockAxisY:!1,activationKeys:[],excluded:[]},pinch:{step:5,disabled:!1,excluded:[]},doubleClick:{disabled:!1,step:.7,mode:"zoomIn",animationType:"easeOut",animationTime:200,excluded:[]},zoomAnimation:{disabled:!1,size:.4,animationTime:200,animationType:"easeOut"},alignmentAnimation:{disabled:!1,sizeX:100,sizeY:100,animationTime:200,velocityAlignmentTime:400,animationType:"easeOut"},velocityAnimation:{disabled:!1,sensitivity:1,animationTime:400,animationType:"easeOut",equalToMove:!0}},j=function(t){var e,n,r,i;return{previousScale:null!==(e=t.initialScale)&&void 0!==e?e:N,scale:null!==(n=t.initialScale)&&void 0!==n?n:N,positionX:null!==(r=t.initialPositionX)&&void 0!==r?r:U,positionY:null!==(i=t.initialPositionY)&&void 0!==i?i:B}},G=function(t){var e=M({},$);return Object.keys(t).forEach((function(n){var r=void 0!==t[n];if(void 0!==$[n]&&r){var i=Object.prototype.toString.call($[n]),s="[object Object]"===i,o="[object Array]"===i;e[n]=s?M(M({},$[n]),t[n]):o?F(F([],$[n],!0),t[n],!0):t[n]}})),e},K=function(t,e,n){var r=t.transformState.scale,i=t.wrapperComponent,o=t.setup,a=o.maxScale,l=o.minScale,u=o.zoomAnimation,c=o.smooth,h=u.size;if(!i)throw new Error("Wrapper is not mounted");var d=c?r*Math.exp(e*n):r+e*n;return y(s(d,3),l,a,h,!1)};function V(t,e,n,r,i){var s=t.wrapperComponent,o=t.transformState,a=o.scale,l=o.positionX,u=o.positionY;if(!s)return console.error("No WrapperComponent found");var c=(s.offsetWidth/2-l)/a,h=(s.offsetHeight/2-u)/a,f=C(t,K(t,e,n),c,h);if(!f)return console.error("Error during zoom event. New transformation state was not calculated.");d(t,f,r,i)}function H(t,e,n,r){var i=t.setup,s=t.wrapperComponent,o=i.limitToBounds,a=j(t.props),l=t.transformState,u=l.scale,c=l.positionX,h=l.positionY;if(s){var p=f(t,a.scale),g=m(a.positionX,a.positionY,p,o,0,0,s),v={scale:a.scale,positionX:g.x,positionY:g.y};u===a.scale&&c===a.positionX&&h===a.positionY||(null==r||r(),d(t,v,e,n))}}var W=function(t){return function(e,n,r){void 0===e&&(e=.5),void 0===n&&(n=300),void 0===r&&(r="easeOut"),V(t,1,e,n,r)}},Y=function(t){return function(e,n,r){void 0===e&&(e=.5),void 0===n&&(n=300),void 0===r&&(r="easeOut"),V(t,-1,e,n,r)}},z=function(t){return function(e,n,r,i,s){void 0===i&&(i=300),void 0===s&&(s="easeOut");var o=t.transformState,a=o.positionX,l=o.positionY,u=o.scale,c=t.wrapperComponent,h=t.contentComponent;if(!t.setup.disabled&&c&&h){var f={positionX:Number.isNaN(e)?a:e,positionY:Number.isNaN(n)?l:n,scale:Number.isNaN(r)?u:r};d(t,f,i,s)}}},q=function(t){return function(e,n){void 0===e&&(e=200),void 0===n&&(n="easeOut"),H(t,e,n)}},X=function(t){return function(e,n,r){void 0===n&&(n=200),void 0===r&&(r="easeOut");var i=t.transformState,s=t.wrapperComponent,o=t.contentComponent;if(s&&o){var a=st(e||i.scale,s,o);d(t,a,n,r)}}},Q=function(t){return function(e,n,r,i){void 0===r&&(r=600),void 0===i&&(i="easeOut"),c(t);var s=t.wrapperComponent,o="string"==typeof e?document.getElementById(e):e;if(s&&o&&s.contains(o)){var a=function(t,e,n){var r=t.wrapperComponent,i=t.contentComponent,s=t.transformState,o=t.setup,a=o.limitToBounds,l=o.minScale,u=o.maxScale;if(!r||!i)return s;var c,h,d,p,g,v,b,E,T=r.getBoundingClientRect(),S=e.getBoundingClientRect(),_=(c=r,h=i,d=s,p=e.getBoundingClientRect(),g=c.getBoundingClientRect(),v=h.getBoundingClientRect(),b=g.x*d.scale,E=g.y*d.scale,{x:(p.x-v.x+b)/d.scale,y:(p.y-v.y+E)/d.scale}),w=_.x,A=_.y,L=S.width/s.scale,R=S.height/s.scale,I=r.offsetWidth/L,D=r.offsetHeight/R,x=y(n||Math.min(I,D),l,u,0,!1),k=(T.width-L*x)/2,O=(T.height-R*x)/2,C=m((T.left-w)*x+k,(T.top-A)*x+O,f(t,x),a,0,0,r);return{positionX:C.x,positionY:C.y,scale:x}}(t,o,n);d(t,a,r,i)}}},Z=function(t){return{instance:t,zoomIn:W(t),zoomOut:Y(t),setTransform:z(t),resetTransform:q(t),centerView:X(t),zoomToElement:Q(t)}},J=function(t){return{instance:t,state:t.transformState}},tt=function(t){var e={};return Object.assign(e,J(t)),Object.assign(e,Z(t)),e};function et(){try{return{get passive(){return!0,!1}}}catch(t){return!1}}var nt=function(t,e){var n=t.tagName.toUpperCase();return!!e.find((function(t){return t.toUpperCase()===n}))||!!e.find((function(e){return t.classList.contains(e)}))},rt=function(t){t&&clearTimeout(t)},it=function(t,e,n){return"translate(".concat(t,"px, ").concat(e,"px) scale(").concat(n,")")},st=function(t,e,n){var r=n.offsetWidth*t,i=n.offsetHeight*t;return{scale:t,positionX:(e.offsetWidth-r)/2,positionY:(e.offsetHeight-i)/2}};var ot=function(t,e){var n=t.setup.wheel,r=n.disabled,i=n.wheelDisabled,s=n.touchPadDisabled,o=n.excluded,a=t.isInitialized,l=t.isPanning,u=e.target;return!(!a||l||r||!u)&&(!(i&&!e.ctrlKey)&&((!s||!e.ctrlKey)&&!nt(u,o)))},at=function(t){return t?t.deltaY<0?1:-1:0};function lt(t,e,n){var r=e.getBoundingClientRect(),i=0,s=0;if("clientX"in t)i=(t.clientX-r.left)/n,s=(t.clientY-r.top)/n;else{var o=t.touches[0];i=(o.clientX-r.left)/n,s=(o.clientY-r.top)/n}return(Number.isNaN(i)||Number.isNaN(s))&&console.error("No mouse or touch offset found"),{x:i,y:s}}var ut=function(t,e){var n=t.setup.pinch,r=n.disabled,i=n.excluded,s=t.isInitialized,o=e.target;return!(!s||r||!o)&&!nt(o,i)},ct=function(t){var e=t.setup.pinch.disabled,n=t.isInitialized,r=t.pinchStartDistance;return!(!n||e||!r)},ht=function(t){return Math.sqrt(Math.pow(t.touches[0].pageX-t.touches[1].pageX,2)+Math.pow(t.touches[0].pageY-t.touches[1].pageY,2))},dt=function(t,e){var n=t.props,r=n.onWheelStart,i=n.onZoomStart;t.wheelStopEventTimer||(c(t),a(tt(t),e,r),a(tt(t),e,i))},ft=function(t,e){var n=t.props,r=n.onWheel,i=n.onZoom,l=t.contentComponent,u=t.setup,c=t.transformState.scale,h=u.limitToBounds,d=u.centerZoomedOut,f=u.zoomAnimation,p=u.wheel,m=u.disablePadding,b=u.smooth,E=f.size,T=f.disabled,S=p.step,_=p.smoothStep;if(!l)throw new Error("Component not mounted");e.preventDefault(),e.stopPropagation();var w=function(t,e,n,r,i){var o=t.transformState.scale,a=t.wrapperComponent,l=t.setup,u=l.maxScale,c=l.minScale,h=l.zoomAnimation,d=l.disablePadding,f=h.size,p=h.disabled;if(!a)throw new Error("Wrapper is not mounted");var g=o+e*n;if(i)return g;var m=!r&&!p;return y(s(g,3),c,u,f,m&&!d)}(t,function(t,e){var n=at(t);return o(e,n)}(e,null),b?_*Math.abs(e.deltaY):S,!e.ctrlKey);if(c!==w){var A=g(t,w),L=lt(e,l,c),R=h&&(T||0===E||d||m),I=v(t,L.x,L.y,w,A,R),D=I.x,x=I.y;t.previousWheelEvent=e,t.setTransformState(w,D,x),a(tt(t),e,r),a(tt(t),e,i)}},pt=function(t,e){var n=t.props,r=n.onWheelStop,i=n.onZoomStop;rt(t.wheelAnimationTimer),t.wheelAnimationTimer=setTimeout((function(){t.mounted&&(P(t,e.x,e.y),t.wheelAnimationTimer=null)}),100),function(t,e){var n=t.previousWheelEvent,r=t.transformState.scale,i=t.setup,s=i.maxScale,o=i.minScale;return!!n&&(r<s||r>o||(Math.sign(n.deltaY)!==Math.sign(e.deltaY)||(n.deltaY>0&&n.deltaY<e.deltaY||(n.deltaY<0&&n.deltaY>e.deltaY||Math.sign(n.deltaY)!==Math.sign(e.deltaY)))))}(t,e)&&(rt(t.wheelStopEventTimer),t.wheelStopEventTimer=setTimeout((function(){t.mounted&&(t.wheelStopEventTimer=null,a(tt(t),e,r),a(tt(t),e,i))}),160))},gt=function(t,e){var n=ht(e);t.pinchStartDistance=n,t.lastDistance=n,t.pinchStartScale=t.transformState.scale,t.isPanning=!1,c(t)},mt=function(t,e){var n=t.contentComponent,r=t.pinchStartDistance,i=t.transformState.scale,o=t.setup,a=o.limitToBounds,l=o.centerZoomedOut,u=o.zoomAnimation,c=u.disabled,h=u.size;if(null!==r&&n){var d=function(t,e,n){var r=n.getBoundingClientRect(),i=t.touches,o=s(i[0].clientX-r.left,5),a=s(i[0].clientY-r.top,5);return{x:(o+s(i[1].clientX-r.left,5))/2/e,y:(a+s(i[1].clientY-r.top,5))/2/e}}(e,i,n);if(Number.isFinite(d.x)&&Number.isFinite(d.y)){var f=ht(e),p=function(t,e){var n=t.pinchStartScale,r=t.pinchStartDistance,i=t.setup,o=i.maxScale,a=i.minScale,l=i.zoomAnimation,u=i.disablePadding,c=l.size,h=l.disabled;if(!n||null===r||!e)throw new Error("Pinch touches distance was not provided");return e<0?t.transformState.scale:y(s(e/r*n,2),a,o,c,!h&&!u)}(t,f);if(p!==i){var m=g(t,p),b=a&&(c||0===h||l),E=v(t,d.x,d.y,p,m,b),T=E.x,S=E.y;t.pinchMidpoint=d,t.lastDistance=f,t.setTransformState(p,T,S)}}}},vt=function(t){var e=t.pinchMidpoint;t.velocity=null,t.lastDistance=null,t.pinchMidpoint=null,t.pinchStartScale=null,t.pinchStartDistance=null,P(t,null==e?void 0:e.x,null==e?void 0:e.y)},yt=function(t,e){var n=t.props.onZoomStop,r=t.setup.doubleClick.animationTime;rt(t.doubleClickStopEventTimer),t.doubleClickStopEventTimer=setTimeout((function(){t.doubleClickStopEventTimer=null,a(tt(t),e,n)}),r)},bt=function(t,e){var n=t.props,r=n.onZoomStart,i=n.onZoom,s=t.setup.doubleClick,o=s.animationTime,l=s.animationType;a(tt(t),e,r),H(t,o,l,(function(){return a(tt(t),e,i)})),yt(t,e)};var Et=function(t,e){var n=t.isInitialized,r=t.setup,i=t.wrapperComponent,s=r.doubleClick,o=s.disabled,a=s.excluded,l=e.target,u=null==i?void 0:i.contains(l);return!(!(n&&l&&u)||o)&&!nt(l,a)},Tt=function(t){var e=this;this.mounted=!0,this.onChangeCallbacks=new Set,this.onInitCallbacks=new Set,this.wrapperComponent=null,this.contentComponent=null,this.isInitialized=!1,this.bounds=null,this.previousWheelEvent=null,this.wheelStopEventTimer=null,this.wheelAnimationTimer=null,this.isPanning=!1,this.startCoords=null,this.lastTouch=null,this.distance=null,this.lastDistance=null,this.pinchStartDistance=null,this.pinchStartScale=null,this.pinchMidpoint=null,this.doubleClickStopEventTimer=null,this.velocity=null,this.velocityTime=null,this.lastMousePosition=null,this.animate=!1,this.animation=null,this.maxBounds=null,this.pressedKeys={},this.mount=function(){e.initializeWindowEvents()},this.unmount=function(){e.cleanupWindowEvents()},this.update=function(t){g(e,e.transformState.scale),e.setup=G(t)},this.initializeWindowEvents=function(){var t,n=et(),r=null===(t=e.wrapperComponent)||void 0===t?void 0:t.ownerDocument,i=null==r?void 0:r.defaultView;null==i||i.addEventListener("mousedown",e.onPanningStart,n),null==i||i.addEventListener("mousemove",e.onPanning,n),null==i||i.addEventListener("mouseup",e.onPanningStop,n),null==r||r.addEventListener("mouseleave",e.clearPanning,n),null==i||i.addEventListener("keyup",e.setKeyUnPressed,n),null==i||i.addEventListener("keydown",e.setKeyPressed,n)},this.cleanupWindowEvents=function(){var t,n,r=et(),i=null===(t=e.wrapperComponent)||void 0===t?void 0:t.ownerDocument,s=null==i?void 0:i.defaultView;null==s||s.removeEventListener("mousedown",e.onPanningStart,r),null==s||s.removeEventListener("mousemove",e.onPanning,r),null==s||s.removeEventListener("mouseup",e.onPanningStop,r),null==i||i.removeEventListener("mouseleave",e.clearPanning,r),null==s||s.removeEventListener("keyup",e.setKeyUnPressed,r),null==s||s.removeEventListener("keydown",e.setKeyPressed,r),document.removeEventListener("mouseleave",e.clearPanning,r),c(e),null===(n=e.observer)||void 0===n||n.disconnect()},this.handleInitializeWrapperEvents=function(t){var n=et();t.addEventListener("wheel",e.onWheelZoom,n),t.addEventListener("dblclick",e.onDoubleClick,n),t.addEventListener("touchstart",e.onTouchPanningStart,n),t.addEventListener("touchmove",e.onTouchPanning,n),t.addEventListener("touchend",e.onTouchPanningStop,n)},this.handleInitialize=function(t){var n=e.setup.centerOnInit;e.applyTransformation(),e.onInitCallbacks.forEach((function(t){return t(tt(e))})),n&&(e.setCenter(),e.observer=new ResizeObserver((function(){var t;e.onInitCallbacks.forEach((function(t){return t(tt(e))})),e.setCenter(),null===(t=e.observer)||void 0===t||t.disconnect()})),e.observer.observe(t))},this.onWheelZoom=function(t){e.setup.disabled||ot(e,t)&&e.isPressingKeys(e.setup.wheel.activationKeys)&&(dt(e,t),ft(e,t),pt(e,t))},this.onPanningStart=function(t){var n=e.setup.disabled,r=e.props.onPanningStart;n||b(e,t)&&e.isPressingKeys(e.setup.panning.activationKeys)&&(t.preventDefault(),t.stopPropagation(),c(e),D(e,t),a(tt(e),t,r))},this.onPanning=function(t){var n=e.setup.disabled,r=e.props.onPanning;n||E(e)&&e.isPressingKeys(e.setup.panning.activationKeys)&&(t.preventDefault(),t.stopPropagation(),k(e,t.clientX,t.clientY),a(tt(e),t,r))},this.onPanningStop=function(t){var n=e.props.onPanningStop;e.isPanning&&(O(e),a(tt(e),t,n))},this.onPinchStart=function(t){var n=e.setup.disabled,r=e.props,i=r.onPinchingStart,s=r.onZoomStart;n||ut(e,t)&&(gt(e,t),c(e),a(tt(e),t,i),a(tt(e),t,s))},this.onPinch=function(t){var n=e.setup.disabled,r=e.props,i=r.onPinching,s=r.onZoom;n||ct(e)&&(t.preventDefault(),t.stopPropagation(),mt(e,t),a(tt(e),t,i),a(tt(e),t,s))},this.onPinchStop=function(t){var n=e.props,r=n.onPinchingStop,i=n.onZoomStop;e.pinchStartScale&&(vt(e),a(tt(e),t,r),a(tt(e),t,i))},this.onTouchPanningStart=function(t){var n=e.setup.disabled,r=e.props.onPanningStart;if(!n&&b(e,t))if(e.lastTouch&&+new Date-e.lastTouch<200&&1===t.touches.length)e.onDoubleClick(t);else{e.lastTouch=+new Date,c(e);var i=t.touches,s=1===i.length,o=2===i.length;s&&(c(e),D(e,t),a(tt(e),t,r)),o&&e.onPinchStart(t)}},this.onTouchPanning=function(t){var n=e.setup.disabled,r=e.props.onPanning;if(e.isPanning&&1===t.touches.length){if(n)return;if(!E(e))return;t.preventDefault(),t.stopPropagation();var i=t.touches[0];k(e,i.clientX,i.clientY),a(tt(e),t,r)}else t.touches.length>1&&e.onPinch(t)},this.onTouchPanningStop=function(t){e.onPanningStop(t),e.onPinchStop(t)},this.onDoubleClick=function(t){e.setup.disabled||Et(e,t)&&function(t,e){var n=t.setup,r=t.doubleClickStopEventTimer,i=t.transformState,s=t.contentComponent,o=i.scale,l=t.props,u=l.onZoomStart,c=l.onZoom,h=n.doubleClick,f=h.disabled,p=h.mode,g=h.step,m=h.animationTime,v=h.animationType;if(!f&&!r){if("reset"===p)return bt(t,e);if(!s)return console.error("No ContentComponent found");var y=K(t,"zoomOut"===p?-1:1,g);if(o!==y){a(tt(t),e,u);var b=lt(e,s,o),E=C(t,y,b.x,b.y);if(!E)return console.error("Error during zoom event. New transformation state was not calculated.");a(tt(t),e,c),d(t,E,m,v),yt(t,e)}}}(e,t)},this.clearPanning=function(t){e.isPanning&&e.onPanningStop(t)},this.setKeyPressed=function(t){e.pressedKeys[t.key]=!0},this.setKeyUnPressed=function(t){e.pressedKeys[t.key]=!1},this.isPressingKeys=function(t){return!t.length||Boolean(t.find((function(t){return e.pressedKeys[t]})))},this.setTransformState=function(t,n,r){var i=e.props.onTransformed;if(Number.isNaN(t)||Number.isNaN(n)||Number.isNaN(r))console.error("Detected NaN set state values");else{t!==e.transformState.scale&&(e.transformState.previousScale=e.transformState.scale,e.transformState.scale=t),e.transformState.positionX=n,e.transformState.positionY=r,e.applyTransformation();var s=tt(e);e.onChangeCallbacks.forEach((function(t){return t(s)})),a(s,{scale:t,positionX:n,positionY:r},i)}},this.setCenter=function(){if(e.wrapperComponent&&e.contentComponent){var t=st(e.transformState.scale,e.wrapperComponent,e.contentComponent);e.setTransformState(t.scale,t.positionX,t.positionY)}},this.handleTransformStyles=function(t,n,r){return e.props.customTransform?e.props.customTransform(t,n,r):it(t,n,r)},this.applyTransformation=function(){if(e.mounted&&e.contentComponent){var t=e.transformState,n=t.scale,r=t.positionX,i=t.positionY,s=e.handleTransformStyles(r,i,n);e.contentComponent.style.transform=s}},this.getContext=function(){return tt(e)},this.onChange=function(t){return e.onChangeCallbacks.has(t)||e.onChangeCallbacks.add(t),function(){e.onChangeCallbacks.delete(t)}},this.onInit=function(t){return e.onInitCallbacks.has(t)||e.onInitCallbacks.add(t),function(){e.onInitCallbacks.delete(t)}},this.init=function(t,n){e.cleanupWindowEvents(),e.wrapperComponent=t,e.contentComponent=n,g(e,e.transformState.scale),e.handleInitializeWrapperEvents(t),e.handleInitialize(n),e.initializeWindowEvents(),e.isInitialized=!0;var r=tt(e);a(r,void 0,e.props.onInit)},this.props=t,this.setup=G(this.props),this.transformState=j(this.props)},St=i.a.createContext(null),_t=i.a.forwardRef((function(t,e){var n,s,o=Object(r.useRef)(new Tt(t)).current,a=(n=t.children,s=Z(o),"function"==typeof n?n(s):n);return Object(r.useImperativeHandle)(e,(function(){return Z(o)}),[o]),Object(r.useEffect)((function(){o.update(t)}),[o,t]),i.a.createElement(St.Provider,{value:o},a)}));i.a.forwardRef((function(t,e){var n,s=Object(r.useRef)(null),o=Object(r.useContext)(St);return Object(r.useEffect)((function(){return o.onChange((function(t){if(s.current){s.current.style.transform=o.handleTransformStyles(0,0,1/t.instance.transformState.scale)}}))}),[o]),i.a.createElement("div",M({},t,{ref:(n=[s,e],function(t){n.forEach((function(e){"function"==typeof e?e(t):null!=e&&(e.current=t)}))})}))}));var wt="transform-component-module_wrapper__SPB86",At="transform-component-module_content__FBWxo";!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(".transform-component-module_wrapper__SPB86 {\n  position: relative;\n  width: -moz-fit-content;\n  width: fit-content;\n  height: -moz-fit-content;\n  height: fit-content;\n  overflow: hidden;\n  -webkit-touch-callout: none; /* iOS Safari */\n  -webkit-user-select: none; /* Safari */\n  -khtml-user-select: none; /* Konqueror HTML */\n  -moz-user-select: none; /* Firefox */\n  -ms-user-select: none; /* Internet Explorer/Edge */\n  user-select: none;\n  margin: 0;\n  padding: 0;\n}\n.transform-component-module_content__FBWxo {\n  display: flex;\n  flex-wrap: wrap;\n  width: -moz-fit-content;\n  width: fit-content;\n  height: -moz-fit-content;\n  height: fit-content;\n  margin: 0;\n  padding: 0;\n  transform-origin: 0% 0%;\n}\n.transform-component-module_content__FBWxo img {\n  pointer-events: none;\n}\n");var Lt=function(t){var e=t.children,n=t.wrapperClass,s=void 0===n?"":n,o=t.contentClass,a=void 0===o?"":o,l=t.wrapperStyle,u=t.contentStyle,c=t.wrapperProps,h=void 0===c?{}:c,d=t.contentProps,f=void 0===d?{}:d,p=Object(r.useContext)(St).init,g=Object(r.useRef)(null),m=Object(r.useRef)(null);return Object(r.useEffect)((function(){var t=g.current,e=m.current;null!==t&&null!==e&&p&&p(t,e)}),[]),i.a.createElement("div",M({},h,{ref:g,className:"react-transform-wrapper ".concat(wt," ").concat(s),style:l}),i.a.createElement("div",M({},f,{ref:m,className:"react-transform-component ".concat(At," ").concat(a),style:u}),e))}},KwXd:function(t,e,n){var r=n("//Dc");t.exports=function(t){return r(t)?void 0:t}},KxBI:function(t,e,n){"use strict";function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}n.d(e,"a",(function(){return Lo}));var i,s,o,a,l,u={exports:{}};i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,o=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u.exports=l={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),!(e=e.trim())){if(!n.alwaysNormalize)return t;var r=l.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return r.path=l.normalizePath(r.path),l.buildURLFromParts(r)}var i=l.parseURL(e);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return n.alwaysNormalize?(i.path=l.normalizePath(i.path),l.buildURLFromParts(i)):e;var o=l.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var a=s.exec(o.path);o.netLoc=a[1],o.path=a[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(u.netLoc=o.netLoc,"/"!==i.path[0]))if(i.path){var c=o.path,h=c.substring(0,c.lastIndexOf("/")+1)+i.path;u.path=l.normalizePath(h)}else u.path=o.path,i.params||(u.params=o.params,i.query||(u.query=o.query));return null===u.path&&(u.path=n.alwaysNormalize?l.normalizePath(i.path):i.path),l.buildURLFromParts(u)},parseURL:function(t){var e=i.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(o,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};var c=u.exports;function h(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?h(Object(n),!0).forEach((function(e){p(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function f(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function p(t,e,n){return(e=f(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function g(){return(g=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}const m=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},v=Number.isSafeInteger||function(t){return"number"==typeof t&&Math.abs(t)<=y},y=Number.MAX_SAFE_INTEGER||9007199254740991;let b=function(t){return t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached",t.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",t}({}),E=function(t){return t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",t}({}),T=function(t){return t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",t.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",t.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",t.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_PARSING_ERROR="levelParsingError",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.FRAG_GAP="fragGap",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.UNKNOWN="unknown",t}({});const S=function(){},_={trace:S,debug:S,log:S,warn:S,info:S,error:S};let w=_;function A(t,...e){e.forEach((function(e){w[e]=t[e]?t[e].bind(t):function(t){const e=self.console[t];return e?e.bind(self.console,`[${t}] >`):S}(e)}))}const L=w,R=/^(\d+)x(\d+)$/,I=/(.+?)=(".*?"|.*?)(?:,|$)/g;class D{constructor(t){"string"==typeof t&&(t=D.parseAttrList(t)),g(this,t)}get clientAttrs(){return Object.keys(this).filter(t=>"X-"===t.substring(0,2))}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;const n=new Uint8Array(e.length/2);for(let t=0;t<e.length/2;t++)n[t]=parseInt(e.slice(2*t,2*t+2),16);return n}return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const n=this[t];return n?parseFloat(n):e}enumeratedString(t){return this[t]}bool(t){return"YES"===this[t]}decimalResolution(t){const e=R.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t){let e;const n={};for(I.lastIndex=0;null!==(e=I.exec(t));){let t=e[2];0===t.indexOf('"')&&t.lastIndexOf('"')===t.length-1&&(t=t.slice(1,-1)),n[e[1].trim()]=t}return n}}function x(t){return"SCTE35-OUT"===t||"SCTE35-IN"===t}class k{constructor(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){const n=e.attr;for(const e in n)if(Object.prototype.hasOwnProperty.call(t,e)&&t[e]!==n[e]){L.warn(`DATERANGE tag attribute: "${e}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=e;break}t=g(new D({}),n,t)}if(this.attr=t,this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const t=new Date(this.attr["END-DATE"]);m(t.getTime())&&(this._endDate=t)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const t=this.duration;return null!==t?new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(m(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&m(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class O{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var C={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class P{constructor(t){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[C.AUDIO]:null,[C.VIDEO]:null,[C.AUDIOVIDEO]:null},this.baseurl=t}setByteRange(t,e){const n=t.split("@",2);let r;r=1===n.length?(null==e?void 0:e.byteRangeEndOffset)||0:parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=c.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}}class M extends P{constructor(t,e){super(e),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new O,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=t}get decryptdata(){const{levelkeys:t}=this;if(!t&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const t=Object.keys(this.levelkeys);if(1===t.length)return this._decryptdata=this.levelkeys[t[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;if(!m(this.programDateTime))return null;const t=m(this.duration)?this.duration:0;return this.programDateTime+1e3*t}get encrypted(){var t;if(null!=(t=this._decryptdata)&&t.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),e=t.length;if(e>1||1===e&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(t){if(this.levelkeys){const e=this.levelkeys[t];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}}abortRequests(){var t,e;null==(t=this.loader)||t.abort(),null==(e=this.keyLoader)||e.abort()}setElementaryStreamInfo(t,e,n,r,i,s=!1){const{elementaryStreams:o}=this,a=o[t];a?(a.startPTS=Math.min(a.startPTS,e),a.endPTS=Math.max(a.endPTS,n),a.startDTS=Math.min(a.startDTS,r),a.endDTS=Math.max(a.endDTS,i)):o[t]={startPTS:e,endPTS:n,startDTS:r,endDTS:i,partial:s}}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[C.AUDIO]=null,t[C.VIDEO]=null,t[C.AUDIOVIDEO]=null}}class F extends P{constructor(t,e,n,r,i){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new O,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=r;const s=t.enumeratedString("BYTERANGE");s&&this.setByteRange(s,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}const N=10;class U{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t)return this.advanced=!0,void(this.updated=!0);const e=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||0===e&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay}get hasProgramDateTime(){return!!this.fragments.length&&m(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||N}get drift(){const t=this.driftEndTime-this.driftStartTime;if(t>0){return 1e3*(this.driftEnd-this.driftStart)/t}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var t;return null!=(t=this.fragments)&&t.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function B(t){return Uint8Array.from(atob(t),t=>t.charCodeAt(0))}function $(t){const e=t.split(":");let n=null;if("data"===e[0]&&2===e.length){const t=e[1].split(";"),r=t[t.length-1].split(",");if(2===r.length){const e="base64"===r[0],i=r[1];e?(t.splice(-1,1),n=B(i)):n=function(t){const e=j(t).subarray(0,16),n=new Uint8Array(16);return n.set(e,16-e.length),n}(i)}}return n}function j(t){return Uint8Array.from(unescape(encodeURIComponent(t)),t=>t.charCodeAt(0))}const G="undefined"!=typeof self?self:void 0;var K={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},V={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function H(t){switch(t){case V.FAIRPLAY:return K.FAIRPLAY;case V.PLAYREADY:return K.PLAYREADY;case V.WIDEVINE:return K.WIDEVINE;case V.CLEARKEY:return K.CLEARKEY}}var W={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",FAIRPLAY:"94ce86fb07ff4f43adb893d2fa968ca2",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Y(t){return t===W.WIDEVINE?K.WIDEVINE:t===W.PLAYREADY?K.PLAYREADY:t===W.CENC||t===W.CLEARKEY?K.CLEARKEY:void 0}function z(t){switch(t){case K.FAIRPLAY:return V.FAIRPLAY;case K.PLAYREADY:return V.PLAYREADY;case K.WIDEVINE:return V.WIDEVINE;case K.CLEARKEY:return V.CLEARKEY}}function q(t){const{drmSystems:e,widevineLicenseUrl:n}=t,r=e?[K.FAIRPLAY,K.WIDEVINE,K.PLAYREADY,K.CLEARKEY].filter(t=>!!e[t]):[];return!r[K.WIDEVINE]&&n&&r.push(K.WIDEVINE),r}const X=null!=G&&null!=(Q=G.navigator)&&Q.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var Q;function Z(t,e,n){return Uint8Array.prototype.slice?t.slice(e,n):new Uint8Array(Array.prototype.slice.call(t,e,n))}const J=(t,e)=>e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128,tt=(t,e)=>e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128,et=(t,e)=>{const n=e;let r=0;for(;J(t,e);){r+=10,r+=nt(t,e+6),tt(t,e+10)&&(r+=10),e+=r}if(r>0)return t.subarray(n,n+r)},nt=(t,e)=>{let n=0;return n=(127&t[e])<<21,n|=(127&t[e+1])<<14,n|=(127&t[e+2])<<7,n|=127&t[e+3],n},rt=(t,e)=>J(t,e)&&nt(t,e+6)+10<=t.length-e,it=t=>{const e=at(t);for(let t=0;t<e.length;t++){const n=e[t];if(st(n))return dt(n)}},st=t=>t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info,ot=t=>{const e=String.fromCharCode(t[0],t[1],t[2],t[3]),n=nt(t,4);return{type:e,size:n,data:t.subarray(10,10+n)}},at=t=>{let e=0;const n=[];for(;J(t,e);){const r=nt(t,e+6);e+=10;const i=e+r;for(;e+8<i;){const r=ot(t.subarray(e)),i=lt(r);i&&n.push(i),e+=r.size+10}tt(t,e)&&(e+=10)}return n},lt=t=>"PRIV"===t.type?ut(t):"W"===t.type[0]?ht(t):ct(t),ut=t=>{if(t.size<2)return;const e=ft(t.data,!0),n=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:n.buffer}},ct=t=>{if(t.size<2)return;if("TXXX"===t.type){let e=1;const n=ft(t.data.subarray(e),!0);e+=n.length+1;const r=ft(t.data.subarray(e));return{key:t.type,info:n,data:r}}const e=ft(t.data.subarray(1));return{key:t.type,data:e}},ht=t=>{if("WXXX"===t.type){if(t.size<2)return;let e=1;const n=ft(t.data.subarray(e),!0);e+=n.length+1;const r=ft(t.data.subarray(e));return{key:t.type,info:n,data:r}}const e=ft(t.data);return{key:t.type,data:e}},dt=t=>{if(8===t.data.byteLength){const e=new Uint8Array(t.data),n=1&e[3];let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},ft=(t,e=!1)=>{const n=gt();if(n){const r=n.decode(t);if(e){const t=r.indexOf("\0");return-1!==t?r.substring(0,t):r}return r.replace(/\0/g,"")}const r=t.length;let i,s,o,a="",l=0;for(;l<r;){if(i=t[l++],0===i&&e)return a;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:s=t[l++],a+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=t[l++],o=t[l++],a+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&o)<<0)}}return a};let pt;function gt(){if(!navigator.userAgent.includes("PlayStation 4"))return pt||void 0===self.TextDecoder||(pt=new self.TextDecoder("utf-8")),pt}const mt={hexDump:function(t){let e="";for(let n=0;n<t.length;n++){let r=t[n].toString(16);r.length<2&&(r="0"+r),e+=r}return e}},vt=Math.pow(2,32)-1,yt=[].push,bt={video:1,audio:2,id3:3,text:4};function Et(t){return String.fromCharCode.apply(null,t)}function Tt(t,e){const n=t[e]<<8|t[e+1];return n<0?65536+n:n}function St(t,e){const n=wt(t,e);return n<0?4294967296+n:n}function _t(t,e){let n=St(t,e);return n*=Math.pow(2,32),n+=St(t,e+4),n}function wt(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function At(t,e,n){t[e]=n>>24,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n}function Lt(t,e){const n=[];if(!e.length)return n;const r=t.byteLength;for(let i=0;i<r;){const s=St(t,i),o=s>1?i+s:r;if(Et(t.subarray(i+4,i+8))===e[0])if(1===e.length)n.push(t.subarray(i+8,o));else{const r=Lt(t.subarray(i+8,o),e.slice(1));r.length&&yt.apply(n,r)}i=o}return n}function Rt(t){const e=[],n=t[0];let r=8;const i=St(t,r);r+=4;let s=0,o=0;0===n?(s=St(t,r),o=St(t,r+4),r+=8):(s=_t(t,r),o=_t(t,r+8),r+=16),r+=2;let a=t.length+o;const l=Tt(t,r);r+=2;for(let n=0;n<l;n++){let n=r;const s=St(t,n);n+=4;const o=2147483647&s;if(1===(2147483648&s)>>>31)return L.warn("SIDX has hierarchical references (not supported)"),null;const l=St(t,n);n+=4,e.push({referenceSize:o,subsegmentDuration:l,info:{duration:l/i,start:a,end:a+o-1}}),a+=o,n+=4,r=n}return{earliestPresentationTime:s,timescale:i,version:n,referencesCount:l,references:e}}function It(t){const e=[],n=Lt(t,["moov","trak"]);for(let t=0;t<n.length;t++){const r=n[t],i=Lt(r,["tkhd"])[0];if(i){let t=i[0];const n=St(i,0===t?12:20),s=Lt(r,["mdia","mdhd"])[0];if(s){t=s[0];const i=St(s,0===t?12:20),o=Lt(r,["mdia","hdlr"])[0];if(o){const t=Et(o.subarray(8,12)),s={soun:C.AUDIO,vide:C.VIDEO}[t];if(s){const t=Dt(Lt(r,["mdia","minf","stbl","stsd"])[0]);e[n]={timescale:i,type:s},e[s]=d({timescale:i,id:n},t)}}}}}return Lt(t,["moov","mvex","trex"]).forEach(t=>{const n=St(t,4),r=e[n];r&&(r.default={duration:St(t,12),flags:St(t,20)})}),e}function Dt(t){const e=t.subarray(8),n=e.subarray(86),r=Et(e.subarray(4,8));let i=r;const s="enca"===r||"encv"===r;if(s){const t=Lt(e,[r])[0];Lt(t.subarray("enca"===r?28:78),["sinf"]).forEach(t=>{const e=Lt(t,["schm"])[0];if(e){const n=Et(e.subarray(4,8));if("cbcs"===n||"cenc"===n){const e=Lt(t,["frma"])[0];e&&(i=Et(e))}}})}switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const t=Lt(n,["avcC"])[0];i+="."+kt(t[1])+kt(t[2])+kt(t[3]);break}case"mp4a":{const t=Lt(e,[r])[0],n=Lt(t.subarray(28),["esds"])[0];if(n&&n.length>12){let t=4;if(3!==n[t++])break;t=xt(n,t),t+=2;const e=n[t++];if(128&e&&(t+=2),64&e&&(t+=n[t++]),4!==n[t++])break;t=xt(n,t);const r=n[t++];if(64!==r)break;if(i+="."+kt(r),t+=12,5!==n[t++])break;t=xt(n,t);const s=n[t++];let o=(248&s)>>3;31===o&&(o+=1+((7&s)<<3)+((224&n[t])>>5)),i+="."+o}break}case"hvc1":case"hev1":{const t=Lt(n,["hvcC"])[0],e=t[1],r=["","A","B","C"][e>>6],s=31&e,o=St(t,2),a=(32&e)>>5?"H":"L",l=t[12],u=t.subarray(6,12);i+="."+r+s,i+="."+o.toString(16).toUpperCase(),i+="."+a+l;let c="";for(let t=u.length;t--;){const e=u[t];if(e||c){c="."+e.toString(16).toUpperCase()+c}}i+=c;break}case"dvh1":case"dvhe":{const t=Lt(n,["dvcC"])[0],e=t[2]>>1&127,r=t[2]<<5&32|t[3]>>3&31;i+="."+Ot(e)+"."+Ot(r);break}case"vp09":{const t=Lt(n,["vpcC"])[0],e=t[4],r=t[5],s=t[6]>>4&15;i+="."+Ot(e)+"."+Ot(r)+"."+Ot(s);break}case"av01":{const t=Lt(n,["av1C"])[0],e=t[1]>>>5,r=31&t[1],s=t[2]>>>7?"H":"M",o=(64&t[2])>>6,a=(32&t[2])>>5,l=2===e&&o?a?12:10:o?10:8,u=(16&t[2])>>4,c=(8&t[2])>>3,h=(4&t[2])>>2,d=3&t[2],f=1,p=1,g=1,m=0;i+="."+e+"."+Ot(r)+s+"."+Ot(l)+"."+u+"."+c+h+d+"."+Ot(f)+"."+Ot(p)+"."+Ot(g)+"."+m;break}}return{codec:i,encrypted:s}}function xt(t,e){const n=e+5;for(;128&t[e++]&&e<n;);return e}function kt(t){return("0"+t.toString(16).toUpperCase()).slice(-2)}function Ot(t){return(t<10?"0":"")+t}function Ct(t){const e=Lt(t,["schm"])[0];if(e){const n=Et(e.subarray(4,8));if("cbcs"===n||"cenc"===n)return Lt(t,["schi","tenc"])[0]}return null}function Pt(t){const e=St(t,0);let n=8;1&e&&(n+=4),4&e&&(n+=4);let r=0;const i=St(t,4);for(let s=0;s<i;s++){if(256&e){r+=St(t,n),n+=4}512&e&&(n+=4),1024&e&&(n+=4),2048&e&&(n+=4)}return r}function Mt(t,e){const n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function Ft(t,e){const n=[],r=e.samples,i=e.timescale,s=e.id;let o=!1;return Lt(r,["moof"]).map(a=>{const l=a.byteOffset-8;Lt(a,["traf"]).map(a=>{const u=Lt(a,["tfdt"]).map(t=>{const e=t[0];let n=St(t,4);return 1===e&&(n*=Math.pow(2,32),n+=St(t,8)),n/i})[0];return void 0!==u&&(t=u),Lt(a,["tfhd"]).map(u=>{const c=St(u,4),h=16777215&St(u,0);let d=0;const f=0!=(16&h);let p=0;const g=0!=(32&h);let m=8;c===s&&(0!=(1&h)&&(m+=8),0!=(2&h)&&(m+=4),0!=(8&h)&&(d=St(u,m),m+=4),f&&(p=St(u,m),m+=4),g&&(m+=4),"video"===e.type&&(o=function(t){if(!t)return!1;const e=t.indexOf("."),n=e<0?t:t.substring(0,e);return"hvc1"===n||"hev1"===n||"dvh1"===n||"dvhe"===n}(e.codec)),Lt(a,["trun"]).map(s=>{const a=s[0],u=16777215&St(s,0),c=0!=(1&u);let h=0;const f=0!=(4&u),g=0!=(256&u);let m=0;const v=0!=(512&u);let y=0;const b=0!=(1024&u),E=0!=(2048&u);let T=0;const S=St(s,4);let _=8;c&&(h=St(s,_),_+=4),f&&(_+=4);let w=h+l;for(let l=0;l<S;l++){if(g?(m=St(s,_),_+=4):m=d,v?(y=St(s,_),_+=4):y=p,b&&(_+=4),E&&(T=0===a?St(s,_):wt(s,_),_+=4),e.type===C.VIDEO){let e=0;for(;e<y;){const s=St(r,w);if(w+=4,Nt(o,r[w])){Ut(r.subarray(w,w+s),o?2:1,t+T/i,n)}w+=s,e+=s+4}}t+=m/i}}))})})}),n}function Nt(t,e){if(t){const t=e>>1&63;return 39===t||40===t}return 6===(31&e)}function Ut(t,e,n,r){const i=Bt(t);let s=0;s+=e;let o=0,a=0,l=0;for(;s<i.length;){o=0;do{if(s>=i.length)break;l=i[s++],o+=l}while(255===l);a=0;do{if(s>=i.length)break;l=i[s++],a+=l}while(255===l);const t=i.length-s;let e=s;if(a<t)s+=a;else if(a>t){L.error(`Malformed SEI payload. ${a} is too small, only ${t} bytes left to parse.`);break}if(4===o){if(181===i[e++]){const t=Tt(i,e);if(e+=2,49===t){const t=St(i,e);if(e+=4,1195456820===t){const t=i[e++];if(3===t){const s=i[e++],a=31&s,l=64&s,u=l?2+3*a:0,c=new Uint8Array(u);if(l){c[0]=s;for(let t=1;t<u;t++)c[t]=i[e++]}r.push({type:t,payloadType:o,pts:n,bytes:c})}}}}}else if(5===o&&a>16){const t=[];for(let n=0;n<16;n++){const r=i[e++].toString(16);t.push(1==r.length?"0"+r:r),3!==n&&5!==n&&7!==n&&9!==n||t.push("-")}const s=a-16,l=new Uint8Array(s);for(let t=0;t<s;t++)l[t]=i[e++];r.push({payloadType:o,pts:n,uuid:t.join(""),userData:ft(l),userDataBytes:l})}}}function Bt(t){const e=t.byteLength,n=[];let r=1;for(;r<e-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return t;const i=e-n.length,s=new Uint8Array(i);let o=0;for(r=0;r<i;o++,r++)o===n[0]&&(o++,n.shift()),s[r]=t[o];return s}function $t(t,e,n){if(16!==t.byteLength)throw new RangeError("Invalid system id");let r,i,s;if(e){r=1,i=new Uint8Array(16*e.length);for(let t=0;t<e.length;t++){const n=e[t];if(16!==n.byteLength)throw new RangeError("Invalid key");i.set(n,16*t)}}else r=0,i=new Uint8Array;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return n&&n.byteLength>0&&new DataView(o.buffer).setUint32(0,n.byteLength,!1),function(t,...e){const n=e.length;let r=8,i=n;for(;i--;)r+=e[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=255&r,s.set(t,4),i=0,r=8;i<n;i++)s.set(e[i],r),r+=e[i].byteLength;return s}([112,115,115,104],new Uint8Array([r,0,0,0]),t,s,i,o,n||new Uint8Array)}function jt(t){const e=t.getUint32(0),n=t.byteOffset,r=t.byteLength;if(r<e)return{offset:n,size:r};if(1886614376!==t.getUint32(4))return{offset:n,size:e};const i=t.getUint32(8)>>>24;if(0!==i&&1!==i)return{offset:n,size:e};const s=t.buffer,o=mt.hexDump(new Uint8Array(s,n+12,16)),a=t.getUint32(28);let l=null,u=null;if(0===i){if(e-32<a||a<22)return{offset:n,size:e};u=new Uint8Array(s,n+32,a)}else if(1===i){if(!a||r<n+32+16*a+16)return{offset:n,size:e};l=[];for(let t=0;t<a;t++)l.push(new Uint8Array(s,n+32+16*t,16))}return{version:i,systemId:o,kids:l,data:u,offset:n,size:e}}let Gt={};class Kt{static clearKeyUriToKeyIdMap(){Gt={}}constructor(t,e,n,r=[1],i=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=n,this.keyFormatVersions=r,this.iv=i,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&"AES-128"!==t}isSupported(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case V.FAIRPLAY:case V.WIDEVINE:case V.PLAYREADY:case V.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof t&&("AES-128"!==this.method||this.iv||L.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0);const e=function(t){const e=new Uint8Array(16);for(let n=12;n<16;n++)e[n]=t>>8*(15-n)&255;return e}(t);return new Kt(this.method,this.uri,"identity",this.keyFormatVersions,e)}const e=$(this.uri);if(e)switch(this.keyFormat){case V.WIDEVINE:this.pssh=e,e.length>=22&&(this.keyId=e.subarray(e.length-22,e.length-6));break;case V.PLAYREADY:{const t=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=$t(t,null,e);const n=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),r=String.fromCharCode.apply(null,Array.from(n)),i=r.substring(r.indexOf("<"),r.length),s=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(s){const t=s.childNodes[0]?s.childNodes[0].nodeValue:s.getAttribute("VALUE");if(t){const e=B(t).subarray(0,16);!function(t){const e=function(t,e,n){const r=t[e];t[e]=t[n],t[n]=r};e(t,0,3),e(t,1,2),e(t,4,5),e(t,6,7)}(e),this.keyId=e}}break}default:{let t=e.subarray(0,16);if(16!==t.length){const e=new Uint8Array(16);e.set(t,16-t.length),t=e}this.keyId=t;break}}if(!this.keyId||16!==this.keyId.byteLength){let t=Gt[this.uri];if(!t){const e=Object.keys(Gt).length%Number.MAX_SAFE_INTEGER;t=new Uint8Array(16),new DataView(t.buffer,12,4).setUint32(0,e),Gt[this.uri]=t}this.keyId=t}return this}}const Vt=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ht(t){return Vt.test(t)}function Wt(t,e,n){if(null!==t.variableList||t.hasVariableRefs)for(let r=n.length;r--;){const i=n[r],s=e[i];s&&(e[i]=Yt(t,s))}}function Yt(t,e){if(null!==t.variableList||t.hasVariableRefs){const n=t.variableList;return e.replace(Vt,e=>{const r=e.substring(2,e.length-1),i=null==n?void 0:n[r];return void 0===i?(t.playlistParsingError||(t.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),e):i})}return e}function zt(t,e,n){let r,i,s=t.variableList;if(s||(t.variableList=s={}),"QUERYPARAM"in e){r=e.QUERYPARAM;try{const t=new self.URL(n).searchParams;if(!t.has(r))throw new Error(`"${r}" does not match any query parameter in URI: "${n}"`);i=t.get(r)}catch(e){t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${e.message}`))}}else r=e.NAME,i=e.VALUE;r in s?t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=i||""}function qt(t,e,n){const r=e.IMPORT;if(n&&r in n){let e=t.variableList;e||(t.variableList=e={}),e[r]=n[r]}else t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function Xt(t=!0){if("undefined"==typeof self)return;return(t||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}const Qt={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Zt(t,e,n=!0){return!t.split(",").some(t=>!Jt(t,e,n))}function Jt(t,e,n=!0){var r;const i=Xt(n);return null!=(r=null==i?void 0:i.isTypeSupported(te(t,e)))&&r}function te(t,e){return`${e}/mp4;codecs="${t}"`}function ee(t){if(t){const e=t.substring(0,4);return Qt.video[e]}return 2}function ne(t){return t.split(",").reduce((t,e)=>{const n=Qt.video[e];return n?(2*n+t)/(t?3:2):(Qt.audio[e]+t)/(t?2:1)},0)}const re={};const ie=/flac|opus/i;function se(t,e=!0){return t.replace(ie,t=>(function(t,e=!0){if(re[t])return re[t];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[t];for(let r=0;r<n.length;r++)if(Jt(n[r],"audio",e))return re[t]=n[r],n[r];return t})(t.toLowerCase(),e))}function oe(t,e){return t&&"mp4a"!==t?t:e?e.split(",")[0]:e}const ae=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,le=/#EXT-X-MEDIA:(.*)/g,ue=/^#EXT(?:INF|-X-TARGETDURATION):/m,ce=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),he=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class de{static findGroup(t,e){for(let n=0;n<t.length;n++){const r=t[n];if(r.id===e)return r}}static resolve(t,e){return c.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return ue.test(t)}static parseMasterPlaylist(t,e){const n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Ht(t)},r=[];let i;for(ae.lastIndex=0;null!=(i=ae.exec(t));)if(i[1]){var s;const t=new D(i[1]);Wt(n,t,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const o=Yt(n,i[2]),a={attrs:t,bitrate:t.decimalInteger("BANDWIDTH")||t.decimalInteger("AVERAGE-BANDWIDTH"),name:t.NAME,url:de.resolve(o,e)},l=t.decimalResolution("RESOLUTION");l&&(a.width=l.width,a.height=l.height),ge(t.CODECS,a),null!=(s=a.unknownCodecs)&&s.length||r.push(a),n.levels.push(a)}else if(i[3]){const t=i[3],r=i[4];switch(t){case"SESSION-DATA":{const t=new D(r);Wt(n,t,["DATA-ID","LANGUAGE","VALUE","URI"]);const e=t["DATA-ID"];e&&(null===n.sessionData&&(n.sessionData={}),n.sessionData[e]=t);break}case"SESSION-KEY":{const t=fe(r,e,n);t.encrypted&&t.isSupported()?(null===n.sessionKeys&&(n.sessionKeys=[]),n.sessionKeys.push(t)):L.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${r}"`);break}case"DEFINE":{const t=new D(r);Wt(n,t,["NAME","VALUE","QUERYPARAM"]),zt(n,t,e)}break;case"CONTENT-STEERING":{const t=new D(r);Wt(n,t,["SERVER-URI","PATHWAY-ID"]),n.contentSteering={uri:de.resolve(t["SERVER-URI"],e),pathwayId:t["PATHWAY-ID"]||"."};break}case"START":n.startTimeOffset=pe(r)}}const o=r.length>0&&r.length<n.levels.length;return n.levels=o?r:n.levels,0===n.levels.length&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(t,e,n){let r;const i={},s=n.levels,o={AUDIO:s.map(t=>({id:t.attrs.AUDIO,audioCodec:t.audioCodec})),SUBTITLES:s.map(t=>({id:t.attrs.SUBTITLES,textCodec:t.textCodec})),"CLOSED-CAPTIONS":[]};let a=0;for(le.lastIndex=0;null!==(r=le.exec(t));){const t=new D(r[1]),s=t.TYPE;if(s){const r=o[s],l=i[s]||[];i[s]=l,Wt(n,t,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const u=t.LANGUAGE,c=t["ASSOC-LANGUAGE"],h=t.CHANNELS,d=t.CHARACTERISTICS,f=t["INSTREAM-ID"],p={attrs:t,bitrate:0,id:a++,groupId:t["GROUP-ID"]||"",name:t.NAME||u||"",type:s,default:t.bool("DEFAULT"),autoselect:t.bool("AUTOSELECT"),forced:t.bool("FORCED"),lang:u,url:t.URI?de.resolve(t.URI,e):""};if(c&&(p.assocLang=c),h&&(p.channels=h),d&&(p.characteristics=d),f&&(p.instreamId=f),null!=r&&r.length){const t=de.findGroup(r,p.groupId)||r[0];me(p,t,"audioCodec"),me(p,t,"textCodec")}l.push(p)}}return i}static parseLevelPlaylist(t,e,n,r,i,s){const o=new U(e),a=o.fragments;let l,u,c,h=null,d=0,f=0,p=0,v=0,y=null,b=new M(r,e),E=-1,T=!1,S=null;for(ce.lastIndex=0,o.m3u8=t,o.hasVariableRefs=Ht(t);null!==(l=ce.exec(t));){T&&(T=!1,b=new M(r,e),b.start=p,b.sn=d,b.cc=v,b.level=n,h&&(b.initSegment=h,b.rawProgramDateTime=h.rawProgramDateTime,h.rawProgramDateTime=null,S&&(b.setByteRange(S),S=null)));const t=l[1];if(t){b.duration=parseFloat(t);const e=(" "+l[2]).slice(1);b.title=e||null,b.tagList.push(e?["INF",t,e]:["INF",t])}else if(l[3]){if(m(b.duration)){b.start=p,c&&be(b,c,o),b.sn=d,b.level=n,b.cc=v,a.push(b);const t=(" "+l[3]).slice(1);b.relurl=Yt(o,t),ve(b,y),y=b,p+=b.duration,d++,f=0,T=!0}}else if(l[4]){const t=(" "+l[4]).slice(1);y?b.setByteRange(t,y):b.setByteRange(t)}else if(l[5])b.rawProgramDateTime=(" "+l[5]).slice(1),b.tagList.push(["PROGRAM-DATE-TIME",b.rawProgramDateTime]),-1===E&&(E=a.length);else{if(l=l[0].match(he),!l){L.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<l.length&&void 0===l[u];u++);const t=(" "+l[u]).slice(1),i=(" "+l[u+1]).slice(1),p=l[u+2]?(" "+l[u+2]).slice(1):"";switch(t){case"PLAYLIST-TYPE":o.type=i.toUpperCase();break;case"MEDIA-SEQUENCE":d=o.startSN=parseInt(i);break;case"SKIP":{const t=new D(i);Wt(o,t,["RECENTLY-REMOVED-DATERANGES"]);const e=t.decimalInteger("SKIPPED-SEGMENTS");if(m(e)){o.skippedSegments=e;for(let t=e;t--;)a.unshift(null);d+=e}const n=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");n&&(o.recentlyRemovedDateranges=n.split("\t"));break}case"TARGETDURATION":o.targetduration=Math.max(parseInt(i),1);break;case"VERSION":o.version=parseInt(i);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(i||p)&&b.tagList.push(p?[i,p]:[i]);break;case"DISCONTINUITY":v++,b.tagList.push(["DIS"]);break;case"GAP":b.gap=!0,b.tagList.push([t]);break;case"BITRATE":b.tagList.push([t,i]);break;case"DATERANGE":{const t=new D(i);Wt(o,t,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Wt(o,t,t.clientAttrs);const e=new k(t,o.dateRanges[t.ID]);e.isValid||o.skippedSegments?o.dateRanges[e.id]=e:L.warn(`Ignoring invalid DATERANGE tag: "${i}"`),b.tagList.push(["EXT-X-DATERANGE",i]);break}case"DEFINE":{const t=new D(i);Wt(o,t,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in t?qt(o,t,s):zt(o,t,e)}break;case"DISCONTINUITY-SEQUENCE":v=parseInt(i);break;case"KEY":{const t=fe(i,e,o);if(t.isSupported()){if("NONE"===t.method){c=void 0;break}c||(c={}),c[t.keyFormat]&&(c=g({},c)),c[t.keyFormat]=t}else L.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${i}"`);break}case"START":o.startTimeOffset=pe(i);break;case"MAP":{const t=new D(i);if(Wt(o,t,["BYTERANGE","URI"]),b.duration){const i=new M(r,e);ye(i,t,n,c),h=i,b.initSegment=h,h.rawProgramDateTime&&!b.rawProgramDateTime&&(b.rawProgramDateTime=h.rawProgramDateTime)}else{const e=b.byteRangeEndOffset;if(e){const t=b.byteRangeStartOffset;S=`${e-t}@${t}`}else S=null;ye(b,t,n,c),h=b,T=!0}break}case"SERVER-CONTROL":{const t=new D(i);o.canBlockReload=t.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=t.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&t.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=t.optionalFloat("PART-HOLD-BACK",0),o.holdBack=t.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const t=new D(i);o.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let t=o.partList;t||(t=o.partList=[]);const n=f>0?t[t.length-1]:void 0,r=f++,s=new D(i);Wt(o,s,["BYTERANGE","URI"]);const a=new F(s,b,e,r,n);t.push(a),b.duration+=a.duration;break}case"PRELOAD-HINT":{const t=new D(i);Wt(o,t,["URI"]),o.preloadHint=t;break}case"RENDITION-REPORT":{const t=new D(i);Wt(o,t,["URI"]),o.renditionReports=o.renditionReports||[],o.renditionReports.push(t);break}default:L.warn(`line parsed but not handled: ${l}`)}}}y&&!y.relurl?(a.pop(),p-=y.duration,o.partList&&(o.fragmentHint=y)):o.partList&&(ve(b,y),b.cc=v,o.fragmentHint=b,c&&be(b,c,o));const _=a.length,w=a[0],A=a[_-1];if(p+=o.skippedSegments*o.targetduration,p>0&&_&&A){o.averagetargetduration=p/_;const t=A.sn;o.endSN="initSegment"!==t?t:0,o.live||(A.endList=!0),w&&(o.startCC=w.cc)}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(p+=o.fragmentHint.duration),o.totalduration=p,o.endCC=v,E>0&&function(t,e){let n=t[e];for(let r=e;r--;){const e=t[r];if(!e)return;e.programDateTime=n.programDateTime-1e3*e.duration,n=e}}(a,E),o}}function fe(t,e,n){var r,i;const s=new D(t);Wt(n,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const o=null!=(r=s.METHOD)?r:"",a=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,c=null!=(i=s.KEYFORMAT)?i:"identity";a&&s.IV&&!l&&L.error(`Invalid IV: ${s.IV}`);const h=a?de.resolve(a,e):"",d=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Kt(o,h,c,d,l)}function pe(t){const e=new D(t).decimalFloatingPoint("TIME-OFFSET");return m(e)?e:null}function ge(t,e){let n=(t||"").split(/[ ,]+/).filter(t=>t);["video","audio","text"].forEach(t=>{const r=n.filter(e=>(function(t,e){const n=Qt[e];return!!n&&!!n[t.slice(0,4)]})(e,t));r.length&&(e[`${t}Codec`]=r.join(","),n=n.filter(t=>-1===r.indexOf(t)))}),e.unknownCodecs=n}function me(t,e,n){const r=e[n];r&&(t[n]=r)}function ve(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),m(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function ye(t,e,n,r){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=n,t.sn="initSegment",r&&(t.levelkeys=r),t.initSegment=null}function be(t,e,n){t.levelkeys=e;const{encryptedFragments:r}=n;r.length&&r[r.length-1].levelkeys===e||!Object.keys(e).some(t=>e[t].isCommonEncryption)||r.push(t)}var Ee={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Te={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Se(t){const{type:e}=t;switch(e){case Ee.AUDIO_TRACK:return Te.AUDIO;case Ee.SUBTITLE_TRACK:return Te.SUBTITLE;default:return Te.MAIN}}function _e(t,e){let n=t.url;return void 0!==n&&0!==n.indexOf("data:")||(n=e.url),n}class we{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.LEVEL_LOADING,this.onLevelLoading,this),t.on(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:t}=this;t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.LEVEL_LOADING,this.onLevelLoading,this),t.off(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(t){const e=this.hls.config,n=e.pLoader,r=e.loader,i=new(n||r)(e);return this.loaders[t.type]=i,i}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:n}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ee.MANIFEST,url:n,deliveryDirectives:null})}onLevelLoading(t,e){const{id:n,level:r,pathwayId:i,url:s,deliveryDirectives:o}=e;this.load({id:n,level:r,pathwayId:i,responseType:"text",type:Ee.LEVEL,url:s,deliveryDirectives:o})}onAudioTrackLoading(t,e){const{id:n,groupId:r,url:i,deliveryDirectives:s}=e;this.load({id:n,groupId:r,level:null,responseType:"text",type:Ee.AUDIO_TRACK,url:i,deliveryDirectives:s})}onSubtitleTrackLoading(t,e){const{id:n,groupId:r,url:i,deliveryDirectives:s}=e;this.load({id:n,groupId:r,level:null,responseType:"text",type:Ee.SUBTITLE_TRACK,url:i,deliveryDirectives:s})}load(t){var e;const n=this.hls.config;let r,i=this.getInternalLoader(t);if(i){const e=i.context;if(e&&e.url===t.url&&e.level===t.level)return void L.trace("[playlist-loader]: playlist request ongoing");L.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),i.abort()}if(r=t.type===Ee.MANIFEST?n.manifestLoadPolicy.default:g({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(t),m(null==(e=t.deliveryDirectives)?void 0:e.part)){let e;if(t.type===Ee.LEVEL&&null!==t.level?e=this.hls.levels[t.level].details:t.type===Ee.AUDIO_TRACK&&null!==t.id?e=this.hls.audioTracks[t.id].details:t.type===Ee.SUBTITLE_TRACK&&null!==t.id&&(e=this.hls.subtitleTracks[t.id].details),e){const t=e.partTarget,n=e.targetduration;if(t&&n){const e=1e3*Math.max(3*t,.8*n);r=g({},r,{maxTimeToFirstByteMs:Math.min(e,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(e,r.maxTimeToFirstByteMs)})}}}const s=r.errorRetry||r.timeoutRetry||{},o={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0},a={onSuccess:(t,e,n,r)=>{const i=this.getInternalLoader(n);this.resetInternalLoader(n.type);const s=t.data;0===s.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),de.isMediaPlaylist(s)?this.handleTrackOrLevelPlaylist(t,e,n,r||null,i):this.handleMasterPlaylist(t,e,n,r)):this.handleManifestParsingError(t,n,new Error("no EXTM3U delimiter"),r||null,e)},onError:(t,e,n,r)=>{this.handleNetworkError(e,n,!1,t,r)},onTimeout:(t,e,n)=>{this.handleNetworkError(e,n,!0,void 0,t)}};i.load(t,o,a)}handleMasterPlaylist(t,e,n,r){const i=this.hls,s=t.data,o=_e(t,n),a=de.parseMasterPlaylist(s,o);if(a.playlistParsingError)return void this.handleManifestParsingError(t,n,a.playlistParsingError,r,e);const{contentSteering:l,levels:u,sessionData:c,sessionKeys:h,startTimeOffset:d,variableList:f}=a;this.variableList=f;const{AUDIO:p=[],SUBTITLES:g,"CLOSED-CAPTIONS":m}=de.parseMasterPlaylistMedia(s,o,a);if(p.length){p.some(t=>!t.url)||!u[0].audioCodec||u[0].attrs.AUDIO||(L.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new D({}),bitrate:0,url:""}))}i.trigger(b.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:g,captions:m,contentSteering:l,url:o,stats:e,networkDetails:r,sessionData:c,sessionKeys:h,startTimeOffset:d,variableList:f})}handleTrackOrLevelPlaylist(t,e,n,r,i){const s=this.hls,{id:o,level:a,type:l}=n,u=_e(t,n),c=m(a)?a:m(o)?o:0,h=Se(n),d=de.parseLevelPlaylist(t.data,u,c,h,0,this.variableList);if(l===Ee.MANIFEST){const t={attrs:new D({}),bitrate:0,details:d,name:"",url:u};s.trigger(b.MANIFEST_LOADED,{levels:[t],audioTracks:[],url:u,stats:e,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),n.levelDetails=d,this.handlePlaylistLoaded(d,t,e,n,r,i)}handleManifestParsingError(t,e,n,r,i){this.hls.trigger(b.ERROR,{type:E.NETWORK_ERROR,details:T.MANIFEST_PARSING_ERROR,fatal:e.type===Ee.MANIFEST,url:t.url,err:n,error:n,reason:n.message,response:t,context:e,networkDetails:r,stats:i})}handleNetworkError(t,e,n=!1,r,i){let s=`A network ${n?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${t.type}`;t.type===Ee.LEVEL?s+=`: ${t.level} id: ${t.id}`:t.type!==Ee.AUDIO_TRACK&&t.type!==Ee.SUBTITLE_TRACK||(s+=` id: ${t.id} group-id: "${t.groupId}"`);const o=new Error(s);L.warn(`[playlist-loader]: ${s}`);let a=T.UNKNOWN,l=!1;const u=this.getInternalLoader(t);switch(t.type){case Ee.MANIFEST:a=n?T.MANIFEST_LOAD_TIMEOUT:T.MANIFEST_LOAD_ERROR,l=!0;break;case Ee.LEVEL:a=n?T.LEVEL_LOAD_TIMEOUT:T.LEVEL_LOAD_ERROR,l=!1;break;case Ee.AUDIO_TRACK:a=n?T.AUDIO_TRACK_LOAD_TIMEOUT:T.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Ee.SUBTITLE_TRACK:a=n?T.SUBTITLE_TRACK_LOAD_TIMEOUT:T.SUBTITLE_LOAD_ERROR,l=!1}u&&this.resetInternalLoader(t.type);const c={type:E.NETWORK_ERROR,details:a,fatal:l,url:t.url,loader:u,context:t,error:o,networkDetails:e,stats:i};if(r){const n=(null==e?void 0:e.url)||t.url;c.response=d({url:n,data:void 0},r)}this.hls.trigger(b.ERROR,c)}handlePlaylistLoaded(t,e,n,r,i,s){const o=this.hls,{type:a,level:l,id:u,groupId:c,deliveryDirectives:h}=r,d=_e(e,r),f=Se(r),p="number"==typeof r.level&&f===Te.MAIN?l:void 0;if(!t.fragments.length){const t=new Error("No Segments found in Playlist");return void o.trigger(b.ERROR,{type:E.NETWORK_ERROR,details:T.LEVEL_EMPTY_ERROR,fatal:!1,url:d,error:t,reason:t.message,response:e,context:r,level:p,parent:f,networkDetails:i,stats:n})}t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));const g=t.playlistParsingError;if(g)o.trigger(b.ERROR,{type:E.NETWORK_ERROR,details:T.LEVEL_PARSING_ERROR,fatal:!1,url:d,error:g,reason:g.message,response:e,context:r,level:p,parent:f,networkDetails:i,stats:n});else switch(t.live&&s&&(s.getCacheAge&&(t.ageHeader=s.getCacheAge()||0),s.getCacheAge&&!isNaN(t.ageHeader)||(t.ageHeader=0)),a){case Ee.MANIFEST:case Ee.LEVEL:o.trigger(b.LEVEL_LOADED,{details:t,level:p||0,id:u||0,stats:n,networkDetails:i,deliveryDirectives:h});break;case Ee.AUDIO_TRACK:o.trigger(b.AUDIO_TRACK_LOADED,{details:t,id:u||0,groupId:c||"",stats:n,networkDetails:i,deliveryDirectives:h});break;case Ee.SUBTITLE_TRACK:o.trigger(b.SUBTITLE_TRACK_LOADED,{details:t,id:u||0,groupId:c||"",stats:n,networkDetails:i,deliveryDirectives:h})}}}function Ae(t,e){let n;try{n=new Event("addtrack")}catch(t){n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=t,e.dispatchEvent(n)}function Le(t,e){const n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){L.debug(`[texttrack-utils]: ${n}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,t.addCue(n)}catch(t){L.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${t}`)}}"disabled"===n&&(t.mode=n)}function Re(t){const e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(let e=t.cues.length;e--;)t.removeCue(t.cues[e]);"disabled"===e&&(t.mode=e)}function Ie(t,e,n,r){const i=t.mode;if("disabled"===i&&(t.mode="hidden"),t.cues&&t.cues.length>0){const i=function(t,e,n){const r=[],i=function(t,e){if(e<t[0].startTime)return 0;const n=t.length-1;if(e>t[n].endTime)return-1;let r=0,i=n;for(;r<=i;){const s=Math.floor((i+r)/2);if(e<t[s].startTime)i=s-1;else{if(!(e>t[s].startTime&&r<n))return s;r=s+1}}return t[r].startTime-e<e-t[i].startTime?r:i}(t,e);if(i>-1)for(let s=i,o=t.length;s<o;s++){const i=t[s];if(i.startTime>=e&&i.endTime<=n)r.push(i);else if(i.startTime>n)return r}return r}(t.cues,e,n);for(let e=0;e<i.length;e++)r&&!r(i[e])||t.removeCue(i[e])}"disabled"===i&&(t.mode=i)}function De(t){const e=[];for(let n=0;n<t.length;n++){const r=t[n];"subtitles"!==r.kind&&"captions"!==r.kind||!r.label||e.push(t[n])}return e}var xe={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const ke=.25;function Oe(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function Ce(t,e,n,r,i){let s=new t(e,n,"");try{s.value=r,i&&(s.type=i)}catch(o){s=new t(e,n,JSON.stringify(i?d({type:i},r):r))}return s}const Pe=(()=>{const t=Oe();try{t&&new t(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Me(t,e){return t.getTime()/1e3-e}class Fe{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:t}=this;t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:t}=this;t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(b.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(t,e){this.media=e.media}onMediaDetaching(){this.id3Track&&(Re(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(this.media){for(let e=0;e<t.length;e++){const n=t[e];if("metadata"===n.kind&&"id3"===n.label)return Ae(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:r}}}=this;if(!n&&!r)return;const{samples:i}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const s=Oe();if(s)for(let t=0;t<i.length;t++){const e=i[t].type;if(e===xe.emsg&&!n||!r)continue;const o=at(i[t].data);if(o){const n=i[t].pts;let r=n+i[t].duration;r>Pe&&(r=Pe),r-n<=0&&(r=n+ke);for(let t=0;t<o.length;t++){const i=o[t];if(!st(i)){this.updateId3CueEnds(n,e);const t=Ce(s,n,r,i,e);t&&this.id3Track.addCue(t)}}}}}updateId3CueEnds(t,e){var n;const r=null==(n=this.id3Track)?void 0:n.cues;if(r)for(let n=r.length;n--;){const i=r[n];i.type===e&&i.startTime<t&&i.endTime===Pe&&(i.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:n,type:r}){const{id3Track:i,hls:s}=this;if(!s)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:a}}=s;if(i&&(o||a)){let t;t="audio"===r?t=>t.type===xe.audioId3&&a:"video"===r?t=>t.type===xe.emsg&&o:t=>t.type===xe.audioId3&&a||t.type===xe.emsg&&o,Ie(i,e,n,t)}}onLevelUpdated(t,{details:e}){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:n,id3Track:r}=this,{dateRanges:i}=e,s=Object.keys(i);if(r){const t=Object.keys(n).filter(t=>!s.includes(t));for(let e=t.length;e--;){const i=t[e];Object.keys(n[i].cues).forEach(t=>{r.removeCue(n[i].cues[t])}),delete n[i]}}const o=e.fragments[e.fragments.length-1];if(0===s.length||!m(null==o?void 0:o.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=o.programDateTime/1e3-o.start,l=Oe();for(let t=0;t<s.length;t++){const e=s[t],r=i[e],o=Me(r.startDate,a),h=n[e],d=(null==h?void 0:h.cues)||{};let f=(null==h?void 0:h.durationKnown)||!1,p=Pe;const g=r.endDate;if(g)p=Me(g,a),f=!0;else if(r.endOnNext&&!f){const t=s.reduce((t,e)=>{if(e!==r.id){const n=i[e];if(n.class===r.class&&n.startDate>r.startDate&&(!t||r.startDate<t.startDate))return n}return t},null);t&&(p=Me(t.startDate,a),f=!0)}const m=Object.keys(r.attr);for(let t=0;t<m.length;t++){const n=m[t];if("ID"===(c=n)||"CLASS"===c||"START-DATE"===c||"DURATION"===c||"END-DATE"===c||"END-ON-NEXT"===c)continue;const i=d[n];if(i)f&&!h.durationKnown&&(i.endTime=p);else if(l){let t=r.attr[n];x(n)&&(u=t,t=Uint8Array.from(u.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);const i=Ce(l,o,p,{key:n,data:t},xe.dateRange);i&&(i.id=e,this.id3Track.addCue(i),d[n]=i)}}n[e]={cues:d,dateRange:r,durationKnown:f}}var u,c}}class Ne{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=t,this.config=t.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:t,levelDetails:e}=this;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const{levelDetails:t}=this;if(null===t)return null;const{holdBack:e,partHoldBack:n,targetduration:r}=t,{liveSyncDuration:i,liveSyncDurationCount:s,lowLatencyMode:o}=this.config,a=this.hls.userConfig;let l=o&&n||e;(a.liveSyncDuration||a.liveSyncDurationCount||0===l)&&(l=void 0!==i?i:s*r);const u=r;return l+Math.min(1*this.stallCount,u)}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency,n=this.levelDetails;if(null===t||null===e||null===n)return null;const r=n.edge,i=t-e-this.edgeStalled,s=r-n.totalduration,o=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(s,i),o)}get drift(){const{levelDetails:t}=this;return null===t?1:t.drift}get edgeStalled(){const{levelDetails:t}=this;if(null===t)return 0;const e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t,levelDetails:e}=this;if(!t||!e)return 0;const n=t.buffered.length;return(n?t.buffered.end(n-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(b.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(b.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:e}){this.levelDetails=e,e.advanced&&this.timeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(t,e){var n;e.details===T.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(n=this.levelDetails)&&n.live&&L.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:t,levelDetails:e}=this;if(!t||!e)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(null===n)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:i}=this.config;if(!r||1===i||!e.live)return;const s=this.targetLatency;if(null===s)return;const o=n-s;if(o<Math.min(this.maxLatency,s+e.targetduration)&&o>.05&&this.forwardBufferLength>1){const e=Math.min(2,Math.max(1,i)),n=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;t.playbackRate=Math.min(e,Math.max(1,n))}else 1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1)}estimateLiveEdge(){const{levelDetails:t}=this;return null===t?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return null===t?null:t-this.currentTime}}const Ue=["NONE","TYPE-0","TYPE-1",null];const Be=["SDR","PQ","HLG"];var $e={No:"",Yes:"YES",v2:"v2"};function je(t){const{canSkipUntil:e,canSkipDateRanges:n,age:r}=t;return e&&r<e/2?n?$e.v2:$e.Yes:$e.No}class Ge{constructor(t,e,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=n}addDirectives(t){const e=new self.URL(t);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class Ke{constructor(t){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(t){return Ve(this._audioGroups,t)}hasSubtitleGroup(t){return Ve(this._subtitleGroups,t)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(t,e){if(e)if("audio"===t){let t=this._audioGroups;t||(t=this._audioGroups=[]),-1===t.indexOf(e)&&t.push(e)}else if("text"===t){let t=this._subtitleGroups;t||(t=this._subtitleGroups=[]),-1===t.indexOf(e)&&t.push(e)}}get urlId(){return 0}set urlId(t){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var t;return null==(t=this.audioGroups)?void 0:t[0]}get textGroupId(){var t;return null==(t=this.subtitleGroups)?void 0:t[0]}addFallback(){}}function Ve(t,e){return!(!e||!t)&&-1!==t.indexOf(e)}function He(t,e){const n=e.startPTS;if(m(n)){let r,i=0;e.sn>t.sn?(i=n-t.start,r=t):(i=t.start-n,r=e),r.duration!==i&&(r.duration=i)}else if(e.sn>t.sn){t.cc===e.cc&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration}else e.start=Math.max(t.start-e.duration,0)}function We(t,e,n,r,i,s){r-n<=0&&(L.warn("Fragment should have a positive duration",e),r=n+e.duration,s=i+e.duration);let o=n,a=r;const l=e.startPTS,u=e.endPTS;if(m(l)){const t=Math.abs(l-n);m(e.deltaPTS)?e.deltaPTS=Math.max(t,e.deltaPTS):e.deltaPTS=t,o=Math.max(n,l),n=Math.min(n,l),i=Math.min(i,e.startDTS),a=Math.min(r,u),r=Math.max(r,u),s=Math.max(s,e.endDTS)}const c=n-e.start;0!==e.start&&(e.start=n),e.duration=r-e.start,e.startPTS=n,e.maxStartPTS=o,e.startDTS=i,e.endPTS=r,e.minEndPTS=a,e.endDTS=s;const h=e.sn;if(!t||h<t.startSN||h>t.endSN)return 0;let d;const f=h-t.startSN,p=t.fragments;for(p[f]=e,d=f;d>0;d--)He(p[d],p[d-1]);for(d=f;d<p.length-1;d++)He(p[d],p[d+1]);return t.fragmentHint&&He(p[p.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,c}function Ye(t,e){let n=null;const r=t.fragments;for(let t=r.length-1;t>=0;t--){const e=r[t].initSegment;if(e){n=e;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;let i,s=0;if(function(t,e,n){const r=e.skippedSegments,i=Math.max(t.startSN,e.startSN)-e.startSN,s=(t.fragmentHint?1:0)+(r?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,o=e.startSN-t.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;for(let t=i;t<=s;t++){const i=l[o+t];let s=a[t];r&&!s&&t<r&&(s=e.fragments[t]=i),i&&s&&n(i,s)}}(t,e,(t,r)=>{t.relurl&&(s=t.cc-r.cc),m(t.startPTS)&&m(t.endPTS)&&(r.start=r.startPTS=t.startPTS,r.startDTS=t.startDTS,r.maxStartPTS=t.maxStartPTS,r.endPTS=t.endPTS,r.endDTS=t.endDTS,r.minEndPTS=t.minEndPTS,r.duration=t.endPTS-t.startPTS,r.duration&&(i=r),e.PTSKnown=e.alignedSliding=!0),r.elementaryStreams=t.elementaryStreams,r.loader=t.loader,r.stats=t.stats,t.initSegment&&(r.initSegment=t.initSegment,n=t.initSegment)}),n){(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(t=>{var e;!t||t.initSegment&&t.initSegment.relurl!==(null==(e=n)?void 0:e.relurl)||(t.initSegment=n)})}if(e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(t=>!t),e.deltaUpdateFailed){L.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let t=e.skippedSegments;t--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=function(t,e,n){const r=g({},t);n&&n.forEach(t=>{delete r[t]});return Object.keys(e).forEach(t=>{const n=new k(e[t].attr,r[t]);n.isValid?r[t]=n:L.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[t].attr)}"`)}),r}(t.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const o=e.fragments;if(s){L.warn("discontinuity sliding from playlist, take drift into account");for(let t=0;t<o.length;t++)o[t].cc+=s}e.skippedSegments&&(e.startCC=e.fragments[0].cc),function(t,e,n){if(t&&e){let r=0;for(let i=0,s=t.length;i<=s;i++){const s=t[i],o=e[i+r];s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn?n(s,o):r--}}}(t.partList,e.partList,(t,e)=>{e.elementaryStreams=t.elementaryStreams,e.stats=t.stats}),i?We(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):ze(t,e),o.length&&(e.totalduration=e.edge-o[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;const a=e.advancedDateTime;if(e.advanced&&a){const t=e.edge;e.driftStart||(e.driftStartTime=a,e.driftStart=t),e.driftEndTime=a,e.driftEnd=t}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime}function ze(t,e){const n=e.startSN+e.skippedSegments-t.startSN,r=t.fragments;n<0||n>=r.length||qe(e,r[n].start)}function qe(t,e){if(e){const n=t.fragments;for(let r=t.skippedSegments;r<n.length;r++)n[r].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function Xe(t,e,n){var r;return null!=t&&t.details?Qe(null==(r=t.details)?void 0:r.partList,e,n):null}function Qe(t,e,n){if(t)for(let r=t.length;r--;){const i=t[r];if(i.index===n&&i.fragment.sn===e)return i}return null}function Ze(t){t.forEach((t,e)=>{const{details:n}=t;null!=n&&n.fragments&&n.fragments.forEach(t=>{t.level=e})})}function Je(t){switch(t.details){case T.FRAG_LOAD_TIMEOUT:case T.KEY_LOAD_TIMEOUT:case T.LEVEL_LOAD_TIMEOUT:case T.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function tn(t,e){const n=Je(e);return t.default[`${n?"timeout":"error"}Retry`]}function en(t,e){const n="linear"===t.backoff?1:Math.pow(2,e);return Math.min(n*t.retryDelayMs,t.maxRetryDelayMs)}function nn(t){return d(d({},t),{errorRetry:null,timeoutRetry:null})}function rn(t,e,n,r){if(!t)return!1;const i=null==r?void 0:r.code,s=e<t.maxNumRetry&&(function(t){return 0===t&&!1===navigator.onLine||!!t&&(t<400||t>499)}(i)||!!n);return t.shouldRetry?t.shouldRetry(t,e,n,r,s):s}const sn={search:function(t,e){let n=0,r=t.length-1,i=null,s=null;for(;n<=r;){i=(n+r)/2|0,s=t[i];const o=e(s);if(o>0)n=i+1;else{if(!(o<0))return s;r=i-1}}return null}};function on(t,e,n=0,r=0,i=.005){let s=null;if(t){s=e[t.sn-e[0].sn+1]||null;const r=t.endDTS-n;r>0&&r<15e-7&&(n+=15e-7)}else 0===n&&0===e[0].start&&(s=e[0]);if(s&&((!t||t.level===s.level)&&0===an(n,r,s)||function(t,e,n){if(e&&0===e.start&&e.level<t.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((t,e)=>("INF"===e[0]&&(t+=parseFloat(e[1])),t),n);return t.start<=r}return!1}(s,t,Math.min(i,r))))return s;const o=sn.search(e,an.bind(null,n,r));return!o||o===t&&s?s:o}function an(t=0,e=0,n){if(n.start<=t&&n.start+n.duration>t)return 0;const r=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=t?1:n.start-r>t&&n.start?-1:0}function ln(t,e,n){const r=1e3*Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>t}var un={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},cn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class hn{constructor(t,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=L.log.bind(L,`${e}:`),this.warn=L.warn.bind(L,`${e}:`),this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e,n){const r=null==e?void 0:e.renditionReports;if(r){let i=-1;for(let n=0;n<r.length;n++){const s=r[n];let o;try{o=new self.URL(s.URI,e.url).href}catch(t){L.warn(`Could not construct new URL for Rendition Report: ${t}`),o=s.URI||""}if(o===t){i=n;break}o===t.substring(0,o.length)&&(i=n)}if(-1!==i){const t=r[i],s=parseInt(t["LAST-MSN"])||(null==e?void 0:e.lastPartSn);let o=parseInt(t["LAST-PART"])||(null==e?void 0:e.lastPartIndex);if(this.hls.config.lowLatencyMode){const t=Math.min(e.age-e.partTarget,e.targetduration);o>=0&&t>e.partTarget&&(o+=1)}const a=n&&je(n);return new Ge(s,o>=0?o:void 0,a)}}}loadPlaylist(t){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}shouldReloadPlaylist(t){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(t)}playlistLoaded(t,e,n){const{details:r,stats:i}=e,s=self.performance.now(),o=i.loading.first?Math.max(0,s-i.loading.first):0;if(r.advancedDateTime=Date.now()-o,r.live||null!=n&&n.live){if(r.reloaded(n),n&&this.log(`live playlist ${t} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),n&&r.fragments.length>0&&Ye(n,r),!this.canLoad||!r.live)return;let o,a=void 0,l=void 0;if(r.canBlockReload&&r.endSN&&r.advanced){const t=this.hls.config.lowLatencyMode,i=r.lastPartSn,s=r.endSN,u=r.lastPartIndex,c=i===s,h=t?0:u;-1!==u?(a=c?s+1:i,l=c?h:u+1):a=s+1;const d=r.age,f=d+r.ageHeader;let p=Math.min(f-r.partTarget,1.5*r.targetduration);if(p>0){if(n&&p>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${p} with playlist age: ${r.age}`),p=0;else{const t=Math.floor(p/r.targetduration);if(a+=t,void 0!==l){l+=Math.round(p%r.targetduration/r.partTarget)}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${d.toFixed(2)}s goal: ${p} skip sn ${t} to part ${l}`)}r.tuneInGoal=p}if(o=this.getDeliveryDirectives(r,e.deliveryDirectives,a,l),t||!c)return void this.loadPlaylist(o)}else(r.canBlockReload||r.canSkipUntil)&&(o=this.getDeliveryDirectives(r,e.deliveryDirectives,a,l));const u=this.hls.mainForwardBufferInfo,c=u?u.end-u.len:0,h=function(t,e=1/0){let n=1e3*t.targetduration;if(t.updated){const r=t.fragments,i=4;if(r.length&&n*i>e){const t=1e3*r[r.length-1].duration;t<n&&(n=t)}}else n/=2;return Math.round(n)}(r,1e3*(r.edge-c));r.updated&&s>this.requestScheduled+h&&(this.requestScheduled=i.loading.start),void 0!==a&&r.canBlockReload?this.requestScheduled=i.loading.first+h-(1e3*r.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+h<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=h);let d=this.requestScheduled-s;d=Math.max(0,d),this.log(`reload live playlist ${t} in ${Math.round(d)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(o),d)}else this.clearTimer()}getDeliveryDirectives(t,e,n,r){let i=je(t);return null!=e&&e.skip&&t.deltaUpdateFailed&&(n=e.msn,r=e.part,i=$e.No),new Ge(n,r,i)}checkRetry(t){const e=t.details,n=Je(t),r=t.errorAction,{action:i,retryCount:s=0,retryConfig:o}=r||{},a=!!r&&!!o&&(i===un.RetryRequest||!r.resolved&&i===un.SendAlternateToPenaltyBox);if(a){var l;if(this.requestScheduled=-1,s>=o.maxNumRetry)return!1;if(n&&null!=(l=t.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${s+1}/${o.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const t=en(o,s);this.timer=self.setTimeout(()=>this.loadPlaylist(),t),this.warn(`Retrying playlist loading ${s+1}/${o.maxNumRetry} after "${e}" in ${t}ms`)}t.levelRetry=!0,r.resolved=!0}return a}}class dn{constructor(t,e=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=n}sample(t,e){const n=Math.pow(this.alpha_,t);this.estimate_=e*(1-n)+n*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class fn{constructor(t,e,n,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new dn(t),this.fast_=new dn(e),this.defaultTTFB_=r,this.ttfb_=new dn(t)}update(t,e){const{slow_:n,fast_:r,ttfb_:i}=this;n.halfLife!==t&&(this.slow_=new dn(t,n.getEstimate(),n.getTotalWeight())),r.halfLife!==e&&(this.fast_=new dn(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.ttfb_=new dn(t,i.getEstimate(),i.getTotalWeight()))}sample(t,e){const n=(t=Math.max(t,this.minDelayMs_))/1e3,r=8*e/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(t){const e=t/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(n,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const pn={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},gn={};function mn(t,e,n,r,i,s){const o=t.audioCodec?t.audioGroups:null,a=null==s?void 0:s.audioCodec,l=null==s?void 0:s.channels,u=l?parseInt(l):a?1/0:2;let c=null;if(null!=o&&o.length)try{c=1===o.length&&o[0]?e.groups[o[0]].channels:o.reduce((t,n)=>{if(n){const r=e.groups[n];if(!r)throw new Error(`Audio track group ${n} not found`);Object.keys(r.channels).forEach(e=>{t[e]=(t[e]||0)+r.channels[e]})}return t},{2:0})}catch(t){return!0}return void 0!==t.videoCodec&&(t.width>1920&&t.height>1088||t.height>1920&&t.width>1088||t.frameRate>Math.max(r,30)||"SDR"!==t.videoRange&&t.videoRange!==n||t.bitrate>Math.max(i,8e6))||!!c&&m(u)&&Object.keys(c).some(t=>parseInt(t)>u)}function vn(t,e,n){const r=t.videoCodec,i=t.audioCodec;if(!r||!i||!n)return Promise.resolve(pn);const s={width:t.width,height:t.height,bitrate:Math.ceil(Math.max(.9*t.bitrate,t.averageBitrate)),framerate:t.frameRate||30},o=t.videoRange;"SDR"!==o&&(s.transferFunction=o.toLowerCase());const a=r.split(",").map(t=>({type:"media-source",video:d(d({},s),{},{contentType:te(t,"video")})}));return i&&t.audioGroups&&t.audioGroups.forEach(t=>{var n;t&&(null==(n=e.groups[t])||n.tracks.forEach(e=>{if(e.groupId===t){const t=e.channels||"",n=parseFloat(t);m(n)&&n>2&&a.push.apply(a,i.split(",").map(t=>({type:"media-source",audio:{contentType:te(t,"audio"),channels:""+n}})))}}))}),Promise.all(a.map(t=>{const e=function(t){const{audio:e,video:n}=t,r=n||e;if(r){const t=r.contentType.split('"')[1];if(n)return`r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${t}_${Math.ceil(n.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${t}`}return""}(t);return gn[e]||(gn[e]=n.decodingInfo(t))})).then(t=>({supported:!t.some(t=>!t.supported),configurations:a,decodingInfoResults:t})).catch(t=>({supported:!1,configurations:a,decodingInfoResults:[],error:t}))}function yn(t,e){let n=!1,r=[];return t&&(n="SDR"!==t,r=[t]),e&&(r=e.allowedVideoRanges||Be.slice(0),n=void 0!==e.preferHDR?e.preferHDR:function(){if("function"==typeof matchMedia){const t=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(t.media!==e.media)return!0===t.matches}return!1}(),r=n?r.filter(t=>"SDR"!==t):["SDR"]),{preferHDR:n,allowedVideoRanges:r}}function bn(t,e){L.log(`[abr] start candidates with "${t}" ignored because ${e}`)}function En(t,e,n){if("attrs"in t){const n=e.indexOf(t);if(-1!==n)return n}for(let r=0;r<e.length;r++){if(Tn(t,e[r],n))return r}return-1}function Tn(t,e,n){const{groupId:r,name:i,lang:s,assocLang:o,characteristics:a,default:l}=t,u=t.forced;return(void 0===r||e.groupId===r)&&(void 0===i||e.name===i)&&(void 0===s||e.lang===s)&&(void 0===s||e.assocLang===o)&&(void 0===l||e.default===l)&&(void 0===u||e.forced===u)&&(void 0===a||function(t,e=""){const n=t.split(","),r=e.split(",");return n.length===r.length&&!n.some(t=>-1===r.indexOf(t))}(a,e.characteristics))&&(void 0===n||n(t,e))}function Sn(t,e){const{audioCodec:n,channels:r}=t;return!(void 0!==n&&(e.audioCodec||"").substring(0,4)!==n.substring(0,4)||void 0!==r&&r!==(e.channels||"2"))}function _n(t,e,n){for(let r=e;r>-1;r--)if(n(t[r]))return r;for(let r=e+1;r<t.length;r++)if(n(t[r]))return r;return-1}class wn{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var An={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Ln{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(b.BUFFER_APPENDED,this.onBufferAppended,this),t.on(b.FRAG_BUFFERED,this.onFragBuffered,this),t.on(b.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:t}=this;t.off(b.BUFFER_APPENDED,this.onBufferAppended,this),t.off(b.FRAG_BUFFERED,this.onFragBuffered,this),t.off(b.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const n=this.activePartLists[e];if(n)for(let e=n.length;e--;){const r=n[e];if(!r)break;const i=r.end;if(r.start<=t&&null!==i&&t<=i)return r}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){const{fragments:n}=this,r=Object.keys(n);for(let i=r.length;i--;){const s=n[r[i]];if((null==s?void 0:s.body.type)===e&&s.buffered){const e=s.body;if(e.start<=t&&t<=e.end)return e}}return null}detectEvictedFragments(t,e,n,r){this.timeRanges&&(this.timeRanges[t]=e);const i=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(r=>{const s=this.fragments[r];if(!s)return;if(i>=s.body.sn)return;if(!s.buffered&&!s.loaded)return void(s.body.type===n&&this.removeFragment(s.body));const o=s.range[t];o&&o.time.some(t=>{const n=!this.isTimeBuffered(t.startPTS,t.endPTS,e);return n&&this.removeFragment(s.body),n})})}detectPartialFragments(t){const e=this.timeRanges,{frag:n,part:r}=t;if(!e||"initSegment"===n.sn)return;const i=In(n),s=this.fragments[i];if(!s||s.buffered&&n.gap)return;const o=!n.relurl;if(Object.keys(e).forEach(t=>{const i=n.elementaryStreams[t];if(!i)return;const a=e[t],l=o||!0===i.partial;s.range[t]=this.getBufferedTimes(n,r,l,a)}),s.loaded=null,Object.keys(s.range).length){s.buffered=!0,(s.body.endList=n.endList||s.body.endList)&&(this.endListFragments[s.body.type]=s),Rn(s)||this.removeParts(n.sn-1,n.type)}else this.removeFragment(s.body)}removeParts(t,e){const n=this.activePartLists[e];n&&(this.activePartLists[e]=n.filter(e=>e.fragment.sn>=t))}fragBuffered(t,e){const n=In(t);let r=this.fragments[n];!r&&e&&(r=this.fragments[n]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(t,e,n,r){const i={time:[],partial:n},s=t.start,o=t.end,a=t.minEndPTS||o,l=t.maxStartPTS||s;for(let t=0;t<r.length;t++){const e=r.start(t)-this.bufferPadding,n=r.end(t)+this.bufferPadding;if(l>=e&&a<=n){i.time.push({startPTS:Math.max(s,r.start(t)),endPTS:Math.min(o,r.end(t))});break}if(s<n&&o>e){const e=Math.max(s,r.start(t)),n=Math.min(o,r.end(t));n>e&&(i.partial=!0,i.time.push({startPTS:e,endPTS:n}))}else if(o<=e)break}return i}getPartialFragment(t){let e,n,r,i=null,s=0;const{bufferPadding:o,fragments:a}=this;return Object.keys(a).forEach(l=>{const u=a[l];u&&Rn(u)&&(n=u.body.start-o,r=u.body.end+o,t>=n&&t<=r&&(e=Math.min(t-n,r-t),s<=e&&(i=u.body,s=e)))}),i}isEndListAppended(t){const e=this.endListFragments[t];return void 0!==e&&(e.buffered||Rn(e))}getState(t){const e=In(t),n=this.fragments[e];return n?n.buffered?Rn(n)?An.PARTIAL:An.OK:An.APPENDING:An.NOT_LOADED}isTimeBuffered(t,e,n){let r,i;for(let s=0;s<n.length;s++){if(r=n.start(s)-this.bufferPadding,i=n.end(s)+this.bufferPadding,t>=r&&e<=i)return!0;if(e<=r)return!1}return!1}onFragLoaded(t,e){const{frag:n,part:r}=e;if("initSegment"===n.sn||n.bitrateTest)return;const i=r?null:e,s=In(n);this.fragments[s]={body:n,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:n,part:r,timeRanges:i}=e;if("initSegment"===n.sn)return;const s=n.type;if(r){let t=this.activePartLists[s];t||(this.activePartLists[s]=t=[]),t.push(r)}this.timeRanges=i,Object.keys(i).forEach(t=>{const e=i[t];this.detectEvictedFragments(t,e,s,r)})}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=In(t);return!!this.fragments[e]}hasParts(t){var e;return!(null==(e=this.activePartLists[t])||!e.length)}removeFragmentsInRange(t,e,n,r,i){r&&!this.hasGaps||Object.keys(this.fragments).forEach(s=>{const o=this.fragments[s];if(!o)return;const a=o.body;a.type!==n||r&&!a.gap||a.start<e&&a.end>t&&(o.buffered||i)&&this.removeFragment(a)})}removeFragment(t){const e=In(t);t.stats.loaded=0,t.clearElementaryStreamInfo();const n=this.activePartLists[t.type];if(n){const e=t.sn;this.activePartLists[t.type]=n.filter(t=>t.fragment.sn!==e)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function Rn(t){var e,n,r;return t.buffered&&(t.body.gap||(null==(e=t.range.video)?void 0:e.partial)||(null==(n=t.range.audio)?void 0:n.partial)||(null==(r=t.range.audiovideo)?void 0:r.partial))}function In(t){return`${t.type}_${t.level}_${t.sn}`}const Dn={length:0,start:()=>0,end:()=>0};class xn{static isBuffered(t,e){try{if(t){const n=xn.getBuffered(t);for(let t=0;t<n.length;t++)if(e>=n.start(t)&&e<=n.end(t))return!0}}catch(t){}return!1}static bufferInfo(t,e,n){try{if(t){const r=xn.getBuffered(t),i=[];let s;for(s=0;s<r.length;s++)i.push({start:r.start(s),end:r.end(s)});return this.bufferedInfo(i,e,n)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}}static bufferedInfo(t,e,n){e=Math.max(0,e),t.sort((function(t,e){const n=t.start-e.start;return n||e.end-t.end}));let r=[];if(n)for(let e=0;e<t.length;e++){const i=r.length;if(i){const s=r[i-1].end;t[e].start-s<n?t[e].end>s&&(r[i-1].end=t[e].end):r.push(t[e])}else r.push(t[e])}else r=t;let i,s=0,o=e,a=e;for(let t=0;t<r.length;t++){const l=r[t].start,u=r[t].end;if(e+n>=l&&e<u)o=l,a=u,s=a-e;else if(e+n<l){i=l;break}}return{len:s,start:o||0,end:a||0,nextStart:i}}static getBuffered(t){try{return t.buffered}catch(t){return L.log("failed to get media.buffered",t),Dn}}}class kn{constructor(t,e,n,r=0,i=-1,s=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=n,this.size=r,this.part=i,this.partial=s}}function On(t,e){for(let r=0,i=t.length;r<i;r++){var n;if((null==(n=t[r])?void 0:n.cc)===e)return t[r]}return null}function Cn(t,e){if(t){const n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}}function Pn(t,e){const n=e.fragments;for(let e=0,r=n.length;e<r;e++)Cn(n[e],t);e.fragmentHint&&Cn(e.fragmentHint,t),e.alignedSliding=!0}function Mn(t,e,n){e&&(!function(t,e,n){if(function(t,e,n){return!(!e||!(n.endCC>n.startCC||t&&t.cc<n.startCC))}(t,n,e)){const t=function(t,e){const n=t.fragments,r=e.fragments;if(!r.length||!n.length)return void L.log("No fragments to align");const i=On(n,r[0].cc);if(i&&(!i||i.startPTS))return i;L.log("No frag in previous level to align on")}(n,e);t&&m(t.start)&&(L.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),Pn(t.start,e))}}(t,n,e),!n.alignedSliding&&e&&Fn(n,e),n.alignedSliding||!e||n.skippedSegments||ze(e,n))}function Fn(t,e){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return;const n=t.fragments,r=e.fragments;if(!n.length||!r.length)return;let i,s;const o=Math.min(e.endCC,t.endCC);e.startCC<o&&t.startCC<o&&(i=On(r,o),s=On(n,o)),i&&s||(i=r[Math.floor(r.length/2)],s=On(n,i.cc)||n[Math.floor(n.length/2)]);const a=i.programDateTime,l=s.programDateTime;a&&l&&Pn((l-a)/1e3-(s.start-i.start),t)}const Nn=Math.pow(2,17);class Un{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const n=t.url;if(!n)return Promise.reject(new jn({type:E.NETWORK_ERROR,details:T.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,i=r.fLoader,s=r.loader;return new Promise((o,a)=>{if(this.loader&&this.loader.destroy(),t.gap){if(t.tagList.some(t=>"GAP"===t[0]))return void a($n(t));t.gap=!1}const l=this.loader=t.loader=i?new i(r):new s(r),u=Bn(t),c=nn(r.fragLoadPolicy.default),h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===t.sn?1/0:Nn};t.stats=l.stats,l.load(u,h,{onSuccess:(e,n,r,i)=>{this.resetLoader(t,l);let s=e.data;r.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),o({frag:t,part:null,payload:s,networkDetails:i})},onError:(e,r,i,s)=>{this.resetLoader(t,l),a(new jn({type:E.NETWORK_ERROR,details:T.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:d({url:n,data:void 0},e),error:new Error(`HTTP Error ${e.code} ${e.text}`),networkDetails:i,stats:s}))},onAbort:(e,n,r)=>{this.resetLoader(t,l),a(new jn({type:E.NETWORK_ERROR,details:T.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:r,stats:e}))},onTimeout:(e,n,r)=>{this.resetLoader(t,l),a(new jn({type:E.NETWORK_ERROR,details:T.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:r,stats:e}))},onProgress:(n,r,i,s)=>{e&&e({frag:t,part:null,payload:i,networkDetails:s})}})})}loadPart(t,e,n){this.abort();const r=this.config,i=r.fLoader,s=r.loader;return new Promise((o,a)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap)return void a($n(t,e));const l=this.loader=t.loader=i?new i(r):new s(r),u=Bn(t,e),c=nn(r.fragLoadPolicy.default),h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Nn};e.stats=l.stats,l.load(u,h,{onSuccess:(r,i,s,a)=>{this.resetLoader(t,l),this.updateStatsFromPart(t,e);const u={frag:t,part:e,payload:r.data,networkDetails:a};n(u),o(u)},onError:(n,r,i,s)=>{this.resetLoader(t,l),a(new jn({type:E.NETWORK_ERROR,details:T.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:d({url:u.url,data:void 0},n),error:new Error(`HTTP Error ${n.code} ${n.text}`),networkDetails:i,stats:s}))},onAbort:(n,r,i)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,l),a(new jn({type:E.NETWORK_ERROR,details:T.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:i,stats:n}))},onTimeout:(n,r,i)=>{this.resetLoader(t,l),a(new jn({type:E.NETWORK_ERROR,details:T.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${h.timeout}ms`),networkDetails:i,stats:n}))}})})}updateStatsFromPart(t,e){const n=t.stats,r=e.stats,i=r.total;if(n.loaded+=r.loaded,i){const r=Math.round(t.duration/e.duration),s=Math.min(Math.round(n.loaded/i),r),o=(r-s)*Math.round(n.loaded/s);n.total=n.loaded+o}else n.total=Math.max(n.loaded,n.total);const s=n.loading,o=r.loading;s.start?s.first+=o.first-o.start:(s.start=o.start,s.first=o.first),s.end=o.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function Bn(t,e=null){const n=e||t,r={frag:t,part:e,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},i=n.byteRangeStartOffset,s=n.byteRangeEndOffset;if(m(i)&&m(s)){var o;let e=i,n=s;if("initSegment"===t.sn&&"AES-128"===(null==(o=t.decryptdata)?void 0:o.method)){const t=s-i;t%16&&(n=s+(16-t%16)),0!==i&&(r.resetIV=!0,e=i-16)}r.rangeStart=e,r.rangeEnd=n}return r}function $n(t,e){const n=new Error(`GAP ${t.gap?"tag":"attribute"} found`),r={type:E.MEDIA_ERROR,details:T.FRAG_GAP,fatal:!1,frag:t,error:n,networkDetails:null};return e&&(r.part=e),(e||t).stats.aborted=!0,new jn(r)}class jn extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class Gn{constructor(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}decrypt(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)}}class Kn{constructor(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}class Vn{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),n=new Uint32Array(4);for(let t=0;t<4;t++)n[t]=e.getUint32(4*t);return n}initTable(){const t=this.sBox,e=this.invSBox,n=this.subMix,r=n[0],i=n[1],s=n[2],o=n[3],a=this.invSubMix,l=a[0],u=a[1],c=a[2],h=a[3],d=new Uint32Array(256);let f=0,p=0,g=0;for(g=0;g<256;g++)d[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){let n=p^p<<1^p<<2^p<<3^p<<4;n=n>>>8^255&n^99,t[f]=n,e[n]=f;const a=d[f],g=d[a],m=d[g];let v=257*d[n]^16843008*n;r[f]=v<<24|v>>>8,i[f]=v<<16|v>>>16,s[f]=v<<8|v>>>24,o[f]=v,v=16843009*m^65537*g^257*a^16843008*f,l[n]=v<<24|v>>>8,u[n]=v<<16|v>>>16,c[n]=v<<8|v>>>24,h[n]=v,f?(f=a^d[d[d[m^a]]],p^=d[d[p]]):f=p=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let n=!0,r=0;for(;r<e.length&&n;)n=e[r]===this.key[r],r++;if(n)return;this.key=e;const i=this.keySize=e.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);const s=this.ksRows=4*(i+6+1);let o,a;const l=this.keySchedule=new Uint32Array(s),u=this.invKeySchedule=new Uint32Array(s),c=this.sBox,h=this.rcon,d=this.invSubMix,f=d[0],p=d[1],g=d[2],m=d[3];let v,y;for(o=0;o<s;o++)o<i?v=l[o]=e[o]:(y=v,o%i==0?(y=y<<8|y>>>24,y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y],y^=h[o/i|0]<<24):i>6&&o%i==4&&(y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y]),l[o]=v=(l[o-i]^y)>>>0);for(a=0;a<s;a++)o=s-a,y=3&a?l[o]:l[o-4],u[a]=a<4||o<=4?y:f[c[y>>>24]]^p[c[y>>>16&255]]^g[c[y>>>8&255]]^m[c[255&y]],u[a]=u[a]>>>0}networkToHostOrderSwap(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24}decrypt(t,e,n){const r=this.keySize+6,i=this.invKeySchedule,s=this.invSBox,o=this.invSubMix,a=o[0],l=o[1],u=o[2],c=o[3],h=this.uint8ArrayToUint32Array_(n);let d=h[0],f=h[1],p=h[2],g=h[3];const m=new Int32Array(t),v=new Int32Array(m.length);let y,b,E,T,S,_,w,A,L,R,I,D,x,k;const O=this.networkToHostOrderSwap;for(;e<m.length;){for(L=O(m[e]),R=O(m[e+1]),I=O(m[e+2]),D=O(m[e+3]),S=L^i[0],_=D^i[1],w=I^i[2],A=R^i[3],x=4,k=1;k<r;k++)y=a[S>>>24]^l[_>>16&255]^u[w>>8&255]^c[255&A]^i[x],b=a[_>>>24]^l[w>>16&255]^u[A>>8&255]^c[255&S]^i[x+1],E=a[w>>>24]^l[A>>16&255]^u[S>>8&255]^c[255&_]^i[x+2],T=a[A>>>24]^l[S>>16&255]^u[_>>8&255]^c[255&w]^i[x+3],S=y,_=b,w=E,A=T,x+=4;y=s[S>>>24]<<24^s[_>>16&255]<<16^s[w>>8&255]<<8^s[255&A]^i[x],b=s[_>>>24]<<24^s[w>>16&255]<<16^s[A>>8&255]<<8^s[255&S]^i[x+1],E=s[w>>>24]<<24^s[A>>16&255]<<16^s[S>>8&255]<<8^s[255&_]^i[x+2],T=s[A>>>24]<<24^s[S>>16&255]<<16^s[_>>8&255]<<8^s[255&w]^i[x+3],v[e]=O(y^d),v[e+1]=O(T^f),v[e+2]=O(E^p),v[e+3]=O(b^g),d=L,f=R,p=I,g=D,e+=4}return v.buffer}}const Hn=16;class Wn{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const t=self.crypto;t&&(this.subtle=t.subtle||t.webkitSubtle)}catch(t){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const n=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?function(t){const e=t.byteLength,n=e&&new DataView(t.buffer).getUint8(e-1);return n?Z(t,0,e-n):t}(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,n){return this.useSoftware?new Promise((r,i)=>{this.softwareDecrypt(new Uint8Array(t),e,n);const s=this.flush();s?r(s.buffer):i(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,n)}softwareDecrypt(t,e,n){const{currentIV:r,currentResult:i,remainderData:s}=this;this.logOnce("JS AES decrypt"),s&&(t=Mt(s,t),this.remainderData=null);const o=this.getValidChunk(t);if(!o.length)return null;r&&(n=r);let a=this.softwareDecrypter;a||(a=this.softwareDecrypter=new Vn),a.expandKey(e);const l=i;return this.currentResult=a.decrypt(o.buffer,0,n),this.currentIV=Z(o,-16).buffer,l||null}webCryptoDecrypt(t,e,n){if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(t,e,n));this.key=e,this.fastAesKey=new Kn(this.subtle,e)}return this.fastAesKey.expandKey().then(e=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));return this.logOnce("WebCrypto AES decrypt"),new Gn(this.subtle,new Uint8Array(n)).decrypt(t.buffer,e)}).catch(r=>(L.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(t,e,n)))}onWebCryptoError(t,e,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,n);const r=this.flush();if(r)return r.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(t){let e=t;const n=t.length-t.length%Hn;return n!==t.length&&(e=Z(t,0,n),this.remainderData=Z(t,n)),e}logOnce(t){this.logEnabled&&(L.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const Yn={toString:function(t){let e="";const n=t.length;for(let r=0;r<n;r++)e+=`[${t.start(r).toFixed(3)}-${t.end(r).toFixed(3)}]`;return e}},zn={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class qn extends wn{constructor(t,e,n,r,i){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=zn.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=i,this.logPrefix=r,this.log=L.log.bind(L,`${r}:`),this.warn=L.warn.bind(L,`${r}:`),this.hls=t,this.fragmentLoader=new Un(t.config),this.keyLoader=n,this.fragmentTracker=e,this.config=t.config,this.decrypter=new Wn(t.config),t.on(b.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;null!=t&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=zn.STOPPED}_streamEnded(t,e){if(e.live||t.nextStart||!t.end||!this.media)return!1;const n=e.partList;if(null!=n&&n.length){const t=n[n.length-1];return xn.isBuffered(this.media,t.start+t.duration/2)}const r=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(r)}getLevelDetails(){var t;if(this.levels&&null!==this.levelLastLoaded)return null==(t=this.levelLastLoaded)?void 0:t.details}onMediaAttached(t,e){const n=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);const r=this.config;this.levels&&r.autoStartLoad&&this.state===zn.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(){const t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:t,fragCurrent:e,media:n,mediaBuffer:r,state:i}=this,s=n?n.currentTime:0,o=xn.bufferInfo(r||n,s,t.maxBufferHole);if(this.log(`media seeking to ${m(s)?s.toFixed(3):s}, state: ${i}`),this.state===zn.ENDED)this.resetLoadingState();else if(e){const n=t.maxFragLookUpTolerance,r=e.start-n,i=e.start+e.duration+n;if(!o.len||i<o.start||r>o.end){const t=s>i;(s<r||t)&&(t&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}n&&(this.fragmentTracker.removeFragmentsInRange(s,1/0,this.playlistType,!0),this.lastCurrentTime=s),this.loadedmetadata||o.len||(this.nextLoadPosition=this.startPosition=s),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=zn.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,n){this._loadFragForPlayback(t,e,n)}_loadFragForPlayback(t,e,n){this._doFragLoad(t,e,n,e=>{if(this.fragContextChanged(t))return this.warn(`Fragment ${t.sn}${e.part?" p: "+e.part.index:""} of level ${t.level} was dropped during download.`),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)}).then(e=>{if(!e)return;const n=this.state;this.fragContextChanged(t)?(n===zn.FRAG_LOADING||!this.fragCurrent&&n===zn.PARSING)&&(this.fragmentTracker.removeFragment(t),this.state=zn.IDLE):("payload"in e&&(this.log(`Loaded fragment ${t.sn} of level ${t.level}`),this.hls.trigger(b.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))}).catch(e=>{this.state!==zn.STOPPED&&this.state!==zn.ERROR&&(this.warn(`Frag error: ${(null==e?void 0:e.message)||e}`),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:n}=this;if(n.getState(t)===An.APPENDING){const e=t.type,r=this.getFwdBufferInfo(this.mediaBuffer,e),i=Math.max(t.duration,r?r.len:this.config.maxBufferLength),s=this.backtrackFragment;(1===(s?t.sn-s.sn:0)||this.reduceMaxBufferLength(i,t.duration))&&n.removeFragment(t)}else 0===(null==(e=this.mediaBuffer)?void 0:e.buffered.length)?n.removeAllFragments():n.hasParts(t.type)&&(n.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),n.getState(t)===An.PARTIAL&&n.removeFragment(t))}checkLiveUpdate(t){if(t.updated&&!t.live){const e=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)}flushMainBuffer(t,e,n=null){if(!(t-e))return;const r={startOffset:t,endOffset:e,type:n};this.hls.trigger(b.BUFFER_FLUSHING,r)}_loadInitSegment(t,e){this._doFragLoad(t,e).then(e=>{if(!e||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e}).then(e=>{const{hls:n}=this,{payload:r}=e,i=t.decryptdata;if(r&&r.byteLength>0&&null!=i&&i.key&&i.iv&&"AES-128"===i.method){const s=self.performance.now();return this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer).catch(e=>{throw n.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(r=>{const i=self.performance.now();return n.trigger(b.FRAG_DECRYPTED,{frag:t,payload:r,stats:{tstart:s,tdecrypt:i}}),e.payload=r,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(e=>{this.state!==zn.STOPPED&&this.state!==zn.ERROR&&(this.warn(e),this.resetFragmentLoading(t))})}completeInitSegmentLoad(t){const{levels:e}=this;if(!e)throw new Error("init load aborted, missing levels");const n=t.frag.stats;this.state=zn.IDLE,t.frag.data=new Uint8Array(t.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.sn!==e.sn||t.level!==e.level}fragBufferedComplete(t,e){var n,r,i,s;const o=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.playlistType===Te.MAIN?"level":"track"} ${t.level} (frag:[${(null!=(n=t.startPTS)?n:NaN).toFixed(3)}-${(null!=(r=t.endPTS)?r:NaN).toFixed(3)}] > buffer:${o?Yn.toString(xn.getBuffered(o)):"(detached)"})`),"initSegment"!==t.sn){var a;if(t.type!==Te.SUBTITLE){const e=t.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return void(this.state=zn.IDLE)}const e=null==(a=this.levels)?void 0:a[t.level];null!=e&&e.fragmentError&&(this.log(`Resetting level fragment error count of ${e.fragmentError} on frag buffered`),e.fragmentError=0)}this.state=zn.IDLE,o&&(!this.loadedmetadata&&t.type==Te.MAIN&&o.buffered.length&&(null==(i=this.fragCurrent)?void 0:i.sn)===(null==(s=this.fragPrevious)?void 0:s.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:n,part:r,partsLoaded:i}=t,s=!i||0===i.length||i.some(t=>!t),o=new kn(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!s);e.flush(o)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,n=null,r){var i;const s=null==e?void 0:e.details;if(!this.levels||!s)throw new Error(`frag load aborted, missing level${s?"":" detail"}s`);let o=null;if(!t.encrypted||null!=(i=t.decryptdata)&&i.key?!t.encrypted&&s.encryptedFragments.length&&this.keyLoader.loadClear(t,s.encryptedFragments):(this.log(`Loading key for ${t.sn} of [${s.startSN}-${s.endSN}], ${"[stream-controller]"===this.logPrefix?"level":"track"} ${t.level}`),this.state=zn.KEY_LOADING,this.fragCurrent=t,o=this.keyLoader.load(t).then(t=>{if(!this.fragContextChanged(t.frag))return this.hls.trigger(b.KEY_LOADED,t),this.state===zn.KEY_LOADING&&(this.state=zn.IDLE),t}),this.hls.trigger(b.KEY_LOADING,{frag:t}),null===this.fragCurrent&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),n=Math.max(t.start,n||0),this.config.lowLatencyMode&&"initSegment"!==t.sn){const i=s.partList;if(i&&r){n>t.end&&s.fragmentHint&&(t=s.fragmentHint);const a=this.getNextPart(i,t,n);if(a>-1){const l=i[a];let u;return this.log(`Loading part sn: ${t.sn} p: ${l.index} cc: ${t.cc} of playlist [${s.startSN}-${s.endSN}] parts [0-${a}-${i.length-1}] ${"[stream-controller]"===this.logPrefix?"level":"track"}: ${t.level}, target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=zn.FRAG_LOADING,u=o?o.then(n=>!n||this.fragContextChanged(n.frag)?null:this.doFragPartsLoad(t,l,e,r)).catch(t=>this.handleFragLoadError(t)):this.doFragPartsLoad(t,l,e,r).catch(t=>this.handleFragLoadError(t)),this.hls.trigger(b.FRAG_LOADING,{frag:t,part:l,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):u}if(!t.url||this.loadedEndOfParts(i,n))return Promise.resolve(null)}}this.log(`Loading fragment ${t.sn} cc: ${t.cc} ${s?"of ["+s.startSN+"-"+s.endSN+"] ":""}${"[stream-controller]"===this.logPrefix?"level":"track"}: ${t.level}, target: ${parseFloat(n.toFixed(3))}`),m(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=zn.FRAG_LOADING;const a=this.config.progressive;let l;return l=a&&o?o.then(e=>!e||this.fragContextChanged(null==e?void 0:e.frag)?null:this.fragmentLoader.load(t,r)).catch(t=>this.handleFragLoadError(t)):Promise.all([this.fragmentLoader.load(t,a?r:void 0),o]).then(([t])=>(!a&&t&&r&&r(t),t)).catch(t=>this.handleFragLoadError(t)),this.hls.trigger(b.FRAG_LOADING,{frag:t,targetBufferTime:n}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(t,e,n,r){return new Promise((i,s)=>{var o;const a=[],l=null==(o=n.details)?void 0:o.partList,u=e=>{this.fragmentLoader.loadPart(t,e,r).then(r=>{a[e.index]=r;const s=r.part;this.hls.trigger(b.FRAG_LOADED,r);const o=Xe(n,t.sn,e.index+1)||Qe(l,t.sn,e.index+1);if(!o)return i({frag:t,part:s,partsLoaded:a});u(o)}).catch(s)};u(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;t.data&&e.details===T.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(b.ERROR,e)}else this.hls.trigger(b.ERROR,{type:E.OTHER_ERROR,details:T.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==zn.PARSING)return void(this.fragCurrent||this.state===zn.STOPPED||this.state===zn.ERROR||(this.state=zn.IDLE));const{frag:n,part:r,level:i}=e,s=self.performance.now();n.stats.parsing.end=s,r&&(r.stats.parsing.end=s),this.updateLevelTiming(n,r,i,t.partial)}getCurrentContext(t){const{levels:e,fragCurrent:n}=this,{level:r,sn:i,part:s}=t;if(null==e||!e[r])return this.warn(`Levels object was unset while buffering fragment ${i} of level ${r}. The current chunk will not be buffered.`),null;const o=e[r],a=s>-1?Xe(o,i,s):null,l=a?a.fragment:function(t,e,n){if(null==t||!t.details)return null;const r=t.details;let i=r.fragments[e-r.startSN];return i||(i=r.fragmentHint,i&&i.sn===e?i:e<r.startSN&&n&&n.sn===e?n:null)}(o,i,n);return l?(n&&n!==l&&(l.stats=n.stats),{frag:l,part:a,level:o}):null}bufferFragmentData(t,e,n,r,i){var s;if(!t||this.state!==zn.PARSING)return;const{data1:o,data2:a}=t;let l=o;if(o&&a&&(l=Mt(o,a)),null==(s=l)||!s.length)return;const u={type:t.type,frag:e,part:n,chunkMeta:r,parent:e.type,data:l};if(this.hls.trigger(b.BUFFER_APPENDING,u),t.dropped&&t.independent&&!n){if(i)return;this.flushBufferGap(e)}}flushBufferGap(t){const e=this.media;if(!e)return;if(!xn.isBuffered(e,e.currentTime))return void this.flushMainBuffer(0,t.start);const n=e.currentTime,r=xn.bufferInfo(e,n,0),i=t.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),o=Math.max(Math.min(t.start-s,r.end-s),n+s);t.start-o>s&&this.flushMainBuffer(o,t.start)}getFwdBufferInfo(t,e){const n=this.getLoadPosition();return m(n)?this.getFwdBufferInfoAtPos(t,n,e):null}getFwdBufferInfoAtPos(t,e,n){const{config:{maxBufferHole:r}}=this,i=xn.bufferInfo(t,e,r);if(0===i.len&&void 0!==i.nextStart){const s=this.fragmentTracker.getBufferedFrag(e,n);if(s&&i.nextStart<s.end)return xn.bufferInfo(t,e,Math.max(i.nextStart,r))}return i}getMaxBufferLength(t){const{config:e}=this;let n;return n=t?Math.max(8*e.maxBufferSize/t,e.maxBufferLength):e.maxBufferLength,Math.min(n,e.maxMaxBufferLength)}reduceMaxBufferLength(t,e){const n=this.config,r=Math.max(Math.min(t-e,n.maxBufferLength),e),i=Math.max(t-3*e,n.maxMaxBufferLength/2,r);return i>=r&&(n.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0)}getAppendedFrag(t,e=Te.MAIN){const n=this.fragmentTracker.getAppendedFrag(t,Te.MAIN);return n&&"fragment"in n?n.fragment:n}getNextFragment(t,e){const n=e.fragments,r=n.length;if(!r)return null;const{config:i}=this,s=n[0].start;let o;if(e.live){const a=i.initialLiveManifestSize;if(r<a)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${a})`),null;(!e.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||t<s)&&(o=this.getInitialLiveFragment(e,n),this.startPosition=this.nextLoadPosition=o?this.hls.liveSyncPosition||o.start:t)}else t<=s&&(o=n[0]);if(!o){const n=i.lowLatencyMode?e.partEnd:e.fragmentEnd;o=this.getFragmentAtPosition(t,n,e)}return this.mapToInitFragWhenRequired(o)}isLoopLoading(t,e){const n=this.fragmentTracker.getState(t);return(n===An.OK||n===An.PARTIAL&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,n,r,i){const s=t.gap,o=this.getNextFragment(this.nextLoadPosition,e);if(null===o)return o;if(t=o,s&&t&&!t.gap&&n.nextStart){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r);if(null!==e&&n.len+e.len>=i)return this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${t.sn}`),null}return t}mapToInitFragWhenRequired(t){return null==t||!t.initSegment||null!=t&&t.initSegment.data||this.bitrateTest?t:t.initSegment}getNextPart(t,e,n){let r=-1,i=!1,s=!0;for(let o=0,a=t.length;o<a;o++){const a=t[o];if(s=s&&!a.independent,r>-1&&n<a.start)break;const l=a.loaded;l?r=-1:(i||a.independent||s)&&a.fragment===e&&(r=o),i=l}return r}loadedEndOfParts(t,e){const n=t[t.length-1];return n&&e>n.start&&n.loaded}getInitialLiveFragment(t,e){const n=this.fragPrevious;let r=null;if(n){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),r=function(t,e,n){if(null===e||!Array.isArray(t)||!t.length||!m(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;n=n||0;for(let r=0;r<t.length;++r){const i=t[r];if(ln(e,n,i))return i}return null}(e,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const i=n.sn+1;if(i>=t.startSN&&i<=t.endSN){const s=e[i-t.startSN];n.cc===s.cc&&(r=s,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=function(t,e){return sn.search(t,t=>t.cc<e?1:t.cc>e?-1:0)}(e,n.cc),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const e=this.hls.liveSyncPosition;null!==e&&(r=this.getFragmentAtPosition(e,this.bitrateTest?t.fragmentEnd:t.edge,t))}return r}getFragmentAtPosition(t,e,n){const{config:r}=this;let{fragPrevious:i}=this,{fragments:s,endSN:o}=n;const{fragmentHint:a}=n,{maxFragLookUpTolerance:l}=r,u=n.partList,c=!!(r.lowLatencyMode&&null!=u&&u.length&&a);let h;if(c&&a&&!this.bitrateTest&&(s=s.concat(a),o=a.sn),t<e){h=on(i,s,t,t>e-l?0:l)}else h=s[s.length-1];if(h){const t=h.sn-n.startSN,e=this.fragmentTracker.getState(h);if((e===An.OK||e===An.PARTIAL&&h.gap)&&(i=h),i&&h.sn===i.sn&&(!c||u[0].fragment.sn>h.sn)){if(i&&h.level===i.level){const e=s[t+1];h=h.sn<o&&this.fragmentTracker.getState(e)!==An.OK?e:null}}}return h}synchronizeToLiveEdge(t){const{config:e,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,i=n.currentTime,s=t.fragments[0].start,o=t.edge,a=i>=s-e.maxFragLookUpTolerance&&i<=o;if(null!==r&&n.duration>r&&(i<r||!a)){const s=void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;(!a&&n.readyState<4||i<o-s)&&(this.loadedmetadata||(this.nextLoadPosition=r),n.readyState&&(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${r.toFixed(3)}`),n.currentTime=r))}}alignPlaylists(t,e,n){const r=t.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const i=t.fragments[0].start,s=!e,o=t.alignedSliding&&m(i);if(s||!o&&!i){const{fragPrevious:i}=this;Mn(i,n,t);const s=t.fragments[0].start;return this.log(`Live playlist sliding: ${s.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${t.startSN} prev-sn: ${i?i.sn:"na"} fragments: ${r}`),s}return i}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)}setStartPosition(t,e){let n=this.startPosition;if(n<e&&(n=-1),-1===n||-1===this.lastCurrentTime){const r=null!==this.startTimeOffset,i=r?this.startTimeOffset:t.startTimeOffset;null!==i&&m(i)?(n=e+i,i<0&&(n+=t.totalduration),n=Math.min(Math.max(e,n),e+t.totalduration),this.log(`Start time offset ${i} found in ${r?"multivariant":"media"} playlist, adjust startPosition to ${n}`),this.startPosition=n):t.live?n=this.hls.liveSyncPosition||e:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n}getLoadPosition(){const{media:t}=this;let e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e}handleFragLoadAborted(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn(`Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===zn.FRAG_LOADING_WAITING_RETRY)||(this.state=zn.IDLE)}onFragmentOrKeyLoadError(t,e){if(e.chunkMeta&&!e.frag){const t=this.getCurrentContext(e.chunkMeta);t&&(e.frag=t.frag)}const n=e.frag;if(!n||n.type!==t||!this.levels)return;var r;if(this.fragContextChanged(n))return void this.warn(`Frag load error must match current frag to retry ${n.url} > ${null==(r=this.fragCurrent)?void 0:r.url}`);const i=e.details===T.FRAG_GAP;i&&this.fragmentTracker.fragBuffered(n,!0);const s=e.errorAction,{action:o,retryCount:a=0,retryConfig:l}=s||{};if(s&&o===un.RetryRequest&&l){this.resetStartWhenNotLoaded(this.levelLastLoaded);const r=en(l,a);this.warn(`Fragment ${n.sn} of ${t} ${n.level} errored with ${e.details}, retrying loading ${a+1}/${l.maxNumRetry} in ${r}ms`),s.resolved=!0,this.retryDate=self.performance.now()+r,this.state=zn.FRAG_LOADING_WAITING_RETRY}else if(l&&s){if(this.resetFragmentErrors(t),!(a<l.maxNumRetry))return void L.warn(`${e.details} reached or exceeded max retry (${a})`);i||o===un.RemoveAlternatePermanently||(s.resolved=!0)}else(null==s?void 0:s.action)===un.SendAlternateToPenaltyBox?this.state=zn.WAITING_LEVEL:this.state=zn.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(t){if(this.state===zn.PARSING||this.state===zn.PARSED){const e=t.frag,n=t.parent,r=this.getFwdBufferInfo(this.mediaBuffer,n),i=r&&r.len>.5;i&&this.reduceMaxBufferLength(r.len,(null==e?void 0:e.duration)||10);const s=!i;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${n} buffer`),e&&(this.fragmentTracker.removeFragment(e),this.nextLoadPosition=e.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(t){t===Te.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==zn.STOPPED&&(this.state=zn.IDLE)}afterBufferFlushed(t,e,n){if(!t)return;const r=xn.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,r,n),this.state===zn.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=zn.IDLE}resetStartWhenNotLoaded(t){if(!this.loadedmetadata){this.startFragRequested=!1;const e=t?t.details:null;null!=e&&e.live?(this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.warn(`The loading context changed while buffering fragment ${t.sn} of level ${t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,n,r){var i;const s=n.details;if(s){if(!Object.keys(t.elementaryStreams).reduce((e,i)=>{const o=t.elementaryStreams[i];if(o){const a=o.endPTS-o.startPTS;if(a<=0)return this.warn(`Could not parse fragment ${t.sn} ${i} duration reliably (${a})`),e||!1;const l=r?0:We(s,t,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return this.hls.trigger(b.LEVEL_PTS_UPDATED,{details:s,level:n,drift:l,type:i,frag:t,start:o.startPTS,end:o.endPTS}),!0}return e},!1)&&null===(null==(i=this.transmuxer)?void 0:i.error)){const e=new Error(`Found no media in fragment ${t.sn} of level ${t.level} resetting transmuxer to fallback to playlist timing`);if(0===n.fragmentError&&(n.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)),this.warn(e.message),this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.FRAG_PARSING_ERROR,fatal:!1,error:e,frag:t,reason:`Found no media in msn ${t.sn} of level "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=zn.PARSED,this.hls.trigger(b.FRAG_PARSED,{frag:t,part:e})}else this.warn("level.details undefined")}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(t){"demuxerWorker"===t.event&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}class Xn{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let n;return t.length?(n=1===t.length?t[0]:function(t,e){const n=new Uint8Array(e);let r=0;for(let e=0;e<t.length;e++){const i=t[e];n.set(i,r),r+=i.length}return n}(t,e),this.reset(),n):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}function Qn(t="",e=9e4){return{type:t,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Zn{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,n){}demux(t,e){this.cachedData&&(t=Mt(this.cachedData,t),this.cachedData=null);let n,r=et(t,0),i=r?r.length:0;const s=this._audioTrack,o=this._id3Track,a=r?it(r):void 0,l=t.length;for((null===this.basePTS||0===this.frameIndex&&m(a))&&(this.basePTS=Jn(a,e,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&r.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:xe.audioId3,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(t,i)){const e=this.appendFrame(s,t,i);e?(this.frameIndex++,this.lastPTS=e.sample.pts,i+=e.length,n=i):i=l}else rt(t,i)?(r=et(t,i),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:xe.audioId3,duration:Number.POSITIVE_INFINITY}),i+=r.length,n=i):i++;if(i===l&&n!==l){const e=Z(t,n);this.cachedData?this.cachedData=Mt(this.cachedData,e):this.cachedData=e}}return{audioTrack:s,videoTrack:Qn(),id3Track:o,textTrack:Qn()}}demuxSampleAes(t,e,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Qn(),id3Track:this._id3Track,textTrack:Qn()}}destroy(){}}const Jn=(t,e,n)=>{if(m(t))return 90*t;return 9e4*e+(n?9e4*n.baseTime/n.timescale:0)};function tr(t,e){return 255===t[e]&&240==(246&t[e+1])}function er(t,e){return 1&t[e+1]?7:9}function nr(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function rr(t,e){return e+1<t.length&&tr(t,e)}function ir(t,e){if(rr(t,e)){const n=er(t,e);if(e+n>=t.length)return!1;const r=nr(t,e);if(r<=n)return!1;const i=e+r;return i===t.length||rr(t,i)}return!1}function sr(t,e,n,r,i){if(!t.samplerate){const s=function(t,e,n,r){let i,s,o,a;const l=navigator.userAgent.toLowerCase(),u=r,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=1+((192&e[n+2])>>>6);const h=(60&e[n+2])>>>2;if(!(h>c.length-1))return o=(1&e[n+2])<<2,o|=(192&e[n+3])>>>6,L.log(`manifest codec:${r}, ADTS type:${i}, samplingIndex:${h}`),/firefox/i.test(l)?h>=6?(i=5,a=new Array(4),s=h-3):(i=2,a=new Array(2),s=h):-1!==l.indexOf("android")?(i=2,a=new Array(2),s=h):(i=5,a=new Array(4),r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&h>=6?s=h-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(h>=6&&1===o||/vivaldi/i.test(l))||!r&&1===o)&&(i=2,a=new Array(2)),s=h)),a[0]=i<<3,a[0]|=(14&h)>>1,a[1]|=(1&h)<<7,a[1]|=o<<3,5===i&&(a[1]|=(14&s)>>1,a[2]=(1&s)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:c[h],channelCount:o,codec:"mp4a.40."+i,manifestCodec:u};{const e=new Error(`invalid ADTS sampling index:${h}`);t.emit(b.ERROR,b.ERROR,{type:E.MEDIA_ERROR,details:T.FRAG_PARSING_ERROR,fatal:!0,error:e,reason:e.message})}}(e,n,r,i);if(!s)return;t.config=s.config,t.samplerate=s.samplerate,t.channelCount=s.channelCount,t.codec=s.codec,t.manifestCodec=s.manifestCodec,L.log(`parsed codec:${t.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function or(t){return 9216e4/t}function ar(t,e,n,r,i){const s=r+i*or(t.samplerate),o=function(t,e){const n=er(t,e);if(e+n<=t.length){const r=nr(t,e)-n;if(r>0)return{headerLength:n,frameLength:r}}}(e,n);let a;if(o){const{frameLength:r,headerLength:i}=o,l=i+r,u=Math.max(0,n+l-e.length);u?(a=new Uint8Array(l-i),a.set(e.subarray(n+i,e.length),0)):a=e.subarray(n+i,n+l);const c={unit:a,pts:s};return u||t.samples.push(c),{sample:c,length:l,missing:u}}const l=e.length-n;return a=new Uint8Array(l),a.set(e.subarray(n,e.length),0),{sample:{unit:a,pts:s},length:l,missing:-1}}let lr=null;const ur=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],cr=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],hr=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],dr=[0,1,1,4];function fr(t,e,n,r,i){if(n+24>e.length)return;const s=pr(e,n);if(s&&n+s.frameLength<=e.length){const o=r+i*(9e4*s.samplesPerFrame/s.sampleRate),a={unit:e.subarray(n,n+s.frameLength),pts:o,dts:o};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(a),{sample:a,length:s.frameLength,missing:0}}}function pr(t,e){const n=t[e+1]>>3&3,r=t[e+1]>>1&3,i=t[e+2]>>4&15,s=t[e+2]>>2&3;if(1!==n&&0!==i&&15!==i&&3!==s){const o=t[e+2]>>1&1,a=t[e+3]>>6,l=1e3*ur[14*(3===n?3-r:3===r?3:4)+i-1],u=cr[3*(3===n?0:2===n?1:2)+s],c=3===a?1:2,h=hr[n][r],d=dr[r],f=8*h*d,p=Math.floor(h*l/u+o)*d;if(null===lr){const t=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);lr=t?parseInt(t[1]):0}return!!lr&&lr<=87&&2===r&&l>=224e3&&0===a&&(t[e+3]=128|t[e+3]),{sampleRate:u,channelCount:c,frameLength:p,samplesPerFrame:f}}}function gr(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])}function mr(t,e){return e+1<t.length&&gr(t,e)}function vr(t,e){if(e+1<t.length&&gr(t,e)){const n=4,r=pr(t,e);let i=n;null!=r&&r.frameLength&&(i=r.frameLength);const s=e+i;return s===t.length||mr(t,s)}return!1}const yr=/\/emsg[-/]ID3/i;const br=(t,e)=>{let n=0,r=5;e+=r;const i=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=t[e];const a=Math.min(r,8),l=8-a;s[0]=4278190080>>>24+l<<l,i[0]=(o[0]&s[0])>>l,n=n?n<<a|i[0]:i[0],e+=1,r-=a}return n};class Er extends Zn{constructor(t){super(),this.observer=void 0,this.observer=t}resetInitSegment(t,e,n,r){super.resetInitSegment(t,e,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}canParse(t,e){return e+64<t.length}appendFrame(t,e,n){const r=Tr(t,e,n,this.basePTS,this.frameIndex);if(-1!==r){return{sample:t.samples[t.samples.length-1],length:r,missing:0}}}static probe(t){if(!t)return!1;const e=et(t,0);if(!e)return!1;const n=e.length;return 11===t[n]&&119===t[n+1]&&void 0!==it(e)&&br(t,n)<16}}function Tr(t,e,n,r,i){if(n+8>e.length)return-1;if(11!==e[n]||119!==e[n+1])return-1;const s=e[n+4]>>6;if(s>=3)return-1;const o=[48e3,44100,32e3][s],a=63&e[n+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*a+s];if(n+l>e.length)return-1;const u=e[n+6]>>5;let c=0;2===u?c+=2:(1&u&&1!==u&&(c+=2),4&u&&(c+=2));const h=(e[n+6]<<8|e[n+7])>>12-c&1,d=[2,1,2,3,3,4,4,5][u]+h,f=e[n+5]>>3,p=7&e[n+5],g=new Uint8Array([s<<6|f<<1|p>>2,(3&p)<<6|u<<3|h<<2|a>>4,a<<4&224]),m=r+i*(1536/o*9e4),v=e.subarray(n,n+l);return t.config=g,t.channelCount=d,t.samplerate=o,t.samples.push({unit:v,pts:m}),l}class Sr{constructor(){this.VideoSample=null}createVideoSample(t,e,n,r){return{key:t,frame:!1,pts:e,dts:n,units:[],debug:r,length:0}}getLastNalUnit(t){var e;let n,r=this.VideoSample;if(r&&0!==r.units.length||(r=t[t.length-1]),null!=(e=r)&&e.units){const t=r.units;n=t[t.length-1]}return n}pushAccessUnit(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){const n=e.samples,r=n.length;if(!r)return void e.dropped++;{const e=n[r-1];t.pts=e.pts,t.dts=e.dts}}e.samples.push(t)}t.debug.length&&L.log(t.pts+"/"+t.dts+":"+t.debug)}}class _r{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,n=t.byteLength-e,r=new Uint8Array(4),i=Math.min(4,e);if(0===i)throw new Error("no bytes available");r.set(t.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}skipBits(t){let e;t=Math.min(t,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(e=(t-=this.bitsAvailable)>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const n=this.word>>>32-e;if(t>32&&L.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return e=t-e,e>0&&this.bitsAvailable?n<<e|this.readBits(e):n}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(t){let e,n=8,r=8;for(let i=0;i<t;i++)0!==r&&(e=this.readEG(),r=(n+e+256)%256),n=0===r?n:r}readSPS(){let t,e,n,r=0,i=0,s=0,o=0;const a=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),h=this.skipBits.bind(this),d=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);a();const g=a();if(l(5),h(3),a(),f(),100===g||110===g||122===g||244===g||44===g||83===g||86===g||118===g||128===g){const t=u();if(3===t&&h(1),f(),f(),h(1),c())for(e=3!==t?8:12,n=0;n<e;n++)c()&&p(n<6?16:64)}f();const m=u();if(0===m)u();else if(1===m)for(h(1),d(),d(),t=u(),n=0;n<t;n++)d();f(),h(1);const v=u(),y=u(),b=l(1);0===b&&h(1),h(1),c()&&(r=u(),i=u(),s=u(),o=u());let E=[1,1];if(c()&&c()){switch(a()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[a()<<8|a(),a()<<8|a()]}}return{width:Math.ceil(16*(v+1)-2*r-2*i),height:(2-b)*(y+1)*16-(b?2:4)*(s+o),pixelRatio:E}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class wr extends Sr{parseAVCPES(t,e,n,r,i){const s=this.parseAVCNALu(t,n.data);let o,a=this.VideoSample,l=!1;n.data=null,a&&s.length&&!t.audFound&&(this.pushAccessUnit(a,t),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts,"")),s.forEach(r=>{var s;switch(r.type){case 1:{let e=!1;o=!0;const i=r.data;if(l&&i.length>4){const t=new _r(i).readSliceType();2!==t&&4!==t&&7!==t&&9!==t||(e=!0)}var u;if(e)null!=(u=a)&&u.frame&&!a.key&&(this.pushAccessUnit(a,t),a=this.VideoSample=null);a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts,"")),a.frame=!0,a.key=e;break}case 5:o=!0,null!=(s=a)&&s.frame&&!a.key&&(this.pushAccessUnit(a,t),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts,"")),a.key=!0,a.frame=!0;break;case 6:o=!0,Ut(r.data,1,n.pts,e.samples);break;case 7:{var c,h;o=!0,l=!0;const e=r.data,n=new _r(e).readSPS();if(!t.sps||t.width!==n.width||t.height!==n.height||(null==(c=t.pixelRatio)?void 0:c[0])!==n.pixelRatio[0]||(null==(h=t.pixelRatio)?void 0:h[1])!==n.pixelRatio[1]){t.width=n.width,t.height=n.height,t.pixelRatio=n.pixelRatio,t.sps=[e],t.duration=i;const r=e.subarray(1,4);let s="avc1.";for(let t=0;t<3;t++){let e=r[t].toString(16);e.length<2&&(e="0"+e),s+=e}t.codec=s}break}case 8:o=!0,t.pps=[r.data];break;case 9:o=!0,t.audFound=!0,a&&this.pushAccessUnit(a,t),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts,"");break;case 12:o=!0;break;default:o=!1,a&&(a.debug+="unknown NAL "+r.type+" ")}if(a&&o){a.units.push(r)}}),r&&a&&(this.pushAccessUnit(a,t),this.VideoSample=null)}parseAVCNALu(t,e){const n=e.byteLength;let r=t.naluState||0;const i=r,s=[];let o,a,l,u=0,c=-1,h=0;for(-1===r&&(c=0,h=31&e[0],r=0,u=1);u<n;)if(o=e[u++],r)if(1!==r)if(o)if(1===o){if(a=u-r-1,c>=0){const t={data:e.subarray(c,a),type:h};s.push(t)}else{const n=this.getLastNalUnit(t.samples);n&&(i&&u<=4-i&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-i)),a>0&&(n.data=Mt(n.data,e.subarray(0,a)),n.state=0))}u<n?(l=31&e[u],c=u,h=l,r=0):r=-1}else r=0;else r=3;else r=o?0:2;else r=o?0:1;if(c>=0&&r>=0){const t={data:e.subarray(c,n),type:h,state:r};s.push(t)}if(0===s.length){const n=this.getLastNalUnit(t.samples);n&&(n.data=Mt(n.data,e))}return t.naluState=r,s}}class Ar{constructor(t,e,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Wn(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(t,e,n){const r=t[e].unit;if(r.length<=16)return;const i=r.subarray(16,r.length-r.length%16),s=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(s).then(i=>{const s=new Uint8Array(i);r.set(s,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,n)})}decryptAacSamples(t,e,n){for(;;e++){if(e>=t.length)return void n();if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(t){const e=16*Math.floor((t.length-48)/160)+16,n=new Int8Array(e);let r=0;for(let e=32;e<t.length-16;e+=160,r+=16)n.set(t.subarray(e,e+16),r);return n}getAvcDecryptedUnit(t,e){const n=new Uint8Array(e);let r=0;for(let e=32;e<t.length-16;e+=160,r+=16)t.set(n.subarray(r,r+16),e);return t}decryptAvcSample(t,e,n,r,i){const s=Bt(i.data),o=this.getAvcEncryptedData(s);this.decryptBuffer(o.buffer).then(o=>{i.data=this.getAvcDecryptedUnit(s,o),this.decrypter.isSync()||this.decryptAvcSamples(t,e,n+1,r)})}decryptAvcSamples(t,e,n,r){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,n=0){if(e>=t.length)return void r();const i=t[e].units;for(;!(n>=i.length);n++){const s=i[n];if(!(s.data.length<=48||1!==s.type&&5!==s.type||(this.decryptAvcSample(t,e,n,r,s),this.decrypter.isSync())))return}}}}const Lr=188;class Rr{constructor(t,e,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=e,this.typeSupported=n,this.videoParser=new wr}static probe(t){const e=Rr.syncOffset(t);return e>0&&L.warn(`MPEG2-TS detected but first sync word found @ offset ${e}`),-1!==e}static syncOffset(t){const e=t.length;let n=Math.min(5*Lr,e-Lr)+1,r=0;for(;r<n;){let i=!1,s=-1,o=0;for(let a=r;a<e;a+=Lr){if(71!==t[a]||e-a!==Lr&&71!==t[a+Lr]){if(o)return-1;break}if(o++,-1===s&&(s=a,0!==s&&(n=Math.min(s+99*Lr,t.length-Lr)+1)),i||(i=0===Ir(t,a)),i&&o>1&&(0===s&&o>2||a+Lr>n))return s}r++}return-1}static createTrack(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:bt[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}}resetInitSegment(t,e,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Rr.createTrack("video"),this._audioTrack=Rr.createTrack("audio",r),this._id3Track=Rr.createTrack("id3"),this._txtTrack=Rr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=n,this._duration=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_videoTrack:e,_id3Track:n}=this;t&&(t.pesData=null),e&&(e.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(t,e,n=!1,r=!1){let i;n||(this.sampleAes=null);const s=this._videoTrack,o=this._audioTrack,a=this._id3Track,l=this._txtTrack;let u=s.pid,c=s.pesData,h=o.pid,d=a.pid,f=o.pesData,p=a.pesData,g=null,m=this.pmtParsed,v=this._pmtId,y=t.length;if(this.remainderData&&(y=(t=Mt(this.remainderData,t)).length,this.remainderData=null),y<Lr&&!r)return this.remainderData=t,{audioTrack:o,videoTrack:s,id3Track:a,textTrack:l};const b=Math.max(0,Rr.syncOffset(t));y-=(y-b)%Lr,y<t.byteLength&&!r&&(this.remainderData=new Uint8Array(t.buffer,y,t.buffer.byteLength-y));let E=0;for(let e=b;e<y;e+=Lr)if(71===t[e]){const r=!!(64&t[e+1]),y=Ir(t,e);let E;if((48&t[e+3])>>4>1){if(E=e+5+t[e+4],E===e+Lr)continue}else E=e+4;switch(y){case u:r&&(c&&(i=Cr(c))&&this.videoParser.parseAVCPES(s,l,i,!1,this._duration),c={data:[],size:0}),c&&(c.data.push(t.subarray(E,e+Lr)),c.size+=e+Lr-E);break;case h:if(r){if(f&&(i=Cr(f)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,i);break;case"mp3":this.parseMPEGPES(o,i);break;case"ac3":this.parseAC3PES(o,i)}f={data:[],size:0}}f&&(f.data.push(t.subarray(E,e+Lr)),f.size+=e+Lr-E);break;case d:r&&(p&&(i=Cr(p))&&this.parseID3PES(a,i),p={data:[],size:0}),p&&(p.data.push(t.subarray(E,e+Lr)),p.size+=e+Lr-E);break;case 0:r&&(E+=t[E]+1),v=this._pmtId=Dr(t,E);break;case v:{r&&(E+=t[E]+1);const i=xr(t,E,this.typeSupported,n,this.observer);u=i.videoPid,u>0&&(s.pid=u,s.segmentCodec=i.segmentVideoCodec),h=i.audioPid,h>0&&(o.pid=h,o.segmentCodec=i.segmentAudioCodec),d=i.id3Pid,d>0&&(a.pid=d),null===g||m||(L.warn(`MPEG-TS PMT found at ${e} after unknown PID '${g}'. Backtracking to sync byte @${b} to parse all TS packets.`),g=null,e=b-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:g=y}}else E++;E>0&&kr(this.observer,new Error(`Found ${E} TS packet/s that do not start with 0x47`)),s.pesData=c,o.pesData=f,a.pesData=p;const T={audioTrack:o,videoTrack:s,id3Track:a,textTrack:l};return r&&this.extractRemainingSamples(T),T}flush(){const{remainderData:t}=this;let e;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:n,id3Track:r,textTrack:i}=t,s=n.pesData,o=e.pesData,a=r.pesData;let l;if(s&&(l=Cr(s))?(this.videoParser.parseAVCPES(n,i,l,!0,this._duration),n.pesData=null):n.pesData=s,o&&(l=Cr(o))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,l);break;case"mp3":this.parseMPEGPES(e,l);break;case"ac3":this.parseAC3PES(e,l)}e.pesData=null}else null!=o&&o.size&&L.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=o;a&&(l=Cr(a))?(this.parseID3PES(r,l),r.pesData=null):r.pesData=a}demuxSampleAes(t,e,n){const r=this.demux(t,n,!0,!this.config.progressive),i=this.sampleAes=new Ar(this.observer,this.config,e);return this.decrypt(r,i)}decrypt(t,e){return new Promise(n=>{const{audioTrack:r,videoTrack:i}=t;r.samples&&"aac"===r.segmentCodec?e.decryptAacSamples(r.samples,0,()=>{i.samples?e.decryptAvcSamples(i.samples,0,0,()=>{n(t)}):n(t)}):i.samples&&e.decryptAvcSamples(i.samples,0,0,()=>{n(t)})})}destroy(){this._duration=0}parseAACPES(t,e){let n=0;const r=this.aacOverFlow;let i,s,o,a=e.data;if(r){this.aacOverFlow=null;const e=r.missing,i=r.sample.unit.byteLength;if(-1===e)a=Mt(r.sample.unit,a);else{const s=i-e;r.sample.unit.set(a.subarray(0,e),s),t.samples.push(r.sample),n=r.missing}}for(i=n,s=a.length;i<s-1&&!rr(a,i);i++);if(i!==n){let t;const e=i<s-1;if(t=e?`AAC PES did not start with ADTS header,offset:${i}`:"No ADTS header found in AAC PES",kr(this.observer,new Error(t),e),!e)return}if(sr(t,this.observer,a,i,this.audioCodec),void 0!==e.pts)o=e.pts;else{if(!r)return void L.warn("[tsdemuxer]: AAC PES unknown PTS");{const e=or(t.samplerate);o=r.sample.pts+e}}let l,u=0;for(;i<s;){if(l=ar(t,a,i,o,u),i+=l.length,l.missing){this.aacOverFlow=l;break}for(u++;i<s-1&&!rr(a,i);i++);}}parseMPEGPES(t,e){const n=e.data,r=n.length;let i=0,s=0;const o=e.pts;if(void 0!==o)for(;s<r;)if(mr(n,s)){const e=fr(t,n,s,o,i);if(!e)break;s+=e.length,i++}else s++;else L.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(t,e){{const n=e.data,r=e.pts;if(void 0===r)return void L.warn("[tsdemuxer]: AC3 PES unknown PTS");const i=n.length;let s,o=0,a=0;for(;a<i&&(s=Tr(t,n,a,r,o++))>0;)a+=s}}parseID3PES(t,e){if(void 0===e.pts)return void L.warn("[tsdemuxer]: ID3 PES unknown PTS");const n=g({},e,{type:this._videoTrack?xe.emsg:xe.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(n)}}function Ir(t,e){return((31&t[e+1])<<8)+t[e+2]}function Dr(t,e){return(31&t[e+10])<<8|t[e+11]}function xr(t,e,n,r,i){const s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<o;){const o=Ir(t,e),a=(15&t[e+3])<<8|t[e+4];switch(t[e]){case 207:if(!r){Or("ADTS AAC");break}case 15:-1===s.audioPid&&(s.audioPid=o);break;case 21:-1===s.id3Pid&&(s.id3Pid=o);break;case 219:if(!r){Or("H.264");break}case 27:-1===s.videoPid&&(s.videoPid=o,s.segmentVideoCodec="avc");break;case 3:case 4:n.mpeg||n.mp3?-1===s.audioPid&&(s.audioPid=o,s.segmentAudioCodec="mp3"):L.log("MPEG audio found, not supported in this browser");break;case 193:if(!r){Or("AC-3");break}case 129:n.ac3?-1===s.audioPid&&(s.audioPid=o,s.segmentAudioCodec="ac3"):L.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===s.audioPid&&a>0){let r=e+5,i=a;for(;i>2;){switch(t[r]){case 106:!0!==n.ac3?L.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=o,s.segmentAudioCodec="ac3")}const e=t[r+1]+2;r+=e,i-=e}}break;case 194:case 135:return kr(i,new Error("Unsupported EC-3 in M2TS found")),s;case 36:return kr(i,new Error("Unsupported HEVC in M2TS found")),s}e+=a+5}return s}function kr(t,e,n){L.warn(`parsing error: ${e.message}`),t.emit(b.ERROR,b.ERROR,{type:E.MEDIA_ERROR,details:T.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:e,reason:e.message})}function Or(t){L.log(`${t} with AES-128-CBC encryption found in unencrypted stream`)}function Cr(t){let e,n,r,i,s,o=0;const a=t.data;if(!t||0===t.size)return null;for(;a[0].length<19&&a.length>1;)a[0]=Mt(a[0],a[1]),a.splice(1,1);if(e=a[0],1===(e[0]<<16)+(e[1]<<8)+e[2]){if(n=(e[4]<<8)+e[5],n&&n>t.size-6)return null;const l=e[7];192&l&&(i=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&l?(s=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2,i-s>54e5&&(L.warn(`${Math.round((i-s)/9e4)}s delta between PTS and DTS, align them`),i=s)):s=i),r=e[8];let u=r+9;if(t.size<=u)return null;t.size-=u;const c=new Uint8Array(t.size);for(let t=0,n=a.length;t<n;t++){e=a[t];let n=e.byteLength;if(u){if(u>n){u-=n;continue}e=e.subarray(u),n-=u,u=0}c.set(e,o),o+=n}return n&&(n-=r+3),{data:c,pts:i,dts:s,len:n}}return null}class Pr{static getSilentFrame(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const Mr=Math.pow(2,32)-1;class Fr{static init(){let t;for(t in Fr.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},Fr.types)Fr.types.hasOwnProperty(t)&&(Fr.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Fr.HDLR_TYPES={video:e,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);Fr.STTS=Fr.STSC=Fr.STCO=i,Fr.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Fr.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Fr.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Fr.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),a=new Uint8Array([0,0,0,1]);Fr.FTYP=Fr.box(Fr.types.ftyp,s,a,s,o),Fr.DINF=Fr.box(Fr.types.dinf,Fr.box(Fr.types.dref,r))}static box(t,...e){let n=8,r=e.length;const i=r;for(;r--;)n+=e[r].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=255&n,s.set(t,4),r=0,n=8;r<i;r++)s.set(e[r],n),n+=e[r].byteLength;return s}static hdlr(t){return Fr.box(Fr.types.hdlr,Fr.HDLR_TYPES[t])}static mdat(t){return Fr.box(Fr.types.mdat,t)}static mdhd(t,e){e*=t;const n=Math.floor(e/(Mr+1)),r=Math.floor(e%(Mr+1));return Fr.box(Fr.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}static mdia(t){return Fr.box(Fr.types.mdia,Fr.mdhd(t.timescale,t.duration),Fr.hdlr(t.type),Fr.minf(t))}static mfhd(t){return Fr.box(Fr.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}static minf(t){return"audio"===t.type?Fr.box(Fr.types.minf,Fr.box(Fr.types.smhd,Fr.SMHD),Fr.DINF,Fr.stbl(t)):Fr.box(Fr.types.minf,Fr.box(Fr.types.vmhd,Fr.VMHD),Fr.DINF,Fr.stbl(t))}static moof(t,e,n){return Fr.box(Fr.types.moof,Fr.mfhd(t),Fr.traf(n,e))}static moov(t){let e=t.length;const n=[];for(;e--;)n[e]=Fr.trak(t[e]);return Fr.box.apply(null,[Fr.types.moov,Fr.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(Fr.mvex(t)))}static mvex(t){let e=t.length;const n=[];for(;e--;)n[e]=Fr.trex(t[e]);return Fr.box.apply(null,[Fr.types.mvex,...n])}static mvhd(t,e){e*=t;const n=Math.floor(e/(Mr+1)),r=Math.floor(e%(Mr+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Fr.box(Fr.types.mvhd,i)}static sdtp(t){const e=t.samples||[],n=new Uint8Array(4+e.length);let r,i;for(r=0;r<e.length;r++)i=e[r].flags,n[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return Fr.box(Fr.types.sdtp,n)}static stbl(t){return Fr.box(Fr.types.stbl,Fr.stsd(t),Fr.box(Fr.types.stts,Fr.STTS),Fr.box(Fr.types.stsc,Fr.STSC),Fr.box(Fr.types.stsz,Fr.STSZ),Fr.box(Fr.types.stco,Fr.STCO))}static avc1(t){let e,n,r,i=[],s=[];for(e=0;e<t.sps.length;e++)n=t.sps[e],r=n.byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(n));for(e=0;e<t.pps.length;e++)n=t.pps[e],r=n.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(n));const o=Fr.box(Fr.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(s))),a=t.width,l=t.height,u=t.pixelRatio[0],c=t.pixelRatio[1];return Fr.box(Fr.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a>>8&255,255&a,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,Fr.box(Fr.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Fr.box(Fr.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(t){const e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}static audioStsd(t){const e=t.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0])}static mp4a(t){return Fr.box(Fr.types.mp4a,Fr.audioStsd(t),Fr.box(Fr.types.esds,Fr.esds(t)))}static mp3(t){return Fr.box(Fr.types[".mp3"],Fr.audioStsd(t))}static ac3(t){return Fr.box(Fr.types["ac-3"],Fr.audioStsd(t),Fr.box(Fr.types.dac3,t.config))}static stsd(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?Fr.box(Fr.types.stsd,Fr.STSD,Fr.mp3(t)):"ac3"===t.segmentCodec?Fr.box(Fr.types.stsd,Fr.STSD,Fr.ac3(t)):Fr.box(Fr.types.stsd,Fr.STSD,Fr.mp4a(t)):Fr.box(Fr.types.stsd,Fr.STSD,Fr.avc1(t))}static tkhd(t){const e=t.id,n=t.duration*t.timescale,r=t.width,i=t.height,s=Math.floor(n/(Mr+1)),o=Math.floor(n%(Mr+1));return Fr.box(Fr.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))}static traf(t,e){const n=Fr.sdtp(t),r=t.id,i=Math.floor(e/(Mr+1)),s=Math.floor(e%(Mr+1));return Fr.box(Fr.types.traf,Fr.box(Fr.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),Fr.box(Fr.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s])),Fr.trun(t,n.length+16+20+8+16+8+8),n)}static trak(t){return t.duration=t.duration||4294967295,Fr.box(Fr.types.trak,Fr.tkhd(t),Fr.mdia(t))}static trex(t){const e=t.id;return Fr.box(Fr.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){const n=t.samples||[],r=n.length,i=12+16*r,s=new Uint8Array(i);let o,a,l,u,c,h;for(e+=8+i,s.set(["video"===t.type?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),o=0;o<r;o++)a=n[o],l=a.duration,u=a.size,c=a.flags,h=a.cts,s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*o);return Fr.box(Fr.types.trun,s)}static initSegment(t){Fr.types||Fr.init();const e=Fr.moov(t);return Mt(Fr.FTYP,e)}}Fr.types=void 0,Fr.HDLR_TYPES=void 0,Fr.STTS=void 0,Fr.STSC=void 0,Fr.STCO=void 0,Fr.STSZ=void 0,Fr.VMHD=void 0,Fr.SMHD=void 0,Fr.STSD=void 0,Fr.FTYP=void 0,Fr.DINF=void 0;const Nr=9e4;function Ur(t,e,n=1,r=!1){const i=t*e*n;return r?Math.round(i):i}function Br(t,e=!1){return Ur(t,1e3,1/Nr,e)}const $r=1e4,jr=1024,Gr=1152,Kr=1536;let Vr,Hr=null,Wr=null;class Yr{constructor(t,e,n,r=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=e,this.typeSupported=n,this.ISGenerated=!1,null===Hr){const t=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Hr=t?parseInt(t[1]):0}if(null===Wr){const t=navigator.userAgent.match(/Safari\/(\d+)/i);Wr=t?parseInt(t[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(t){L.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t}resetNextTimestamp(){L.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){L.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(t){let e=!1;const n=t.reduce((t,n)=>{const r=n.pts-t;return r<-4294967296?(e=!0,zr(t,n.pts)):r>0?t:n.pts},t[0].pts);return e&&L.debug("PTS rollover detected"),n}remux(t,e,n,r,i,s,o,a){let l,u,c,h,d,f,p=i,g=i;const m=t.pid>-1,v=e.pid>-1,y=e.samples.length,b=t.samples.length>0,E=o&&y>0||y>1;if((!m||b)&&(!v||E)||this.ISGenerated||o){if(this.ISGenerated){var T,S,_,w;const t=this.videoTrackConfig;!t||e.width===t.width&&e.height===t.height&&(null==(T=e.pixelRatio)?void 0:T[0])===(null==(S=t.pixelRatio)?void 0:S[0])&&(null==(_=e.pixelRatio)?void 0:_[1])===(null==(w=t.pixelRatio)?void 0:w[1])||this.resetInitSegment()}else c=this.generateIS(t,e,i,s);const n=this.isVideoContiguous;let r,o=-1;if(E&&(o=function(t){for(let e=0;e<t.length;e++)if(t[e].key)return e;return-1}(e.samples),!n&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,o>0){L.warn(`[mp4-remuxer]: Dropped ${o} out of ${y} video samples due to a missing keyframe`);const t=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(o),e.dropped+=o,g+=(e.samples[0].pts-t)/e.inputTimeScale,r=g}else-1===o&&(L.warn(`[mp4-remuxer]: No keyframe found out of ${y} video samples`),f=!1);if(this.ISGenerated){if(b&&E){const n=this.getVideoStartPts(e.samples),r=(zr(t.samples[0].pts,n)-n)/e.inputTimeScale;p+=Math.max(0,r),g+=Math.max(0,-r)}if(b){if(t.samplerate||(L.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(t,e,i,s)),u=this.remuxAudio(t,p,this.isAudioContiguous,s,v||E||a===Te.AUDIO?g:void 0),E){const r=u?u.endPTS-u.startPTS:0;e.inputTimeScale||(L.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(t,e,i,s)),l=this.remuxVideo(e,g,n,r)}}else E&&(l=this.remuxVideo(e,g,n,0));l&&(l.firstKeyFrame=o,l.independent=-1!==o,l.firstKeyFramePTS=r)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(d=qr(n,i,this._initPTS,this._initDTS)),r.samples.length&&(h=Xr(r,i,this._initPTS))),{audio:u,video:l,initSegment:c,independent:f,text:h,id3:d}}generateIS(t,e,n,r){const i=t.samples,s=e.samples,o=this.typeSupported,a={},l=this._initPTS;let u,c,h,d=!l||r,f="audio/mp4";if(d&&(u=c=1/0),t.config&&i.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":o.mpeg?(f="audio/mpeg",t.codec=""):o.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3"}a.audio={id:"audio",container:f,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&o.mpeg?new Uint8Array(0):Fr.initSegment([t]),metadata:{channelCount:t.channelCount}},d&&(h=t.inputTimeScale,l&&h===l.timescale?d=!1:u=c=i[0].pts-Math.round(h*n))}if(e.sps&&e.pps&&s.length){if(e.timescale=e.inputTimeScale,a.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Fr.initSegment([e]),metadata:{width:e.width,height:e.height}},d)if(h=e.inputTimeScale,l&&h===l.timescale)d=!1;else{const t=this.getVideoStartPts(s),e=Math.round(h*n);c=Math.min(c,zr(s[0].dts,t)-e),u=Math.min(u,t-e)}this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(a).length)return this.ISGenerated=!0,d?(this._initPTS={baseTime:u,timescale:h},this._initDTS={baseTime:c,timescale:h}):u=h=void 0,{tracks:a,initPTS:u,timescale:h}}remuxVideo(t,e,n,r){const i=t.inputTimeScale,s=t.samples,o=[],a=s.length,l=this._initPTS;let u,c,h=this.nextAvcDts,d=8,f=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,v=!1;if(!n||null===h){const t=e*i,r=s[0].pts-zr(s[0].dts,s[0].pts);Hr&&null!==h&&Math.abs(t-r-h)<15e3?n=!0:h=t-r}const y=l.baseTime*i/l.timescale;for(let t=0;t<a;t++){const e=s[t];e.pts=zr(e.pts-y,h),e.dts=zr(e.dts-y,h),e.dts<s[t>0?t-1:t].dts&&(v=!0)}v&&s.sort((function(t,e){const n=t.dts-e.dts,r=t.pts-e.pts;return n||r})),u=s[0].dts,c=s[s.length-1].dts;const S=c-u,_=S?Math.round(S/(a-1)):f||t.inputTimeScale/30;if(n){const t=u-h,n=t>_,r=t<-1;if((n||r)&&(n?L.warn(`AVC: ${Br(t,!0)} ms (${t}dts) hole between fragments detected at ${e.toFixed(3)}`):L.warn(`AVC: ${Br(-t,!0)} ms (${t}dts) overlapping between fragments detected at ${e.toFixed(3)}`),!r||h>=s[0].pts||Hr)){u=h;const e=s[0].pts-t;if(n)s[0].dts=u,s[0].pts=e;else for(let n=0;n<s.length&&!(s[n].dts>e);n++)s[n].dts-=t,s[n].pts-=t;L.log(`Video: Initial PTS/DTS adjusted: ${Br(e,!0)}/${Br(u,!0)}, delta: ${Br(t,!0)} ms`)}}u=Math.max(0,u);let w=0,A=0,R=u;for(let t=0;t<a;t++){const e=s[t],n=e.units,r=n.length;let i=0;for(let t=0;t<r;t++)i+=n[t].data.length;A+=i,w+=r,e.length=i,e.dts<R?(e.dts=R,R+=_/4|0||1):R=e.dts,p=Math.min(e.pts,p),m=Math.max(e.pts,m)}c=s[a-1].dts;const I=A+4*w+8;let D;try{D=new Uint8Array(I)}catch(t){return void this.observer.emit(b.ERROR,b.ERROR,{type:E.MUX_ERROR,details:T.REMUX_ALLOC_ERROR,fatal:!1,error:t,bytes:I,reason:`fail allocating video mdat ${I}`})}const x=new DataView(D.buffer);x.setUint32(0,I),D.set(Fr.types.mdat,4);let k=!1,O=Number.POSITIVE_INFINITY,C=Number.POSITIVE_INFINITY,P=Number.NEGATIVE_INFINITY,M=Number.NEGATIVE_INFINITY;for(let t=0;t<a;t++){const e=s[t],n=e.units;let l,u=0;for(let t=0,e=n.length;t<e;t++){const e=n[t],r=e.data,i=e.data.byteLength;x.setUint32(d,i),d+=4,D.set(r,d),d+=i,u+=4+i}if(t<a-1)f=s[t+1].dts-e.dts,l=s[t+1].pts-e.pts;else{const n=this.config,o=t>0?e.dts-s[t-1].dts:_;if(l=t>0?e.pts-s[t-1].pts:_,n.stretchShortVideoTrack&&null!==this.nextAudioPts){const t=Math.floor(n.maxBufferHole*i),s=(r?p+r*i:this.nextAudioPts)-e.pts;s>t?(f=s-o,f<0?f=o:k=!0,L.log(`[mp4-remuxer]: It is approximately ${s/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=o}else f=o}const c=Math.round(e.pts-e.dts);O=Math.min(O,f),P=Math.max(P,f),C=Math.min(C,l),M=Math.max(M,l),o.push(new Qr(e.key,f,u,c))}if(o.length)if(Hr){if(Hr<70){const t=o[0].flags;t.dependsOn=2,t.isNonSync=0}}else if(Wr&&M-C<P-O&&_/P<.025&&0===o[0].cts){L.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let t=u;for(let e=0,n=o.length;e<n;e++){const r=t+o[e].duration,i=t+o[e].cts;if(e<n-1){const t=r+o[e+1].cts;o[e].duration=t-i}else o[e].duration=e?o[e-1].duration:_;o[e].cts=0,t=r}}f=k||!f?_:f,this.nextAvcDts=h=c+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const F={data1:Fr.moof(t.sequenceNumber++,u,g({},t,{samples:o})),data2:D,startPTS:p/i,endPTS:(m+f)/i,startDTS:u/i,endDTS:h/i,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:t.dropped};return t.samples=[],t.dropped=0,F}getSamplesPerFrame(t){switch(t.segmentCodec){case"mp3":return Gr;case"ac3":return Kr;default:return jr}}remuxAudio(t,e,n,r,i){const s=t.inputTimeScale,o=s/(t.samplerate?t.samplerate:s),a=this.getSamplesPerFrame(t),l=a*o,u=this._initPTS,c="mp3"===t.segmentCodec&&this.typeSupported.mpeg,h=[],d=void 0!==i;let f=t.samples,p=c?0:8,m=this.nextAudioPts||-1;const v=e*s,y=u.baseTime*s/u.timescale;if(this.isAudioContiguous=n=n||f.length&&m>0&&(r&&Math.abs(v-m)<9e3||Math.abs(zr(f[0].pts-y,v)-m)<20*l),f.forEach((function(t){t.pts=zr(t.pts-y,v)})),!n||m<0){if(f=f.filter(t=>t.pts>=0),!f.length)return;m=0===i?0:r&&!d?Math.max(0,v):f[0].pts}if("aac"===t.segmentCodec){const e=this.config.maxAudioFramesDrift;for(let n=0,r=m;n<f.length;n++){const i=f[n],o=i.pts,a=o-r,u=Math.abs(1e3*a/s);if(a<=-e*l&&d)0===n&&(L.warn(`Audio frame @ ${(o/s).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*a/s)} ms.`),this.nextAudioPts=m=r=o);else if(a>=e*l&&u<$r&&d){let e=Math.round(a/l);r=o-e*l,r<0&&(e--,r+=l),0===n&&(this.nextAudioPts=m=r),L.warn(`[mp4-remuxer]: Injecting ${e} audio frame @ ${(r/s).toFixed(3)}s due to ${Math.round(1e3*a/s)} ms gap.`);for(let s=0;s<e;s++){const e=Math.max(r,0);let s=Pr.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);s||(L.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),s=i.unit.subarray()),f.splice(n,0,{unit:s,pts:e}),r+=l,n++}}i.pts=r,r+=l}}let S,_=null,w=null,A=0,R=f.length;for(;R--;)A+=f[R].unit.byteLength;for(let e=0,r=f.length;e<r;e++){const r=f[e],i=r.unit;let s=r.pts;if(null!==w){h[e-1].duration=Math.round((s-w)/o)}else{if(n&&"aac"===t.segmentCodec&&(s=m),_=s,!(A>0))return;A+=p;try{S=new Uint8Array(A)}catch(t){return void this.observer.emit(b.ERROR,b.ERROR,{type:E.MUX_ERROR,details:T.REMUX_ALLOC_ERROR,fatal:!1,error:t,bytes:A,reason:`fail allocating audio mdat ${A}`})}if(!c){new DataView(S.buffer).setUint32(0,A),S.set(Fr.types.mdat,4)}}S.set(i,p);const l=i.byteLength;p+=l,h.push(new Qr(!0,a,l,0)),w=s}const I=h.length;if(!I)return;const D=h[h.length-1];this.nextAudioPts=m=w+o*D.duration;const x=c?new Uint8Array(0):Fr.moof(t.sequenceNumber++,_/o,g({},t,{samples:h}));t.samples=[];const k=_/s,O=m/s,C={data1:x,data2:S,startPTS:k,endPTS:O,startDTS:k,endDTS:O,type:"audio",hasAudio:!0,hasVideo:!1,nb:I};return this.isAudioContiguous=!0,C}remuxEmptyAudio(t,e,n,r){const i=t.inputTimeScale,s=i/(t.samplerate?t.samplerate:i),o=this.nextAudioPts,a=this._initDTS,l=9e4*a.baseTime/a.timescale,u=(null!==o?o:r.startDTS*i)+l,c=r.endDTS*i+l,h=s*jr,d=Math.ceil((c-u)/h),f=Pr.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(L.warn("[mp4-remuxer]: remux empty Audio"),!f)return void L.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");const p=[];for(let t=0;t<d;t++){const e=u+t*h;p.push({unit:f,pts:e,dts:e})}return t.samples=p,this.remuxAudio(t,e,n,!1)}}function zr(t,e){let n;if(null===e)return t;for(n=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=n;return t}function qr(t,e,n,r){const i=t.samples.length;if(!i)return;const s=t.inputTimeScale;for(let o=0;o<i;o++){const i=t.samples[o];i.pts=zr(i.pts-n.baseTime*s/n.timescale,e*s)/s,i.dts=zr(i.dts-r.baseTime*s/r.timescale,e*s)/s}const o=t.samples;return t.samples=[],{samples:o}}function Xr(t,e,n){const r=t.samples.length;if(!r)return;const i=t.inputTimeScale;for(let s=0;s<r;s++){const r=t.samples[s];r.pts=zr(r.pts-n.baseTime*i/n.timescale,e*i)/i}t.samples.sort((t,e)=>t.pts-e.pts);const s=t.samples;return t.samples=[],{samples:s}}class Qr{constructor(t,e,n,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=n,this.cts=r,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:t?2:1,isNonSync:t?0:1}}}function Zr(t,e){const n=null==t?void 0:t.codec;if(n&&n.length>4)return n;if(e===C.AUDIO){if("ec-3"===n||"ac-3"===n||"alac"===n)return n;if("fLaC"===n||"Opus"===n){return se(n,!1)}const t="mp4a.40.5";return L.info(`Parsed audio codec "${n}" or audio object type not handled. Using "${t}"`),t}return L.warn(`Unhandled video codec "${n}"`),"hvc1"===n||"hev1"===n?"hvc1.1.6.L120.90":"av01"===n?"av01.0.04M.08":"avc1.42e01e"}try{Vr=self.performance.now.bind(self.performance)}catch(t){L.debug("Unable to use Performance API on this environment"),Vr=null==G?void 0:G.Date.now}const Jr=[{demux:class{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,n,r){const i=this.videoTrack=Qn("video",1),s=this.audioTrack=Qn("audio",1),o=this.txtTrack=Qn("text",1);if(this.id3Track=Qn("id3",1),this.timeOffset=0,null==t||!t.byteLength)return;const a=It(t);if(a.video){const{id:t,timescale:e,codec:n}=a.video;i.id=t,i.timescale=o.timescale=e,i.codec=n}if(a.audio){const{id:t,timescale:e,codec:n}=a.audio;s.id=t,s.timescale=e,s.codec=n}o.id=bt.text,i.sampleDuration=0,i.duration=s.duration=r}resetContiguity(){this.remainderData=null}static probe(t){return function(t){const e=t.byteLength;for(let n=0;n<e;){const r=St(t,n);if(r>8&&109===t[n+4]&&111===t[n+5]&&111===t[n+6]&&102===t[n+7])return!0;n=r>1?n+r:e}return!1}(t)}demux(t,e){this.timeOffset=e;let n=t;const r=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Mt(this.remainderData,t));const e=function(t){const e={valid:null,remainder:null},n=Lt(t,["moof"]);if(n.length<2)return e.remainder=t,e;const r=n[n.length-1];return e.valid=Z(t,0,r.byteOffset-8),e.remainder=Z(t,r.byteOffset-8),e}(n);this.remainderData=e.remainder,r.samples=e.valid||new Uint8Array}else r.samples=n;const s=this.extractID3Track(r,e);return i.samples=Ft(e,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,n=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(e,this.timeOffset);return n.samples=Ft(t,e),{videoTrack:e,audioTrack:Qn(),id3Track:r,textTrack:Qn()}}extractID3Track(t,e){const n=this.id3Track;if(t.samples.length){const r=Lt(t.samples,["emsg"]);r&&r.forEach(t=>{const r=function(t){const e=t[0];let n="",r="",i=0,s=0,o=0,a=0,l=0,u=0;if(0===e){for(;"\0"!==Et(t.subarray(u,u+1));)n+=Et(t.subarray(u,u+1)),u+=1;for(n+=Et(t.subarray(u,u+1)),u+=1;"\0"!==Et(t.subarray(u,u+1));)r+=Et(t.subarray(u,u+1)),u+=1;r+=Et(t.subarray(u,u+1)),u+=1,i=St(t,12),s=St(t,16),a=St(t,20),l=St(t,24),u=28}else if(1===e){u+=4,i=St(t,u),u+=4;const e=St(t,u);u+=4;const s=St(t,u);for(u+=4,o=2**32*e+s,v(o)||(o=Number.MAX_SAFE_INTEGER,L.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=St(t,u),u+=4,l=St(t,u),u+=4;"\0"!==Et(t.subarray(u,u+1));)n+=Et(t.subarray(u,u+1)),u+=1;for(n+=Et(t.subarray(u,u+1)),u+=1;"\0"!==Et(t.subarray(u,u+1));)r+=Et(t.subarray(u,u+1)),u+=1;r+=Et(t.subarray(u,u+1)),u+=1}return{schemeIdUri:n,value:r,timeScale:i,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:t.subarray(u,t.byteLength)}}(t);if(yr.test(r.schemeIdUri)){const t=m(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale;let i=4294967295===r.eventDuration?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;i<=.001&&(i=Number.POSITIVE_INFINITY);const s=r.payload;n.samples.push({data:s,len:s.byteLength,dts:t,pts:t,type:xe.emsg,duration:i})}})}return n}demuxSampleAes(t,e,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},remux:class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(t){this.initPTS=t,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(t,e,n,r){this.audioCodec=e,this.videoCodec=n,this.generateInitSegment(function(t,e){if(!t||!e)return t;const n=e.keyId;if(n&&e.isCommonEncryption){Lt(t,["moov","trak"]).forEach(t=>{const e=Lt(t,["mdia","minf","stbl","stsd"])[0].subarray(8);let r=Lt(e,["enca"]);const i=r.length>0;i||(r=Lt(e,["encv"])),r.forEach(t=>{Lt(i?t.subarray(28):t.subarray(78),["sinf"]).forEach(t=>{const e=Ct(t);if(e){const t=e.subarray(8,24);t.some(t=>0!==t)||(L.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${mt.hexDump(t)} -> ${mt.hexDump(n)}`),e.set(n,8))}})})})}return t}(t,r)),this.emitInitSegment=!0}generateInitSegment(t){let{audioCodec:e,videoCodec:n}=this;if(null==t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const r=this.initData=It(t);r.audio&&(e=Zr(r.audio,C.AUDIO)),r.video&&(n=Zr(r.video,C.VIDEO));const i={};r.audio&&r.video?i.audiovideo={container:"video/mp4",codec:e+","+n,initSegment:t,id:"main"}:r.audio?i.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:r.video?i.video={container:"video/mp4",codec:n,initSegment:t,id:"main"}:L.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i}remux(t,e,n,r,i,s){var o,a;let{initPTS:l,lastEndTime:u}=this;const c={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};m(u)||(u=this.lastEndTime=i||0);const h=e.samples;if(null==h||!h.length)return c;const d={initPTS:void 0,timescale:1};let f=this.initData;if(null!=(o=f)&&o.length||(this.generateInitSegment(h),f=this.initData),null==(a=f)||!a.length)return L.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);const p=function(t,e){let n=0,r=0,i=0;const s=Lt(t,["moof","traf"]);for(let t=0;t<s.length;t++){const o=s[t],a=Lt(o,["tfhd"])[0],l=e[St(a,4)];if(!l)continue;const u=l.default,c=St(a,0)|(null==u?void 0:u.flags);let h=null==u?void 0:u.duration;8&c&&(h=St(a,2&c?12:8));const d=l.timescale||9e4,f=Lt(o,["trun"]);for(let t=0;t<f.length;t++){if(n=Pt(f[t]),!n&&h){n=h*St(f[t],4)}l.type===C.VIDEO?r+=n/d:l.type===C.AUDIO&&(i+=n/d)}}if(0===r&&0===i){let e=1/0,n=0,r=0;const i=Lt(t,["sidx"]);for(let t=0;t<i.length;t++){const s=Rt(i[t]);if(null!=s&&s.references){e=Math.min(e,s.earliestPresentationTime/s.timescale);const t=s.references.reduce((t,e)=>t+e.info.duration||0,0);n=Math.max(n,t+s.earliestPresentationTime/s.timescale),r=n-e}}if(r&&m(r))return r}return r||i}(h,f),g=function(t,e){return Lt(e,["moof","traf"]).reduce((e,n)=>{const r=Lt(n,["tfdt"])[0],i=r[0],s=Lt(n,["tfhd"]).reduce((e,n)=>{const s=St(n,4),o=t[s];if(o){let t=St(r,4);if(1===i){if(t===vt)return L.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),e;t*=vt+1,t+=St(r,8)}const n=t/(o.timescale||9e4);if(m(n)&&(null===e||n<e))return n}return e},null);return null!==s&&m(s)&&(null===e||s<e)?s:e},null)}(f,h),v=null===g?i:g;(function(t,e,n,r){if(null===t)return!0;const i=Math.max(r,1),s=e-t.baseTime/t.timescale;return Math.abs(s-n)>i}(l,v,i,p)||d.timescale!==l.timescale&&s)&&(d.initPTS=v-i,l&&1===l.timescale&&L.warn(`Adjusting initPTS by ${d.initPTS-l.baseTime}`),this.initPTS=l={baseTime:d.initPTS,timescale:1});const y=t?v-l.baseTime/l.timescale:u,b=y+p;!function(t,e,n){Lt(e,["moof","traf"]).forEach(e=>{Lt(e,["tfhd"]).forEach(r=>{const i=St(r,4),s=t[i];if(!s)return;const o=s.timescale||9e4;Lt(e,["tfdt"]).forEach(t=>{const e=t[0],r=n*o;if(r){let n=St(t,4);if(0===e)n-=r,n=Math.max(n,0),At(t,4,n);else{n*=Math.pow(2,32),n+=St(t,8),n-=r,n=Math.max(n,0);const e=Math.floor(n/(vt+1)),i=Math.floor(n%(vt+1));At(t,4,e),At(t,8,i)}}})})})}(f,h,l.baseTime/l.timescale),p>0?this.lastEndTime=b:(L.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const E=!!f.audio,T=!!f.video;let S="";E&&(S+="audio"),T&&(S+="video");const _={data1:h,startPTS:y,startDTS:y,endPTS:b,endDTS:b,type:S,hasAudio:E,hasVideo:T,nb:1,dropped:0};return c.audio="audio"===_.type?_:void 0,c.video="audio"!==_.type?_:void 0,c.initSegment=d,c.id3=qr(n,i,l,l),r.samples.length&&(c.text=Xr(r,i,l)),c}}},{demux:Rr,remux:Yr},{demux:class extends Zn{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,n,r){super.resetInitSegment(t,e,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;const e=et(t,0);let n=(null==e?void 0:e.length)||0;if(vr(t,n))return!1;for(let e=t.length;n<e;n++)if(ir(t,n))return L.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return function(t,e){return function(t,e){return e+5<t.length}(t,e)&&tr(t,e)&&nr(t,e)<=t.length-e}(t,e)}appendFrame(t,e,n){sr(t,this.observer,e,n,t.manifestCodec);const r=ar(t,e,n,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r}},remux:Yr},{demux:class extends Zn{resetInitSegment(t,e,n,r){super.resetInitSegment(t,e,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;const e=et(t,0);let n=(null==e?void 0:e.length)||0;if(e&&11===t[n]&&119===t[n+1]&&void 0!==it(e)&&br(t,n)<=16)return!1;for(let e=t.length;n<e;n++)if(vr(t,n))return L.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return function(t,e){return gr(t,e)&&4<=t.length-e}(t,e)}appendFrame(t,e,n){if(null!==this.basePTS)return fr(t,e,n,this.basePTS,this.frameIndex)}},remux:Yr}];Jr.splice(2,0,{demux:Er,remux:Yr});class ti{constructor(t,e,n,r,i){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=n,this.vendor=r,this.id=i}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,n,r){const i=n.transmuxing;i.executeStart=Vr();let s=new Uint8Array(t);const{currentTransmuxState:o,transmuxConfig:a}=this;r&&(this.currentTransmuxState=r);const{contiguous:l,discontinuity:u,trackSwitch:c,accurateTimeOffset:h,timeOffset:d,initSegmentChange:f}=r||o,{audioCodec:p,videoCodec:g,defaultInitPts:m,duration:v,initSegmentData:y}=a,S=function(t,e){let n=null;t.byteLength>0&&null!=(null==e?void 0:e.key)&&null!==e.iv&&null!=e.method&&(n=e);return n}(s,e);if(S&&"AES-128"===S.method){const t=this.getDecrypter();if(!t.isSync())return this.decryptionPromise=t.webCryptoDecrypt(s,S.key.buffer,S.iv.buffer).then(t=>{const e=this.push(t,null,n);return this.decryptionPromise=null,e}),this.decryptionPromise;{let e=t.softwareDecrypt(s,S.key.buffer,S.iv.buffer);if(n.part>-1&&(e=t.flush()),!e)return i.executeEnd=Vr(),ei(n);s=new Uint8Array(e)}}const _=this.needsProbing(u,c);if(_){const t=this.configureTransmuxer(s);if(t)return L.warn(`[transmuxer] ${t.message}`),this.observer.emit(b.ERROR,b.ERROR,{type:E.MEDIA_ERROR,details:T.FRAG_PARSING_ERROR,fatal:!1,error:t,reason:t.message}),i.executeEnd=Vr(),ei(n)}(u||c||f||_)&&this.resetInitSegment(y,p,g,v,e),(u||f||_)&&this.resetInitialTimestamp(m),l||this.resetContiguity();const w=this.transmux(s,S,d,h,n),A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,i.executeEnd=Vr(),w}flush(t){const e=t.transmuxing;e.executeStart=Vr();const{decrypter:n,currentTransmuxState:r,decryptionPromise:i}=this;if(i)return i.then(()=>this.flush(t));const s=[],{timeOffset:o}=r;if(n){const e=n.flush();e&&s.push(this.push(e,null,t))}const{demuxer:a,remuxer:l}=this;if(!a||!l)return e.executeEnd=Vr(),[ei(t)];const u=a.flush(o);return ni(u)?u.then(e=>(this.flushRemux(s,e,t),s)):(this.flushRemux(s,u,t),s)}flushRemux(t,e,n){const{audioTrack:r,videoTrack:i,id3Track:s,textTrack:o}=e,{accurateTimeOffset:a,timeOffset:l}=this.currentTransmuxState;L.log(`[transmuxer.ts]: Flushed fragment ${n.sn}${n.part>-1?" p: "+n.part:""} of level ${n.level}`);const u=this.remuxer.remux(r,i,s,o,l,a,!0,this.id);t.push({remuxResult:u,chunkMeta:n}),n.transmuxing.executeEnd=Vr()}resetInitialTimestamp(t){const{demuxer:e,remuxer:n}=this;e&&n&&(e.resetTimeStamp(t),n.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,n,r,i){const{demuxer:s,remuxer:o}=this;s&&o&&(s.resetInitSegment(t,e,n,r),o.resetInitSegment(t,e,n,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,n,r,i){let s;return s=e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,n,r,i):this.transmuxUnencrypted(t,n,r,i),s}transmuxUnencrypted(t,e,n,r){const{audioTrack:i,videoTrack:s,id3Track:o,textTrack:a}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,s,o,a,e,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(t,e,n,r,i){return this.demuxer.demuxSampleAes(t,e,n).then(t=>{return{remuxResult:this.remuxer.remux(t.audioTrack,t.videoTrack,t.id3Track,t.textTrack,n,r,!1,this.id),chunkMeta:i}})}configureTransmuxer(t){const{config:e,observer:n,typeSupported:r,vendor:i}=this;let s;for(let e=0,n=Jr.length;e<n;e++){var o;if(null!=(o=Jr[e].demux)&&o.probe(t)){s=Jr[e];break}}if(!s)return new Error("Failed to find demuxer by probing fragment data");const a=this.demuxer,l=this.remuxer,u=s.remux,c=s.demux;l&&l instanceof u||(this.remuxer=new u(n,e,r,i)),a&&a instanceof c||(this.demuxer=new c(n,e,r),this.probe=c.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new Wn(this.config)),t}}const ei=t=>({remuxResult:{},chunkMeta:t});function ni(t){return"then"in t&&t.then instanceof Function}class ri{constructor(t,e,n,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=n,this.duration=r,this.defaultInitPts=i||null}}class ii{constructor(t,e,n,r,i,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=i,this.initSegmentChange=s}}var si={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,r,s,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new i(r,s||t,o),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},a.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o},a.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},a.prototype.emit=function(t,e,r,i,s,o){var a=n?n+t:t;if(!this._events[a])return!1;var l,u,c=this._events[a],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,i),!0;case 5:return c.fn.call(c.context,e,r,i,s),!0;case 6:return c.fn.call(c.context,e,r,i,s,o),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,r);break;case 4:c[u].fn.call(c[u].context,e,r,i);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},a.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},a.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},a.prototype.removeListener=function(t,e,r,i){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||i&&!a.once||r&&a.context!==r||o(this,s);else{for(var l=0,u=[],c=a.length;l<c;l++)(a[l].fn!==e||i&&!a[l].once||r&&a[l].context!==r)&&u.push(a[l]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&o(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a}(si);var oi=r(si.exports);class ai{constructor(t,e,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const i=t.config;this.hls=t,this.id=e,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const s=(t,e)=>{(e=e||{}).frag=this.frag,e.id=this.id,t===b.ERROR&&(this.error=e.error),this.hls.trigger(t,e)};this.observer=new oi,this.observer.on(b.FRAG_DECRYPTED,s),this.observer.on(b.ERROR,s);const o=Xt(i.preferManagedMediaSource)||{isTypeSupported:()=>!1},a={mpeg:o.isTypeSupported("audio/mpeg"),mp3:o.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:o.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&"undefined"!=typeof Worker){if(i.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{i.workerPath?(L.log(`loading Web Worker ${i.workerPath} for "${e}"`),this.workerContext=function(t){const e=new self.URL(t,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}(i.workerPath)):(L.log(`injecting Web Worker for "${e}"`),this.workerContext=function(){const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(t);return{worker:new self.Worker(e),objectURL:e}}()),this.onwmsg=t=>this.onWorkerMessage(t);const{worker:t}=this.workerContext;t.addEventListener("message",this.onwmsg),t.onerror=t=>{const n=new Error(`${t.message}  (${t.filename}:${t.lineno})`);i.enableWorker=!1,L.warn(`Error in "${e}" Web Worker, fallback to inline`),this.hls.trigger(b.ERROR,{type:E.OTHER_ERROR,details:T.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:n})},t.postMessage({cmd:"init",typeSupported:a,vendor:"",id:e,config:JSON.stringify(i)})}catch(t){L.warn(`Error setting up "${e}" Web Worker, fallback to inline`,t),this.resetWorker(),this.error=null,this.transmuxer=new ti(this.observer,a,i,"",e)}return}}this.transmuxer=new ti(this.observer,a,i,"",e)}resetWorker(){if(this.workerContext){const{worker:t,objectURL:e}=this.workerContext;e&&self.URL.revokeObjectURL(e),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(t,e,n,r,i,s,o,a,l,u){var c,h;l.transmuxing.start=self.performance.now();const{transmuxer:d}=this,f=s?s.start:i.start,p=i.decryptdata,g=this.frag,m=!(g&&i.cc===g.cc),v=!(g&&l.level===g.level),y=g?l.sn-g.sn:-1,b=this.part?l.part-this.part.index:-1,E=0===y&&l.id>1&&l.id===(null==g?void 0:g.stats.chunkCount),T=!v&&(1===y||0===y&&(1===b||E&&b<=0)),S=self.performance.now();(v||y||0===i.stats.parsing.start)&&(i.stats.parsing.start=S),!s||!b&&T||(s.stats.parsing.start=S);const _=!(g&&(null==(c=i.initSegment)?void 0:c.url)===(null==(h=g.initSegment)?void 0:h.url)),w=new ii(m,T,a,v,f,_);if(!T||m||_){L.log(`[transmuxer-interface, ${i.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}\n        discontinuity: ${m}\n        trackSwitch: ${v}\n        contiguous: ${T}\n        accurateTimeOffset: ${a}\n        timeOffset: ${f}\n        initSegmentChange: ${_}`);const t=new ri(n,r,e,o,u);this.configureTransmuxer(t)}if(this.frag=i,this.part=s,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:t,decryptdata:p,chunkMeta:l,state:w},t instanceof ArrayBuffer?[t]:[]);else if(d){const e=d.push(t,p,l,w);ni(e)?(d.async=!0,e.then(t=>{this.handleTransmuxComplete(t)}).catch(t=>{this.transmuxerError(t,l,"transmuxer-interface push error")})):(d.async=!1,this.handleTransmuxComplete(e))}}flush(t){t.transmuxing.start=self.performance.now();const{transmuxer:e}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:t});else if(e){let n=e.flush(t);ni(n)||e.async?(ni(n)||(n=Promise.resolve(n)),n.then(e=>{this.handleFlushResult(e,t)}).catch(e=>{this.transmuxerError(e,t,"transmuxer-interface flush error")})):this.handleFlushResult(n,t)}}transmuxerError(t,e,n){this.hls&&(this.error=t,this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,fatal:!1,error:t,err:t,reason:n}))}handleFlushResult(t,e){t.forEach(t=>{this.handleTransmuxComplete(t)}),this.onFlush(e)}onWorkerMessage(t){const e=t.data;if(null==e||!e.event)return void L.warn(`worker message received with no ${e?"event name":"data"}`);const n=this.hls;if(this.hls)switch(e.event){case"init":{var r;const t=null==(r=this.workerContext)?void 0:r.objectURL;t&&self.URL.revokeObjectURL(t);break}case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;case"workerLog":L[e.data.logType]&&L[e.data.logType](e.data.message);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,n.trigger(e.event,e.data)}}configureTransmuxer(t){const{transmuxer:e}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:t}):e&&e.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}function li(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!ui(t[n].attrs,e[n].attrs))return!1;return!0}function ui(t,e,n){const r=t["STABLE-RENDITION-ID"];return r&&!n?r===e["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>t[n]!==e[n])}function ci(t,e){return e.label.toLowerCase()===t.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(t.lang||"").toLowerCase())}const hi=100;const di=500;class fi{constructor(t){this.buffered=void 0;const e=(e,n,r)=>{if((n>>>=0)>r-1)throw new DOMException(`Failed to execute '${e}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${r})`);return t[n][e]};this.buffered={get length(){return t.length},end:n=>e("end",n,t.length),start:n=>e("start",n,t.length)}}}class pi{constructor(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}append(t,e,n){const r=this.queues[e];r.push(t),1!==r.length||n||this.executeNext(e)}insertAbort(t,e){this.queues[e].unshift(t),this.executeNext(e)}appendBlocker(t){let e;const n=new Promise(t=>{e=t}),r={execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(r,t),n}executeNext(t){const e=this.queues[t];if(e.length){const n=e[0];try{n.execute()}catch(e){L.warn(`[buffer-operation-queue]: Exception executing "${t}" SourceBuffer operation: ${e}`),n.onError(e);const r=this.buffers[t];null!=r&&r.updating||this.shiftAndExecuteNext(t)}}}shiftAndExecuteNext(t){this.queues[t].shift(),this.executeNext(t)}current(t){return this.queues[t][0]}}const gi=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;function mi(t){const e=t.querySelectorAll("source");[].slice.call(e).forEach(e=>{t.removeChild(e)})}const vi={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},yi=t=>String.fromCharCode(vi[t]||t),bi=15,Ei=100,Ti={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Si={17:2,18:4,21:6,22:8,23:10,19:13,20:15},_i={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},wi={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Ai=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Li{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const n="function"==typeof e?e():e;L.log(`${this.time} [${t}] ${n}`)}}}const Ri=function(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].toString(16));return e};class Ii{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let n=0;n<e.length;n++){const r=e[n];t.hasOwnProperty(r)&&(this[r]=t[r])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Di{constructor(){this.uchar=" ",this.penState=new Ii}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class xi{constructor(t){this.chars=[],this.pos=0,this.currPenState=new Ii,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Ei;t++)this.chars.push(new Di);this.logger=t}equals(t){for(let e=0;e<Ei;e++)if(!this.chars[e].equals(t.chars[e]))return!1;return!0}copy(t){for(let e=0;e<Ei;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<Ei;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Ei&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Ei)}moveCursor(t){const e=this.pos+t;if(t>1)for(let t=this.pos+1;t<e+1;t++)this.chars[t].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=yi(t);this.pos>=Ei?this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))}clearFromPos(t){let e;for(e=t;e<Ei;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let n=0;n<Ei;n++){const r=this.chars[n].uchar;" "!==r&&(e=!1),t.push(r)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}class ki{constructor(t){this.rows=[],this.currRow=bi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let e=0;e<bi;e++)this.rows.push(new xi(t));this.logger=t}reset(){for(let t=0;t<bi;t++)this.rows[t].clear();this.currRow=bi-1}equals(t){let e=!0;for(let n=0;n<bi;n++)if(!this.rows[n].equals(t.rows[n])){e=!1;break}return e}copy(t){for(let e=0;e<bi;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<bi;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+JSON.stringify(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let t=0;t<bi;t++)this.rows[t].clear();const t=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){const r=n.rows[t].cueStartTime,i=this.logger.time;if(null!==r&&null!==i&&r<i)for(let r=0;r<this.nrRollUpRows;r++)this.rows[e-this.nrRollUpRows+r+1].copy(n.rows[t+r])}}this.currRow=e;const n=this.rows[this.currRow];if(null!==t.indent){const e=t.indent,r=Math.max(e-1,0);n.setCursor(t.indent),t.color=n.chars[r].penState.foreground}const r={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(t){this.logger.log(2,()=>"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let n="",r=-1;for(let n=0;n<bi;n++){const i=this.rows[n].getTextString();i&&(r=n+1,t?e.push("Row "+r+": '"+i+"'"):e.push(i.trim()))}return e.length>0&&(n=t?"["+e.join(" | ")+"]":e.join("\n")),n}getTextAndFormat(){return this.rows}}class Oi{constructor(t,e,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new ki(n),this.nonDisplayedMemory=new ki(n),this.lastOutputScreen=new ki(n),this.currRollUpRow=this.displayedMemory.rows[bi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[bi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{const n=Math.floor(t/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=r[n]}this.logger.log(2,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class Ci{constructor(t,e,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const r=this.logger=new Li;this.channels=[null,new Oi(t,e,r),new Oi(t+1,n,r)]}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){this.logger.time=t;for(let t=0;t<e.length;t+=2){const n=127&e[t],r=127&e[t+1];let i=!1,s=null;if(0===n&&0===r)continue;this.logger.log(3,()=>"["+Ri([e[t],e[t+1]])+"] -> ("+Ri([n,r])+")");const o=this.cmdHistory;if(n>=16&&n<=31){if(Mi(n,r,o)){Pi(null,null,o),this.logger.log(3,()=>"Repeated command ("+Ri([n,r])+") is dropped");continue}Pi(n,r,this.cmdHistory),i=this.parseCmd(n,r),i||(i=this.parseMidrow(n,r)),i||(i=this.parsePAC(n,r)),i||(i=this.parseBackgroundAttributes(n,r))}else Pi(null,null,o);if(!i&&(s=this.parseChars(n,r),s)){const t=this.currentChannel;if(t&&t>0){this.channels[t].insertChars(s)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}i||s||this.logger.log(2,()=>"Couldn't parse cleaned data "+Ri([n,r])+" orig: "+Ri([e[t],e[t+1]]))}}parseCmd(t,e){if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47)&&!((23===t||31===t)&&e>=33&&e<=35))return!1;const n=20===t||21===t||23===t?1:2,r=this.channels[n];return 20===t||21===t||28===t||29===t?32===e?r.ccRCL():33===e?r.ccBS():34===e?r.ccAOF():35===e?r.ccAON():36===e?r.ccDER():37===e?r.ccRU(2):38===e?r.ccRU(3):39===e?r.ccRU(4):40===e?r.ccFON():41===e?r.ccRDC():42===e?r.ccTR():43===e?r.ccRTD():44===e?r.ccEDM():45===e?r.ccCR():46===e?r.ccENM():47===e&&r.ccEOC():r.ccTO(e-32),this.currentChannel=n,!0}parseMidrow(t,e){let n=0;if((17===t||25===t)&&e>=32&&e<=47){if(n=17===t?1:2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return!!r&&(r.ccMIDROW(e),this.logger.log(3,()=>"MIDROW ("+Ri([t,e])+")"),!0)}return!1}parsePAC(t,e){let n;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127)&&!((16===t||24===t)&&e>=64&&e<=95))return!1;const r=t<=23?1:2;n=e>=64&&e<=95?1===r?Ti[t]:_i[t]:1===r?Si[t]:wi[t];const i=this.channels[r];return!!i&&(i.setPAC(this.interpretPAC(n,e)),this.currentChannel=r,!0)}interpretPAC(t,e){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:t};return n=e>95?e-96:e-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r}parseChars(t,e){let n,r=null,i=null;if(t>=25?(n=2,i=t-8):(n=1,i=t),i>=17&&i<=19){let t;t=17===i?e+80:18===i?e+112:e+144,this.logger.log(2,()=>"Special char '"+yi(t)+"' in channel "+n),r=[t]}else t>=32&&t<=127&&(r=0===e?[t]:[t,e]);return r&&this.logger.log(3,()=>"Char codes =  "+Ri(r).join(",")),r}parseBackgroundAttributes(t,e){if(!((16===t||24===t)&&e>=32&&e<=47)&&!((23===t||31===t)&&e>=45&&e<=47))return!1;let n;const r={};16===t||24===t?(n=Math.floor((e-32)/2),r.background=Ai[n],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0));const i=t<=23?1:2;return this.channels[i].setBkgData(r),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}Pi(null,null,this.cmdHistory)}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const n=this.channels[e];n&&n.cueSplitAtTime(t)}}}function Pi(t,e,n){n.a=t,n.b=e}function Mi(t,e,n){return n.a===t&&n.b===e}class Fi{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,n){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Ni=function(){if(null!=G&&G.VTTCue)return self.VTTCue;const t=["","lr","rl"],e=["start","middle","end","left","right"];function n(t,e){if("string"!=typeof e)return!1;if(!Array.isArray(t))return!1;const n=e.toLowerCase();return!!~t.indexOf(n)&&n}function r(t){return n(e,t)}function i(t,...e){let n=1;for(;n<arguments.length;n++){const e=arguments[n];for(const n in e)t[n]=e[n]}return t}function s(e,s,o){const a=this,l={enumerable:!0};a.hasBeenReset=!1;let u="",c=!1,h=e,d=s,f=o,p=null,g="",m=!0,v="auto",y="start",b=50,E="middle",T=50,S="middle";Object.defineProperty(a,"id",i({},l,{get:function(){return u},set:function(t){u=""+t}})),Object.defineProperty(a,"pauseOnExit",i({},l,{get:function(){return c},set:function(t){c=!!t}})),Object.defineProperty(a,"startTime",i({},l,{get:function(){return h},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");h=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",i({},l,{get:function(){return d},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",i({},l,{get:function(){return f},set:function(t){f=""+t,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",i({},l,{get:function(){return p},set:function(t){p=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",i({},l,{get:function(){return g},set:function(e){const r=function(e){return n(t,e)}(e);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");g=r,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",i({},l,{get:function(){return m},set:function(t){m=!!t,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",i({},l,{get:function(){return v},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",i({},l,{get:function(){return y},set:function(t){const e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",i({},l,{get:function(){return b},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",i({},l,{get:function(){return E},set:function(t){const e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",i({},l,{get:function(){return T},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");T=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",i({},l,{get:function(){return S},set:function(t){const e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");S=e,this.hasBeenReset=!0}})),a.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}();class Ui{decode(t,e){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function Bi(t){function e(t,e,n,r){return 3600*(0|t)+60*(0|e)+(0|n)+parseFloat(r||0)}const n=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?e(n[2],n[3],0,n[4]):e(n[1],n[2],n[3],n[4]):null}class $i{constructor(){this.values=Object.create(null)}set(t,e){this.get(t)||""===e||(this.values[t]=e)}get(t,e,n){return n?this.has(t)?this.values[t]:e[n]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,n){for(let r=0;r<n.length;++r)if(e===n[r]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const n=parseFloat(e);if(n>=0&&n<=100)return this.set(t,n),!0}return!1}}function ji(t,e,n,r){const i=r?t.split(r):[t];for(const t in i){if("string"!=typeof i[t])continue;const r=i[t].split(n);2===r.length&&e(r[0],r[1])}}const Gi=new Ni(0,0,""),Ki="middle"===Gi.align?"middle":"center";function Vi(t,e,n){const r=t;function i(){const e=Bi(t);if(null===e)throw new Error("Malformed timestamp: "+r);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function s(){t=t.replace(/^\s+/,"")}if(s(),e.startTime=i(),s(),"--\x3e"!==t.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);t=t.slice(3),s(),e.endTime=i(),s(),function(t,e){const r=new $i;ji(t,(function(t,e){let i;switch(t){case"region":for(let i=n.length-1;i>=0;i--)if(n[i].id===e){r.set(t,n[i].region);break}break;case"vertical":r.alt(t,e,["rl","lr"]);break;case"line":i=e.split(","),r.integer(t,i[0]),r.percent(t,i[0])&&r.set("snapToLines",!1),r.alt(t,i[0],["auto"]),2===i.length&&r.alt("lineAlign",i[1],["start",Ki,"end"]);break;case"position":i=e.split(","),r.percent(t,i[0]),2===i.length&&r.alt("positionAlign",i[1],["start",Ki,"end","line-left","line-right","auto"]);break;case"size":r.percent(t,e);break;case"align":r.alt(t,e,["start",Ki,"end","left","right"])}}),/:/,/\s/),e.region=r.get("region",null),e.vertical=r.get("vertical","");let i=r.get("line","auto");"auto"===i&&-1===Gi.line&&(i=-1),e.line=i,e.lineAlign=r.get("lineAlign","start"),e.snapToLines=r.get("snapToLines",!0),e.size=r.get("size",100),e.align=r.get("align",Ki);let s=r.get("position","auto");"auto"===s&&50===Gi.position&&(s="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=s}(t,e)}function Hi(t){return t.replace(/<br(?: \/)?>/gi,"\n")}class Wi{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Ui,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;function n(){let t=e.buffer,n=0;for(t=Hi(t);n<t.length&&"\r"!==t[n]&&"\n"!==t[n];)++n;const r=t.slice(0,n);return"\r"===t[n]&&++n,"\n"===t[n]&&++n,e.buffer=t.slice(n),r}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{let t="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;t=n();const r=t.match(/^()?WEBVTT([ \t].*)?$/);if(null==r||!r[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let r=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(r?r=!1:t=n(),e.state){case"HEADER":/:/.test(t)?ji(t,(function(t,e){}),/:/):t||(e.state="ID");continue;case"NOTE":t||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){e.state="NOTE";break}if(!t)continue;if(e.cue=new Ni(0,0,""),e.state="CUE",-1===t.indexOf("--\x3e")){e.cue.id=t;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{Vi(t,e.cue,e.regionList)}catch(t){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const n=-1!==t.indexOf("--\x3e");if(!t||n&&(r=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=t}continue;case"BADCUE":t||(e.state="ID")}}}catch(t){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const Yi=/\r\n|\n\r|\n|\r/g,zi=function(t,e,n=0){return t.slice(n,n+e.length)===e},qi=function(t){let e=parseInt(t.slice(-3));const n=parseInt(t.slice(-6,-4)),r=parseInt(t.slice(-9,-7)),i=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!(m(e)&&m(n)&&m(r)&&m(i)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${t}`);return e+=1e3*n,e+=6e4*r,e+=36e5*i,e},Xi=function(t){let e=5381,n=t.length;for(;n;)e=33*e^t.charCodeAt(--n);return(e>>>0).toString()};function Qi(t,e,n){return Xi(t.toString())+Xi(e.toString())+Xi(n)}const Zi=function(t,e,n){let r=t[e],i=t[r.prevCC];if(!i||!i.new&&r.new)return t.ccOffset=t.presentationOffset=r.start,void(r.new=!1);for(;null!=(s=i)&&s.new;){var s;t.ccOffset+=r.start-i.start,r.new=!1,r=i,i=t[r.prevCC]}t.presentationOffset=n};function Ji(t,e,n,r,i,s,o){const a=new Wi,l=ft(new Uint8Array(t)).trim().replace(Yi,"\n").split("\n"),u=[],c=e?function(t,e=1){return Ur(t,Nr,1/e)}(e.baseTime,e.timescale):0;let h,d="00:00.000",f=0,p=0,g=!0;a.oncue=function(t){const s=n[r];let o=n.ccOffset;const a=(f-c)/9e4;if(null!=s&&s.new&&(void 0!==p?o=n.ccOffset=s.start:Zi(n,r,a)),a){if(!e)return void(h=new Error("Missing initPTS for VTT MPEGTS"));o=a-n.presentationOffset}const l=t.endTime-t.startTime,d=zr(9e4*(t.startTime+o-p),9e4*i)/9e4;t.startTime=Math.max(d,0),t.endTime=Math.max(d+l,0);const g=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(g)),t.id||(t.id=Qi(t.startTime,t.endTime,g)),t.endTime>0&&u.push(t)},a.onparsingerror=function(t){h=t},a.onflush=function(){h?o(h):s(u)},l.forEach(t=>{if(g){if(zi(t,"X-TIMESTAMP-MAP=")){g=!1,t.slice(16).split(",").forEach(t=>{zi(t,"LOCAL:")?d=t.slice(6):zi(t,"MPEGTS:")&&(f=parseInt(t.slice(7)))});try{p=qi(d)/1e3}catch(t){h=t}return}""===t&&(g=!1)}a.parse(t+"\n")}),a.flush()}const ts="stpp.ttml.im1t",es=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ns=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,rs={left:"start",center:"center",right:"end",start:"start",end:"end"};function is(t,e,n,r){const i=Lt(new Uint8Array(t),["mdat"]);if(0===i.length)return void r(new Error("Could not parse IMSC1 mdat"));const s=i.map(t=>ft(t)),o=function(t,e,n=1,r=!1){return Ur(t,e,1/n,r)}(e.baseTime,1,e.timescale);try{s.forEach(t=>n(function(t,e){const n=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(r).reduce((t,e)=>(t[e]=n.getAttribute(`ttp:${e}`)||r[e],t),{}),s="preserve"!==n.getAttribute("xml:space"),o=os(ss(n,"styling","style")),a=os(ss(n,"layout","region")),l=ss(n,"body","[begin]");return[].map.call(l,t=>{const n=function t(e,n){return[].slice.call(e.childNodes).reduce((e,r,i)=>{var s;return"br"===r.nodeName&&i?e+"\n":null!=(s=r.childNodes)&&s.length?t(r,n):n?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent},"")}(t,s);if(!n||!t.hasAttribute("begin"))return null;const r=us(t.getAttribute("begin"),i),l=us(t.getAttribute("dur"),i);let u=us(t.getAttribute("end"),i);if(null===r)throw ls(t);if(null===u){if(null===l)throw ls(t);u=r+l}const c=new Ni(r-e,u-e,n);c.id=Qi(c.startTime,c.endTime,c.text);const h=function(t,e,n){const r="http://www.w3.org/ns/ttml#styling";let i=null;const s=null!=t&&t.hasAttribute("style")?t.getAttribute("style"):null;s&&n.hasOwnProperty(s)&&(i=n[s]);return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((n,s)=>{const o=as(e,r,s)||as(t,r,s)||as(i,r,s);return o&&(n[s]=o),n},{})}(a[t.getAttribute("region")],o[t.getAttribute("style")],o),{textAlign:d}=h;if(d){const t=rs[d];t&&(c.lineAlign=t),c.align=d}return g(c,h),c}).filter(t=>null!==t)}(t,o)))}catch(t){r(t)}}function ss(t,e,n){const r=t.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function os(t){return t.reduce((t,e)=>{const n=e.getAttribute("xml:id");return n&&(t[n]=e),t},{})}function as(t,e,n){return t&&t.hasAttributeNS(e,n)?t.getAttributeNS(e,n):null}function ls(t){return new Error(`Could not parse ttml timestamp ${t}`)}function us(t,e){if(!t)return null;let n=Bi(t);return null===n&&(es.test(t)?n=function(t,e){const n=es.exec(t),r=(0|n[4])+(0|n[5])/e.subFrameRate;return 3600*(0|n[1])+60*(0|n[2])+(0|n[3])+r/e.frameRate}(t,e):ns.test(t)&&(n=function(t,e){const n=ns.exec(t),r=Number(n[1]);switch(n[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}(t,e))),n}function cs(t){return t.characteristics&&/transcribes-spoken-dialog/gi.test(t.characteristics)&&/describes-music-and-sound/gi.test(t.characteristics)?"captions":"subtitles"}function hs(t,e){return!!t&&t.kind===cs(e)&&ci(e,t)}class ds{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(b.BUFFER_CODECS,this.onBufferCodecs,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(b.BUFFER_CODECS,this.onBufferCodecs,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const n=this.hls.levels[e.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(t,e){const n=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,n.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onLevelsUpdated(t,e){this.timer&&m(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const t=this.hls.levels;if(t.length){const e=this.hls,n=this.getMaxLevel(t.length-1);n!==this.autoLevelCapping&&L.log(`Setting autoLevelCapping to ${n}: ${t[n].height}p@${t[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),e.autoLevelCapping=n,e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const n=e.filter((e,n)=>this.isLevelAllowed(e)&&n<=t);return this.clientRect=null,ds.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const n=t.getBoundingClientRect();e.width=n.width,e.height=n.height,e.width||e.height||(e.width=n.right-n.left||t.width||0,e.height=n.bottom-n.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(t){}return t}isLevelAllowed(t){return!this.restrictedLevels.some(e=>t.bitrate===e.bitrate&&t.width===e.width&&t.height===e.height)}static getMaxLevelByMediaSize(t,e,n){if(null==t||!t.length)return-1;const r=(t,e)=>!e||(t.width!==e.width||t.height!==e.height);let i=t.length-1;const s=Math.max(e,n);for(let e=0;e<t.length;e+=1){const n=t[e];if((n.width>=s||n.height>=s)&&r(n,t[e+1])){i=e;break}}return i}}const fs="[eme]";class ps{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=ps.CDMCleanupPromise?[ps.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=L.debug.bind(L,fs),this.log=L.log.bind(L,fs),this.warn=L.warn.bind(L,fs),this.error=L.error.bind(L,fs),this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:n}=this.config,r=e[t];if(r)return r.licenseUrl;if(t===K.WIDEVINE&&n)return n;throw new Error(`no license server URL configured for key-system "${t}"`)}getServerCertificateUrl(t){const{drmSystems:e}=this.config,n=e[t];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const e=this.hls.levels,n=(t,e,n)=>!!t&&n.indexOf(t)===e,r=e.map(t=>t.audioCodec).filter(n),i=e.map(t=>t.videoCodec).filter(n);return r.length+i.length===0&&i.push("avc1.42e01e"),new Promise((e,n)=>{const s=t=>{const o=t.shift();this.getMediaKeysPromise(o,r,i).then(t=>e({keySystem:o,mediaKeys:t})).catch(e=>{t.length?s(t):n(e instanceof gs?e:new gs({type:E.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_NO_ACCESS,error:e,fatal:!0},e.message))})};s(t)})}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:n}=this.config;if("function"!=typeof n){let t=`Configured requestMediaKeySystemAccess is not a function ${n}`;return null===X&&"http:"===self.location.protocol&&(t=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(t))}return n(t,e)}getMediaKeysPromise(t,e,n){const r=function(t,e,n,r){let i;switch(t){case K.FAIRPLAY:i=["cenc","sinf"];break;case K.WIDEVINE:case K.PLAYREADY:i=["cenc"];break;case K.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${t}`)}return function(t,e,n,r){return[{initDataTypes:t,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(t=>({contentType:`audio/mp4; codecs="${t}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:n.map(t=>({contentType:`video/mp4; codecs="${t}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}(i,e,n,r)}(t,e,n,this.config.drmSystemOptions),i=this.keySystemAccessPromises[t];let s=null==i?void 0:i.keySystemAccess;if(!s){this.log(`Requesting encrypted media "${t}" key-system access with config: ${JSON.stringify(r)}`),s=this.requestMediaKeySystemAccess(t,r);const e=this.keySystemAccessPromises[t]={keySystemAccess:s};return s.catch(e=>{this.log(`Failed to obtain access to key-system "${t}": ${e}`)}),s.then(n=>{this.log(`Access for key-system "${n.keySystem}" obtained`);const r=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),e.mediaKeys=n.createMediaKeys().then(e=>(this.log(`Media-keys created for "${t}"`),r.then(n=>n?this.setMediaKeysServerCertificate(e,t,n):e))),e.mediaKeys.catch(e=>{this.error(`Failed to create media-keys for "${t}"}: ${e}`)}),e.mediaKeys})}return s.then(()=>i.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:e,mediaKeys:n}){this.log(`Creating key-system session "${e}" keyId: ${mt.hexDump(t.keyId||[])}`);const r=n.createSession(),i={decryptdata:t,keySystem:e,mediaKeys:n,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const n=this.createMediaKeySessionContext(t),r=this.getKeyIdString(e),i="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,i,e.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(null===t.keyId)throw new Error("keyId is null");return mt.hexDump(t.keyId)}updateKeySession(t,e){var n;const r=t.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${mt.hexDump((null==(n=t.decryptdata)?void 0:n.keyId)||[])}\n      } (data length: ${e?e.byteLength:e})`),r.update(e)}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){return new Promise((e,n)=>{const r=q(this.config),i=t.map(H).filter(t=>!!t&&-1!==r.indexOf(t));return this.getKeySystemSelectionPromise(i).then(({keySystem:t})=>{const r=z(t);r?e(r):n(new Error(`Unable to find format for key-system "${t}"`))}).catch(n)})}loadKey(t){const e=t.keyInfo.decryptdata,n=this.getKeyIdString(e),r=`(keyId: ${n} format: "${e.keyFormat}" method: ${e.method} uri: ${e.uri})`;this.log(`Starting session for key ${r}`);let i=this.keyIdToKeySessionPromise[n];return i||(i=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(e).then(({keySystem:n,mediaKeys:i})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${r}`),this.attemptSetMediaKeys(n,i).then(()=>{this.throwIfDestroyed();const t=this.createMediaKeySessionContext({keySystem:n,mediaKeys:i,decryptdata:e});return this.generateRequestWithPreferredKeySession(t,"cenc",e.pssh,"playlist-key")}))),i.catch(t=>this.handleError(t))),i}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){this.hls&&(this.error(t.message),t instanceof gs?this.hls.trigger(b.ERROR,t.data):this.hls.trigger(b.ERROR,{type:E.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){const e=this.getKeyIdString(t),n=this.keyIdToKeySessionPromise[e];if(!n){const e=H(t.keyFormat),n=e?[e]:q(this.config);return this.attemptKeySystemAccess(n)}return n}getKeySystemSelectionPromise(t){if(t.length||(t=q(this.config)),0===t.length)throw new gs({type:E.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}_onMediaEncrypted(t){const{initDataType:e,initData:n}=t,r=`"${t.type}" event: init data type: "${e}"`;if(this.debug(r),null===n)return;let i,s;if("sinf"===e&&this.config.drmSystems[K.FAIRPLAY]){const t=Et(new Uint8Array(n));try{const e=B(JSON.parse(t).sinf),n=Ct(new Uint8Array(e));if(!n)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");i=n.subarray(8,24),s=K.FAIRPLAY}catch(t){return void this.warn(`${r} Failed to parse sinf: ${t}`)}}else{const t=function(t){const e=[];if(t instanceof ArrayBuffer){const n=t.byteLength;let r=0;for(;r+32<n;){const n=jt(new DataView(t,r));e.push(n),r+=n.size}}return e}(n),e=t.filter(t=>t.systemId===W.WIDEVINE)[0];if(!e)return void(0===t.length||t.some(t=>!t.systemId)?this.warn(`${r} contains incomplete or invalid pssh data`):this.log(`ignoring ${r} for ${t.map(t=>Y(t.systemId)).join(",")} pssh data in favor of playlist keys`));if(s=Y(e.systemId),0===e.version&&e.data){const t=e.data.length-22;i=e.data.subarray(t,t+16)}}if(!s||!i)return;const o=mt.hexDump(i),{keyIdToKeySessionPromise:a,mediaKeySessions:l}=this;let u=a[o];for(let t=0;t<l.length;t++){const r=l[t],s=r.decryptdata;if(!s.keyId)continue;const c=mt.hexDump(s.keyId);if(o===c||-1!==s.uri.replace(/-/g,"").indexOf(o)){if(u=a[c],s.pssh)break;delete a[c],s.pssh=new Uint8Array(n),s.keyId=i,u=a[o]=u.then(()=>this.generateRequestWithPreferredKeySession(r,e,n,"encrypted-event-key-match"));break}}u||(u=a[o]=this.getKeySystemSelectionPromise([s]).then(({keySystem:t,mediaKeys:r})=>{var s;this.throwIfDestroyed();const a=new Kt("ISO-23001-7",o,null!=(s=z(t))?s:"");return a.pssh=new Uint8Array(n),a.keyId=i,this.attemptSetMediaKeys(t,r).then(()=>{this.throwIfDestroyed();const i=this.createMediaKeySessionContext({decryptdata:a,keySystem:t,mediaKeys:r});return this.generateRequestWithPreferredKeySession(i,e,n,"encrypted-event-no-match")})})),u.catch(t=>this.handleError(t))}_onWaitingForKey(t){this.log(`"${t.type}" event`)}attemptSetMediaKeys(t,e){const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const r=Promise.all(n).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(e)});return this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${t}"`),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(t=>-1===n.indexOf(t))})}generateRequestWithPreferredKeySession(t,e,n,r){var i,s;const o=null==(i=this.config.drmSystems)?void 0:null==(s=i[t.keySystem])?void 0:s.generateRequest;if(o)try{const r=o.call(this.hls,e,n,t);if(!r)throw new Error("Invalid response from configured generateRequest filter");e=r.initDataType,n=t.decryptdata.pssh=r.initData?new Uint8Array(r.initData):null}catch(t){var a;if(this.warn(t.message),null!=(a=this.hls)&&a.config.debug)throw t}if(null===n)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(t);const l=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${r}": ${l} (init data type: ${e} length: ${n?n.byteLength:null})`);const u=new oi,c=t._onmessage=e=>{const n=t.mediaKeysSession;if(!n)return void u.emit("error",new Error("invalid state"));const{messageType:r,message:i}=e;this.log(`"${r}" message event for session "${n.sessionId}" message size: ${i.byteLength}`),"license-request"===r||"license-renewal"===r?this.renewLicense(t,i).catch(t=>{this.handleError(t),u.emit("error",t)}):"license-release"===r?t.keySystem===K.FAIRPLAY&&(this.updateKeySession(t,j("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${r}"`)},h=t._onkeystatuseschange=e=>{if(!t.mediaKeysSession)return void u.emit("error",new Error("invalid state"));this.onKeyStatusChange(t);const n=t.keyStatus;u.emit("keyStatus",n),"expired"===n&&(this.warn(`${t.keySystem} expired for key ${l}`),this.renewKeySession(t))};t.mediaKeysSession.addEventListener("message",c),t.mediaKeysSession.addEventListener("keystatuseschange",h);const d=new Promise((t,e)=>{u.on("error",e),u.on("keyStatus",n=>{n.startsWith("usable")?t():"output-restricted"===n?e(new gs({type:E.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===n?e(new gs({type:E.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${n}"`)):"expired"===n?e(new Error("key expired while generating request")):this.warn(`unhandled key status change "${n}"`)})});return t.mediaKeysSession.generateRequest(e,n).then(()=>{var e;this.log(`Request generated for key-session "${null==(e=t.mediaKeysSession)?void 0:e.sessionId}" keyId: ${l}`)}).catch(t=>{throw new gs({type:E.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_NO_SESSION,error:t,fatal:!1},`Error generating key-session request: ${t}`)}).then(()=>d).catch(e=>{throw u.removeAllListeners(),this.removeSession(t),e}).then(()=>(u.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((e,n)=>{this.log(`key status change "${e}" for keyStatuses keyId: ${mt.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${mt.hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=e})}fetchServerCertificate(t){const e=this.config,n=new(0,e.loader)(e),r=this.getServerCertificateUrl(t);return r?(this.log(`Fetching server certificate for "${t}"`),new Promise((i,s)=>{const o={responseType:"arraybuffer",url:r},a=e.certLoadPolicy.default,l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(t,e,n,r)=>{i(t.data)},onError:(e,n,i,a)=>{s(new gs({type:E.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:d({url:o.url,data:void 0},e)},`"${t}" certificate request failed (${r}). Status: ${e.code} (${e.text})`))},onTimeout:(e,n,i)=>{s(new gs({type:E.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:o.url,data:void 0}},`"${t}" certificate request timed out (${r})`))},onAbort:(t,e,n)=>{s(new Error("aborted"))}};n.load(o,l,u)})):Promise.resolve()}setMediaKeysServerCertificate(t,e,n){return new Promise((r,i)=>{t.setServerCertificate(n).then(i=>{this.log(`setServerCertificate ${i?"success":"not supported by CDM"} (${null==n?void 0:n.byteLength}) on "${e}"`),r(t)}).catch(t=>{i(new gs({type:E.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:t,fatal:!0},t.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(e=>this.updateKeySession(t,new Uint8Array(e)).catch(t=>{throw new gs({type:E.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:t,fatal:!0},t.message)}))}unpackPlayReadyKeyMessage(t,e){const n=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!n.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;const r=(new DOMParser).parseFromString(n,"application/xml"),i=r.querySelectorAll("HttpHeader");if(i.length>0){let e;for(let n=0,r=i.length;n<r;n++){var s,o;e=i[n];const r=null==(s=e.querySelector("name"))?void 0:s.textContent,a=null==(o=e.querySelector("value"))?void 0:o.textContent;r&&a&&t.setRequestHeader(r,a)}}const a=r.querySelector("Challenge"),l=null==a?void 0:a.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return j(atob(l))}setupLicenseXHR(t,e,n,r){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return i.call(this.hls,t,e,n,r)}).catch(s=>{if(!n.decryptdata)throw s;return t.open("POST",e,!0),i.call(this.hls,t,e,n,r)}).then(n=>{return t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:n||r}}):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:r}))}requestLicense(t,e){const n=this.config.keyLoadPolicy.default;return new Promise((r,i)=>{const s=this.getLicenseServerUrl(t.keySystem);this.log(`Sending license request to URL: ${s}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return i(new Error("invalid state"));if(4===o.readyState)if(200===o.status){this._requestLicenseFailureCount=0;let e=o.response;this.log(`License received ${e instanceof ArrayBuffer?e.byteLength:e}`);const n=this.config.licenseResponseCallback;if(n)try{e=n.call(this.hls,o,s,t)}catch(t){this.error(t)}r(e)}else{const a=n.errorRetry,l=a?a.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||o.status>=400&&o.status<500)i(new gs({type:E.KEY_SYSTEM_ERROR,details:T.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o,response:{url:s,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${s}). Status: ${o.status} (${o.statusText})`));else{const n=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${n} attempts left`),this.requestLicense(t,e).then(r,i)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=o,this.setupLicenseXHR(o,s,t,e).then(({xhr:e,licenseChallenge:n})=>{t.keySystem==K.PLAYREADY&&(n=this.unpackPlayReadyKeyMessage(e,n)),e.send(n)})})}onMediaAttached(t,e){if(!this.config.emeEnabled)return;const n=e.media;this.media=n,n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const t=this.media,e=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Kt.clearKeyUriToKeyIdMap();const n=e.length;ps.CDMCleanupPromise=Promise.all(e.map(t=>this.removeSession(t)).concat(null==t?void 0:t.setMediaKeys(null).catch(t=>{this.log(`Could not clear media keys: ${t}`)}))).then(()=>{n&&(this.log("finished closing key sessions and clearing media keys"),e.length=0)}).catch(t=>{this.log(`Could not close sessions and clear media keys: ${t}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:e}){if(e&&this.config.emeEnabled&&!this.keyFormatPromise){const t=e.reduce((t,e)=>(-1===t.indexOf(e.keyFormat)&&t.push(e.keyFormat),t),[]);this.log(`Selecting key-system from session-keys ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:n}=t;if(e){this.log(`Remove licenses and keys and close session ${e.sessionId}`),t._onmessage&&(e.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(e.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(t);return r>-1&&this.mediaKeySessions.splice(r,1),e.remove().catch(t=>{this.log(`Could not remove session: ${t}`)}).then(()=>e.close()).catch(t=>{this.log(`Could not close session: ${t}`)})}}}ps.CDMCleanupPromise=void 0;class gs extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}var ms,vs,ys;!function(t){t.MANIFEST="m",t.AUDIO="a",t.VIDEO="v",t.MUXED="av",t.INIT="i",t.CAPTION="c",t.TIMED_TEXT="tt",t.KEY="k",t.OTHER="o"}(ms||(ms={})),function(t){t.DASH="d",t.HLS="h",t.SMOOTH="s",t.OTHER="o"}(vs||(vs={})),function(t){t.OBJECT="CMCD-Object",t.REQUEST="CMCD-Request",t.SESSION="CMCD-Session",t.STATUS="CMCD-Status"}(ys||(ys={}));const bs={[ys.OBJECT]:["br","d","ot","tb"],[ys.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[ys.SESSION]:["cid","pr","sf","sid","st","v"],[ys.STATUS]:["bs","rtp"]};class Es{constructor(t,e){this.value=void 0,this.params=void 0,Array.isArray(t)&&(t=t.map(t=>t instanceof Es?t:new Es(t))),this.value=t,this.params=e}}class Ts{constructor(t){this.description=void 0,this.description=t}}const Ss="Dict";function _s(t,e,n,r){return new Error(`failed to ${t} "${i=e,Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":"object"==typeof i?JSON.stringify(i):String(i)}" as ${n}`,{cause:r});var i}const ws="Bare Item",As="Boolean",Ls="Byte Sequence",Rs="Decimal",Is="Integer";const Ds=/[\x00-\x1f\x7f]+/,xs="Token",ks="Key";function Os(t,e,n){return _s("serialize",t,e,n)}function Cs(t){if(!1===ArrayBuffer.isView(t))throw Os(t,Ls);return`:${e=t,btoa(String.fromCharCode(...e))}:`;var e}function Ps(t){if(function(t){return t<-999999999999999||999999999999999<t}(t))throw Os(t,Is);return t.toString()}function Ms(t){const e=function t(e,n){if(e<0)return-t(-e,n);const r=Math.pow(10,n);if(Math.abs(e*r%1-.5)<Number.EPSILON){const t=Math.floor(e*r);return(t%2==0?t:t+1)/r}return Math.round(e*r)/r}(t,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Os(t,Rs);const n=e.toString();return n.includes(".")?n:`${n}.0`}const Fs="String";function Ns(t){const e=(n=t).description||n.toString().slice(7,-1);var n;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e))throw Os(e,xs);return e}function Us(t){switch(typeof t){case"number":if(!m(t))throw Os(t,ws);return Number.isInteger(t)?Ps(t):Ms(t);case"string":return function(t){if(Ds.test(t))throw Os(t,Fs);return`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(t);case"symbol":return Ns(t);case"boolean":return function(t){if("boolean"!=typeof t)throw Os(t,As);return t?"?1":"?0"}(t);case"object":if(t instanceof Date)return function(t){return`@${Ps(t.getTime()/1e3)}`}(t);if(t instanceof Uint8Array)return Cs(t);if(t instanceof Ts)return Ns(t);default:throw Os(t,ws)}}function Bs(t){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(t))throw Os(t,ks);return t}function $s(t){return null==t?"":Object.entries(t).map(([t,e])=>!0===e?`;${Bs(t)}`:`;${Bs(t)}=${Us(e)}`).join("")}function js(t){return t instanceof Es?`${Us(t.value)}${$s(t.params)}`:Us(t)}function Gs(t,e={whitespace:!0}){if("object"!=typeof t)throw Os(t,Ss);const n=t instanceof Map?t.entries():Object.entries(t),r=null!=e&&e.whitespace?" ":"";return Array.from(n).map(([t,e])=>{e instanceof Es==!1&&(e=new Es(e));let n=Bs(t);return!0===e.value?n+=$s(e.params):(n+="=",Array.isArray(e.value)?n+=function(t){return`(${t.value.map(js).join(" ")})${$s(t.params)}`}(e):n+=js(e)),n}).join(`,${r}`)}const Ks=t=>"ot"===t||"sf"===t||"st"===t,Vs=t=>"number"==typeof t?m(t):null!=t&&""!==t&&!1!==t;const Hs=t=>Math.round(t),Ws=t=>100*Hs(t/100),Ys={br:Hs,d:Hs,bl:Ws,dl:Ws,mtp:Ws,nor:(t,e)=>(null!=e&&e.baseUrl&&(t=function(t,e){const n=new URL(t),r=new URL(e);if(n.origin!==r.origin)return t;const i=n.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")}(t,e.baseUrl)),encodeURIComponent(t)),rtp:Ws,tb:Hs};function zs(t,e={}){return t?function(t,e){return Gs(t,e)}(function(t,e){const n={};if(null==t||"object"!=typeof t)return n;const r=Object.keys(t).sort(),i=g({},Ys,null==e?void 0:e.formatters),s=null==e?void 0:e.filter;return r.forEach(r=>{if(null!=s&&s(r))return;let o=t[r];const a=i[r];a&&(o=a(o,e)),"v"===r&&1===o||"pr"==r&&1===o||Vs(o)&&(Ks(r)&&"string"==typeof o&&(o=new Ts(o)),n[r]=o)}),n}(t,e),g({whitespace:!1},e)):""}function qs(t,e,n){return g(t,function(t,e={}){if(!t)return{};const n=Object.entries(t),r=Object.entries(bs).concat(Object.entries((null==e?void 0:e.customHeaderMap)||{})),i=n.reduce((t,e)=>{var n;const[i,s]=e,o=(null==(n=r.find(t=>t[1].includes(i)))?void 0:n[0])||ys.REQUEST;return null!=t[o]||(t[o]={}),t[o][i]=s,t},{});return Object.entries(i).reduce((t,[n,r])=>(t[n]=zs(r,e),t),{})}(e,n))}const Xs="CMCD";const Qs=/CMCD=[^&#]+/;function Zs(t,e,n){const r=function(t,e={}){if(!t)return"";const n=zs(t,e);return`${Xs}=${encodeURIComponent(n)}`}(e,n);if(!r)return t;if(Qs.test(t))return t.replace(Qs,r);const i=t.includes("?")?"&":"?";return`${t}${i}${r}`}const Js=3e5;function to(t,e,n,r){t&&Object.keys(e).forEach(i=>{const s=t.filter(t=>t.groupId===i).map(t=>{const s=g({},t);return s.details=void 0,s.attrs=new D(s.attrs),s.url=s.attrs.URI=eo(t.url,t.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),s.groupId=s.attrs["GROUP-ID"]=e[i],s.attrs["PATHWAY-ID"]=r,s});t.push(...s)})}function eo(t,e,n,r){const{HOST:i,PARAMS:s,[n]:o}=r;let a;e&&(a=null==o?void 0:o[e],a&&(t=a));const l=new self.URL(t);return i&&!a&&(l.host=i),s&&Object.keys(s).sort().forEach(t=>{t&&l.searchParams.set(t,s[t])}),l.href}const no=/^age:\s*[\d.]+\s*$/im;class ro{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new O,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t||!e)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(this.loader===n&&!this.stats.aborted)return i(n,e.url)}).catch(t=>{if(this.loader===n&&!this.stats.aborted)return n.open("GET",e.url,!0),i(n,e.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,e,t)}).catch(t=>{this.callbacks.onError({code:n.status,text:t.message},e,n,r)}):this.openAndSendXhr(n,e,t)}openAndSendXhr(t,e,n){t.readyState||t.open("GET",e.url,!0);const r=e.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:s}=n.loadPolicy;if(r)for(const e in r)t.setRequestHeader(e,r[e]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),n.timeout=i&&m(i)?i:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:n}=this;if(!t||!e)return;const r=e.readyState,i=this.config;if(!n.aborted&&r>=2&&(0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),4===r)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const r=e.status,s="text"!==e.responseType;if(r>=200&&r<300&&(s&&e.response||null!==e.responseText)){n.loading.end=Math.max(self.performance.now(),n.loading.first);const i=s?e.response:e.responseText,o="arraybuffer"===e.responseType?i.byteLength:i.length;if(n.loaded=n.total=o,n.bwEstimate=8e3*n.total/(n.loading.end-n.loading.first),!this.callbacks)return;const a=this.callbacks.onProgress;if(a&&a(n,t,i,e),!this.callbacks)return;const l={url:e.responseURL,data:i,code:r};this.callbacks.onSuccess(l,n,t,e)}else{const s=i.loadPolicy.errorRetry;rn(s,n.retry,!1,{url:t.url,data:void 0,code:r})?this.retry(s):(L.error(`${r} while loading ${t.url}`),this.callbacks.onError({code:r,text:e.statusText},t,e,n))}}}loadtimeout(){if(!this.config)return;const t=this.config.loadPolicy.timeoutRetry;if(rn(t,this.stats.retry,!0))this.retry(t);else{var e;L.warn(`timeout while loading ${null==(e=this.context)?void 0:e.url}`);const t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:n}=this;this.retryDelay=en(t,n.retry),n.retry++,L.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==e?void 0:e.url}, retrying ${n.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&no.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}const io=/(\d+)-(\d+)\/(\d+)/;class so{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||oo,this.controller=new self.AbortController,this.stats=new O}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const i=function(t,e){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(g({},t.headers))};t.rangeEnd&&n.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1));return n}(t,this.controller.signal),s=n.onProgress,o="arraybuffer"===t.responseType,a=o?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=n,this.request=this.fetchSetup(t,i),self.clearTimeout(this.requestTimeout),e.timeout=l&&m(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(r,t,this.response)},e.timeout),self.fetch(this.request).then(i=>{this.response=this.loader=i;const a=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(r,t,this.response)},u-(a-r.loading.start)),!i.ok){const{status:t,statusText:e}=i;throw new ao(e||"fetch, bad network response",t,i)}return r.loading.first=a,r.total=function(t){const e=t.get("Content-Range");if(e){const t=function(t){const e=io.exec(t);if(e)return parseInt(e[2])-parseInt(e[1])+1}(e);if(m(t))return t}const n=t.get("Content-Length");if(n)return parseInt(n)}(i.headers)||r.total,s&&m(e.highWaterMark)?this.loadProgressively(i,r,t,e.highWaterMark,s):o?i.arrayBuffer():"json"===t.responseType?i.json():i.text()}).then(i=>{const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const l=i[a];l&&(r.loaded=r.total=l);const u={url:o.url,data:i,code:o.status};s&&!m(e.highWaterMark)&&s(r,t,i,o),n.onSuccess(u,r,t,o)}).catch(e=>{if(self.clearTimeout(this.requestTimeout),r.aborted)return;const i=e&&e.code||0,s=e?e.message:null;n.onError({code:i,text:s},t,e?e.details:null,r)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,n,r=0,i){const s=new Xn,o=t.body.getReader(),a=()=>o.read().then(o=>{if(o.done)return s.dataLength&&i(e,n,s.flush(),t),Promise.resolve(new ArrayBuffer(0));const l=o.value,u=l.length;return e.loaded+=u,u<r||s.dataLength?(s.push(l),s.dataLength>=r&&i(e,n,s.flush(),t)):i(e,n,l,t),a()}).catch(()=>Promise.reject());return a()}}function oo(t,e){return new self.Request(t.url,e)}class ao extends Error{constructor(t,e,n){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=n}}const lo=/\s/,uo=d(d({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:ro,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class{constructor(t){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:t,partCurrent:e,hls:n}=this,{autoLevelEnabled:r,media:i}=n;if(!t||!i)return;const s=performance.now(),o=e?e.stats:t.stats,a=e?e.duration:t.duration,l=s-o.loading.start,u=n.minAutoLevel;if(o.aborted||o.loaded&&o.loaded===o.total||t.level<=u)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!r||i.paused||!i.playbackRate||!i.readyState)return;const c=n.mainForwardBufferInfo;if(null===c)return;const h=this.bwEstimator.getEstimateTTFB(),d=Math.abs(i.playbackRate);if(l<=Math.max(h,a/(2*d)*1e3))return;const f=c.len/d,p=o.loading.first?o.loading.first-o.loading.start:-1,g=o.loaded&&p>-1,v=this.getBwEstimate(),y=n.levels,E=y[t.level],T=o.total||Math.max(o.loaded,Math.round(a*E.averageBitrate/8));let S=g?l-p:l;S<1&&g&&(S=Math.min(l,8*o.loaded/v));const _=g?1e3*o.loaded/S:0,w=_?(T-o.loaded)/_:8*T/v+h/1e3;if(w<=f)return;const A=_?8*_:v;let R,I=Number.POSITIVE_INFINITY;for(R=t.level-1;R>u;R--){const t=y[R].maxBitrate;if(I=this.getTimeToLoadFrag(h/1e3,A,a*t,!y[R].details),I<f)break}if(I>=w)return;if(I>10*a)return;n.nextLoadLevel=n.nextAutoLevel=R,g?this.bwEstimator.sample(l-Math.min(h,p),o.loaded):this.bwEstimator.sampleTTFB(l);const D=y[R].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>D&&this.resetEstimator(D),this.clearTimer(),L.warn(`[abr] Fragment ${t.sn}${e?" part "+e.index:""} of level ${t.level} is loading too slowly;\n      Time to underbuffer: ${f.toFixed(3)} s\n      Estimated load time for current fragment: ${w.toFixed(3)} s\n      Estimated load time for down switch fragment: ${I.toFixed(3)} s\n      TTFB estimate: ${0|p} ms\n      Current BW estimate: ${m(v)?0|v:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${R} @ ${0|D} bps`),n.trigger(b.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:o})},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(t){t&&(L.log(`setting initial bwe to ${t}`),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const t=this.hls.config;return new fn(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)}registerListeners(){const{hls:t}=this;t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.FRAG_LOADING,this.onFragLoading,this),t.on(b.FRAG_LOADED,this.onFragLoaded,this),t.on(b.FRAG_BUFFERED,this.onFragBuffered,this),t.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(b.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t&&(t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.FRAG_LOADING,this.onFragLoading,this),t.off(b.FRAG_LOADED,this.onFragLoaded,this),t.off(b.FRAG_BUFFERED,this.onFragBuffered,this),t.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(b.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(b.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(t,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(t,e){const n=e.frag;if(!this.ignoreFragment(n)){var r;if(!n.bitrateTest)this.fragCurrent=n,this.partCurrent=null!=(r=e.part)?r:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(t,e){this.clearTimer()}onError(t,e){if(!e.fatal)switch(e.details){case T.BUFFER_ADD_CODEC_ERROR:case T.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case T.FRAG_LOAD_TIMEOUT:{const t=e.frag,{fragCurrent:n,partCurrent:r}=this;if(t&&n&&t.sn===n.sn&&t.level===n.level){const e=performance.now(),n=r?r.stats:t.stats,i=e-n.loading.start,s=n.loading.first?n.loading.first-n.loading.start:-1;if(n.loaded&&s>-1){const t=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(i-Math.min(t,s),n.loaded)}else this.bwEstimator.sampleTTFB(i)}break}}}getTimeToLoadFrag(t,e,n,r){return t+n/e+(r?this.lastLevelLoadSec:0)}onLevelLoaded(t,e){const n=this.hls.config,{loading:r}=e.stats,i=r.end-r.start;m(i)&&(this.lastLevelLoadSec=i/1e3),e.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)}onFragLoaded(t,{frag:e,part:n}){const r=n?n.stats:e.stats;if(e.type===Te.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),e.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const t=n?n.duration:e.duration,i=this.hls.levels[e.level],s=(i.loaded?i.loaded.bytes:0)+r.loaded,o=(i.loaded?i.loaded.duration:0)+t;i.loaded={bytes:s,duration:o},i.realBitrate=Math.round(8*s/o)}if(e.bitrateTest){const t={stats:r,frag:e,part:n,id:e.type};this.onFragBuffered(b.FRAG_BUFFERED,t),e.bitrateTest=!1}else this.lastLoadedFragLevel=e.level}}onFragBuffered(t,e){const{frag:n,part:r}=e,i=null!=r&&r.stats.loaded?r.stats:n.stats;if(i.aborted)return;if(this.ignoreFragment(n))return;const s=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(s,i.loaded),i.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==Te.MAIN||"initSegment"===t.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:t,minAutoLevel:e}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,i=this.findBestLevel(n,e,t,0,r,1,1);if(i>-1)return i;const s=this.hls.firstLevel,o=Math.min(Math.max(s,e),t);return L.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${s} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const t=this.forcedAutoLevel,e=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(!(-1===t||e&&n&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return t;const r=e&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==t){const e=this.hls.levels;if(e.length>Math.max(t,r)&&e[t].loadError<=e[r].loadError)return t}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:n}=this,{maxAutoLevel:r,config:i,minAutoLevel:s}=n,o=e?e.duration:t?t.duration:0,a=this.getBwEstimate(),l=this.getStarvationDelay();let u=i.abrBandWidthFactor,c=i.abrBandWidthUpFactor;if(l){const t=this.findBestLevel(a,s,r,l,0,u,c);if(t>=0)return t}let h=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay;if(!l){const t=this.bitrateTestDelay;if(t){h=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-t,L.info(`[abr] bitrate test took ${Math.round(1e3*t)}ms, set first fragment max fetchDuration to ${Math.round(1e3*h)} ms`),u=c=1}}const d=this.findBestLevel(a,s,r,l,h,u,c);if(L.info(`[abr] ${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${d}`),d>-1)return d;const f=n.levels[s],p=n.levels[n.loadLevel];return(null==f?void 0:f.bitrate)<(null==p?void 0:p.bitrate)?s:n.loadLevel}getStarvationDelay(){const t=this.hls,e=t.media;if(!e)return 1/0;const n=e&&0!==e.playbackRate?Math.abs(e.playbackRate):1,r=t.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(t,e,n,r,i,s,o){var a;const l=r+i,u=this.lastLoadedFragLevel,c=-1===u?this.hls.firstLevel:u,{fragCurrent:h,partCurrent:d}=this,{levels:f,allAudioTracks:p,loadLevel:g,config:v}=this.hls;if(1===f.length)return 0;const y=f[c],b=!(null==y||null==(a=y.details)||!a.live),E=-1===g||-1===u;let T,S="SDR",_=(null==y?void 0:y.frameRate)||0;const{audioPreference:w,videoPreference:A}=v,R=this.audioTracksByGroup||(this.audioTracksByGroup=function(t){return t.reduce((t,e)=>{let n=t.groups[e.groupId];n||(n=t.groups[e.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(e);const r=e.channels||"2";return n.channels[r]=(n.channels[r]||0)+1,n.hasDefault=n.hasDefault||e.default,n.hasAutoSelect=n.hasAutoSelect||e.autoselect,n.hasDefault&&(t.hasDefaultAudio=!0),n.hasAutoSelect&&(t.hasAutoSelectAudio=!0),t},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}(p));if(E){if(-1!==this.firstSelection)return this.firstSelection;const r=function(t,e,n,r,i){const s=Object.keys(t),o=null==r?void 0:r.channels,a=null==r?void 0:r.audioCodec,l=o&&2===parseInt(o);let u=!0,c=!1,h=1/0,d=1/0,f=1/0,p=0,g=[];const{preferHDR:v,allowedVideoRanges:y}=yn(e,i);for(let e=s.length;e--;){const n=t[s[e]];u=n.channels[2]>0,h=Math.min(h,n.minHeight),d=Math.min(d,n.minFramerate),f=Math.min(f,n.minBitrate);const r=y.filter(t=>n.videoRanges[t]>0);r.length>0&&(c=!0,g=r)}h=m(h)?h:0,d=m(d)?d:0;const b=Math.max(1080,h),E=Math.max(30,d);return f=m(f)?f:n,n=Math.max(f,n),c||(e=void 0,g=[]),{codecSet:s.reduce((e,r)=>{const i=t[r];if(r===e)return e;if(i.minBitrate>n)return bn(r,`min bitrate of ${i.minBitrate} > current estimate of ${n}`),e;if(!i.hasDefaultAudio)return bn(r,"no renditions with default or auto-select sound found"),e;if(a&&r.indexOf(a.substring(0,4))%5!=0)return bn(r,`audio codec preference "${a}" not found`),e;if(o&&!l){if(!i.channels[o])return bn(r,`no renditions with ${o} channel sound found (channels options: ${Object.keys(i.channels)})`),e}else if((!a||l)&&u&&0===i.channels[2])return bn(r,"no renditions with stereo sound found"),e;return i.minHeight>b?(bn(r,`min resolution of ${i.minHeight} > maximum of ${b}`),e):i.minFramerate>E?(bn(r,`min framerate of ${i.minFramerate} > maximum of ${E}`),e):g.some(t=>i.videoRanges[t]>0)?i.maxScore<p?(bn(r,`max score of ${i.maxScore} < selected max of ${p}`),e):e&&(ne(r)>=ne(e)||i.fragmentError>t[e].fragmentError)?e:(p=i.maxScore,r):(bn(r,`no variants with VIDEO-RANGE of ${JSON.stringify(g)} found`),e)},void 0),videoRanges:g,preferHDR:v,minFramerate:d,minBitrate:f}}(this.codecTiers||(this.codecTiers=function(t,e,n,r){return t.slice(n,r+1).reduce((t,n)=>{if(!n.codecSet)return t;const r=n.audioGroups;let i=t[n.codecSet];i||(t[n.codecSet]=i={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!r,fragmentError:0}),i.minBitrate=Math.min(i.minBitrate,n.bitrate);const s=Math.min(n.height,n.width);return i.minHeight=Math.min(i.minHeight,s),i.minFramerate=Math.min(i.minFramerate,n.frameRate),i.maxScore=Math.max(i.maxScore,n.score),i.fragmentError+=n.fragmentError,i.videoRanges[n.videoRange]=(i.videoRanges[n.videoRange]||0)+1,r&&r.forEach(t=>{if(!t)return;const n=e.groups[t];n&&(i.hasDefaultAudio=i.hasDefaultAudio||e.hasDefaultAudio?n.hasDefault:n.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(n.channels).forEach(t=>{i.channels[t]=(i.channels[t]||0)+n.channels[t]}))}),t},{})}(f,R,e,n)),S,t,w,A),{codecSet:i,videoRanges:s,minFramerate:o,minBitrate:a,preferHDR:l}=r;T=i,S=l?s[s.length-1]:s[0],_=o,t=Math.max(t,a),L.log(`[abr] picked start tier ${JSON.stringify(r)}`)}else T=null==y?void 0:y.codecSet,S=null==y?void 0:y.videoRange;const I=d?d.duration:h?h.duration:0,D=this.bwEstimator.getEstimateTTFB()/1e3,x=[];for(let a=n;a>=e;a--){var k;const e=f[a],h=a>c;if(!e)continue;if(v.useMediaCapabilities&&!e.supportedResult&&!e.supportedPromise){const n=navigator.mediaCapabilities;"function"==typeof(null==n?void 0:n.decodingInfo)&&mn(e,R,S,_,t,w)?(e.supportedPromise=vn(e,R,n),e.supportedPromise.then(t=>{if(!this.hls)return;e.supportedResult=t;const n=this.hls.levels,r=n.indexOf(e);t.error?L.warn(`[abr] MediaCapabilities decodingInfo error: "${t.error}" for level ${r} ${JSON.stringify(t)}`):t.supported||(L.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${r} ${JSON.stringify(t)}`),r>-1&&n.length>1&&(L.log(`[abr] Removing unsupported level ${r}`),this.hls.removeLevel(r)))})):e.supportedResult=pn}if(T&&e.codecSet!==T||S&&e.videoRange!==S||h&&_>e.frameRate||!h&&_>0&&_<e.frameRate||e.supportedResult&&(null==(k=e.supportedResult.decodingInfoResults)||!k[0].smooth)){x.push(a);continue}const p=e.details,A=(d?null==p?void 0:p.partTarget:null==p?void 0:p.averagetargetduration)||I;let O;O=h?o*t:s*t;const C=I&&r>=2*I&&0===i?f[a].averageBitrate:f[a].maxBitrate,P=this.getTimeToLoadFrag(D,O,C*A,void 0===p);if(O>=C&&(a===u||0===e.loadError&&0===e.fragmentError)&&(P<=D||!m(P)||b&&!this.bitrateTestDelay||P<l)){const t=this.forcedAutoLevel;return a===g||-1!==t&&t===g||(x.length&&L.trace(`[abr] Skipped level(s) ${x.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${f[x[0]].codecs}" ${f[x[0]].videoRange}; not compatible with "${y.codecs}" ${S}`),L.info(`[abr] switch candidate:${c}->${a} adjustedbw(${Math.round(O)})-bitrate=${Math.round(O-C)} ttfb:${D.toFixed(1)} avgDuration:${A.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${P.toFixed(1)} firstSelection:${E} codecSet:${T} videoRange:${S} hls.loadLevel:${g}`)),E&&(this.firstSelection=a),a}}return-1}set nextAutoLevel(t){const{maxAutoLevel:e,minAutoLevel:n}=this.hls,r=Math.min(Math.max(t,n),e);this._nextAutoLevel!==r&&(this.nextAutoLevelKey="",this._nextAutoLevel=r)}},bufferController:class{constructor(t){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=t=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=t=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:t,mediaSource:e}=this;this.log("Media source opened"),t&&(t.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(b.MEDIA_ATTACHED,{media:t,mediaSource:e})),e&&e.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:t,_objectUrl:e}=this;t!==e&&L.error(`Media element src was set while attaching MediaSource (${e} > ${t})`)},this.hls=t;const e="[buffer-controller]";var n;this.appendSource=(n=Xt(t.config.preferManagedMediaSource),"undefined"!=typeof self&&n===self.ManagedMediaSource),this.log=L.log.bind(L,e),this.warn=L.warn.bind(L,e),this.error=L.error.bind(L,e),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:t}=this;t.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.BUFFER_RESET,this.onBufferReset,this),t.on(b.BUFFER_APPENDING,this.onBufferAppending,this),t.on(b.BUFFER_CODECS,this.onBufferCodecs,this),t.on(b.BUFFER_EOS,this.onBufferEos,this),t.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(b.FRAG_PARSED,this.onFragParsed,this),t.on(b.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:t}=this;t.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.BUFFER_RESET,this.onBufferReset,this),t.off(b.BUFFER_APPENDING,this.onBufferAppending,this),t.off(b.BUFFER_CODECS,this.onBufferCodecs,this),t.off(b.BUFFER_EOS,this.onBufferEos,this),t.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(b.FRAG_PARSED,this.onFragParsed,this),t.off(b.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new pi(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){let n=2;(e.audio&&!e.video||!e.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(t,e){const n=this.media=e.media,r=Xt(this.appendSource);if(n&&r){var i;const t=this.mediaSource=new r;this.log(`created media source: ${null==(i=t.constructor)?void 0:i.name}`),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming));const e=this._objectUrl=self.URL.createObjectURL(t);if(this.appendSource)try{n.removeAttribute("src");const r=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||r&&t instanceof r,mi(n),function(t,e){const n=self.document.createElement("source");n.type="video/mp4",n.src=e,t.appendChild(n)}(n,e),n.load()}catch(t){n.src=e}else n.src=e;n.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:t,mediaSource:e,_objectUrl:n}=this;if(e){if(this.log("media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(t){this.warn(`onMediaDetaching: ${t.message} while calling endOfStream`)}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.removeEventListener("startstreaming",this._onStartStreaming),e.removeEventListener("endstreaming",this._onEndStreaming)),t&&(t.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),this.mediaSrc===n?(t.removeAttribute("src"),this.appendSource&&mi(t),t.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(b.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(t=>{this.resetBuffer(t)}),this._initSourceBuffer()}resetBuffer(t){const e=this.sourceBuffer[t];try{var n;if(e)this.removeBufferListeners(t),this.sourceBuffer[t]=void 0,null!=(n=this.mediaSource)&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(e)}catch(e){this.warn(`onBufferReset ${t}`,e)}}onBufferCodecs(t,e){const n=this.getSourceBufferTypes().length,r=Object.keys(e);if(r.forEach(t=>{if(n){const n=this.tracks[t];if(n&&"function"==typeof n.buffer.changeType){var r;const{id:i,codec:s,levelCodec:o,container:a,metadata:l}=e[t],u=oe(n.codec,n.levelCodec),c=null==u?void 0:u.replace(gi,"$1");let h=oe(s,o);const d=null==(r=h)?void 0:r.replace(gi,"$1");if(h&&c!==d){"audio"===t.slice(0,5)&&(h=se(h,this.appendSource));const e=`${a};codecs=${h}`;this.appendChangeType(t,e),this.log(`switching codec ${u} to ${h}`),this.tracks[t]={buffer:n.buffer,codec:s,container:a,levelCodec:o,metadata:l,id:i}}}}else this.pendingTracks[t]=e[t]}),n)return;const i=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==i&&(this.log(`${i} bufferCodec event(s) expected ${r.join(",")}`),this.bufferCodecEventsExpected=i),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks()}appendChangeType(t,e){const{operationQueue:n}=this,r={execute:()=>{const r=this.sourceBuffer[t];r&&(this.log(`changing ${t} sourceBuffer type to ${e}`),r.changeType(e)),n.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn(`Failed to change ${t} SourceBuffer type`,e)}};n.append(r,t,!!this.pendingTracks[t])}onBufferAppending(t,e){const{hls:n,operationQueue:r,tracks:i}=this,{data:s,type:o,frag:a,part:l,chunkMeta:u}=e,c=u.buffering[o],h=self.performance.now();c.start=h;const d=a.stats.buffering,f=l?l.stats.buffering:null;0===d.start&&(d.start=h),f&&0===f.start&&(f.start=h);const p=i.audio;let g=!1;"audio"===o&&"audio/mpeg"===(null==p?void 0:p.container)&&(g=!this.lastMpegAudioChunk||1===u.id||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const m=a.start,v={execute:()=>{if(c.executeStart=self.performance.now(),g){const t=this.sourceBuffer[o];if(t){const e=m-t.timestampOffset;Math.abs(e)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${m} (delta: ${e}) sn: ${a.sn})`),t.timestampOffset=m)}}this.appendExecutor(s,o)},onStart:()=>{},onComplete:()=>{const t=self.performance.now();c.executeEnd=c.end=t,0===d.first&&(d.first=t),f&&0===f.first&&(f.first=t);const{sourceBuffer:e}=this,n={};for(const t in e)n[t]=xn.getBuffered(e[t]);this.appendErrors[o]=0,"audio"===o||"video"===o?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(b.BUFFER_APPENDED,{type:o,frag:a,part:l,chunkMeta:u,parent:a.type,timeRanges:n})},onError:t=>{const e={type:E.MEDIA_ERROR,parent:a.type,details:T.BUFFER_APPEND_ERROR,sourceBufferName:o,frag:a,part:l,chunkMeta:u,error:t,err:t,fatal:!1};if(t.code===DOMException.QUOTA_EXCEEDED_ERR)e.details=T.BUFFER_FULL_ERROR;else{const t=++this.appendErrors[o];e.details=T.BUFFER_APPEND_ERROR,this.warn(`Failed ${t}/${n.config.appendErrorMaxRetry} times to append segment in "${o}" sourceBuffer`),t>=n.config.appendErrorMaxRetry&&(e.fatal=!0)}n.trigger(b.ERROR,e)}};r.append(v,o,!!this.pendingTracks[o])}onBufferFlushing(t,e){const{operationQueue:n}=this,r=t=>({execute:this.removeExecutor.bind(this,t,e.startOffset,e.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(b.BUFFER_FLUSHED,{type:t})},onError:e=>{this.warn(`Failed to remove from ${t} SourceBuffer`,e)}});e.type?n.append(r(e.type),e.type):this.getSourceBufferTypes().forEach(t=>{n.append(r(t),t)})}onFragParsed(t,e){const{frag:n,part:r}=e,i=[],s=r?r.elementaryStreams:n.elementaryStreams;s[C.AUDIOVIDEO]?i.push("audiovideo"):(s[C.AUDIO]&&i.push("audio"),s[C.VIDEO]&&i.push("video"));0===i.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(()=>{const t=self.performance.now();n.stats.buffering.end=t,r&&(r.stats.buffering.end=t);const e=r?r.stats:n.stats;this.hls.trigger(b.FRAG_BUFFERED,{frag:n,part:r,stats:e,id:n.type})},i)}onFragChanged(t,e){this.trimBuffers()}onBufferEos(t,e){this.getSourceBufferTypes().reduce((t,n)=>{const r=this.sourceBuffer[n];return!r||e.type&&e.type!==n||(r.ending=!0,r.ended||(r.ended=!0,this.log(`${n} sourceBuffer now EOS`))),t&&!(r&&!r.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(t=>{const e=this.sourceBuffer[t];e&&(e.ending=!1)});const{mediaSource:t}=this;t&&"open"===t.readyState?(this.log("Calling mediaSource.endOfStream()"),t.endOfStream()):t&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${t.readyState}`)}))}onLevelUpdated(t,{details:e}){e.fragments.length&&(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:t,details:e,media:n}=this;if(!n||null===e)return;if(!this.getSourceBufferTypes().length)return;const r=t.config,i=n.currentTime,s=e.levelTargetDuration,o=e.live&&null!==r.liveBackBufferLength?r.liveBackBufferLength:r.backBufferLength;if(m(o)&&o>0){const t=Math.max(o,s),e=Math.floor(i/s)*s-t;this.flushBackBuffer(i,s,e)}if(m(r.frontBufferFlushThreshold)&&r.frontBufferFlushThreshold>0){const t=Math.max(r.maxBufferLength,r.frontBufferFlushThreshold),e=Math.max(t,s),n=Math.floor(i/s)*s+e;this.flushFrontBuffer(i,s,n)}}flushBackBuffer(t,e,n){const{details:r,sourceBuffer:i}=this;this.getSourceBufferTypes().forEach(s=>{const o=i[s];if(o){const i=xn.getBuffered(o);if(i.length>0&&n>i.start(0)){if(this.hls.trigger(b.BACK_BUFFER_REACHED,{bufferEnd:n}),null!=r&&r.live)this.hls.trigger(b.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(o.ended&&i.end(i.length-1)-t<2*e)return void this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:s})}}})}flushFrontBuffer(t,e,n){const{sourceBuffer:r}=this;this.getSourceBufferTypes().forEach(i=>{const s=r[i];if(s){const r=xn.getBuffered(s),o=r.length;if(o<2)return;const a=r.start(o-1),l=r.end(o-1);if(n>a||t>=a&&t<=l)return;if(s.ended&&t-l<2*e)return void this.log(`Cannot flush ${i} front buffer while SourceBuffer is in ended state`);this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:a,endOffset:1/0,type:i})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||"open"!==this.mediaSource.readyState)return;const{details:t,hls:e,media:n,mediaSource:r}=this,i=t.fragments[0].start+t.totalduration,s=n.duration,o=m(r.duration)?r.duration:0;t.live&&e.config.liveDurationInfinity?(r.duration=1/0,this.updateSeekableRange(t)):(i>o&&i>s||!m(s))&&(this.log(`Updating Media Source duration to ${i.toFixed(3)}`),r.duration=i)}updateSeekableRange(t){const e=this.mediaSource,n=t.fragments;if(n.length&&t.live&&null!=e&&e.setLiveSeekableRange){const r=Math.max(0,n[0].start),i=Math.max(r,r+t.totalduration);this.log(`Media Source duration is set to ${e.duration}. Setting seekable range to ${r}-${i}.`),e.setLiveSeekableRange(r,i)}}checkPendingTracks(){const{bufferCodecEventsExpected:t,operationQueue:e,pendingTracks:n}=this,r=Object.keys(n).length;if(r&&(!t||2===r||"audiovideo"in n)){this.createSourceBuffers(n),this.pendingTracks={};const t=this.getSourceBufferTypes();if(t.length)this.hls.trigger(b.BUFFER_CREATED,{tracks:this.tracks}),t.forEach(t=>{e.executeNext(t)});else{const t=new Error("could not create source buffer for media codec(s)");this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:t,reason:t.message})}}}createSourceBuffers(t){const{sourceBuffer:e,mediaSource:n}=this;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(const i in t)if(!e[i]){var r;const s=t[i];if(!s)throw Error(`source buffer exists for track ${i}, however track does not`);let o=-1===(null==(r=s.levelCodec)?void 0:r.indexOf(","))?s.levelCodec:s.codec;o&&"audio"===i.slice(0,5)&&(o=se(o,this.appendSource));const a=`${s.container};codecs=${o}`;this.log(`creating sourceBuffer(${a})`);try{const t=e[i]=n.addSourceBuffer(a),r=i;this.addBufferListener(r,"updatestart",this._onSBUpdateStart),this.addBufferListener(r,"updateend",this._onSBUpdateEnd),this.addBufferListener(r,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(r,"bufferedchange",(t,e)=>{const n=e.removedRanges;null!=n&&n.length&&this.hls.trigger(b.BUFFER_FLUSHED,{type:i})}),this.tracks[i]={buffer:t,codec:o,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id}}catch(t){this.error(`error while trying to add sourceBuffer: ${t.message}`),this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,sourceBufferName:i,mimeType:a})}}}get mediaSrc(){var t,e;const n=(null==(t=this.media)?void 0:null==(e=t.querySelector)?void 0:e.call(t,"source"))||this.media;return null==n?void 0:n.src}_onSBUpdateStart(t){const{operationQueue:e}=this;e.current(t).onStart()}_onSBUpdateEnd(t){var e;if("closed"===(null==(e=this.mediaSource)?void 0:e.readyState))return void this.resetBuffer(t);const{operationQueue:n}=this;n.current(t).onComplete(),n.shiftAndExecuteNext(t)}_onSBUpdateError(t,e){var n;const r=new Error(`${t} SourceBuffer error. MediaSource readyState: ${null==(n=this.mediaSource)?void 0:n.readyState}`);this.error(`${r}`,e),this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:r,fatal:!1});const i=this.operationQueue.current(t);i&&i.onError(r)}removeExecutor(t,e,n){const{media:r,mediaSource:i,operationQueue:s,sourceBuffer:o}=this,a=o[t];if(!r||!i||!a)return this.warn(`Attempting to remove from the ${t} SourceBuffer, but it does not exist`),void s.shiftAndExecuteNext(t);const l=m(r.duration)?r.duration:1/0,u=m(i.duration)?i.duration:1/0,c=Math.max(0,e),h=Math.min(n,l,u);h>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${h}] from the ${t} SourceBuffer`),a.remove(c,h)):s.shiftAndExecuteNext(t)}appendExecutor(t,e){const n=this.sourceBuffer[e];if(n)n.ended=!1,n.appendBuffer(t);else if(!this.pendingTracks[e])throw new Error(`Attempting to append to the ${e} SourceBuffer, but it does not exist`)}blockBuffers(t,e=this.getSourceBufferTypes()){if(!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(t);const{operationQueue:n}=this,r=e.map(t=>n.appendBlocker(t));Promise.all(r).then(()=>{t(),e.forEach(t=>{const e=this.sourceBuffer[t];null!=e&&e.updating||n.shiftAndExecuteNext(t)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(t,e,n){const r=this.sourceBuffer[t];if(!r)return;const i=n.bind(this,t);this.listeners[t].push({event:e,listener:i}),r.addEventListener(e,i)}removeBufferListeners(t){const e=this.sourceBuffer[t];e&&this.listeners[t].forEach(t=>{e.removeEventListener(t.event,t.listener)})}},capLevelController:ds,errorController:class{constructor(t){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=L.log.bind(L,"[info]:"),this.warn=L.warn.bind(L,"[warning]:"),this.error=L.error.bind(L,"[error]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(b.ERROR,this.onError,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;t&&(t.off(b.ERROR,this.onError,this),t.off(b.ERROR,this.onErrorOut,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(t){}stopLoad(){this.playlistError=0}getVariantLevelIndex(t){return(null==t?void 0:t.type)===Te.MAIN?t.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(t,e){var n,r;if(e.fatal)return;const i=this.hls,s=e.context;switch(e.details){case T.FRAG_LOAD_ERROR:case T.FRAG_LOAD_TIMEOUT:case T.KEY_LOAD_ERROR:case T.KEY_LOAD_TIMEOUT:return void(e.errorAction=this.getFragRetryOrSwitchAction(e));case T.FRAG_PARSING_ERROR:if(null!=(n=e.frag)&&n.gap)return void(e.errorAction={action:un.DoNothing,flags:cn.None});case T.FRAG_GAP:case T.FRAG_DECRYPT_ERROR:return e.errorAction=this.getFragRetryOrSwitchAction(e),void(e.errorAction.action=un.SendAlternateToPenaltyBox);case T.LEVEL_EMPTY_ERROR:case T.LEVEL_PARSING_ERROR:{var o,a;const t=e.parent===Te.MAIN?e.level:i.loadLevel;e.details===T.LEVEL_EMPTY_ERROR&&null!=(o=e.context)&&null!=(a=o.levelDetails)&&a.live?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,t):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t))}return;case T.LEVEL_LOAD_ERROR:case T.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==s?void 0:s.level)&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,s.level)));case T.AUDIO_TRACK_LOAD_ERROR:case T.AUDIO_TRACK_LOAD_TIMEOUT:case T.SUBTITLE_LOAD_ERROR:case T.SUBTITLE_TRACK_LOAD_TIMEOUT:if(s){const t=i.levels[i.loadLevel];if(t&&(s.type===Ee.AUDIO_TRACK&&t.hasAudioGroup(s.groupId)||s.type===Ee.SUBTITLE_TRACK&&t.hasSubtitleGroup(s.groupId)))return e.errorAction=this.getPlaylistRetryOrSwitchAction(e,i.loadLevel),e.errorAction.action=un.SendAlternateToPenaltyBox,void(e.errorAction.flags=cn.MoveAllAlternatesMatchingHost)}return;case T.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const t=i.levels[i.loadLevel],n=null==t?void 0:t.attrs["HDCP-LEVEL"];n?e.errorAction={action:un.SendAlternateToPenaltyBox,flags:cn.MoveAllAlternatesMatchingHDCP,hdcpLevel:n}:this.keySystemError(e)}return;case T.BUFFER_ADD_CODEC_ERROR:case T.REMUX_ALLOC_ERROR:case T.BUFFER_APPEND_ERROR:return void(e.errorAction=this.getLevelSwitchAction(e,null!=(r=e.level)?r:i.loadLevel));case T.INTERNAL_EXCEPTION:case T.BUFFER_APPENDING_ERROR:case T.BUFFER_FULL_ERROR:case T.LEVEL_SWITCH_ERROR:case T.BUFFER_STALLED_ERROR:case T.BUFFER_SEEK_OVER_HOLE:case T.BUFFER_NUDGE_ON_STALL:return void(e.errorAction={action:un.DoNothing,flags:cn.None})}e.type===E.KEY_SYSTEM_ERROR&&this.keySystemError(e)}keySystemError(t){const e=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e)}getPlaylistRetryOrSwitchAction(t,e){const n=tn(this.hls.config.playlistLoadPolicy,t),r=this.playlistError++;if(rn(n,r,Je(t),t.response))return{action:un.RetryRequest,flags:cn.None,retryConfig:n,retryCount:r};const i=this.getLevelSwitchAction(t,e);return n&&(i.retryConfig=n,i.retryCount=r),i}getFragRetryOrSwitchAction(t){const e=this.hls,n=this.getVariantLevelIndex(t.frag),r=e.levels[n],{fragLoadPolicy:i,keyLoadPolicy:s}=e.config,o=tn(t.details.startsWith("key")?s:i,t),a=e.levels.reduce((t,e)=>t+e.fragmentError,0);if(r){if(t.details!==T.FRAG_GAP&&r.fragmentError++,rn(o,a,Je(t),t.response))return{action:un.RetryRequest,flags:cn.None,retryConfig:o,retryCount:a}}const l=this.getLevelSwitchAction(t,n);return o&&(l.retryConfig=o,l.retryCount=a),l}getLevelSwitchAction(t,e){const n=this.hls;null==e&&(e=n.loadLevel);const r=this.hls.levels[e];if(r){var i,s;const e=t.details;r.loadError++,e===T.BUFFER_APPEND_ERROR&&r.fragmentError++;let l=-1;const{levels:u,loadLevel:c,minAutoLevel:h,maxAutoLevel:d}=n;n.autoLevelEnabled||(n.loadLevel=-1);const f=null==(i=t.frag)?void 0:i.type,p=(f===Te.AUDIO&&e===T.FRAG_PARSING_ERROR||"audio"===t.sourceBufferName&&(e===T.BUFFER_ADD_CODEC_ERROR||e===T.BUFFER_APPEND_ERROR))&&u.some(({audioCodec:t})=>r.audioCodec!==t),g="video"===t.sourceBufferName&&(e===T.BUFFER_ADD_CODEC_ERROR||e===T.BUFFER_APPEND_ERROR)&&u.some(({codecSet:t,audioCodec:e})=>r.codecSet!==t&&r.audioCodec===e),{type:m,groupId:v}=null!=(s=t.context)?s:{};for(let n=u.length;n--;){const i=(n+c)%u.length;if(i!==c&&i>=h&&i<=d&&0===u[i].loadError){var o,a;const n=u[i];if(e===T.FRAG_GAP&&f===Te.MAIN&&t.frag){const e=u[i].details;if(e){const n=on(t.frag,e.fragments,t.frag.start);if(null!=n&&n.gap)continue}}else{if(m===Ee.AUDIO_TRACK&&n.hasAudioGroup(v)||m===Ee.SUBTITLE_TRACK&&n.hasSubtitleGroup(v))continue;if(f===Te.AUDIO&&null!=(o=r.audioGroups)&&o.some(t=>n.hasAudioGroup(t))||f===Te.SUBTITLE&&null!=(a=r.subtitleGroups)&&a.some(t=>n.hasSubtitleGroup(t))||p&&r.audioCodec===n.audioCodec||!p&&r.audioCodec!==n.audioCodec||g&&r.codecSet===n.codecSet)continue}l=i;break}}if(l>-1&&n.loadLevel!==l)return t.levelRetry=!0,this.playlistError=0,{action:un.SendAlternateToPenaltyBox,flags:cn.None,nextAutoLevel:l}}return{action:un.SendAlternateToPenaltyBox,flags:cn.MoveAllAlternatesMatchingHost}}onErrorOut(t,e){var n;switch(null==(n=e.errorAction)?void 0:n.action){case un.DoNothing:break;case un.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(e),e.errorAction.resolved||e.details===T.FRAG_GAP?/MediaSource readyState: ended/.test(e.error.message)&&(this.warn(`MediaSource ended after "${e.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):e.fatal=!0;break;case un.RetryRequest:}e.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(t){const e=this.hls,n=t.errorAction;if(!n)return;const{flags:r,hdcpLevel:i,nextAutoLevel:s}=n;switch(r){case cn.None:this.switchLevel(t,s);break;case cn.MoveAllAlternatesMatchingHDCP:i&&(e.maxHdcpLevel=Ue[Ue.indexOf(i)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`)}n.resolved||this.switchLevel(t,s)}switchLevel(t,e){void 0!==e&&t.errorAction&&(this.warn(`switching to level ${e} after ${t.details}`),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}},fpsController:class{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const n=this.hls.config;if(n.capLevelOnFPSDrop){const t=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=t,t&&"function"==typeof t.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}checkFPS(t,e,n){const r=performance.now();if(e){if(this.lastTime){const t=r-this.lastTime,i=n-this.lastDroppedFrames,s=e-this.lastDecodedFrames,o=1e3*i/t,a=this.hls;if(a.trigger(b.FPS_DROP,{currentDropped:i,currentDecoded:s,totalDroppedFrames:n}),o>0&&i>a.config.fpsDroppedMonitoringThreshold*s){let t=a.currentLevel;L.warn("drop FPS ratio greater than max allowed value for currentLevel: "+t),t>0&&(-1===a.autoLevelCapping||a.autoLevelCapping>=t)&&(t-=1,a.trigger(b.FPS_DROP_LEVEL_CAPPING,{level:t,droppedLevel:a.currentLevel}),a.autoLevelCapping=t,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:X,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:{newCue(t,e,n,r){const i=[];let s,o,a,l,u;const c=self.VTTCue||self.TextTrackCue;for(let d=0;d<r.rows.length;d++)if(s=r.rows[d],a=!0,l=0,u="",!s.isEmpty()){var h;for(let t=0;t<s.chars.length;t++)lo.test(s.chars[t].uchar)&&a?l++:(u+=s.chars[t].uchar,a=!1);s.cueStartTime=e,e===n&&(n+=1e-4),l>=16?l--:l++;const r=Hi(u.trim()),f=Qi(e,n,r);null!=t&&null!=(h=t.cues)&&h.getCueById(f)||(o=new c(e,n,r),o.id=f,o.line=d+1,o.align="left",o.position=10+Math.min(80,10*Math.floor(8*l/32)),i.push(o))}return t&&i.length&&(i.sort((t,e)=>"auto"===t.line||"auto"===e.line?0:t.line>8&&e.line>8?e.line-t.line:t.line-e.line),i.forEach(e=>Le(t,e))),i}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends qn{constructor(t,e,n){super(t,e,n,"[subtitle-stream-controller]",Te.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:t}=this;t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.ERROR,this.onError,this),t.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.ERROR,this.onError,this),t.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(t){this.stopLoad(),this.state=zn.IDLE,this.setInterval(di),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:n,success:r}=e;if(this.fragPrevious=n,this.state=zn.IDLE,!r)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let s;const o=n.start;for(let t=0;t<i.length;t++)if(o>=i[t].start&&o<=i[t].end){s=i[t];break}const a=n.start+n.duration;s?s.end=a:(s={start:o,end:a},i.push(s)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null)}onBufferFlushing(t,e){const{startOffset:n,endOffset:r}=e;if(0===n&&r!==Number.POSITIVE_INFINITY){const t=r-1;if(t<=0)return;e.endOffsetSubtitles=Math.max(0,t),this.tracksBuffered.forEach(e=>{for(let n=0;n<e.length;)if(e[n].end<=t)e.shift();else{if(!(e[n].start<t))break;e[n].start=t,n++}}),this.fragmentTracker.removeFragmentsInRange(n,t,Te.SUBTITLE)}}onFragBuffered(t,e){var n;this.loadedmetadata||e.frag.type!==Te.MAIN||null!=(n=this.media)&&n.buffered.length&&(this.loadedmetadata=!0)}onError(t,e){const n=e.frag;(null==n?void 0:n.type)===Te.SUBTITLE&&(e.details===T.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==zn.STOPPED&&(this.state=zn.IDLE))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){this.levels&&li(this.levels,e)?this.levels=e.map(t=>new Ke(t)):(this.tracksBuffered=[],this.levels=e.map(t=>{const e=new Ke(t);return this.tracksBuffered[e.id]=[],e}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Te.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(t,e){var n;if(this.currentTrackId=e.id,null==(n=this.levels)||!n.length||-1===this.currentTrackId)return void this.clearInterval();const r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.setInterval(di)}onSubtitleTrackLoaded(t,e){var n;const{currentTrackId:r,levels:i}=this,{details:s,id:o}=e;if(!i)return void this.warn(`Subtitle tracks were reset while loading level ${o}`);const a=i[o];if(o>=i.length||!a)return;this.log(`Subtitle track ${o} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(s.live||null!=(n=a.details)&&n.live){const t=this.mainDetails;if(s.deltaUpdateFailed||!t)return;const e=t.fragments[0];var u;if(a.details)l=this.alignPlaylists(s,a.details,null==(u=this.levelLastLoaded)?void 0:u.details),0===l&&e&&(l=e.start,qe(s,l));else s.hasProgramDateTime&&t.hasProgramDateTime?(Fn(s,t),l=s.fragments[0].start):e&&(l=e.start,qe(s,l))}if(a.details=s,this.levelLastLoaded=a,o===r&&(this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(this.mainDetails||s,l),this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===zn.IDLE)){on(null,s.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),a.details=void 0)}}_handleFragmentLoadComplete(t){const{frag:e,payload:n}=t,r=e.decryptdata,i=this.hls;if(!this.fragContextChanged(e)&&n&&n.byteLength>0&&null!=r&&r.key&&r.iv&&"AES-128"===r.method){const t=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer).catch(t=>{throw i.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t}).then(n=>{const r=performance.now();i.trigger(b.FRAG_DECRYPTED,{frag:e,payload:n,stats:{tstart:t,tdecrypt:r}})}).catch(t=>{this.warn(`${t.name}: ${t.message}`),this.state=zn.IDLE})}}doTick(){if(this.media){if(this.state===zn.IDLE){const{currentTrackId:t,levels:e}=this,n=null==e?void 0:e[t];if(!n||!e.length||!n.details)return;const{config:r}=this,i=this.getLoadPosition(),s=xn.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,r.maxBufferHole),{end:o,len:a}=s,l=this.getFwdBufferInfo(this.media,Te.MAIN),u=n.details;if(a>this.getMaxBufferLength(null==l?void 0:l.len)+u.levelTargetDuration)return;const c=u.fragments,h=c.length,d=u.edge;let f=null;const p=this.fragPrevious;if(o<d){const t=r.maxFragLookUpTolerance,e=o>d-t?0:t;f=on(p,c,Math.max(c[0].start,o),e),!f&&p&&p.start<c[0].start&&(f=c[0])}else f=c[h-1];if(!f)return;if(f=this.mapToInitFragWhenRequired(f),"initSegment"!==f.sn){const t=c[f.sn-u.startSN-1];t&&t.cc===f.cc&&this.fragmentTracker.getState(t)===An.NOT_LOADED&&(f=t)}this.fragmentTracker.getState(f)===An.NOT_LOADED&&this.loadFragment(f,n,o)}}else this.state=zn.IDLE}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.max(e,t):e}loadFragment(t,e,n){this.fragCurrent=t,"initSegment"===t.sn?this._loadInitSegment(t,e):(this.startFragRequested=!0,super.loadFragment(t,e,n))}get mediaBufferTimeRanges(){return new fi(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends hn{constructor(t){super(t,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const e=De(this.media.textTracks);for(let n=0;n<e.length;n++)if("hidden"===e[n].mode)t=e[n];else if("showing"===e[n].mode){t=e[n];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:t}=this;t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.LEVEL_LOADING,this.onLevelLoading,this),t.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.LEVEL_LOADING,this.onLevelLoading,this),t.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(b.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),De(this.media.textTracks).forEach(t=>{Re(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:n,groupId:r,details:i}=e,s=this.tracksInGroup[n];if(!s||s.groupId!==r)return void this.warn(`Subtitle track with id:${n} and group:${r} not found in active group ${null==s?void 0:s.groupId}`);const o=s.details;s.details=e.details,this.log(`Subtitle track ${n} "${s.name}" lang:${s.lang} group:${r} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,e,o)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const n=e.subtitleGroups||null,r=this.groupIds;let i=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some(t=>-1===(null==r?void 0:r.indexOf(t)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const t=this.tracks.filter(t=>!n||-1!==n.indexOf(t.groupId));if(t.length)this.selectDefaultTrack&&!t.some(t=>t.default)&&(this.selectDefaultTrack=!1),t.forEach((t,e)=>{t.id=e});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=t;const e=this.hls.config.subtitlePreference;if(!i&&e){this.selectDefaultTrack=!1;const n=En(e,t);if(n>-1)i=t[n];else{const t=En(e,this.tracks);i=this.tracks[t]}}let r=this.findTrackId(i);-1===r&&i&&(r=this.findTrackId(null));const s={subtitleTracks:t};this.log(`Updating subtitle tracks, ${t.length} track(s) found in "${null==n?void 0:n.join(",")}" group-id`),this.hls.trigger(b.SUBTITLE_TRACKS_UPDATED,s),-1!==r&&-1===this.trackId&&this.setSubtitleTrack(r)}else this.shouldReloadPlaylist(i)&&this.setSubtitleTrack(this.trackId)}findTrackId(t){const e=this.tracksInGroup,n=this.selectDefaultTrack;for(let r=0;r<e.length;r++){const i=e[r];if((!n||i.default)&&(n||t)&&(!t||Tn(i,t)))return r}if(t){for(let n=0;n<e.length;n++){const r=e[n];if(ui(t.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<e.length;n++){const r=e[n];if(ui(t.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(t){if(t){const e=this.tracksInGroup;for(let n=0;n<e.length;n++){if(ci(e[n],t))return n}}return-1}onError(t,e){!e.fatal&&e.context&&(e.context.type!==Ee.SUBTITLE_TRACK||e.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(e.context.groupId)||this.checkRetry(e))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}setSubtitleOption(t){if(this.hls.config.subtitlePreference=t,t){const e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){const n=this.currentTrack;if(n&&Tn(t,n))return n;const r=En(t,this.tracksInGroup);if(r>-1){const t=this.tracksInGroup[r];return this.setSubtitleTrack(r),t}if(n)return null;{const n=En(t,e);if(n>-1)return e[n]}}}return null}loadPlaylist(t){super.loadPlaylist();const e=this.currentTrack;if(this.shouldLoadPlaylist(e)&&e){const n=e.id,r=e.groupId;let i=e.url;if(t)try{i=t.addDirectives(i)}catch(t){this.warn(`Could not construct new URL with HLS Delivery Directives: ${t}`)}this.log(`Loading subtitle playlist for id ${n}`),this.hls.trigger(b.SUBTITLE_TRACK_LOADING,{url:i,id:n,groupId:r,deliveryDirectives:t||null})}}toggleTrackModes(){const{media:t}=this;if(!t)return;const e=De(t.textTracks),n=this.currentTrack;let r;if(n&&(r=e.filter(t=>ci(n,t))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(e).forEach(t=>{"disabled"!==t.mode&&t!==r&&(t.mode="disabled")}),r){const t=this.subtitleDisplay?"showing":"hidden";r.mode!==t&&(r.mode=t)}}setSubtitleTrack(t){const e=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=t);if(t<-1||t>=e.length||!m(t))return void this.warn(`Invalid subtitle track id: ${t}`);this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,r=e[t]||null;if(this.trackId=t,this.currentTrack=r,this.toggleTrackModes(),!r)return void this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:t});const i=!!r.details&&!r.details.live;if(t===this.trackId&&r===n&&i)return;this.log(`Switching to subtitle-track ${t}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:s,groupId:o="",name:a,type:l,url:u}=r;this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:s,groupId:o,name:a,type:l,url:u});const c=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(c)}},timelineController:class{constructor(t){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(b.FRAG_LOADING,this.onFragLoading,this),t.on(b.FRAG_LOADED,this.onFragLoaded,this),t.on(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(b.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(b.FRAG_LOADING,this.onFragLoading,this),t.off(b.FRAG_LOADED,this.onFragLoaded,this),t.off(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(b.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const t=new Fi(this,"textTrack1"),e=new Fi(this,"textTrack2"),n=new Fi(this,"textTrack3"),r=new Fi(this,"textTrack4");this.cea608Parser1=new Ci(1,t,e),this.cea608Parser2=new Ci(3,n,r)}}addCues(t,e,n,r,i){let s=!1;for(let t=i.length;t--;){const r=i[t],c=(o=r[0],a=r[1],l=e,u=n,Math.min(a,u)-Math.max(o,l));if(c>=0&&(r[0]=Math.min(r[0],e),r[1]=Math.max(r[1],n),s=!0,c/(n-e)>.5))return}var o,a,l,u;if(s||i.push([e,n]),this.config.renderTextTracksNatively){const i=this.captionsTracks[t];this.Cues.newCue(i,e,n,r)}else{const i=this.Cues.newCue(null,e,n,r);this.hls.trigger(b.CUES_PARSED,{type:"captions",cues:i,track:t})}}onInitPtsFound(t,{frag:e,id:n,initPTS:r,timescale:i}){const{unparsedVttFrags:s}=this;"main"===n&&(this.initPTS[e.cc]={baseTime:r,timescale:i}),s.length&&(this.unparsedVttFrags=[],s.forEach(t=>{this.onFragLoaded(b.FRAG_LOADED,t)}))}getExistingTrack(t,e){const{media:n}=this;if(n)for(let r=0;r<n.textTracks.length;r++){const i=n.textTracks[r];if(hs(i,{name:t,lang:e,attrs:{}}))return i}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:n,media:r}=this,{label:i,languageCode:s}=e[t],o=this.getExistingTrack(i,s);if(o)n[t]=o,Re(n[t]),Ae(n[t],r);else{const e=this.createTextTrack("captions",i,s);e&&(e[t]=!0,n[t]=e)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const n={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=n,this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(t,e,n){const r=this.media;if(r)return r.addTextTrack(t,e,n)}onMediaAttaching(t,e){this.media=e.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:t}=this;Object.keys(t).forEach(e=>{Re(t[e]),delete t[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let t=0;t<e.length;t++)Re(e[t])}onSubtitleTracksUpdated(t,e){const n=e.subtitleTracks||[],r=n.some(t=>t.textCodec===ts);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(li(this.tracks,n))return void(this.tracks=n);if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const t=this.media,e=t?De(t.textTracks):null;if(this.tracks.forEach((t,n)=>{let r;if(e){let n=null;for(let r=0;r<e.length;r++)if(e[r]&&hs(e[r],t)){n=e[r],e[r]=null;break}n&&(r=n)}if(r)Re(r);else{const e=cs(t);r=this.createTextTrack(e,t.name,t.lang),r&&(r.mode="disabled")}r&&this.textTracks.push(r)}),null!=e&&e.length){const t=e.filter(t=>null!==t).map(t=>t.label);t.length&&L.warn(`Media element contains unused subtitle tracks: ${t.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const t=this.tracks.map(t=>({label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}));this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:t})}}}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(t=>{const e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(!e)return;const n=`textTrack${e[1]}`,r=this.captionsProperties[n];r&&(r.label=t.name,t.lang&&(r.languageCode=t.lang),r.media=t)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return null==e?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){if(this.enabled&&e.frag.type===Te.MAIN){var n,r;const{cea608Parser1:t,cea608Parser2:i,lastSn:s}=this,{cc:o,sn:a}=e.frag,l=null!=(n=null==(r=e.part)?void 0:r.index)?n:-1;t&&i&&(a!==s+1||a===s&&l!==this.lastPartIndex+1||o!==this.lastCc)&&(t.reset(),i.reset()),this.lastCc=o,this.lastSn=a,this.lastPartIndex=l}}onFragLoaded(t,e){const{frag:n,payload:r}=e;if(n.type===Te.SUBTITLE)if(r.byteLength){const t=n.decryptdata,i="stats"in e;if(null==t||!t.encrypted||i){const t=this.tracks[n.level],i=this.vttCCs;i[n.cc]||(i[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),t&&t.textCodec===ts?this._parseIMSC1(n,r):this._parseVTTs(e)}}else this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const n=this.hls;is(e,this.initPTS[t.cc],e=>{this._appendCues(e,t.level),n.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},e=>{L.log(`Failed to parse IMSC1: ${e}`),n.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:e})})}_parseVTTs(t){var e;const{frag:n,payload:r}=t,{initPTS:i,unparsedVttFrags:s}=this,o=i.length-1;if(!i[n.cc]&&-1===o)return void s.push(t);const a=this.hls;Ji(null!=(e=n.initSegment)&&e.data?Mt(n.initSegment.data,new Uint8Array(r)):r,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,t=>{this._appendCues(t,n.level),a.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},e=>{const i="Missing initPTS for VTT MPEGTS"===e.message;i?s.push(t):this._fallbackToIMSC1(n,r),L.log(`Failed to parse VTT cue: ${e}`),i&&o>n.cc||a.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:e})})}_fallbackToIMSC1(t,e){const n=this.tracks[t.level];n.textCodec||is(e,this.initPTS[t.cc],()=>{n.textCodec=ts,this._parseIMSC1(t,e)},()=>{n.textCodec="wvtt"})}_appendCues(t,e){const n=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[e];if(!n||"disabled"===n.mode)return;t.forEach(t=>Le(n,t))}else{const r=this.tracks[e];if(!r)return;const i=r.default?"default":"subtitles"+e;n.trigger(b.CUES_PARSED,{type:"subtitles",cues:t,track:i})}}onFragDecrypted(t,e){const{frag:n}=e;n.type===Te.SUBTITLE&&this.onFragLoaded(b.FRAG_LOADED,e)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){this.initCea608Parsers();const{cea608Parser1:n,cea608Parser2:r}=this;if(!this.enabled||!n||!r)return;const{frag:i,samples:s}=e;if(i.type!==Te.MAIN||"NONE"!==this.closedCaptionsForLevel(i))for(let t=0;t<s.length;t++){const e=s[t].bytes;if(e){const i=this.extractCea608Data(e);n.addData(s[t].pts,i[0]),r.addData(s[t].pts,i[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:n,endOffsetSubtitles:r,type:i}){const{media:s}=this;if(s&&!(s.currentTime<n)){if(!i||"video"===i){const{captionsTracks:t}=this;Object.keys(t).forEach(r=>Ie(t[r],e,n))}if(this.config.renderTextTracksNatively&&0===e&&void 0!==r){const{textTracks:t}=this;Object.keys(t).forEach(n=>Ie(t[n],e,r))}}}extractCea608Data(t){const e=[[],[]],n=31&t[0];let r=2;for(let i=0;i<n;i++){const n=t[r++],i=127&t[r++],s=127&t[r++];if((0!==i||0!==s)&&0!=(4&n)){const t=3&n;0!==t&&1!==t||(e[t].push(i),e[t].push(s))}}return e}},audioStreamController:class extends qn{constructor(t,e,n){super(t,e,n,"[audio-stream-controller]",Te.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:t}=this;t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(b.ERROR,this.onError,this),t.on(b.BUFFER_RESET,this.onBufferReset,this),t.on(b.BUFFER_CREATED,this.onBufferCreated,this),t.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(b.ERROR,this.onError,this),t.off(b.BUFFER_RESET,this.onBufferReset,this),t.off(b.BUFFER_CREATED,this.onBufferCreated,this),t.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(t,{frag:e,id:n,initPTS:r,timescale:i}){if("main"===n){const t=e.cc;this.initPTS[e.cc]={baseTime:r,timescale:i},this.log(`InitPTS for cc: ${t} found from main: ${r}`),this.videoTrackCC=t,this.state===zn.WAITING_INIT_PTS&&this.tick()}}startLoad(t){if(!this.levels)return this.startPosition=t,void(this.state=zn.STOPPED);const e=this.lastCurrentTime;this.stopLoad(),this.setInterval(hi),e>0&&-1===t?(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e,this.state=zn.IDLE):(this.loadedmetadata=!1,this.state=zn.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}doTick(){switch(this.state){case zn.IDLE:this.doTickIdle();break;case zn.WAITING_TRACK:{var t;const{levels:e,trackId:n}=this,r=null==e?void 0:null==(t=e[n])?void 0:t.details;if(r){if(this.waitForCdnTuneIn(r))break;this.state=zn.WAITING_INIT_PTS}break}case zn.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),n=this.retryDate;if(!n||t>=n||null!=(e=this.media)&&e.seeking){const{levels:t,trackId:e}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((null==t?void 0:t[e])||null),this.state=zn.IDLE}break}case zn.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:e,part:n,cache:r,complete:i}=t;if(void 0!==this.initPTS[e.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=zn.FRAG_LOADING;const t={frag:e,part:n,payload:r.flush(),networkDetails:null};this._handleFragmentLoadProgress(t),i&&super._handleFragmentLoadComplete(t)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${e.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const t=this.getLoadPosition(),n=xn.bufferInfo(this.mediaBuffer,t,this.config.maxBufferHole);an(n.end,this.config.maxFragLookUpTolerance,e)<0&&(this.log(`Waiting fragment cc (${e.cc}) @ ${e.start} cancelled because another fragment at ${n.end} is needed`),this.clearWaitingFragment())}}else this.state=zn.IDLE}}this.onTickEnd()}clearWaitingFragment(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=zn.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:t}=this;null!=t&&t.readyState&&(this.lastCurrentTime=t.currentTime)}doTickIdle(){const{hls:t,levels:e,media:n,trackId:r}=this,i=t.config;if(!n&&(this.startFragRequested||!i.startFragPrefetch)||null==e||!e[r])return;const s=e[r],o=s.details;if(!o||o.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(o))return void(this.state=zn.WAITING_TRACK);const a=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&a&&(this.bufferFlushed=!1,this.afterBufferFlushed(a,C.AUDIO,Te.AUDIO));const l=this.getFwdBufferInfo(a,Te.AUDIO);if(null===l)return;const{bufferedTrack:u,switchingTrack:c}=this;if(!c&&this._streamEnded(l,o))return t.trigger(b.BUFFER_EOS,{type:"audio"}),void(this.state=zn.ENDED);const h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Te.MAIN),d=l.len,f=this.getMaxBufferLength(null==h?void 0:h.len),p=o.fragments,g=p[0].start;let m=this.flushing?this.getLoadPosition():l.end;if(c&&n){const t=this.getLoadPosition();u&&!ui(c.attrs,u.attrs)&&(m=t),o.PTSKnown&&t<g&&(l.end>g||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=g+.05)}if(d>=f&&!c&&m<p[p.length-1].start)return;let v=this.getNextFragment(m,o),y=!1;if(v&&this.isLoopLoading(v,m)&&(y=!!v.gap,v=this.getNextFragmentLoopLoading(v,o,l,Te.MAIN,f)),!v)return void(this.bufferFlushed=!0);const E=h&&v.start>h.end+o.targetduration;if(E||(null==h||!h.len)&&l.len){const t=this.getAppendedFrag(v.start,Te.MAIN);if(null===t)return;if(y||(y=!!t.gap||!!E&&0===h.len),E&&!y||y&&l.nextStart&&l.nextStart<t.end)return}this.loadFragment(v,s,m)}getMaxBufferLength(t){const e=super.getMaxBufferLength();return t?Math.min(Math.max(e,t),this.config.maxMaxBufferLength):e}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(t=>new Ke(t))}onAudioTrackSwitching(t,e){const n=!!e.url;this.trackId=e.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?this.setInterval(hi):this.resetTransmuxer(),n?(this.switchingTrack=e,this.state=zn.IDLE,this.flushAudioIfNeeded(e)):(this.switchingTrack=null,this.bufferedTrack=e,this.state=zn.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(t,e){this.mainDetails=e.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(b.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(t,e){var n;if(null==this.mainDetails)return void(this.cachedTrackLoadedData=e);const{levels:r}=this,{details:i,id:s}=e;if(!r)return void this.warn(`Audio tracks were reset while loading level ${s}`);this.log(`Audio track ${s} loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const o=r[s];let a=0;if(i.live||null!=(n=o.details)&&n.live){this.checkLiveUpdate(i);const t=this.mainDetails;if(i.deltaUpdateFailed||!t)return;var l;if(!o.details&&i.hasProgramDateTime&&t.hasProgramDateTime)Fn(i,t),a=i.fragments[0].start;else a=this.alignPlaylists(i,o.details,null==(l=this.levelLastLoaded)?void 0:l.details)}o.details=i,this.levelLastLoaded=o,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(this.mainDetails||i,a),this.state!==zn.WAITING_TRACK||this.waitForCdnTuneIn(i)||(this.state=zn.IDLE),this.tick()}_handleFragmentLoadProgress(t){var e;const{frag:n,part:r,payload:i}=t,{config:s,trackId:o,levels:a}=this;if(!a)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);const l=a[o];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const u=l.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(n.start);const c=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let h=this.transmuxer;h||(h=this.transmuxer=new ai(this.hls,Te.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const d=this.initPTS[n.cc],f=null==(e=n.initSegment)?void 0:e.data;if(void 0!==d){const t=!1,e=r?r.index:-1,s=-1!==e,o=new kn(n.level,n.sn,n.stats.chunkCount,i.byteLength,e,s);h.push(i,f,c,"",n,r,u.totalduration,t,o,d)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${u.startSN} ,${u.endSN}],track ${o}`);const{cache:t}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new Xn,complete:!1};t.push(new Uint8Array(i)),this.waitingVideoCC=this.videoTrackCC,this.state=zn.WAITING_INIT_PTS}}_handleFragmentLoadComplete(t){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(t,e){const n=e.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer||null)}onFragBuffered(t,e){const{frag:n,part:r}=e;if(n.type===Te.AUDIO)if(this.fragContextChanged(n))this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if("initSegment"!==n.sn){this.fragPrevious=n;const t=this.switchingTrack;t&&(this.bufferedTrack=t,this.switchingTrack=null,this.hls.trigger(b.AUDIO_TRACK_SWITCHED,d({},t)))}this.fragBufferedComplete(n,r)}else if(!this.loadedmetadata&&n.type===Te.MAIN){const t=this.videoBuffer||this.media;if(t){xn.getBuffered(t).length&&(this.loadedmetadata=!0)}}}onError(t,e){var n;if(e.fatal)this.state=zn.ERROR;else switch(e.details){case T.FRAG_GAP:case T.FRAG_PARSING_ERROR:case T.FRAG_DECRYPT_ERROR:case T.FRAG_LOAD_ERROR:case T.FRAG_LOAD_TIMEOUT:case T.KEY_LOAD_ERROR:case T.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Te.AUDIO,e);break;case T.AUDIO_TRACK_LOAD_ERROR:case T.AUDIO_TRACK_LOAD_TIMEOUT:case T.LEVEL_PARSING_ERROR:e.levelRetry||this.state!==zn.WAITING_TRACK||(null==(n=e.context)?void 0:n.type)!==Ee.AUDIO_TRACK||(this.state=zn.IDLE);break;case T.BUFFER_APPEND_ERROR:case T.BUFFER_FULL_ERROR:if(!e.parent||"audio"!==e.parent)return;if(e.details===T.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case T.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}}onBufferFlushing(t,{type:e}){e!==C.VIDEO&&(this.flushing=!0)}onBufferFlushed(t,{type:e}){if(e!==C.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===zn.ENDED&&(this.state=zn.IDLE);const t=this.mediaBuffer||this.media;t&&(this.afterBufferFlushed(t,e,Te.AUDIO),this.tick())}}_handleTransmuxComplete(t){var e;const n="audio",{hls:r}=this,{remuxResult:i,chunkMeta:s}=t,o=this.getCurrentContext(s);if(!o)return void this.resetWhenMissingContext(s);const{frag:a,part:l,level:u}=o,{details:c}=u,{audio:h,text:d,id3:f,initSegment:p}=i;if(!this.fragContextChanged(a)&&c){if(this.state=zn.PARSING,this.switchingTrack&&h&&this.completeAudioSwitch(this.switchingTrack),null!=p&&p.tracks){const t=a.initSegment||a;this._bufferInitSegment(u,p.tracks,t,s),r.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:t,id:n,tracks:p.tracks})}if(h){const{startPTS:t,endPTS:e,startDTS:n,endDTS:r}=h;l&&(l.elementaryStreams[C.AUDIO]={startPTS:t,endPTS:e,startDTS:n,endDTS:r}),a.setElementaryStreamInfo(C.AUDIO,t,e,n,r),this.bufferFragmentData(h,a,l,s)}if(null!=f&&null!=(e=f.samples)&&e.length){const t=g({id:n,frag:a,details:c},f);r.trigger(b.FRAG_PARSING_METADATA,t)}if(d){const t=g({id:n,frag:a,details:c},d);r.trigger(b.FRAG_PARSING_USERDATA,t)}}else this.fragmentTracker.removeFragment(a)}_bufferInitSegment(t,e,n,r){if(this.state!==zn.PARSING)return;e.video&&delete e.video;const i=e.audio;if(!i)return;i.id="audio";const s=t.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${s}/${i.codec}]`),s&&1===s.split(",").length&&(i.levelCodec=s),this.hls.trigger(b.BUFFER_CODECS,e);const o=i.initSegment;if(null!=o&&o.byteLength){const t={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:o};this.hls.trigger(b.BUFFER_APPENDING,t)}this.tickImmediate()}loadFragment(t,e,n){const r=this.fragmentTracker.getState(t);var i;if(this.fragCurrent=t,this.switchingTrack||r===An.NOT_LOADED||r===An.PARTIAL)if("initSegment"===t.sn)this._loadInitSegment(t,e);else if(null!=(i=e.details)&&i.live&&!this.initPTS[t.cc]){this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state=zn.WAITING_INIT_PTS;const n=this.mainDetails;n&&n.fragments[0].start!==e.details.fragments[0].start&&Fn(e.details,n)}else this.startFragRequested=!0,super.loadFragment(t,e,n);else this.clearTrackerIfNeeded(t)}flushAudioIfNeeded(t){const{media:e,bufferedTrack:n}=this,r=null==n?void 0:n.attrs,i=t.attrs;e&&r&&(r.CHANNELS!==i.CHANNELS||n.name!==t.name||n.lang!==t.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(t){const{hls:e}=this;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(b.AUDIO_TRACK_SWITCHED,d({},t))}},audioTrackController:class extends hn{constructor(t){super(t,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.LEVEL_LOADING,this.onLevelLoading,this),t.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(b.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.LEVEL_LOADING,this.onLevelLoading,this),t.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(b.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:n,groupId:r,details:i}=e,s=this.tracksInGroup[n];if(!s||s.groupId!==r)return void this.warn(`Audio track with id:${n} and group:${r} not found in active group ${null==s?void 0:s.groupId}`);const o=s.details;s.details=e.details,this.log(`Audio track ${n} "${s.name}" lang:${s.lang} group:${r} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,e,o)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const n=e.audioGroups||null,r=this.groupIds;let i=this.currentTrack;if(!n||(null==r?void 0:r.length)!==(null==n?void 0:n.length)||null!=n&&n.some(t=>-1===(null==r?void 0:r.indexOf(t)))){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const t=this.tracks.filter(t=>!n||-1!==n.indexOf(t.groupId));if(t.length)this.selectDefaultTrack&&!t.some(t=>t.default)&&(this.selectDefaultTrack=!1),t.forEach((t,e)=>{t.id=e});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=t;const e=this.hls.config.audioPreference;if(!i&&e){const n=En(e,t,Sn);if(n>-1)i=t[n];else{const t=En(e,this.tracks);i=this.tracks[t]}}let r=this.findTrackId(i);-1===r&&i&&(r=this.findTrackId(null));const o={audioTracks:t};this.log(`Updating audio tracks, ${t.length} track(s) found in group(s): ${null==n?void 0:n.join(",")}`),this.hls.trigger(b.AUDIO_TRACKS_UPDATED,o);const a=this.trackId;if(-1!==r&&-1===a)this.setAudioTrack(r);else if(t.length&&-1===a){var s;const e=new Error(`No audio track selected for current audio group-ID(s): ${null==(s=this.groupIds)?void 0:s.join(",")} track count: ${t.length}`);this.warn(e.message),this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:e})}}else this.shouldReloadPlaylist(i)&&this.setAudioTrack(this.trackId)}onError(t,e){!e.fatal&&e.context&&(e.context.type!==Ee.AUDIO_TRACK||e.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(e.context.groupId)||(this.requestScheduled=-1,this.checkRetry(e)))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioOption(t){const e=this.hls;if(e.config.audioPreference=t,t){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&Tn(t,r,Sn))return r;const i=En(t,this.tracksInGroup,Sn);if(i>-1){const t=this.tracksInGroup[i];return this.setAudioTrack(i),t}if(r){let r=e.loadLevel;-1===r&&(r=e.firstAutoLevel);const i=function(t,e,n,r,i){const s=e[r],o=e.reduce((t,e,n)=>{const r=e.uri;return(t[r]||(t[r]=[])).push(n),t},{})[s.uri];o.length>1&&(r=Math.max.apply(Math,o));const a=s.videoRange,l=s.frameRate,u=s.codecSet.substring(0,4),c=_n(e,r,e=>{if(e.videoRange!==a||e.frameRate!==l||e.codecSet.substring(0,4)!==u)return!1;const r=e.audioGroups,s=n.filter(t=>!r||-1!==r.indexOf(t.groupId));return En(t,s,i)>-1});return c>-1?c:_n(e,r,e=>{const r=e.audioGroups,s=n.filter(t=>!r||-1!==r.indexOf(t.groupId));return En(t,s,i)>-1})}(t,e.levels,n,r,Sn);if(-1===i)return null;e.nextLoadLevel=i}if(t.channels||t.audioCodec){const e=En(t,n);if(e>-1)return n[e]}}}return null}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length)return void this.warn(`Invalid audio track id: ${t}`);this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,r=e[t],i=r.details&&!r.details.live;if(t===this.trackId&&r===n&&i)return;if(this.log(`Switching to audio-track ${t} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=t,this.currentTrack=r,this.hls.trigger(b.AUDIO_TRACK_SWITCHING,d({},r)),i)return;const s=this.switchParams(r.url,null==n?void 0:n.details,r.details);this.loadPlaylist(s)}findTrackId(t){const e=this.tracksInGroup;for(let n=0;n<e.length;n++){const r=e[n];if((!this.selectDefaultTrack||r.default)&&(!t||Tn(t,r,Sn)))return n}if(t){const{name:n,lang:r,assocLang:i,characteristics:s,audioCodec:o,channels:a}=t;for(let t=0;t<e.length;t++){if(Tn({name:n,lang:r,assocLang:i,characteristics:s,audioCodec:o,channels:a},e[t],Sn))return t}for(let n=0;n<e.length;n++){const r=e[n];if(ui(t.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<e.length;n++){const r=e[n];if(ui(t.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}loadPlaylist(t){const e=this.currentTrack;if(this.shouldLoadPlaylist(e)&&e){super.loadPlaylist();const n=e.id,r=e.groupId;let i=e.url;if(t)try{i=t.addDirectives(i)}catch(t){this.warn(`Could not construct new URL with HLS Delivery Directives: ${t}`)}this.log(`loading audio-track playlist ${n} "${e.name}" lang:${e.lang} group:${r}`),this.clearTimer(),this.hls.trigger(b.AUDIO_TRACK_LOADING,{url:i,id:n,groupId:r,deliveryDirectives:t||null})}}},emeController:ps,cmcdController:class{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=t=>{try{this.apply(t,{ot:ms.MANIFEST,su:!this.initialized})}catch(t){L.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=t=>{try{const e=t.frag,n=this.hls.levels[e.level],r=this.getObjectType(e),i={d:1e3*e.duration,ot:r};r!==ms.VIDEO&&r!==ms.AUDIO&&r!=ms.MUXED||(i.br=n.bitrate/1e3,i.tb=this.getTopBandwidth(r)/1e3,i.bl=this.getBufferLength(r)),this.apply(t,i)}catch(t){L.warn("Could not generate segment CMCD data.",t)}},this.hls=t;const e=this.config=t.config,{cmcd:n}=e;null!=n&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||function(){try{return crypto.randomUUID()}catch(t){try{const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}catch(t){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}}}(),this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const t=this.hls;t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHED,this.onMediaDetached,this),t.on(b.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHED,this.onMediaDetached,this),t.off(b.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var n,r;this.audioBuffer=null==(n=e.tracks.audio)?void 0:n.buffer,this.videoBuffer=null==(r=e.tracks.video)?void 0:r.buffer}createData(){var t;return{v:1,sf:vs.HLS,sid:this.sid,cid:this.cid,pr:null==(t=this.media)?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,e={}){g(e,this.createData());const n=e.ot===ms.INIT||e.ot===ms.VIDEO||e.ot===ms.MUXED;this.starved&&n&&(e.bs=!0,e.su=!0,this.starved=!1),null==e.su&&(e.su=this.buffering);const{includeKeys:r}=this;r&&(e=Object.keys(e).reduce((t,n)=>(r.includes(n)&&(t[n]=e[n]),t),{})),this.useHeaders?(t.headers||(t.headers={}),qs(t.headers,e)):t.url=Zs(t.url,e)}getObjectType(t){const{type:e}=t;return"subtitle"===e?ms.TIMED_TEXT:"initSegment"===t.sn?ms.INIT:"audio"===e?ms.AUDIO:"main"===e?this.hls.audioTracks.length?ms.VIDEO:ms.MUXED:void 0}getTopBandwidth(t){let e,n=0;const r=this.hls;if(t===ms.AUDIO)e=r.audioTracks;else{const t=r.maxAutoLevel,n=t>-1?t+1:r.levels.length;e=r.levels.slice(0,n)}for(const t of e)t.bitrate>n&&(n=t.bitrate);return n>0?n:NaN}getBufferLength(t){const e=this.hls.media,n=t===ms.AUDIO?this.audioBuffer:this.videoBuffer;return n&&e?1e3*xn.bufferInfo(n,e.currentTime,this.config.maxBufferHole).len:NaN}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,n=t||this.config.loader;return class{constructor(t){this.loader=void 0,this.loader=new n(t)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(t,n,r){e(t),this.loader.load(t,n,r)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,n=t||this.config.loader;return class{constructor(t){this.loader=void 0,this.loader=new n(t)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(t,n,r){e(t),this.loader.load(t,n,r)}}}},contentSteeringController:class{constructor(t){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=L.log.bind(L,"[content-steering]:"),this.registerListeners()}registerListeners(){const t=this.hls;t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;t&&(t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const t=1e3*this.timeToLoad-(performance.now()-this.updated);if(t>0)return void this.scheduleRefresh(this.uri,t)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(e=>e!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:n}=e;null!==n&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:n}=e;if((null==n?void 0:n.action)===un.SendAlternateToPenaltyBox&&n.flags===cn.MoveAllAlternatesMatchingHost){const t=this.levels;let r=this.pathwayPriority,i=this.pathwayId;if(e.context){const{groupId:n,pathwayId:r,type:s}=e.context;n&&t?i=this.getPathwayForGroupId(n,s,i):r&&(i=r)}i in this.penalizedPathways||(this.penalizedPathways[i]=performance.now()),!r&&t&&(r=t.reduce((t,e)=>(-1===t.indexOf(e.pathwayId)&&t.push(e.pathwayId),t),[])),r&&r.length>1&&(this.updatePathwayPriority(r),n.resolved=this.pathwayId!==i),n.resolved||L.warn(`Could not resolve ${e.details} ("${e.error.message}") with content-steering for Pathway: ${i} levels: ${t?t.length:t} priorities: ${JSON.stringify(r)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(0===e.length){const n=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),e=this.getLevelsForPathway(n),this.pathwayId=n}return e.length!==t.length&&this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e}getLevelsForPathway(t){return null===this.levels?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){let e;this.pathwayPriority=t;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(t=>{r-n[t]>Js&&delete n[t]});for(let r=0;r<t.length;r++){const i=t[r];if(i in n)continue;if(i===this.pathwayId)return;const s=this.hls.nextLoadLevel,o=this.hls.levels[s];if(e=this.getLevelsForPathway(i),e.length>0){this.log(`Setting Pathway to "${i}"`),this.pathwayId=i,Ze(e),this.hls.trigger(b.LEVELS_UPDATED,{levels:e});const t=this.hls.levels[s];o&&t&&this.levels&&(t.attrs["STABLE-VARIANT-ID"]!==o.attrs["STABLE-VARIANT-ID"]&&t.bitrate!==o.bitrate&&this.log(`Unstable Pathways change from bitrate ${o.bitrate} to ${t.bitrate}`),this.hls.nextLoadLevel=s);break}}}getPathwayForGroupId(t,e,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let n=0;n<r.length;n++)if(e===Ee.AUDIO_TRACK&&r[n].hasAudioGroup(t)||e===Ee.SUBTITLE_TRACK&&r[n].hasSubtitleGroup(t))return r[n].pathwayId;return n}clonePathways(t){const e=this.levels;if(!e)return;const n={},r={};t.forEach(t=>{const{ID:i,"BASE-ID":s,"URI-REPLACEMENT":o}=t;if(e.some(t=>t.pathwayId===i))return;const a=this.getLevelsForPathway(s).map(t=>{const e=new D(t.attrs);e["PATHWAY-ID"]=i;const s=e.AUDIO&&`${e.AUDIO}_clone_${i}`,a=e.SUBTITLES&&`${e.SUBTITLES}_clone_${i}`;s&&(n[e.AUDIO]=s,e.AUDIO=s),a&&(r[e.SUBTITLES]=a,e.SUBTITLES=a);const l=eo(t.uri,e["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",o),u=new Ke({attrs:e,audioCodec:t.audioCodec,bitrate:t.bitrate,height:t.height,name:t.name,url:l,videoCodec:t.videoCodec,width:t.width});if(t.audioGroups)for(let e=1;e<t.audioGroups.length;e++)u.addGroupId("audio",`${t.audioGroups[e]}_clone_${i}`);if(t.subtitleGroups)for(let e=1;e<t.subtitleGroups.length;e++)u.addGroupId("text",`${t.subtitleGroups[e]}_clone_${i}`);return u});e.push(...a),to(this.audioTracks,n,o,i),to(this.subtitleTracks,r,o,i)})}loadSteeringManifest(t){const e=this.hls.config,n=e.loader;let r;this.loader&&this.loader.destroy(),this.loader=new n(e);try{r=new self.URL(t)}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${t}`)}if("data:"!==r.protocol){const t=0|(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate);r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+t)}const i={responseType:"json",url:r.href},s=e.steeringManifestLoadPolicy.default,o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(t,e,n,i)=>{this.log(`Loaded steering manifest: "${r}"`);const s=t.data;if(1!==s.VERSION)return void this.log(`Steering VERSION ${s.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=s.TTL;const{"RELOAD-URI":o,"PATHWAY-CLONES":a,"PATHWAY-PRIORITY":l}=s;if(o)try{this.uri=new self.URL(o,r).href}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${o}`)}this.scheduleRefresh(this.uri||n.url),a&&this.clonePathways(a);const u={steeringManifest:s,url:r.toString()};this.hls.trigger(b.STEERING_MANIFEST_LOADED,u),l&&this.updatePathwayPriority(l)},onError:(t,e,n,r)=>{if(this.log(`Error loading steering manifest: ${t.code} ${t.text} (${e.url})`),this.stopLoad(),410===t.code)return this.enabled=!1,void this.log(`Steering manifest ${e.url} no longer available`);let i=1e3*this.timeToLoad;if(429!==t.code)this.scheduleRefresh(this.uri||e.url,i);else{const t=this.loader;if("function"==typeof(null==t?void 0:t.getResponseHeader)){const e=t.getResponseHeader("Retry-After");e&&(i=1e3*parseFloat(e))}this.log(`Steering manifest ${e.url} rate limited`)}},onTimeout:(t,e,n)=>{this.log(`Timeout loading steering manifest (${e.url})`),this.scheduleRefresh(this.uri||e.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(i,a,l)}scheduleRefresh(t,e=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var e;const n=null==(e=this.hls)?void 0:e.media;!n||n.ended?this.scheduleRefresh(t,1e3*this.timeToLoad):this.loadSteeringManifest(t)},e)}}});function co(t){return t&&"object"==typeof t?Array.isArray(t)?t.map(co):Object.keys(t).reduce((e,n)=>(e[n]=co(t[n]),e),{}):t}function ho(t){const e=t.loader;if(e!==so&&e!==ro)L.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1})()&&(t.loader=so,t.progressive=!0,t.enableSoftwareAES=!0,L.log("[config]: Progressive streaming enabled, using FetchLoader"))}}let fo;class po extends hn{constructor(t,e){super(t,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(b.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(b.FRAG_BUFFERED,this.onFragBuffered,this),t.on(b.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(b.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(b.FRAG_BUFFERED,this.onFragBuffered,this),t.off(b.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const n=this.hls.config.preferManagedMediaSource,r=[],i={},s={};let o=!1,a=!1,l=!1;e.levels.forEach(t=>{var e,u;const c=t.attrs;let{audioCodec:h,videoCodec:d}=t;-1!==(null==(e=h)?void 0:e.indexOf("mp4a.40.34"))&&(fo||(fo=/chrome|firefox/i.test(navigator.userAgent)),fo&&(t.audioCodec=h=void 0)),h&&(t.audioCodec=h=se(h,n)),0===(null==(u=d)?void 0:u.indexOf("avc1"))&&(d=t.videoCodec=function(t){const e=t.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");if(n.length>2){let r=n.shift()+".";r+=parseInt(n.shift()).toString(16),r+=("000"+parseInt(n.shift()).toString(16)).slice(-4),e[t]=r}}return e.join(",")}(d));const{width:f,height:p,unknownCodecs:g}=t;if(o||(o=!(!f||!p)),a||(a=!!d),l||(l=!!h),null!=g&&g.length||h&&!Zt(h,"audio",n)||d&&!Zt(d,"video",n))return;const{CODECS:m,"FRAME-RATE":v,"HDCP-LEVEL":y,"PATHWAY-ID":b,RESOLUTION:E,"VIDEO-RANGE":T}=c,S=`${`${b||"."}-`}${t.bitrate}-${E}-${v}-${m}-${T}-${y}`;if(i[S])if(i[S].uri===t.url||t.attrs["PATHWAY-ID"])i[S].addGroupId("audio",c.AUDIO),i[S].addGroupId("text",c.SUBTITLES);else{const e=s[S]+=1;t.attrs["PATHWAY-ID"]=new Array(e+1).join(".");const n=new Ke(t);i[S]=n,r.push(n)}else{const e=new Ke(t);i[S]=e,s[S]=1,r.push(e)}}),this.filterAndSortMediaOptions(r,e,o,a,l)}filterAndSortMediaOptions(t,e,n,r,i){let s=[],o=[],a=t;if((n||r)&&i&&(a=a.filter(({videoCodec:t,videoRange:e,width:n,height:r})=>(!!t||!(!n||!r))&&function(t){return!!t&&Be.indexOf(t)>-1}(e))),0===a.length)return void Promise.resolve().then(()=>{if(this.hls){e.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(e.levels[0].attrs)}`);const t=new Error("no level with compatible codecs found in manifest");this.hls.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:t,reason:t.message})}});if(e.audioTracks){const{preferManagedMediaSource:t}=this.hls.config;s=e.audioTracks.filter(e=>!e.audioCodec||Zt(e.audioCodec,"audio",t)),go(s)}e.subtitles&&(o=e.subtitles,go(o));const l=a.slice(0);a.sort((t,e)=>{if(t.attrs["HDCP-LEVEL"]!==e.attrs["HDCP-LEVEL"])return(t.attrs["HDCP-LEVEL"]||"")>(e.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&t.height!==e.height)return t.height-e.height;if(t.frameRate!==e.frameRate)return t.frameRate-e.frameRate;if(t.videoRange!==e.videoRange)return Be.indexOf(t.videoRange)-Be.indexOf(e.videoRange);if(t.videoCodec!==e.videoCodec){const n=ee(t.videoCodec),r=ee(e.videoCodec);if(n!==r)return r-n}if(t.uri===e.uri&&t.codecSet!==e.codecSet){const n=ne(t.codecSet),r=ne(e.codecSet);if(n!==r)return r-n}return t.averageBitrate!==e.averageBitrate?t.averageBitrate-e.averageBitrate:0});let u=l[0];if(this.steering&&(a=this.steering.filterParsedLevels(a),a.length!==l.length))for(let t=0;t<l.length;t++)if(l[t].pathwayId===a[0].pathwayId){u=l[t];break}this._levels=a;for(let t=0;t<a.length;t++)if(a[t]===u){var c;this._firstLevel=t;const e=u.bitrate,n=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${a.length} level(s) found, first bitrate: ${e}`),void 0===(null==(c=this.hls.userConfig)?void 0:c.abrEwmaDefaultEstimate)){const t=Math.min(e,this.hls.config.abrEwmaDefaultEstimateMax);t>n&&n===uo.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=t)}break}const h=i&&!r,d={levels:a,audioTracks:s,subtitleTracks:o,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:i,video:r,altAudio:!h&&s.some(t=>!!t.url)};this.hls.trigger(b.MANIFEST_PARSED,d),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return 0===this._levels.length?null:this._levels}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(0===e.length)return;if(t<0||t>=e.length){const n=new Error("invalid level idx"),r=t<0;if(this.hls.trigger(b.ERROR,{type:E.OTHER_ERROR,details:T.LEVEL_SWITCH_ERROR,level:t,fatal:r,error:n,reason:n.message}),r)return;t=Math.min(t,e.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,i=r?r.attrs["PATHWAY-ID"]:void 0,s=e[t],o=s.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=s,n===t&&s.details&&r&&i===o)return;this.log(`Switching to level ${t} (${s.height?s.height+"p ":""}${s.videoRange?s.videoRange+" ":""}${s.codecSet?s.codecSet+" ":""}@${s.bitrate})${o?" with Pathway "+o:""} from level ${n}${i?" with Pathway "+i:""}`);const a={level:t,attrs:s.attrs,details:s.details,bitrate:s.bitrate,averageBitrate:s.averageBitrate,maxBitrate:s.maxBitrate,realBitrate:s.realBitrate,width:s.width,height:s.height,codecSet:s.codecSet,audioCodec:s.audioCodec,videoCodec:s.videoCodec,audioGroups:s.audioGroups,subtitleGroups:s.subtitleGroups,loaded:s.loaded,loadError:s.loadError,fragmentError:s.fragmentError,name:s.name,id:s.id,uri:s.uri,url:s.url,urlId:0,audioGroupIds:s.audioGroupIds,textGroupIds:s.textGroupIds};this.hls.trigger(b.LEVEL_SWITCHING,a);const l=s.details;if(!l||l.live){const t=this.switchParams(s.uri,null==r?void 0:r.details,l);this.loadPlaylist(t)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(void 0===this._startLevel){const t=this.hls.config.startLevel;return void 0!==t?t:this.hls.firstAutoLevel}return this._startLevel}set startLevel(t){this._startLevel=t}onError(t,e){!e.fatal&&e.context&&e.context.type===Ee.LEVEL&&e.context.level===this.level&&this.checkRetry(e)}onFragBuffered(t,{frag:e}){if(void 0!==e&&e.type===Te.MAIN){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return;const n=this._levels[e.level];null!=n&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(t,e){var n;const{level:r,details:i}=e,s=this._levels[r];var o;if(!s)return this.warn(`Invalid level index ${r}`),void(null!=(o=e.deliveryDirectives)&&o.skip&&(i.deltaUpdateFailed=!0));r===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0),this.playlistLoaded(r,e,s.details)):null!=(n=e.deliveryDirectives)&&n.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(t){super.loadPlaylist();const e=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){let r=n.uri;if(t)try{r=t.addDirectives(r)}catch(t){this.warn(`Could not construct new URL with HLS Delivery Directives: ${t}`)}const i=n.attrs["PATHWAY-ID"];this.log(`Loading level index ${e}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""} with${i?" Pathway "+i:""} ${r}`),this.clearTimer(),this.hls.trigger(b.LEVEL_LOADING,{url:r,level:e,pathwayId:n.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}removeLevel(t){var e;const n=this._levels.filter((e,n)=>n!==t||(this.steering&&this.steering.removeLevel(e),e===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,e.details&&e.details.fragments.forEach(t=>t.level=-1)),!1));Ze(n),this._levels=n,this.currentLevelIndex>-1&&null!=(e=this.currentLevel)&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(b.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(t,{levels:e}){this._levels=e}checkMaxAutoUpdated(){const{autoLevelCapping:t,maxAutoLevel:e,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==e&&(this._maxAutoLevel=e,this.hls.trigger(b.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:e,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function go(t){const e={};t.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}class mo{constructor(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const n in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[n].loader;if(r){var e;if(t&&t!==(null==(e=r.context)?void 0:e.frag.type))return;r.abort()}}}detach(){for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(t,e=T.KEY_LOAD_ERROR,n,r,i){return new jn({type:E.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:i,error:n,networkDetails:r})}loadClear(t,e){if(this.emeController&&this.config.emeEnabled){const{sn:n,cc:r}=t;for(let t=0;t<e.length;t++){const i=e[t];if(r<=i.cc&&("initSegment"===n||"initSegment"===i.sn||n<i.sn)){this.emeController.selectKeySystemFormat(i).then(t=>{i.setKeyFormat(t)});break}}}}load(t){return!t.decryptdata&&t.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var n,r;e&&t.setKeyFormat(e);const i=t.decryptdata;if(!i){const n=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,T.KEY_LOAD_ERROR,n))}const s=i.uri;if(!s)return Promise.reject(this.createKeyLoadError(t,T.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${s}"`)));let o=this.keyUriToKeyInfo[s];if(null!=(n=o)&&n.decryptdata.key)return i.key=o.decryptdata.key,Promise.resolve({frag:t,keyInfo:o});var a;if(null!=(r=o)&&r.keyLoadPromise)switch(null==(a=o.mediaKeySessionContext)?void 0:a.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return o.keyLoadPromise.then(e=>(i.key=e.keyInfo.decryptdata.key,{frag:t,keyInfo:o}))}switch(o=this.keyUriToKeyInfo[s]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===i.keyFormat?this.loadKeyHTTP(o,t):this.loadKeyEME(o,t);case"AES-128":return this.loadKeyHTTP(o,t);default:return Promise.reject(this.createKeyLoadError(t,T.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(t,e){const n={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){const e=this.emeController.loadKey(n);if(e)return(t.keyLoadPromise=e.then(e=>(t.mediaKeySessionContext=e,n))).catch(e=>{throw t.keyLoadPromise=null,e})}return Promise.resolve(n)}loadKeyHTTP(t,e){const n=this.config,r=new(0,n.loader)(n);return e.keyLoader=t.loader=r,t.keyLoadPromise=new Promise((i,s)=>{const o={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},a=n.keyLoadPolicy.default,l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(t,e,n,r)=>{const{frag:o,keyInfo:a,url:l}=n;if(!o.decryptdata||a!==this.keyUriToKeyInfo[l])return s(this.createKeyLoadError(o,T.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));a.decryptdata.key=o.decryptdata.key=new Uint8Array(t.data),o.keyLoader=null,a.loader=null,i({frag:o,keyInfo:a})},onError:(t,n,r,i)=>{this.resetLoader(n),s(this.createKeyLoadError(e,T.KEY_LOAD_ERROR,new Error(`HTTP Error ${t.code} loading key ${t.text}`),r,d({url:o.url,data:void 0},t)))},onTimeout:(t,n,r)=>{this.resetLoader(n),s(this.createKeyLoadError(e,T.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:(t,n,r)=>{this.resetLoader(n),s(this.createKeyLoadError(e,T.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};r.load(o,l,u)})}resetLoader(t){const{frag:e,keyInfo:n,url:r}=t,i=n.loader;e.keyLoader===i&&(e.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[r],i&&i.destroy()}}function vo(){return self.SourceBuffer||self.WebKitSourceBuffer}function yo(){if(!Xt())return!1;const t=vo();return!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove}const bo=250,Eo=2,To=.1,So=.05;class _o{constructor(t,e,n,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=n,this.hls=r}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(t,e){const{config:n,media:r,stalled:i}=this;if(null===r)return;const{currentTime:s,seeking:o}=r,a=this.seeking&&!o,l=!this.seeking&&o;if(this.seeking=o,s!==t){if(this.moved=!0,o||(this.nudgeRetry=0),null!==i){if(this.stallReported){const t=self.performance.now()-i;L.warn(`playback not stuck anymore @${s}, after ${Math.round(t)}ms`),this.stallReported=!1}this.stalled=null}return}if(l||a)return void(this.stalled=null);if(r.paused&&!o||r.ended||0===r.playbackRate||!xn.getBuffered(r).length)return void(this.nudgeRetry=0);const u=xn.bufferInfo(r,s,0),c=u.nextStart||0;if(o){const t=u.len>Eo,n=!c||e&&e.start<=s||c-s>Eo&&!this.fragmentTracker.getPartialFragment(s);if(t||n)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var h;if(!(u.len>0)&&!c)return;const t=Math.max(c,u.start||0)-s,e=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,n=(null==e?void 0:null==(h=e.details)?void 0:h.live)?2*e.details.targetduration:Eo,i=this.fragmentTracker.getPartialFragment(s);if(t>0&&(t<=n||i))return void(r.paused||this._trySkipBufferHole(i))}const d=self.performance.now();if(null===i)return void(this.stalled=d);const f=d-i;if(!o&&f>=bo&&(this._reportStall(u),!this.media))return;const p=xn.bufferInfo(r,s,n.maxBufferHole);this._tryFixBufferStall(p,f)}_tryFixBufferStall(t,e){const{config:n,fragmentTracker:r,media:i}=this;if(null===i)return;const s=i.currentTime,o=r.getPartialFragment(s);if(o){if(this._trySkipBufferHole(o)||!this.media)return}(t.len>n.maxBufferHole||t.nextStart&&t.nextStart-s<n.maxBufferHole)&&e>1e3*n.highBufferWatchdogPeriod&&(L.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(t){const{hls:e,media:n,stallReported:r}=this;if(!r&&n){this.stallReported=!0;const r=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${JSON.stringify(t)})`);L.warn(r.message),e.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:t.len})}}_trySkipBufferHole(t){const{config:e,hls:n,media:r}=this;if(null===r)return 0;const i=r.currentTime,s=xn.bufferInfo(r,i,0),o=i<s.start?s.start:s.nextStart;if(o){const a=s.len<=e.maxBufferHole,l=s.len>0&&s.len<1&&r.readyState<3,u=o-i;if(u>0&&(a||l)){if(u>e.maxBufferHole){const{fragmentTracker:e}=this;let n=!1;if(0===i){const t=e.getAppendedFrag(0,Te.MAIN);t&&o<t.end&&(n=!0)}if(!n){const n=t||e.getAppendedFrag(i,Te.MAIN);if(n){let t=!1,r=n.end;for(;r<o;){const n=e.getPartialFragment(r);if(!n){t=!0;break}r+=n.duration}if(t)return 0}}}const s=Math.max(o+So,i+To);if(L.warn(`skipping hole, adjusting currentTime from ${i} to ${s}`),this.moved=!0,this.stalled=null,r.currentTime=s,t&&!t.gap){const e=new Error(`fragment loaded with buffer holes, seeking from ${i} to ${s}`);n.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:e,reason:e.message,frag:t})}return s}}return 0}_tryNudgeBuffer(){const{config:t,hls:e,media:n,nudgeRetry:r}=this;if(null===n)return;const i=n.currentTime;if(this.nudgeRetry++,r<t.nudgeMaxRetry){const s=i+(r+1)*t.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${i} to ${s}`);L.warn(o.message),n.currentTime=s,e.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{const n=new Error(`Playhead still not moving while enough data buffered @${i} after ${t.nudgeMaxRetry} nudges`);L.error(n.message),e.trigger(b.ERROR,{type:E.MEDIA_ERROR,details:T.BUFFER_STALLED_ERROR,error:n,fatal:!0})}}}const wo=100;class Ao extends qn{constructor(t,e,n){super(t,e,n,"[stream-controller]",Te.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(b.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.LEVEL_LOADING,this.onLevelLoading,this),t.on(b.LEVEL_LOADED,this.onLevelLoaded,this),t.on(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(b.ERROR,this.onError,this),t.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(b.BUFFER_CREATED,this.onBufferCreated,this),t.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:t}=this;t.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(b.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.LEVEL_LOADED,this.onLevelLoaded,this),t.off(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(b.ERROR,this.onError,this),t.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(b.BUFFER_CREATED,this.onBufferCreated,this),t.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(t){if(this.levels){const{lastCurrentTime:e,hls:n}=this;if(this.stopLoad(),this.setInterval(wo),this.level=-1,!this.startFragRequested){let t=n.startLevel;-1===t&&(n.config.testBandwidth&&this.levels.length>1?(t=0,this.bitrateTest=!0):t=n.firstAutoLevel),n.nextLoadLevel=t,this.level=n.loadLevel,this.loadedmetadata=!1}e>0&&-1===t&&(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),t=e),this.state=zn.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=zn.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case zn.WAITING_LEVEL:{const{levels:t,level:e}=this,n=null==t?void 0:t[e],r=null==n?void 0:n.details;if(r&&(!r.live||this.levelLastLoaded===n)){if(this.waitForCdnTuneIn(r))break;this.state=zn.IDLE;break}if(this.hls.nextLoadLevel!==this.level){this.state=zn.IDLE;break}break}case zn.FRAG_LOADING_WAITING_RETRY:{var t;const e=self.performance.now(),n=this.retryDate;if(!n||e>=n||null!=(t=this.media)&&t.seeking){const{levels:t,level:e}=this,n=null==t?void 0:t[e];this.resetStartWhenNotLoaded(n||null),this.state=zn.IDLE}}}this.state===zn.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:n,media:r}=this;if(null===e||!r&&(this.startFragRequested||!t.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const i=t.nextLoadLevel;if(null==n||!n[i])return;const s=n[i],o=this.getMainFwdBufferInfo();if(null===o)return;const a=this.getLevelDetails();if(a&&this._streamEnded(o,a)){const t={};return this.altAudio&&(t.type="video"),this.hls.trigger(b.BUFFER_EOS,t),void(this.state=zn.ENDED)}t.loadLevel!==i&&-1===t.manualLevel&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=t.nextLoadLevel=i;const l=s.details;if(!l||this.state===zn.WAITING_LEVEL||l.live&&this.levelLastLoaded!==s)return this.level=i,void(this.state=zn.WAITING_LEVEL);const u=o.len,c=this.getMaxBufferLength(s.maxBitrate);if(u>=c)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const h=this.backtrackFragment?this.backtrackFragment.start:o.end;let d=this.getNextFragment(h,l);if(this.couldBacktrack&&!this.fragPrevious&&d&&"initSegment"!==d.sn&&this.fragmentTracker.getState(d)!==An.OK){var f;const t=(null!=(f=this.backtrackFragment)?f:d).sn-l.startSN,e=l.fragments[t-1];e&&d.cc===e.cc&&(d=e,this.fragmentTracker.removeFragment(e))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(d&&this.isLoopLoading(d,h)){if(!d.gap){const t=this.audioOnly&&!this.altAudio?C.AUDIO:C.VIDEO,e=(t===C.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;e&&this.afterBufferFlushed(e,t,Te.MAIN)}d=this.getNextFragmentLoopLoading(d,l,o,Te.MAIN,c)}d&&(!d.initSegment||d.initSegment.data||this.bitrateTest||(d=d.initSegment),this.loadFragment(d,s,h))}loadFragment(t,e,n){const r=this.fragmentTracker.getState(t);this.fragCurrent=t,r===An.NOT_LOADED||r===An.PARTIAL?"initSegment"===t.sn?this._loadInitSegment(t,e):this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):(this.startFragRequested=!0,super.loadFragment(t,e,n)):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,Te.MAIN)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(null!=e&&e.readyState){let n;const r=this.getAppendedFrag(e.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const i=this.getLevelDetails();if(null!=i&&i.live){const t=this.getMainFwdBufferInfo();if(!t||t.len<2*i.targetduration)return}if(!e.paused&&t){const e=t[this.hls.nextLoadLevel],r=this.fragLastKbps;n=r&&this.fragCurrent?this.fragCurrent.duration*e.maxBitrate/(1e3*r)+1:0}else n=0;const s=this.getBufferedFrag(e.currentTime+n);if(s){const t=this.followingBufferedFrag(s);if(t){this.abortCurrentFrag();const e=t.maxStartPTS?t.maxStartPTS:t.start,n=t.duration,r=Math.max(s.end,e+Math.min(Math.max(n-this.config.maxFragLookUpTolerance,n*(this.couldBacktrack?.5:.125)),n*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(r,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case zn.KEY_LOADING:case zn.FRAG_LOADING:case zn.FRAG_LOADING_WAITING_RETRY:case zn.PARSING:case zn.PARSED:this.state=zn.IDLE}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,this.altAudio?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const n=e.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new _o(this.config,n,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:t}=this;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const t=this.media,e=t?t.currentTime:null;m(e)&&this.log(`Media seeked to ${e.toFixed(3)}`);const n=this.getMainFwdBufferInfo();null!==n&&0!==n.len?this.tick():this.warn(`Main forward buffer length on "seeked" event ${n?n.len:"empty"})`)}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(t,e){let n=!1,r=!1;e.levels.forEach(t=>{const e=t.audioCodec;e&&(n=n||-1!==e.indexOf("mp4a.40.2"),r=r||-1!==e.indexOf("mp4a.40.5"))}),this.audioCodecSwitch=n&&r&&!function(){var t;const e=vo();return"function"==typeof(null==e?void 0:null==(t=e.prototype)?void 0:t.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:n}=this;if(!n||this.state!==zn.IDLE)return;const r=n[e.level];(!r.details||r.details.live&&this.levelLastLoaded!==r||this.waitForCdnTuneIn(r.details))&&(this.state=zn.WAITING_LEVEL)}onLevelLoaded(t,e){var n;const{levels:r}=this,i=e.level,s=e.details,o=s.totalduration;if(!r)return void this.warn(`Levels were reset while loading level ${i}`);this.log(`Level ${i} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""}, cc [${s.startCC}, ${s.endCC}] duration:${o}`);const a=r[i],l=this.fragCurrent;!l||this.state!==zn.FRAG_LOADING&&this.state!==zn.FRAG_LOADING_WAITING_RETRY||l.level!==e.level&&l.loader&&this.abortCurrentFrag();let u=0;if(s.live||null!=(n=a.details)&&n.live){var c;if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;u=this.alignPlaylists(s,a.details,null==(c=this.levelLastLoaded)?void 0:c.details)}if(a.details=s,this.levelLastLoaded=a,this.hls.trigger(b.LEVEL_UPDATED,{details:s,level:i}),this.state===zn.WAITING_LEVEL){if(this.waitForCdnTuneIn(s))return;this.state=zn.IDLE}this.startFragRequested?s.live&&this.synchronizeToLiveEdge(s):this.setStartPosition(s,u),this.tick()}_handleFragmentLoadProgress(t){var e;const{frag:n,part:r,payload:i}=t,{levels:s}=this;if(!s)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);const o=s[n.level],a=o.details;if(!a)return this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),void this.fragmentTracker.removeFragment(n);const l=o.videoCodec,u=a.PTSKnown||!a.live,c=null==(e=n.initSegment)?void 0:e.data,h=this._getAudioCodec(o),d=this.transmuxer=this.transmuxer||new ai(this.hls,Te.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=r?r.index:-1,p=-1!==f,g=new kn(n.level,n.sn,n.stats.chunkCount,i.byteLength,f,p),m=this.initPTS[n.cc];d.push(i,c,h,l,n,r,a.totalduration,u,g,m)}onAudioTrackSwitching(t,e){const n=this.altAudio;if(!!!e.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const t=this.fragCurrent;t&&(this.log("Switching to main audio track, cancel main fragment load"),t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const t=this.hls;n&&(t.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),t.trigger(b.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const n=e.id,r=!!this.hls.audioTracks[n].url;if(r){const t=this.videoBuffer;t&&this.mediaBuffer!==t&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=t)}this.altAudio=r,this.tick()}onBufferCreated(t,e){const n=e.tracks;let r,i,s=!1;for(const t in n){const e=n[t];if("main"===e.id){if(i=t,r=e,"video"===t){const e=n[t];e&&(this.videoBuffer=e.buffer)}}else s=!0}s&&r?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:n,part:r}=e;if(n&&n.type!==Te.MAIN)return;if(this.fragContextChanged(n))return this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===zn.PARSED&&(this.state=zn.IDLE));const i=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*i.total/(i.buffering.end-i.loading.first)),"initSegment"!==n.sn&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}onError(t,e){var n;if(e.fatal)this.state=zn.ERROR;else switch(e.details){case T.FRAG_GAP:case T.FRAG_PARSING_ERROR:case T.FRAG_DECRYPT_ERROR:case T.FRAG_LOAD_ERROR:case T.FRAG_LOAD_TIMEOUT:case T.KEY_LOAD_ERROR:case T.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Te.MAIN,e);break;case T.LEVEL_LOAD_ERROR:case T.LEVEL_LOAD_TIMEOUT:case T.LEVEL_PARSING_ERROR:e.levelRetry||this.state!==zn.WAITING_LEVEL||(null==(n=e.context)?void 0:n.type)!==Ee.LEVEL||(this.state=zn.IDLE);break;case T.BUFFER_APPEND_ERROR:case T.BUFFER_FULL_ERROR:if(!e.parent||"main"!==e.parent)return;if(e.details===T.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(e)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case T.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}}checkBuffer(){const{media:t,gapController:e}=this;if(t&&e&&t.readyState){if(this.loadedmetadata||!xn.getBuffered(t).length){const t=this.state!==zn.IDLE?this.fragCurrent:null;e.poll(this.lastCurrentTime,t)}this.lastCurrentTime=t.currentTime}}onFragLoadEmergencyAborted(){this.state=zn.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(t,{type:e}){if(e!==C.AUDIO||this.audioOnly&&!this.altAudio){const t=(e===C.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(t,e,Te.MAIN),this.tick()}}onLevelsUpdated(t,e){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let n=this.startPosition;if(n>=0&&e<n){if(t.seeking)return void this.log(`could not seek to ${n}, already seeking at ${e}`);const r=xn.getBuffered(t),i=(r.length?r.start(0):0)-n;i>0&&(i<this.config.maxBufferHole||i<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${i} to match buffer start`),n+=i,this.startPosition=n),this.log(`seek to target start position ${n} from current time ${e}`),t.currentTime=n}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(n=>{const{hls:r}=this;if(!n||this.fragContextChanged(t))return;e.fragmentError=0,this.state=zn.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const i=t.stats;i.parsing.start=i.parsing.end=i.buffering.start=i.buffering.end=self.performance.now(),r.trigger(b.FRAG_LOADED,n),t.bitrateTest=!1})}_handleTransmuxComplete(t){var e;const n="main",{hls:r}=this,{remuxResult:i,chunkMeta:s}=t,o=this.getCurrentContext(s);if(!o)return void this.resetWhenMissingContext(s);const{frag:a,part:l,level:u}=o,{video:c,text:h,id3:d,initSegment:f}=i,{details:p}=u,g=this.altAudio?void 0:i.audio;if(this.fragContextChanged(a))this.fragmentTracker.removeFragment(a);else{if(this.state=zn.PARSING,f){if(null!=f&&f.tracks){const t=a.initSegment||a;this._bufferInitSegment(u,f.tracks,t,s),r.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:t,id:n,tracks:f.tracks})}const t=f.initPTS,e=f.timescale;m(t)&&(this.initPTS[a.cc]={baseTime:t,timescale:e},r.trigger(b.INIT_PTS_FOUND,{frag:a,id:n,initPTS:t,timescale:e}))}if(c&&p&&"initSegment"!==a.sn){const t=p.fragments[a.sn-1-p.startSN],e=a.sn===p.startSN,n=!t||a.cc>t.cc;if(!1!==i.independent){const{startPTS:t,endPTS:r,startDTS:i,endDTS:o}=c;if(l)l.elementaryStreams[c.type]={startPTS:t,endPTS:r,startDTS:i,endDTS:o};else if(c.firstKeyFrame&&c.independent&&1===s.id&&!n&&(this.couldBacktrack=!0),c.dropped&&c.independent){const i=this.getMainFwdBufferInfo(),s=(i?i.end:this.getLoadPosition())+this.config.maxBufferHole,l=c.firstKeyFramePTS?c.firstKeyFramePTS:t;if(!e&&s<l-this.config.maxBufferHole&&!n)return void this.backtrack(a);n&&(a.gap=!0),a.setElementaryStreamInfo(c.type,a.start,r,a.start,o,!0)}else e&&t>Eo&&(a.gap=!0);a.setElementaryStreamInfo(c.type,t,r,i,o),this.backtrackFragment&&(this.backtrackFragment=a),this.bufferFragmentData(c,a,l,s,e||n)}else{if(!e&&!n)return void this.backtrack(a);a.gap=!0}}if(g){const{startPTS:t,endPTS:e,startDTS:n,endDTS:r}=g;l&&(l.elementaryStreams[C.AUDIO]={startPTS:t,endPTS:e,startDTS:n,endDTS:r}),a.setElementaryStreamInfo(C.AUDIO,t,e,n,r),this.bufferFragmentData(g,a,l,s)}if(p&&null!=d&&null!=(e=d.samples)&&e.length){const t={id:n,frag:a,details:p,samples:d.samples};r.trigger(b.FRAG_PARSING_METADATA,t)}if(p&&h){const t={id:n,frag:a,details:p,samples:h.samples};r.trigger(b.FRAG_PARSING_USERDATA,t)}}}_bufferInitSegment(t,e,n,r){if(this.state!==zn.PARSING)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;const{audio:i,video:s,audiovideo:o}=e;if(i){let e=t.audioCodec;const n=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){e&&(e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const t=i.metadata;t&&"channelCount"in t&&1!==(t.channelCount||1)&&-1===n.indexOf("firefox")&&(e="mp4a.40.5")}e&&-1!==e.indexOf("mp4a.40.5")&&-1!==n.indexOf("android")&&"audio/mpeg"!==i.container&&(e="mp4a.40.2",this.log(`Android: force audio codec to ${e}`)),t.audioCodec&&t.audioCodec!==e&&this.log(`Swapping manifest audio codec "${t.audioCodec}" for "${e}"`),i.levelCodec=e,i.id="main",this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${e||""}/${t.audioCodec||""}/${i.codec}]`)}s&&(s.levelCodec=t.videoCodec,s.id="main",this.log(`Init video buffer, container:${s.container}, codecs[level/parsed]=[${t.videoCodec||""}/${s.codec}]`)),o&&this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${t.codecs}/${o.codec}]`),this.hls.trigger(b.BUFFER_CODECS,e),Object.keys(e).forEach(t=>{const i=e[t].initSegment;null!=i&&i.byteLength&&this.hls.trigger(b.BUFFER_APPENDING,{type:t,data:i,frag:n,part:null,chunkMeta:r,parent:n.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Te.MAIN)}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=zn.IDLE}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&!1===t.seeking){const n=t.currentTime;if(xn.isBuffered(t,n)?e=this.getAppendedFrag(n):xn.isBuffered(t,n+.1)&&(e=this.getAppendedFrag(n+.1)),e){this.backtrackFragment=null;const t=this.fragPlaying,n=e.level;t&&e.sn===t.sn&&t.level===n||(this.fragPlaying=e,this.hls.trigger(b.FRAG_CHANGED,{frag:e}),t&&t.level===n||this.hls.trigger(b.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){const t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}get currentProgramDateTime(){const t=this.media;if(t){const e=t.currentTime,n=this.currentFrag;if(n&&m(e)&&m(n.programDateTime)){const t=n.programDateTime+1e3*(e-n.start);return new Date(t)}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class Lo{static get version(){return"1.5.17"}static isMSESupported(){return yo()}static isSupported(){return function(){if(!yo())return!1;const t=Xt();return"function"==typeof(null==t?void 0:t.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>t.isTypeSupported(te(e,"video")))||["mp4a.40.2","fLaC"].some(e=>t.isTypeSupported(te(e,"audio"))))}()}static getMediaSource(){return Xt()}static get Events(){return b}static get ErrorTypes(){return E}static get ErrorDetails(){return T}static get DefaultConfig(){return Lo.defaultConfig?Lo.defaultConfig:uo}static set DefaultConfig(t){Lo.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new oi,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,function(t,e){if("object"==typeof console&&!0===t||"object"==typeof t){A(t,"debug","log","info","warn","error");try{w.log(`Debug logs enabled for "${e}" in hls.js version 1.5.17`)}catch(t){w=_}}else w=_}(t.debug||!1,"Hls instance");const e=this.config=function(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=co(t),r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(t=>{const i=`${"level"===t?"playlist":t}LoadPolicy`,s=void 0===e[i],o=[];r.forEach(r=>{const a=`${t}Loading${r}`,l=e[a];if(void 0!==l&&s){o.push(a);const t=n[i].default;switch(e[i]={default:t},r){case"TimeOut":t.maxLoadTimeMs=l,t.maxTimeToFirstByteMs=l;break;case"MaxRetry":t.errorRetry.maxNumRetry=l,t.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":t.errorRetry.retryDelayMs=l,t.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":t.errorRetry.maxRetryDelayMs=l,t.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&L.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${i}": ${JSON.stringify(e[i])}`)}),d(d({},n),e)}(Lo.DefaultConfig,t);this.userConfig=t,e.progressive&&ho(e);const{abrController:n,bufferController:r,capLevelController:i,errorController:s,fpsController:o}=e,a=new s(this),l=this.abrController=new n(this),u=this.bufferController=new r(this),c=this.capLevelController=new i(this),h=new o(this),f=new we(this),p=new Fe(this),g=e.contentSteeringController,m=g?new g(this):null,v=this.levelController=new po(this,m),y=new Ln(this),E=new mo(this.config),T=this.streamController=new Ao(this,y,E);c.setStreamController(T),h.setStreamController(T);const S=[f,v,T];m&&S.splice(1,0,m),this.networkControllers=S;const R=[l,u,c,h,p,y];this.audioTrackController=this.createController(e.audioTrackController,S);const I=e.audioStreamController;I&&S.push(new I(this,y,E)),this.subtitleTrackController=this.createController(e.subtitleTrackController,S);const D=e.subtitleStreamController;D&&S.push(new D(this,y,E)),this.createController(e.timelineController,R),E.emeController=this.emeController=this.createController(e.emeController,R),this.cmcdController=this.createController(e.cmcdController,R),this.latencyController=this.createController(Ne,R),this.coreComponents=R,S.push(a);const x=a.onErrorOut;"function"==typeof x&&this.on(b.ERROR,x,a)}createController(t,e){if(t){const n=new t(this);return e&&e.push(n),n}return null}on(t,e,n=this){this._emitter.on(t,e,n)}once(t,e,n=this){this._emitter.once(t,e,n)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,n=this,r){this._emitter.off(t,e,n,r)}listeners(t){return this._emitter.listeners(t)}emit(t,e,n){return this._emitter.emit(t,e,n)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(e){if(L.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),!this.triggeringException){this.triggeringException=!0;const n=t===b.ERROR;this.trigger(b.ERROR,{type:E.OTHER_ERROR,details:T.INTERNAL_EXCEPTION,fatal:n,event:t,error:e}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){L.log("destroy"),this.trigger(b.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){L.log("attachMedia"),this._media=t,this.trigger(b.MEDIA_ATTACHING,{media:t})}detachMedia(){L.log("detachMedia"),this.trigger(b.MEDIA_DETACHING,void 0),this._media=null}loadSource(t){this.stopLoad();const e=this.media,n=this.url,r=this.url=c.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,L.log(`loadSource:${r}`),e&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(b.MANIFEST_LOADING,{url:t})}startLoad(t=-1){L.log(`startLoad(${t})`),this.started=!0,this.networkControllers.forEach(e=>{e.startLoad(t)})}stopLoad(){L.log("stopLoad"),this.started=!1,this.networkControllers.forEach(t=>{t.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(t=>{"fragmentLoader"in t&&t.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(t=>{"fragmentLoader"in t&&t.stopLoad()})}swapAudioCodec(){L.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){L.log("recoverMediaError");const t=this._media;this.detachMedia(),t&&this.attachMedia(t)}removeLevel(t){this.levelController.removeLevel(t)}get levels(){const t=this.levelController.levels;return t||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){L.log(`set currentLevel:${t}`),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){L.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){L.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){L.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){const t=this.levelController.startLevel;return-1===t&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){L.log(`set startLevel:${t}`),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(L.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){(function(t){return Ue.indexOf(t)>-1})(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const n=t.length;for(let r=0;r<n;r++)if(t[r].maxBitrate>=e)return r;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:n}=this;let r;if(r=-1===e&&null!=t&&t.length?t.length-1:e,n)for(let e=r;e--;){const r=t[e].attrs["HDCP-LEVEL"];if(r&&r<=n)return e}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(t){var e;return null==(e=this.audioTrackController)?void 0:e.setAudioOption(t)}setSubtitleOption(t){var e;return null==(e=this.subtitleTrackController)||e.setSubtitleOption(t),null}get allAudioTracks(){const t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get allSubtitleTracks(){const t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return!!t&&t.subtitleDisplay}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Lo.defaultConfig=void 0},LXdD:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=t=>({acceleration:e,position:n,velocity:r},i)=>{const s=t(n,r,e,i);if(0===s.length)return null;if(1===s.length)return s[0]>0?s[0]:null;if(2===s.length){if(s[1]<0)return null;if(s[0]>0)return s[0];if(s[1]>0)return s[1]}return null}},MWAu:function(t,e,n){var r=n("6OdY"),i=n("1mK8"),s=n("R4Kb");t.exports=function(t){return function(e,n,o){var a=Object(e);if(!i(e)){var l=r(n,3);e=s(e),n=function(t){return l(a[t],t,a)}}var u=t(e,n,o);return u>-1?a[l?e[u]:u]:void 0}}},Oaut:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=t=>(e,n,r)=>{const i=t(e,n,r);return null===i||i===Number.POSITIVE_INFINITY?null:i}},Q14B:function(t,e,n){},Q37M:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n("dOFO"),i=n("qTF4"),s=n("42jw");function o(t){return Object(r.a)(t)||Object(i.a)(t)||Object(s.a)()}},Qihb:function(t,e,n){var r=n("lGiI").runInContext();t.exports=n("y3DY")(r,r)},"RyO+":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=(t,e)=>{const{acceleration:n,position:r,timestamp:i,velocity:s}=t;return{acceleration:n,position:r+s*e+.5*n*e**2,timestamp:i+e,velocity:s+n*e}}},SmkT:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=()=>{try{return new DOMException("","IllegalValueError")}catch(t){return t.name="IllegalValueError",t}}},TD5G:function(t,e,n){var r=n("4shy"),i=n("2iYa"),s=n("P1Mu");t.exports=function(t){return t&&t.length?r(t,s,i):void 0}},Tei2:function(t,e,n){},Tt6i:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n("Q5Ww");function i(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Object(r.a)(t)););return t}},ULeP:function(t,e,n){},UcAE:function(t,e,n){},VrfG:function(t,e,n){},W3E0:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=t=>()=>{if(null===t)throw new Error("A native EventTarget could not be created.");return t.document.createElement("p")}},WORc:function(t,e,n){},XNSo:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=t=>(e,n,r)=>{const i=t(e,n),s=t(e,r);return null!==i&&null!==s?i<s?i:s:null!==i?i:null!==s?s:null}},XOUN:function(t,e,n){},Xqcm:function(t,e,n){},YwOg:function(t,e,n){t.exports=n("s2lO")()},Z6su:function(t,e,n){},b6Ed:function(t,e,n){},bYTA:function(t,e,n){"use strict";var r=new Blob([new Uint8Array([255,227,24,196,0,0,0,3,72,1,64,0,0,4,132,16,31,227,192,225,76,255,67,12,255,221,27,255,228,97,73,63,255,195,131,69,192,232,223,255,255,207,102,239,255,255,255,101,158,206,70,20,59,255,254,95,70,149,66,4,16,128,0,2,2,32,240,138,255,36,106,183,255,227,24,196,59,11,34,62,80,49,135,40,0,253,29,191,209,200,141,71,7,255,252,152,74,15,130,33,185,6,63,255,252,195,70,203,86,53,15,255,255,247,103,76,121,64,32,47,255,34,227,194,209,138,76,65,77,69,51,46,57,55,170,170,170,170,170,170,170,170,170,170,255,227,24,196,73,13,153,210,100,81,135,56,0,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170])],{type:"audio/mpeg"}),i=new Blob([new Uint8Array([0,0,0,28,102,116,121,112,105,115,111,109,0,0,2,0,105,115,111,109,105,115,111,50,109,112,52,49,0,0,0,8,102,114,101,101,0,0,2,239,109,100,97,116,33,16,5,32,164,27,255,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,55,167,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,33,16,5,32,164,27,255,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,55,167,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,112,0,0,2,194,109,111,111,118,0,0,0,108,109,118,104,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,232,0,0,0,47,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,1,236,116,114,97,107,0,0,0,92,116,107,104,100,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,47,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,101,100,116,115,0,0,0,28,101,108,115,116,0,0,0,0,0,0,0,1,0,0,0,47,0,0,0,0,0,1,0,0,0,0,1,100,109,100,105,97,0,0,0,32,109,100,104,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,172,68,0,0,8,0,85,196,0,0,0,0,0,45,104,100,108,114,0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0,0,0,1,15,109,105,110,102,0,0,0,16,115,109,104,100,0,0,0,0,0,0,0,0,0,0,0,36,100,105,110,102,0,0,0,28,100,114,101,102,0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1,0,0,0,211,115,116,98,108,0,0,0,103,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,87,109,112,52,97,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,172,68,0,0,0,0,0,51,101,115,100,115,0,0,0,0,3,128,128,128,34,0,2,0,4,128,128,128,20,64,21,0,0,0,0,1,244,0,0,1,243,249,5,128,128,128,2,18,16,6,128,128,128,1,2,0,0,0,24,115,116,116,115,0,0,0,0,0,0,0,1,0,0,0,2,0,0,4,0,0,0,0,28,115,116,115,99,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,1,0,0,0,28,115,116,115,122,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,115,0,0,1,116,0,0,0,20,115,116,99,111,0,0,0,0,0,0,0,1,0,0,0,44,0,0,0,98,117,100,116,97,0,0,0,90,109,101,116,97,0,0,0,0,0,0,0,33,104,100,108,114,0,0,0,0,0,0,0,0,109,100,105,114,97,112,112,108,0,0,0,0,0,0,0,0,0,0,0,0,45,105,108,115,116,0,0,0,37,169,116,111,111,0,0,0,29,100,97,116,97,0,0,0,1,0,0,0,0,76,97,118,102,53,54,46,52,48,46,49,48,49])],{type:"video/mp4"});function s(t){return Object.assign({muted:!1,timeout:250,inline:!1},t)}function o(t,e){var n=t.muted,r=t.timeout,i=t.inline,s=e(),o=s.element,a=s.source,l=void 0,u=void 0,c=void 0;return o.muted=n,!0===n&&o.setAttribute("muted","muted"),!0===i&&o.setAttribute("playsinline","playsinline"),o.src=a,new Promise((function(t){l=o.play(),u=setTimeout((function(){c(!1,new Error("Timeout "+r+" ms has been reached"))}),r),c=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;clearTimeout(u),t({result:e,error:n})},void 0!==l?l.then((function(){return c(!0)})).catch((function(t){return c(!1,t)})):c(!0)}))}var a={audio:function(t){return o(t=s(t),(function(){return{element:document.createElement("audio"),source:URL.createObjectURL(r)}}))},video:function(t){return o(t=s(t),(function(){return{element:document.createElement("video"),source:URL.createObjectURL(i)}}))}};e.a=a},dmU3:function(t,e,n){"use strict";n.d(e,"a",(function(){return D}));var r=n("tU5a"),i=n("gbB/"),s=n("rGHg"),o=n("iaIS"),a=0;var l={};function u(t){return l[t]||(l[t]=function(t){if("function"==typeof Symbol)return Symbol(t);var e="__$mobx-react "+t+" ("+a+")";return a++,e}(t)),l[t]}function c(t,e){if(h(t,e))return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++)if(!Object.hasOwnProperty.call(e,n[i])||!h(t[n[i]],e[n[i]]))return!1;return!0}function h(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}function d(t,e,n){Object.hasOwnProperty.call(t,e)?t[e]=n:Object.defineProperty(t,e,{enumerable:!1,configurable:!0,writable:!0,value:n})}var f=u("patchMixins"),p=u("patchedDefinition");function g(t,e){for(var n=this,r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];e.locks++;try{var o;return null!=t&&(o=t.apply(this,i)),o}finally{e.locks--,0===e.locks&&e.methods.forEach((function(t){t.apply(n,i)}))}}function m(t,e){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];g.call.apply(g,[this,t,e].concat(r))}}function v(t,e,n){var r=function(t,e){var n=t[f]=t[f]||{},r=n[e]=n[e]||{};return r.locks=r.locks||0,r.methods=r.methods||[],r}(t,e);r.methods.indexOf(n)<0&&r.methods.push(n);var i=Object.getOwnPropertyDescriptor(t,e);if(!i||!i[p]){var s=t[e],o=function t(e,n,r,i,s){var o,a=m(s,i);return(o={})[p]=!0,o.get=function(){return a},o.set=function(s){if(this===e)a=m(s,i);else{var o=t(this,n,r,i,s);Object.defineProperty(this,n,o)}},o.configurable=!0,o.enumerable=r,o}(t,e,i?i.enumerable:void 0,r,s);Object.defineProperty(t,e,o)}}var y=r.a||"$mobx",b=u("isUnmounted"),E=u("skipRender"),T=u("isForcingUpdate");function S(t){var e=t.prototype;if(e.componentWillReact)throw new Error("The componentWillReact life-cycle event is no longer supported");if(t.__proto__!==i.PureComponent)if(e.shouldComponentUpdate){if(e.shouldComponentUpdate!==w)throw new Error("It is not allowed to use shouldComponentUpdate in observer based components.")}else e.shouldComponentUpdate=w;A(e,"props"),A(e,"state");var n=e.render;return e.render=function(){return _.call(this,n)},v(e,"componentWillUnmount",(function(){if(!0!==Object(o.b)()){if(this.render[y])this.render[y].dispose();else;this[b]=!0}})),t}function _(t){var e=this;if(!0===Object(o.b)())return t.call(this);d(this,E,!1),d(this,T,!1);var n,s=(n=this).displayName||n.name||n.constructor&&(n.constructor.displayName||n.constructor.name)||"<component>",a=t.bind(this),l=!1,u=new r.b(s+".render()",(function(){if(!l&&(l=!0,!0!==e[b])){var t=!0;try{d(e,T,!0),e[E]||i.Component.prototype.forceUpdate.call(e),t=!1}finally{d(e,T,!1),t&&u.dispose()}}}));function c(){l=!1;var t=void 0,e=void 0;if(u.track((function(){try{e=Object(r.c)(!1,a)}catch(e){t=e}})),t)throw t;return e}return u.reactComponent=this,c[y]=u,this.render=c,c.call(this)}function w(t,e){return Object(o.b)()&&console.warn("[mobx-react] It seems that a re-rendering of a React component is triggered while in static (server-side) mode. Please make sure components are rendered only once server-side."),this.state!==e||!c(this.props,t)}function A(t,e){var n=u("reactProp_"+e+"_valueHolder"),i=u("reactProp_"+e+"_atomHolder");function s(){return this[i]||d(this,i,Object(r.j)("reactive "+e)),this[i]}Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){var t=!1;return r.e&&r.d&&(t=Object(r.e)(!0)),s.call(this).reportObserved(),r.e&&r.d&&Object(r.d)(t),this[n]},set:function(t){this[T]||c(this[n],t)?d(this,n,t):(d(this,n,t),d(this,E,!0),s.call(this).reportChanged(),d(this,E,!1))}})}var L="function"==typeof Symbol&&Symbol.for,R=L?Symbol.for("react.forward_ref"):"function"==typeof i.forwardRef&&Object(i.forwardRef)((function(t){return null})).$$typeof,I=L?Symbol.for("react.memo"):"function"==typeof i.memo&&Object(i.memo)((function(t){return null})).$$typeof;function D(t){if(!0===t.isMobxInjector&&console.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"),I&&t.$$typeof===I)throw new Error("Mobx observer: You are trying to use 'observer' on function component wrapped to either another observer or 'React.memo'. The observer already applies 'React.memo' for you.");if(R&&t.$$typeof===R){var e=t.render;if("function"!=typeof e)throw new Error("render property of ForwardRef was not a function");return Object(i.forwardRef)((function(){var t=arguments;return Object(i.createElement)(o.a,null,(function(){return e.apply(void 0,t)}))}))}return"function"!=typeof t||t.prototype&&t.prototype.render||t.isReactClass||Object.prototype.isPrototypeOf.call(i.Component,t)?S(t):Object(o.c)(t)}if(!i.Component)throw new Error("mobx-react requires React to be available");if(!r.q)throw new Error("mobx-react requires mobx to be available");"function"==typeof s.unstable_batchedUpdates&&Object(r.i)({reactionScheduler:s.unstable_batchedUpdates})},dqmg:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=()=>{try{return new DOMException("","InvalidStateError")}catch(t){return t.code=11,t.name="InvalidStateError",t}}},eDUW:function(t,e,n){var r=n("4DXW"),i=n("6OdY"),s=n("mlf9"),o=Math.max;t.exports=function(t,e,n){var a=null==t?0:t.length;if(!a)return-1;var l=null==n?0:s(n);return l<0&&(l=o(a+l,0)),r(t,i(e,3),l)}},emll:function(t,e,n){},f3ws:function(t,e,n){},"fR9/":function(t,e,n){"use strict";function r(t,e){return t===e}function i(t,e,n){if(null===e||null===n||e.length!==n.length)return!1;for(var r=e.length,i=0;i<r;i++)if(!t(e[i],n[i]))return!1;return!0}function s(t){var e=Array.isArray(t[0])?t[0]:t;if(!e.every((function(t){return"function"==typeof t}))){var n=e.map((function(t){return typeof t})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+n+"]")}return e}n.d(e,"a",(function(){return o}));var o=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return function(){for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];var o=0,a=r.pop(),l=s(r),u=t.apply(void 0,[function(){return o++,a.apply(null,arguments)}].concat(n)),c=t((function(){for(var t=[],e=l.length,n=0;n<e;n++)t.push(l[n].apply(null,arguments));return u.apply(null,t)}));return c.resultFunc=a,c.dependencies=l,c.recomputations=function(){return o},c.resetRecomputations=function(){return o=0},c}}((function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,n=null,s=null;return function(){return i(e,n,arguments)||(s=t.apply(null,arguments)),n=arguments,s}}))},gXvu:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=(t,e,n,r)=>{if(0===n&&0===e)return t!==r?[]:[0];if(0===n)return[(r-t)/e];const i=e/n,s=Math.sqrt(i**2-2/n*(t-r));return[s-i,-(s+i)].filter(t=>!isNaN(t)).sort()}},iaIS:function(t,e,n){"use strict";n.d(e,"a",(function(){return m})),n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return p}));var r=n("tU5a"),i=n("gbB/");if(!i.useState)throw new Error("mobx-react-lite requires React with Hooks support");if(!r.t)throw new Error("mobx-react-lite requires mobx at least version 4 to be available");var s=!1;function o(){return s}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function l(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function u(t){return t.current?Object(r.m)(t.current):"<unknown>"}var c=[];function h(){var t=l(Object(i.useState)(0),2)[1];return Object(i.useCallback)((function(){t((function(t){return t+1}))}),[])}var d={};function f(t,e,n){if(void 0===e&&(e="observed"),void 0===n&&(n=d),o())return t();var s=(n.useForceUpdate||h)(),a=Object(i.useRef)(null);a.current||(a.current=new r.b("observer("+e+")",(function(){s()})));var l,f,p=function(){a.current&&!a.current.isDisposed&&(a.current.dispose(),a.current=null)};if(Object(i.useDebugValue)(a,u),function(t){Object(i.useEffect)((function(){return t}),c)}((function(){p()})),a.current.track((function(){try{l=t()}catch(t){f=t}})),f)throw p(),f;return l}function p(t,e){if(o())return t;var n,r,s,l=a({forwardRef:!1},e),u=t.displayName||t.name,c=function(e,n){return f((function(){return t(e,n)}),u)};return c.displayName=u,n=l.forwardRef?Object(i.memo)(Object(i.forwardRef)(c)):Object(i.memo)(c),r=t,s=n,Object.keys(r).forEach((function(t){r.hasOwnProperty(t)&&!g[t]&&Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(r,t))})),n.displayName=u,n}var g={$$typeof:!0,render:!0,compare:!0,type:!0};function m(t){var e=t.children,n=t.render,r=e||n;return"function"!=typeof r?null:f(r)}function v(t,e,n,r,i){var s="children"===e?"render":"children",o="function"==typeof t[e],a="function"==typeof t[s];return o&&a?new Error("MobX Observer: Do not use children and render in the same time in`"+n):o||a?null:new Error("Invalid prop `"+i+"` of type `"+typeof t[e]+"` supplied to `"+n+"`, expected `function`.")}m.propTypes={children:v,render:v},m.displayName="Observer"},jnXQ:function(t,e,n){var r=n("IBeF"),i=n("A0Az"),s=n("V7vT"),o=n("yOTq"),a=n("spkS"),l=n("KwXd"),u=n("p8CC"),c=n("jSFv"),h=u((function(t,e){var n={};if(null==t)return n;var u=!1;e=r(e,(function(e){return e=o(e,t),u||(u=e.length>1),e})),a(t,c(t),n),u&&(n=i(n,7,l));for(var h=e.length;h--;)s(n,e[h]);return n}));t.exports=h},kFVD:function(t,e,n){var r=n("q7dE"),i=n("fSst"),s=n("UqkC"),o=n("+EJi"),a=n("1mK8"),l=n("sASb"),u=n("RlTC"),c=n("36WF"),h="[object Map]",d="[object Set]",f=Object.prototype.hasOwnProperty;t.exports=function(t){if(null==t)return!0;if(a(t)&&(o(t)||"string"==typeof t||"function"==typeof t.splice||l(t)||c(t)||s(t)))return!t.length;var e=i(t);if(e==h||e==d)return!t.size;if(u(t))return!r(t).length;for(var n in t)if(f.call(t,n))return!1;return!0}},kLJ4:function(t,e,n){},kQVp:function(t,e,n){},lGiI:function(t,e,n){(function(t,r){var i;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){function s(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function o(t,e,n,r){for(var i=-1,s=null==t?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function a(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function l(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function u(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function c(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function h(t,e){return!(null==t||!t.length)&&T(t,e,0)>-1}function d(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function f(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function p(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function g(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function m(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function v(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function y(t){return t.match(De)||[]}function b(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function E(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function T(t,e,n){return e==e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):E(t,_,n)}function S(t,e,n,r){for(var i=n-1,s=t.length;++i<s;)if(r(t[i],e))return i;return-1}function _(t){return t!=t}function w(t,e){var n=null==t?0:t.length;return n?I(t,e)/n:At}function A(t){return function(e){return null==e?Y:e[t]}}function L(t){return function(e){return null==t?Y:t[e]}}function R(t,e,n,r,i){return i(t,(function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)})),n}function I(t,e){for(var n,r=-1,i=t.length;++r<i;){var s=e(t[r]);s!==Y&&(n=n===Y?s:n+s)}return n}function D(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function x(t){return t?t.slice(0,H(t)+1).replace(we,""):t}function k(t){return function(e){return t(e)}}function O(t,e){return f(e,(function(e){return t[e]}))}function C(t,e){return t.has(e)}function P(t,e){for(var n=-1,r=t.length;++n<r&&T(e,t[n],0)>-1;);return n}function M(t,e){for(var n=t.length;n--&&T(e,t[n],0)>-1;);return n}function F(t){return"\\"+Dn[t]}function N(t){return _n.test(t)}function U(t){return wn.test(t)}function B(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function $(t,e){return function(n){return t(e(n))}}function j(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var o=t[n];o!==e&&o!==tt||(t[n]=tt,s[i++]=n)}return s}function G(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function K(t){return N(t)?function(t){for(var e=Tn.lastIndex=0;Tn.test(t);)++e;return e}(t):Wn(t)}function V(t){return N(t)?function(t){return t.match(Tn)||[]}(t):function(t){return t.split("")}(t)}function H(t){for(var e=t.length;e--&&Ae.test(t.charAt(e)););return e}function W(t){return t.match(Sn)||[]}var Y,z=200,q="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",X="Expected a function",Q="Invalid `variable` option passed into `_.template`",Z="__lodash_hash_undefined__",J=500,tt="__lodash_placeholder__",et=1,nt=2,rt=4,it=1,st=2,ot=1,at=2,lt=4,ut=8,ct=16,ht=32,dt=64,ft=128,pt=256,gt=512,mt=30,vt="...",yt=800,bt=16,Et=1,Tt=2,St=1/0,_t=9007199254740991,wt=17976931348623157e292,At=NaN,Lt=4294967295,Rt=Lt-1,It=Lt>>>1,Dt=[["ary",ft],["bind",ot],["bindKey",at],["curry",ut],["curryRight",ct],["flip",gt],["partial",ht],["partialRight",dt],["rearg",pt]],xt="[object Arguments]",kt="[object Array]",Ot="[object AsyncFunction]",Ct="[object Boolean]",Pt="[object Date]",Mt="[object DOMException]",Ft="[object Error]",Nt="[object Function]",Ut="[object GeneratorFunction]",Bt="[object Map]",$t="[object Number]",jt="[object Null]",Gt="[object Object]",Kt="[object Promise]",Vt="[object Proxy]",Ht="[object RegExp]",Wt="[object Set]",Yt="[object String]",zt="[object Symbol]",qt="[object Undefined]",Xt="[object WeakMap]",Qt="[object WeakSet]",Zt="[object ArrayBuffer]",Jt="[object DataView]",te="[object Float32Array]",ee="[object Float64Array]",ne="[object Int8Array]",re="[object Int16Array]",ie="[object Int32Array]",se="[object Uint8Array]",oe="[object Uint8ClampedArray]",ae="[object Uint16Array]",le="[object Uint32Array]",ue=/\b__p \+= '';/g,ce=/\b(__p \+=) '' \+/g,he=/(__e\(.*?\)|\b__t\)) \+\n'';/g,de=/&(?:amp|lt|gt|quot|#39);/g,fe=/[&<>"']/g,pe=RegExp(de.source),ge=RegExp(fe.source),me=/<%-([\s\S]+?)%>/g,ve=/<%([\s\S]+?)%>/g,ye=/<%=([\s\S]+?)%>/g,be=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ee=/^\w*$/,Te=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Se=/[\\^$.*+?()[\]{}|]/g,_e=RegExp(Se.source),we=/^\s+/,Ae=/\s/,Le=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Re=/\{\n\/\* \[wrapped with (.+)\] \*/,Ie=/,? & /,De=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,xe=/[()=,{}\[\]\/\s]/,ke=/\\(\\)?/g,Oe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ce=/\w*$/,Pe=/^[-+]0x[0-9a-f]+$/i,Me=/^0b[01]+$/i,Fe=/^\[object .+?Constructor\]$/,Ne=/^0o[0-7]+$/i,Ue=/^(?:0|[1-9]\d*)$/,Be=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,$e=/($^)/,je=/['\n\r\u2028\u2029\\]/g,Ge="\\ud800-\\udfff",Ke="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ve="\\u2700-\\u27bf",He="a-z\\xdf-\\xf6\\xf8-\\xff",We="A-Z\\xc0-\\xd6\\xd8-\\xde",Ye="\\ufe0e\\ufe0f",ze="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",qe="[']",Xe="["+Ge+"]",Qe="["+ze+"]",Ze="["+Ke+"]",Je="\\d+",tn="["+Ve+"]",en="["+He+"]",nn="[^"+Ge+ze+Je+Ve+He+We+"]",rn="\\ud83c[\\udffb-\\udfff]",sn="[^"+Ge+"]",on="(?:\\ud83c[\\udde6-\\uddff]){2}",an="[\\ud800-\\udbff][\\udc00-\\udfff]",ln="["+We+"]",un="\\u200d",cn="(?:"+en+"|"+nn+")",hn="(?:"+ln+"|"+nn+")",dn="(?:['](?:d|ll|m|re|s|t|ve))?",fn="(?:['](?:D|LL|M|RE|S|T|VE))?",pn="(?:"+Ze+"|"+rn+")"+"?",gn="["+Ye+"]?",mn=gn+pn+("(?:"+un+"(?:"+[sn,on,an].join("|")+")"+gn+pn+")*"),vn="(?:"+[tn,on,an].join("|")+")"+mn,yn="(?:"+[sn+Ze+"?",Ze,on,an,Xe].join("|")+")",bn=RegExp(qe,"g"),En=RegExp(Ze,"g"),Tn=RegExp(rn+"(?="+rn+")|"+yn+mn,"g"),Sn=RegExp([ln+"?"+en+"+"+dn+"(?="+[Qe,ln,"$"].join("|")+")",hn+"+"+fn+"(?="+[Qe,ln+cn,"$"].join("|")+")",ln+"?"+cn+"+"+dn,ln+"+"+fn,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Je,vn].join("|"),"g"),_n=RegExp("["+un+Ge+Ke+Ye+"]"),wn=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,An=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ln=-1,Rn={};Rn[te]=Rn[ee]=Rn[ne]=Rn[re]=Rn[ie]=Rn[se]=Rn[oe]=Rn[ae]=Rn[le]=!0,Rn[xt]=Rn[kt]=Rn[Zt]=Rn[Ct]=Rn[Jt]=Rn[Pt]=Rn[Ft]=Rn[Nt]=Rn[Bt]=Rn[$t]=Rn[Gt]=Rn[Ht]=Rn[Wt]=Rn[Yt]=Rn[Xt]=!1;var In={};In[xt]=In[kt]=In[Zt]=In[Jt]=In[Ct]=In[Pt]=In[te]=In[ee]=In[ne]=In[re]=In[ie]=In[Bt]=In[$t]=In[Gt]=In[Ht]=In[Wt]=In[Yt]=In[zt]=In[se]=In[oe]=In[ae]=In[le]=!0,In[Ft]=In[Nt]=In[Xt]=!1;var Dn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},xn=parseFloat,kn=parseInt,On="object"==typeof t&&t&&t.Object===Object&&t,Cn="object"==typeof self&&self&&self.Object===Object&&self,Pn=On||Cn||Function("return this")(),Mn=e&&!e.nodeType&&e,Fn=Mn&&"object"==typeof r&&r&&!r.nodeType&&r,Nn=Fn&&Fn.exports===Mn,Un=Nn&&On.process,Bn=function(){try{var t=Fn&&Fn.require&&Fn.require("util").types;return t||Un&&Un.binding&&Un.binding("util")}catch(t){}}(),$n=Bn&&Bn.isArrayBuffer,jn=Bn&&Bn.isDate,Gn=Bn&&Bn.isMap,Kn=Bn&&Bn.isRegExp,Vn=Bn&&Bn.isSet,Hn=Bn&&Bn.isTypedArray,Wn=A("length"),Yn=L({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),zn=L({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),qn=L({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Xn=function t(e){function n(t){if(fs(t)&&!rl(t)&&!(t instanceof L)){if(t instanceof i)return t;if(no.call(t,"__wrapped__"))return Bi(t)}return new i(t)}function r(){}function i(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=Y}function L(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Lt,this.__views__=[]}function Ae(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function De(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ge(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ke(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Ge;++e<n;)this.add(t[e])}function Ve(t){this.size=(this.__data__=new De(t)).size}function He(t,e){var n=rl(t),r=!n&&nl(t),i=!n&&!r&&sl(t),s=!n&&!r&&!i&&cl(t),o=n||r||i||s,a=o?D(t.length,qs):[],l=a.length;for(var u in t)!e&&!no.call(t,u)||o&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||_i(u,l))||a.push(u);return a}function We(t){var e=t.length;return e?t[or(0,e-1)]:Y}function Ye(t,e){return Mi(Nr(t),nn(e,0,t.length))}function ze(t){return Mi(Nr(t))}function qe(t,e,n){(n===Y||ss(t[e],n))&&(n!==Y||e in t)||tn(t,e,n)}function Xe(t,e,n){var r=t[e];no.call(t,e)&&ss(r,n)&&(n!==Y||e in t)||tn(t,e,n)}function Qe(t,e){for(var n=t.length;n--;)if(ss(t[n][0],e))return n;return-1}function Ze(t,e,n,r){return ea(t,(function(t,i,s){e(r,t,n(t),s)})),r}function Je(t,e){return t&&Ur(e,Rs(e),t)}function tn(t,e,n){"__proto__"==e&&To?To(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function en(t,e){for(var n=-1,r=e.length,i=Gs(r),s=null==t;++n<r;)i[n]=s?Y:As(t,e[n]);return i}function nn(t,e,n){return t==t&&(n!==Y&&(t=t<=n?t:n),e!==Y&&(t=t>=e?t:e)),t}function rn(t,e,n,r,i,s){var o,l=e&et,u=e&nt,c=e&rt;if(n&&(o=i?n(t,r,i,s):n(t)),o!==Y)return o;if(!ds(t))return t;var h=rl(t);if(h){if(o=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&no.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!l)return Nr(t,o)}else{var d=fa(t),f=d==Nt||d==Ut;if(sl(t))return kr(t,l);if(d==Gt||d==xt||f&&!i){if(o=u||f?{}:Ti(t),!l)return u?function(t,e){return Ur(t,da(t),e)}(t,function(t,e){return t&&Ur(e,Is(e),t)}(o,t)):function(t,e){return Ur(t,ha(t),e)}(t,Je(o,t))}else{if(!In[d])return i?t:{};o=function(t,e,n){var r=t.constructor;switch(e){case Zt:return Or(t);case Ct:case Pt:return new r(+t);case Jt:return function(t,e){return new t.constructor(e?Or(t.buffer):t.buffer,t.byteOffset,t.byteLength)}(t,n);case te:case ee:case ne:case re:case ie:case se:case oe:case ae:case le:return Cr(t,n);case Bt:return new r;case $t:case Yt:return new r(t);case Ht:return function(t){var e=new t.constructor(t.source,Ce.exec(t));return e.lastIndex=t.lastIndex,e}(t);case Wt:return new r;case zt:return function(t){return Zo?Ys(Zo.call(t)):{}}(t)}}(t,d,l)}}s||(s=new Ve);var p=s.get(t);if(p)return p;s.set(t,o),ul(t)?t.forEach((function(r){o.add(rn(r,e,n,r,t,s))})):al(t)&&t.forEach((function(r,i){o.set(i,rn(r,e,n,i,t,s))}));var g=h?Y:(c?u?fi:di:u?Is:Rs)(t);return a(g||t,(function(r,i){g&&(r=t[i=r]),Xe(o,i,rn(r,e,n,i,t,s))})),o}function sn(t,e,n){var r=n.length;if(null==t)return!r;for(t=Ys(t);r--;){var i=n[r],s=e[i],o=t[i];if(o===Y&&!(i in t)||!s(o))return!1}return!0}function on(t,e,n){if("function"!=typeof t)throw new Xs(X);return ma((function(){t.apply(Y,n)}),e)}function an(t,e,n,r){var i=-1,s=h,o=!0,a=t.length,l=[],u=e.length;if(!a)return l;n&&(e=f(e,k(n))),r?(s=d,o=!1):e.length>=z&&(s=C,o=!1,e=new Ke(e));t:for(;++i<a;){var c=t[i],p=null==n?c:n(c);if(c=r||0!==c?c:0,o&&p==p){for(var g=u;g--;)if(e[g]===p)continue t;l.push(c)}else s(e,p,r)||l.push(c)}return l}function ln(t,e){var n=!0;return ea(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function un(t,e,n){for(var r=-1,i=t.length;++r<i;){var s=t[r],o=e(s);if(null!=o&&(a===Y?o==o&&!vs(o):n(o,a)))var a=o,l=s}return l}function cn(t,e){var n=[];return ea(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function hn(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=Si),i||(i=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?hn(a,e-1,n,r,i):p(i,a):r||(i[i.length]=a)}return i}function dn(t,e){return t&&ra(t,e,Rs)}function fn(t,e){return t&&ia(t,e,Rs)}function pn(t,e){return c(e,(function(e){return us(t[e])}))}function gn(t,e){for(var n=0,r=(e=Dr(e,t)).length;null!=t&&n<r;)t=t[Fi(e[n++])];return n&&n==r?t:Y}function mn(t,e,n){var r=e(t);return rl(t)?r:p(r,n(t))}function vn(t){return null==t?t===Y?qt:jt:Eo&&Eo in Ys(t)?function(t){var e=no.call(t,Eo),n=t[Eo];try{t[Eo]=Y;var r=!0}catch(t){}var i=so.call(t);return r&&(e?t[Eo]=n:delete t[Eo]),i}(t):function(t){return so.call(t)}(t)}function yn(t,e){return t>e}function Tn(t,e){return null!=t&&no.call(t,e)}function Sn(t,e){return null!=t&&e in Ys(t)}function _n(t,e,n){for(var r=n?d:h,i=t[0].length,s=t.length,o=s,a=Gs(s),l=1/0,u=[];o--;){var c=t[o];o&&e&&(c=f(c,k(e))),l=Co(c.length,l),a[o]=!n&&(e||i>=120&&c.length>=120)?new Ke(o&&c):Y}c=t[0];var p=-1,g=a[0];t:for(;++p<i&&u.length<l;){var m=c[p],v=e?e(m):m;if(m=n||0!==m?m:0,!(g?C(g,v):r(u,v,n))){for(o=s;--o;){var y=a[o];if(!(y?C(y,v):r(t[o],v,n)))continue t}g&&g.push(v),u.push(m)}}return u}function wn(t,e,n){var r=null==(t=ki(t,e=Dr(e,t)))?t:t[Fi(Vi(e))];return null==r?Y:s(r,t,n)}function Dn(t){return fs(t)&&vn(t)==xt}function On(t,e,n,r,i){return t===e||(null==t||null==e||!fs(t)&&!fs(e)?t!=t&&e!=e:function(t,e,n,r,i,s){var o=rl(t),a=rl(e),l=o?kt:fa(t),u=a?kt:fa(e),c=(l=l==xt?Gt:l)==Gt,h=(u=u==xt?Gt:u)==Gt,d=l==u;if(d&&sl(t)){if(!sl(e))return!1;o=!0,c=!1}if(d&&!c)return s||(s=new Ve),o||cl(t)?ci(t,e,n,r,i,s):function(t,e,n,r,i,s,o){switch(n){case Jt:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case Zt:return!(t.byteLength!=e.byteLength||!s(new ho(t),new ho(e)));case Ct:case Pt:case $t:return ss(+t,+e);case Ft:return t.name==e.name&&t.message==e.message;case Ht:case Yt:return t==e+"";case Bt:var a=B;case Wt:var l=r&it;if(a||(a=G),t.size!=e.size&&!l)return!1;var u=o.get(t);if(u)return u==e;r|=st,o.set(t,e);var c=ci(a(t),a(e),r,i,s,o);return o.delete(t),c;case zt:if(Zo)return Zo.call(t)==Zo.call(e)}return!1}(t,e,l,n,r,i,s);if(!(n&it)){var f=c&&no.call(t,"__wrapped__"),p=h&&no.call(e,"__wrapped__");if(f||p){var g=f?t.value():t,m=p?e.value():e;return s||(s=new Ve),i(g,m,n,r,s)}}return!!d&&(s||(s=new Ve),function(t,e,n,r,i,s){var o=n&it,a=di(t),l=a.length;if(l!=di(e).length&&!o)return!1;for(var u=l;u--;){var c=a[u];if(!(o?c in e:no.call(e,c)))return!1}var h=s.get(t),d=s.get(e);if(h&&d)return h==e&&d==t;var f=!0;s.set(t,e),s.set(e,t);for(var p=o;++u<l;){c=a[u];var g=t[c],m=e[c];if(r)var v=o?r(m,g,c,e,t,s):r(g,m,c,t,e,s);if(!(v===Y?g===m||i(g,m,n,r,s):v)){f=!1;break}p||(p="constructor"==c)}if(f&&!p){var y=t.constructor,b=e.constructor;y!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(f=!1)}return s.delete(t),s.delete(e),f}(t,e,n,r,i,s))}(t,e,n,r,On,i))}function Cn(t,e,n,r){var i=n.length,s=i,o=!r;if(null==t)return!s;for(t=Ys(t);i--;){var a=n[i];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<s;){var l=(a=n[i])[0],u=t[l],c=a[1];if(o&&a[2]){if(u===Y&&!(l in t))return!1}else{var h=new Ve;if(r)var d=r(u,c,l,t,e,h);if(!(d===Y?On(c,u,it|st,r,h):d))return!1}}return!0}function Mn(t){return!(!ds(t)||function(t){return!!io&&io in t}(t))&&(us(t)?lo:Fe).test(Ni(t))}function Fn(t){return"function"==typeof t?t:null==t?Ms:"object"==typeof t?rl(t)?Jn(t[0],t[1]):Zn(t):Bs(t)}function Un(t){if(!Ri(t))return ko(t);var e=[];for(var n in Ys(t))no.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Bn(t){if(!ds(t))return function(t){var e=[];if(null!=t)for(var n in Ys(t))e.push(n);return e}(t);var e=Ri(t),n=[];for(var r in t)("constructor"!=r||!e&&no.call(t,r))&&n.push(r);return n}function Wn(t,e){return t<e}function Qn(t,e){var n=-1,r=os(t)?Gs(t.length):[];return ea(t,(function(t,i,s){r[++n]=e(t,i,s)})),r}function Zn(t){var e=yi(t);return 1==e.length&&e[0][2]?Di(e[0][0],e[0][1]):function(n){return n===t||Cn(n,t,e)}}function Jn(t,e){return Ai(t)&&Ii(e)?Di(Fi(t),e):function(n){var r=As(n,t);return r===Y&&r===e?Ls(n,t):On(e,r,it|st)}}function tr(t,e,n,r,i){t!==e&&ra(e,(function(s,o){if(i||(i=new Ve),ds(s))!function(t,e,n,r,i,s,o){var a=Oi(t,n),l=Oi(e,n),u=o.get(l);if(u)return qe(t,n,u),Y;var c=s?s(a,l,n+"",t,e,o):Y,h=c===Y;if(h){var d=rl(l),f=!d&&sl(l),p=!d&&!f&&cl(l);c=l,d||f||p?rl(a)?c=a:as(a)?c=Nr(a):f?(h=!1,c=kr(l,!0)):p?(h=!1,c=Cr(l,!0)):c=[]:gs(l)||nl(l)?(c=a,nl(a)?c=_s(a):ds(a)&&!us(a)||(c=Ti(l))):h=!1}h&&(o.set(l,c),i(c,l,r,s,o),o.delete(l)),qe(t,n,c)}(t,e,o,n,tr,r,i);else{var a=r?r(Oi(t,o),s,o+"",t,e,i):Y;a===Y&&(a=s),qe(t,o,a)}}),Is)}function er(t,e){var n=t.length;if(n)return _i(e+=e<0?n:0,n)?t[e]:Y}function nr(t,e,n){e=e.length?f(e,(function(t){return rl(t)?function(e){return gn(e,1===t.length?t[0]:t)}:t})):[Ms];var r=-1;return e=f(e,k(mi())),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(Qn(t,(function(t,n,i){return{criteria:f(e,(function(e){return e(t)})),index:++r,value:t}})),(function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,s=e.criteria,o=i.length,a=n.length;++r<o;){var l=Pr(i[r],s[r]);if(l)return r>=a?l:l*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function rr(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=gn(t,o);n(a,o)&&hr(s,Dr(o,t),a)}return s}function ir(t,e,n,r){var i=r?S:T,s=-1,o=e.length,a=t;for(t===e&&(e=Nr(e)),n&&(a=f(t,k(n)));++s<o;)for(var l=0,u=e[s],c=n?n(u):u;(l=i(a,c,l,r))>-1;)a!==t&&vo.call(a,l,1),vo.call(t,l,1);return t}function sr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==s){var s=i;_i(i)?vo.call(t,i,1):Tr(t,i)}}return t}function or(t,e){return t+Lo(Fo()*(e-t+1))}function ar(t,e){var n="";if(!t||e<1||e>_t)return n;do{e%2&&(n+=t),(e=Lo(e/2))&&(t+=t)}while(e);return n}function lr(t,e){return va(xi(t,e,Ms),t+"")}function ur(t){return We(xs(t))}function cr(t,e){var n=xs(t);return Mi(n,nn(e,0,n.length))}function hr(t,e,n,r){if(!ds(t))return t;for(var i=-1,s=(e=Dr(e,t)).length,o=s-1,a=t;null!=a&&++i<s;){var l=Fi(e[i]),u=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return t;if(i!=o){var c=a[l];(u=r?r(c,l,a):Y)===Y&&(u=ds(c)?c:_i(e[i+1])?[]:{})}Xe(a,l,u),a=a[l]}return t}function dr(t){return Mi(xs(t))}function fr(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Gs(i);++r<i;)s[r]=t[r+e];return s}function pr(t,e){var n;return ea(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function gr(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=It){for(;r<i;){var s=r+i>>>1,o=t[s];null!==o&&!vs(o)&&(n?o<=e:o<e)?r=s+1:i=s}return i}return mr(t,e,Ms,n)}function mr(t,e,n,r){var i=0,s=null==t?0:t.length;if(0===s)return 0;for(var o=(e=n(e))!=e,a=null===e,l=vs(e),u=e===Y;i<s;){var c=Lo((i+s)/2),h=n(t[c]),d=h!==Y,f=null===h,p=h==h,g=vs(h);if(o)var m=r||p;else m=u?p&&(r||d):a?p&&d&&(r||!f):l?p&&d&&!f&&(r||!g):!f&&!g&&(r?h<=e:h<e);m?i=c+1:s=c}return Co(s,Rt)}function vr(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var o=t[n],a=e?e(o):o;if(!n||!ss(a,l)){var l=a;s[i++]=0===o?0:o}}return s}function yr(t){return"number"==typeof t?t:vs(t)?At:+t}function br(t){if("string"==typeof t)return t;if(rl(t))return f(t,br)+"";if(vs(t))return Jo?Jo.call(t):"";var e=t+"";return"0"==e&&1/t==-St?"-0":e}function Er(t,e,n){var r=-1,i=h,s=t.length,o=!0,a=[],l=a;if(n)o=!1,i=d;else if(s>=z){var u=e?null:ua(t);if(u)return G(u);o=!1,i=C,l=new Ke}else l=e?[]:a;t:for(;++r<s;){var c=t[r],f=e?e(c):c;if(c=n||0!==c?c:0,o&&f==f){for(var p=l.length;p--;)if(l[p]===f)continue t;e&&l.push(f),a.push(c)}else i(l,f,n)||(l!==a&&l.push(f),a.push(c))}return a}function Tr(t,e){return null==(t=ki(t,e=Dr(e,t)))||delete t[Fi(Vi(e))]}function Sr(t,e,n,r){return hr(t,e,n(gn(t,e)),r)}function _r(t,e,n,r){for(var i=t.length,s=r?i:-1;(r?s--:++s<i)&&e(t[s],s,t););return n?fr(t,r?0:s,r?s+1:i):fr(t,r?s+1:0,r?i:s)}function wr(t,e){var n=t;return n instanceof L&&(n=n.value()),g(e,(function(t,e){return e.func.apply(e.thisArg,p([t],e.args))}),n)}function Ar(t,e,n){var r=t.length;if(r<2)return r?Er(t[0]):[];for(var i=-1,s=Gs(r);++i<r;)for(var o=t[i],a=-1;++a<r;)a!=i&&(s[i]=an(s[i]||o,t[a],e,n));return Er(hn(s,1),e,n)}function Lr(t,e,n){for(var r=-1,i=t.length,s=e.length,o={};++r<i;)n(o,t[r],r<s?e[r]:Y);return o}function Rr(t){return as(t)?t:[]}function Ir(t){return"function"==typeof t?t:Ms}function Dr(t,e){return rl(t)?t:Ai(t,e)?[t]:ya(ws(t))}function xr(t,e,n){var r=t.length;return n=n===Y?r:n,!e&&n>=r?t:fr(t,e,n)}function kr(t,e){if(e)return t.slice();var n=t.length,r=fo?fo(n):new t.constructor(n);return t.copy(r),r}function Or(t){var e=new t.constructor(t.byteLength);return new ho(e).set(new ho(t)),e}function Cr(t,e){return new t.constructor(e?Or(t.buffer):t.buffer,t.byteOffset,t.length)}function Pr(t,e){if(t!==e){var n=t!==Y,r=null===t,i=t==t,s=vs(t),o=e!==Y,a=null===e,l=e==e,u=vs(e);if(!a&&!u&&!s&&t>e||s&&o&&l&&!a&&!u||r&&o&&l||!n&&l||!i)return 1;if(!r&&!s&&!u&&t<e||u&&n&&i&&!r&&!s||a&&n&&i||!o&&i||!l)return-1}return 0}function Mr(t,e,n,r){for(var i=-1,s=t.length,o=n.length,a=-1,l=e.length,u=Oo(s-o,0),c=Gs(l+u),h=!r;++a<l;)c[a]=e[a];for(;++i<o;)(h||i<s)&&(c[n[i]]=t[i]);for(;u--;)c[a++]=t[i++];return c}function Fr(t,e,n,r){for(var i=-1,s=t.length,o=-1,a=n.length,l=-1,u=e.length,c=Oo(s-a,0),h=Gs(c+u),d=!r;++i<c;)h[i]=t[i];for(var f=i;++l<u;)h[f+l]=e[l];for(;++o<a;)(d||i<s)&&(h[f+n[o]]=t[i++]);return h}function Nr(t,e){var n=-1,r=t.length;for(e||(e=Gs(r));++n<r;)e[n]=t[n];return e}function Ur(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],l=r?r(n[a],t[a],a,n,t):Y;l===Y&&(l=t[a]),i?tn(n,a,l):Xe(n,a,l)}return n}function Br(t,e){return function(n,r){var i=rl(n)?o:Ze,s=e?e():{};return i(n,t,mi(r,2),s)}}function $r(t){return lr((function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:Y,o=i>2?n[2]:Y;for(s=t.length>3&&"function"==typeof s?(i--,s):Y,o&&wi(n[0],n[1],o)&&(s=i<3?Y:s,i=1),e=Ys(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e}))}function jr(t,e){return function(n,r){if(null==n)return n;if(!os(n))return t(n,r);for(var i=n.length,s=e?i:-1,o=Ys(n);(e?s--:++s<i)&&!1!==r(o[s],s,o););return n}}function Gr(t){return function(e,n,r){for(var i=-1,s=Ys(e),o=r(e),a=o.length;a--;){var l=o[t?a:++i];if(!1===n(s[l],l,s))break}return e}}function Kr(t){return function(e){var n=N(e=ws(e))?V(e):Y,r=n?n[0]:e.charAt(0),i=n?xr(n,1).join(""):e.slice(1);return r[t]()+i}}function Vr(t){return function(e){return g(Cs(Os(e).replace(bn,"")),t,"")}}function Hr(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=ta(t.prototype),r=t.apply(n,e);return ds(r)?r:n}}function Wr(t,e,n){var r=Hr(t);return function i(){for(var o=arguments.length,a=Gs(o),l=o,u=gi(i);l--;)a[l]=arguments[l];var c=o<3&&a[0]!==u&&a[o-1]!==u?[]:j(a,u);return(o-=c.length)<n?ri(t,e,qr,i.placeholder,Y,a,c,Y,Y,n-o):s(this&&this!==Pn&&this instanceof i?r:t,this,a)}}function Yr(t){return function(e,n,r){var i=Ys(e);if(!os(e)){var s=mi(n,3);e=Rs(e),n=function(t){return s(i[t],t,i)}}var o=t(e,n,r);return o>-1?i[s?e[o]:o]:Y}}function zr(t){return hi((function(e){var n=e.length,r=n,s=i.prototype.thru;for(t&&e.reverse();r--;){var o=e[r];if("function"!=typeof o)throw new Xs(X);if(s&&!a&&"wrapper"==pi(o))var a=new i([],!0)}for(r=a?r:n;++r<n;){var l=pi(o=e[r]),u="wrapper"==l?ca(o):Y;a=u&&Li(u[0])&&u[1]==(ft|ut|ht|pt)&&!u[4].length&&1==u[9]?a[pi(u[0])].apply(a,u[3]):1==o.length&&Li(o)?a[l]():a.thru(o)}return function(){var t=arguments,r=t[0];if(a&&1==t.length&&rl(r))return a.plant(r).value();for(var i=0,s=n?e[i].apply(this,t):r;++i<n;)s=e[i].call(this,s);return s}}))}function qr(t,e,n,r,i,s,o,a,l,u){var c=e&ft,h=e&ot,d=e&at,f=e&(ut|ct),p=e&gt,g=d?Y:Hr(t);return function m(){for(var v=arguments.length,y=Gs(v),b=v;b--;)y[b]=arguments[b];if(f)var E=gi(m),T=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(y,E);if(r&&(y=Mr(y,r,i,f)),s&&(y=Fr(y,s,o,f)),v-=T,f&&v<u)return ri(t,e,qr,m.placeholder,n,y,j(y,E),a,l,u-v);var S=h?n:this,_=d?S[t]:t;return v=y.length,a?y=function(t,e){for(var n=t.length,r=Co(e.length,n),i=Nr(t);r--;){var s=e[r];t[r]=_i(s,n)?i[s]:Y}return t}(y,a):p&&v>1&&y.reverse(),c&&l<v&&(y.length=l),this&&this!==Pn&&this instanceof m&&(_=g||Hr(_)),_.apply(S,y)}}function Xr(t,e){return function(n,r){return function(t,e,n,r){return dn(t,(function(t,i,s){e(r,n(t),i,s)})),r}(n,t,e(r),{})}}function Qr(t,e){return function(n,r){var i;if(n===Y&&r===Y)return e;if(n!==Y&&(i=n),r!==Y){if(i===Y)return r;"string"==typeof n||"string"==typeof r?(n=br(n),r=br(r)):(n=yr(n),r=yr(r)),i=t(n,r)}return i}}function Zr(t){return hi((function(e){return e=f(e,k(mi())),lr((function(n){var r=this;return t(e,(function(t){return s(t,r,n)}))}))}))}function Jr(t,e){var n=(e=e===Y?" ":br(e)).length;if(n<2)return n?ar(e,t):e;var r=ar(e,Ao(t/K(e)));return N(e)?xr(V(r),0,t).join(""):r.slice(0,t)}function ti(t,e,n,r){var i=e&ot,o=Hr(t);return function e(){for(var a=-1,l=arguments.length,u=-1,c=r.length,h=Gs(c+l),d=this&&this!==Pn&&this instanceof e?o:t;++u<c;)h[u]=r[u];for(;l--;)h[u++]=arguments[++a];return s(d,i?n:this,h)}}function ei(t){return function(e,n,r){return r&&"number"!=typeof r&&wi(e,n,r)&&(n=r=Y),e=bs(e),n===Y?(n=e,e=0):n=bs(n),function(t,e,n,r){for(var i=-1,s=Oo(Ao((e-t)/(n||1)),0),o=Gs(s);s--;)o[r?s:++i]=t,t+=n;return o}(e,n,r=r===Y?e<n?1:-1:bs(r),t)}}function ni(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=Ss(e),n=Ss(n)),t(e,n)}}function ri(t,e,n,r,i,s,o,a,l,u){var c=e&ut;e|=c?ht:dt,(e&=~(c?dt:ht))&lt||(e&=~(ot|at));var h=[t,e,i,c?s:Y,c?o:Y,c?Y:s,c?Y:o,a,l,u],d=n.apply(Y,h);return Li(t)&&ga(d,h),d.placeholder=r,Ci(d,t,e)}function ii(t){var e=Ws[t];return function(t,n){if(t=Ss(t),(n=null==n?0:Co(Es(n),292))&&Do(t)){var r=(ws(t)+"e").split("e");return+((r=(ws(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}function si(t){return function(e){var n=fa(e);return n==Bt?B(e):n==Wt?function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}(e):function(t,e){return f(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function oi(t,e,n,r,i,s,o,a){var l=e&at;if(!l&&"function"!=typeof t)throw new Xs(X);var u=r?r.length:0;if(u||(e&=~(ht|dt),r=i=Y),o=o===Y?o:Oo(Es(o),0),a=a===Y?a:Es(a),u-=i?i.length:0,e&dt){var c=r,h=i;r=i=Y}var d=l?Y:ca(t),f=[t,e,n,r,i,c,h,s,o,a];if(d&&function(t,e){var n=t[1],r=e[1],i=n|r,s=i<(ot|at|ft),o=r==ft&&n==ut||r==ft&&n==pt&&t[7].length<=e[8]||r==(ft|pt)&&e[7].length<=e[8]&&n==ut;if(!s&&!o)return t;r&ot&&(t[2]=e[2],i|=n&ot?0:lt);var a=e[3];if(a){var l=t[3];t[3]=l?Mr(l,a,e[4]):a,t[4]=l?j(t[3],tt):e[4]}(a=e[5])&&(l=t[5],t[5]=l?Fr(l,a,e[6]):a,t[6]=l?j(t[5],tt):e[6]),(a=e[7])&&(t[7]=a),r&ft&&(t[8]=null==t[8]?e[8]:Co(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i}(f,d),t=f[0],e=f[1],n=f[2],r=f[3],i=f[4],!(a=f[9]=f[9]===Y?l?0:t.length:Oo(f[9]-u,0))&&e&(ut|ct)&&(e&=~(ut|ct)),e&&e!=ot)p=e==ut||e==ct?Wr(t,e,a):e!=ht&&e!=(ot|ht)||i.length?qr.apply(Y,f):ti(t,e,n,r);else var p=function(t,e,n){var r=e&ot,i=Hr(t);return function e(){return(this&&this!==Pn&&this instanceof e?i:t).apply(r?n:this,arguments)}}(t,e,n);return Ci((d?sa:ga)(p,f),t,e)}function ai(t,e,n,r){return t===Y||ss(t,Js[n])&&!no.call(r,n)?e:t}function li(t,e,n,r,i,s){return ds(t)&&ds(e)&&(s.set(e,t),tr(t,e,Y,li,s),s.delete(e)),t}function ui(t){return gs(t)?Y:t}function ci(t,e,n,r,i,s){var o=n&it,a=t.length,l=e.length;if(a!=l&&!(o&&l>a))return!1;var u=s.get(t),c=s.get(e);if(u&&c)return u==e&&c==t;var h=-1,d=!0,f=n&st?new Ke:Y;for(s.set(t,e),s.set(e,t);++h<a;){var p=t[h],g=e[h];if(r)var m=o?r(g,p,h,e,t,s):r(p,g,h,t,e,s);if(m!==Y){if(m)continue;d=!1;break}if(f){if(!v(e,(function(t,e){if(!C(f,e)&&(p===t||i(p,t,n,r,s)))return f.push(e)}))){d=!1;break}}else if(p!==g&&!i(p,g,n,r,s)){d=!1;break}}return s.delete(t),s.delete(e),d}function hi(t){return va(xi(t,Y,Gi),t+"")}function di(t){return mn(t,Rs,ha)}function fi(t){return mn(t,Is,da)}function pi(t){for(var e=t.name+"",n=Ho[e],r=no.call(Ho,e)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==t)return i.name}return e}function gi(t){return(no.call(n,"placeholder")?n:t).placeholder}function mi(){var t=n.iteratee||Fs;return t=t===Fs?Fn:t,arguments.length?t(arguments[0],arguments[1]):t}function vi(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function yi(t){for(var e=Rs(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Ii(i)]}return e}function bi(t,e){var n=function(t,e){return null==t?Y:t[e]}(t,e);return Mn(n)?n:Y}function Ei(t,e,n){for(var r=-1,i=(e=Dr(e,t)).length,s=!1;++r<i;){var o=Fi(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&hs(i)&&_i(o,i)&&(rl(t)||nl(t))}function Ti(t){return"function"!=typeof t.constructor||Ri(t)?{}:ta(po(t))}function Si(t){return rl(t)||nl(t)||!!(yo&&t&&t[yo])}function _i(t,e){var n=typeof t;return!!(e=null==e?_t:e)&&("number"==n||"symbol"!=n&&Ue.test(t))&&t>-1&&t%1==0&&t<e}function wi(t,e,n){if(!ds(n))return!1;var r=typeof e;return!!("number"==r?os(n)&&_i(e,n.length):"string"==r&&e in n)&&ss(n[e],t)}function Ai(t,e){if(rl(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!vs(t))||Ee.test(t)||!be.test(t)||null!=e&&t in Ys(e)}function Li(t){var e=pi(t),r=n[e];if("function"!=typeof r||!(e in L.prototype))return!1;if(t===r)return!0;var i=ca(r);return!!i&&t===i[0]}function Ri(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Js)}function Ii(t){return t==t&&!ds(t)}function Di(t,e){return function(n){return null!=n&&n[t]===e&&(e!==Y||t in Ys(n))}}function xi(t,e,n){return e=Oo(e===Y?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=Oo(r.length-e,0),a=Gs(o);++i<o;)a[i]=r[e+i];i=-1;for(var l=Gs(e+1);++i<e;)l[i]=r[i];return l[e]=n(a),s(t,this,l)}}function ki(t,e){return e.length<2?t:gn(t,fr(e,0,-1))}function Oi(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}function Ci(t,e,n){var r=e+"";return va(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(Le,"{\n/* [wrapped with "+e+"] */\n")}(r,Ui(function(t){var e=t.match(Re);return e?e[1].split(Ie):[]}(r),n)))}function Pi(t){var e=0,n=0;return function(){var r=Po(),i=bt-(r-n);if(n=r,i>0){if(++e>=yt)return arguments[0]}else e=0;return t.apply(Y,arguments)}}function Mi(t,e){var n=-1,r=t.length,i=r-1;for(e=e===Y?r:e;++n<e;){var s=or(n,i),o=t[s];t[s]=t[n],t[n]=o}return t.length=e,t}function Fi(t){if("string"==typeof t||vs(t))return t;var e=t+"";return"0"==e&&1/t==-St?"-0":e}function Ni(t){if(null!=t){try{return eo.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Ui(t,e){return a(Dt,(function(n){var r="_."+n[0];e&n[1]&&!h(t,r)&&t.push(r)})),t.sort()}function Bi(t){if(t instanceof L)return t.clone();var e=new i(t.__wrapped__,t.__chain__);return e.__actions__=Nr(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function $i(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Es(n);return i<0&&(i=Oo(r+i,0)),E(t,mi(e,3),i)}function ji(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r-1;return n!==Y&&(i=Es(n),i=n<0?Oo(r+i,0):Co(i,r-1)),E(t,mi(e,3),i,!0)}function Gi(t){return null!=t&&t.length?hn(t,1):[]}function Ki(t){return t&&t.length?t[0]:Y}function Vi(t){var e=null==t?0:t.length;return e?t[e-1]:Y}function Hi(t,e){return t&&t.length&&e&&e.length?ir(t,e):t}function Wi(t){return null==t?t:No.call(t)}function Yi(t){if(!t||!t.length)return[];var e=0;return t=c(t,(function(t){if(as(t))return e=Oo(t.length,e),!0})),D(e,(function(e){return f(t,A(e))}))}function zi(t,e){if(!t||!t.length)return[];var n=Yi(t);return null==e?n:f(n,(function(t){return s(e,Y,t)}))}function qi(t){var e=n(t);return e.__chain__=!0,e}function Xi(t,e){return e(t)}function Qi(t,e){return(rl(t)?a:ea)(t,mi(e,3))}function Zi(t,e){return(rl(t)?l:na)(t,mi(e,3))}function Ji(t,e){return(rl(t)?f:Qn)(t,mi(e,3))}function ts(t,e,n){return e=n?Y:e,e=t&&null==e?t.length:e,oi(t,ft,Y,Y,Y,Y,e)}function es(t,e){var n;if("function"!=typeof e)throw new Xs(X);return t=Es(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=Y),n}}function ns(t,e,n){function r(e){var n=l,r=u;return l=u=Y,p=e,h=t.apply(r,n)}function i(t){var n=t-f;return f===Y||n>=e||n<0||m&&t-p>=c}function s(){var t=Ha();return i(t)?o(t):(d=ma(s,function(t){var n=e-(t-f);return m?Co(n,c-(t-p)):n}(t)),Y)}function o(t){return d=Y,v&&l?r(t):(l=u=Y,h)}function a(){var t=Ha(),n=i(t);if(l=arguments,u=this,f=t,n){if(d===Y)return function(t){return p=t,d=ma(s,e),g?r(t):h}(f);if(m)return la(d),d=ma(s,e),r(f)}return d===Y&&(d=ma(s,e)),h}var l,u,c,h,d,f,p=0,g=!1,m=!1,v=!0;if("function"!=typeof t)throw new Xs(X);return e=Ss(e)||0,ds(n)&&(g=!!n.leading,c=(m="maxWait"in n)?Oo(Ss(n.maxWait)||0,e):c,v="trailing"in n?!!n.trailing:v),a.cancel=function(){d!==Y&&la(d),p=0,l=f=u=d=Y},a.flush=function(){return d===Y?h:o(Ha())},a}function rs(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Xs(X);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(rs.Cache||Ge),n}function is(t){if("function"!=typeof t)throw new Xs(X);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function ss(t,e){return t===e||t!=t&&e!=e}function os(t){return null!=t&&hs(t.length)&&!us(t)}function as(t){return fs(t)&&os(t)}function ls(t){if(!fs(t))return!1;var e=vn(t);return e==Ft||e==Mt||"string"==typeof t.message&&"string"==typeof t.name&&!gs(t)}function us(t){if(!ds(t))return!1;var e=vn(t);return e==Nt||e==Ut||e==Ot||e==Vt}function cs(t){return"number"==typeof t&&t==Es(t)}function hs(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=_t}function ds(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function fs(t){return null!=t&&"object"==typeof t}function ps(t){return"number"==typeof t||fs(t)&&vn(t)==$t}function gs(t){if(!fs(t)||vn(t)!=Gt)return!1;var e=po(t);if(null===e)return!0;var n=no.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&eo.call(n)==oo}function ms(t){return"string"==typeof t||!rl(t)&&fs(t)&&vn(t)==Yt}function vs(t){return"symbol"==typeof t||fs(t)&&vn(t)==zt}function ys(t){if(!t)return[];if(os(t))return ms(t)?V(t):Nr(t);if(bo&&t[bo])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[bo]());var e=fa(t);return(e==Bt?B:e==Wt?G:xs)(t)}function bs(t){return t?(t=Ss(t))===St||t===-St?(t<0?-1:1)*wt:t==t?t:0:0===t?t:0}function Es(t){var e=bs(t),n=e%1;return e==e?n?e-n:e:0}function Ts(t){return t?nn(Es(t),0,Lt):0}function Ss(t){if("number"==typeof t)return t;if(vs(t))return At;if(ds(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=ds(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=x(t);var n=Me.test(t);return n||Ne.test(t)?kn(t.slice(2),n?2:8):Pe.test(t)?At:+t}function _s(t){return Ur(t,Is(t))}function ws(t){return null==t?"":br(t)}function As(t,e,n){var r=null==t?Y:gn(t,e);return r===Y?n:r}function Ls(t,e){return null!=t&&Ei(t,e,Sn)}function Rs(t){return os(t)?He(t):Un(t)}function Is(t){return os(t)?He(t,!0):Bn(t)}function Ds(t,e){if(null==t)return{};var n=f(fi(t),(function(t){return[t]}));return e=mi(e),rr(t,n,(function(t,n){return e(t,n[0])}))}function xs(t){return null==t?[]:O(t,Rs(t))}function ks(t){return Fl(ws(t).toLowerCase())}function Os(t){return(t=ws(t))&&t.replace(Be,Yn).replace(En,"")}function Cs(t,e,n){return t=ws(t),(e=n?Y:e)===Y?U(t)?W(t):y(t):t.match(e)||[]}function Ps(t){return function(){return t}}function Ms(t){return t}function Fs(t){return Fn("function"==typeof t?t:rn(t,et))}function Ns(t,e,n){var r=Rs(e),i=pn(e,r);null!=n||ds(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=pn(e,Rs(e)));var s=!(ds(n)&&"chain"in n&&!n.chain),o=us(t);return a(i,(function(n){var r=e[n];t[n]=r,o&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__);return(n.__actions__=Nr(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,p([this.value()],arguments))})})),t}function Us(){}function Bs(t){return Ai(t)?A(Fi(t)):function(t){return function(e){return gn(e,t)}}(t)}function $s(){return[]}function js(){return!1}var Gs=(e=null==e?Pn:Xn.defaults(Pn.Object(),e,Xn.pick(Pn,An))).Array,Ks=e.Date,Vs=e.Error,Hs=e.Function,Ws=e.Math,Ys=e.Object,zs=e.RegExp,qs=e.String,Xs=e.TypeError,Qs=Gs.prototype,Zs=Hs.prototype,Js=Ys.prototype,to=e["__core-js_shared__"],eo=Zs.toString,no=Js.hasOwnProperty,ro=0,io=function(){var t=/[^.]+$/.exec(to&&to.keys&&to.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),so=Js.toString,oo=eo.call(Ys),ao=Pn._,lo=zs("^"+eo.call(no).replace(Se,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),uo=Nn?e.Buffer:Y,co=e.Symbol,ho=e.Uint8Array,fo=uo?uo.allocUnsafe:Y,po=$(Ys.getPrototypeOf,Ys),go=Ys.create,mo=Js.propertyIsEnumerable,vo=Qs.splice,yo=co?co.isConcatSpreadable:Y,bo=co?co.iterator:Y,Eo=co?co.toStringTag:Y,To=function(){try{var t=bi(Ys,"defineProperty");return t({},"",{}),t}catch(t){}}(),So=e.clearTimeout!==Pn.clearTimeout&&e.clearTimeout,_o=Ks&&Ks.now!==Pn.Date.now&&Ks.now,wo=e.setTimeout!==Pn.setTimeout&&e.setTimeout,Ao=Ws.ceil,Lo=Ws.floor,Ro=Ys.getOwnPropertySymbols,Io=uo?uo.isBuffer:Y,Do=e.isFinite,xo=Qs.join,ko=$(Ys.keys,Ys),Oo=Ws.max,Co=Ws.min,Po=Ks.now,Mo=e.parseInt,Fo=Ws.random,No=Qs.reverse,Uo=bi(e,"DataView"),Bo=bi(e,"Map"),$o=bi(e,"Promise"),jo=bi(e,"Set"),Go=bi(e,"WeakMap"),Ko=bi(Ys,"create"),Vo=Go&&new Go,Ho={},Wo=Ni(Uo),Yo=Ni(Bo),zo=Ni($o),qo=Ni(jo),Xo=Ni(Go),Qo=co?co.prototype:Y,Zo=Qo?Qo.valueOf:Y,Jo=Qo?Qo.toString:Y,ta=function(){function t(){}return function(e){if(!ds(e))return{};if(go)return go(e);t.prototype=e;var n=new t;return t.prototype=Y,n}}();n.templateSettings={escape:me,evaluate:ve,interpolate:ye,variable:"",imports:{_:n}},n.prototype=r.prototype,n.prototype.constructor=n,i.prototype=ta(r.prototype),i.prototype.constructor=i,L.prototype=ta(r.prototype),L.prototype.constructor=L,Ae.prototype.clear=function(){this.__data__=Ko?Ko(null):{},this.size=0},Ae.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Ae.prototype.get=function(t){var e=this.__data__;if(Ko){var n=e[t];return n===Z?Y:n}return no.call(e,t)?e[t]:Y},Ae.prototype.has=function(t){var e=this.__data__;return Ko?e[t]!==Y:no.call(e,t)},Ae.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Ko&&e===Y?Z:e,this},De.prototype.clear=function(){this.__data__=[],this.size=0},De.prototype.delete=function(t){var e=this.__data__,n=Qe(e,t);return!(n<0||(n==e.length-1?e.pop():vo.call(e,n,1),--this.size,0))},De.prototype.get=function(t){var e=this.__data__,n=Qe(e,t);return n<0?Y:e[n][1]},De.prototype.has=function(t){return Qe(this.__data__,t)>-1},De.prototype.set=function(t,e){var n=this.__data__,r=Qe(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Ge.prototype.clear=function(){this.size=0,this.__data__={hash:new Ae,map:new(Bo||De),string:new Ae}},Ge.prototype.delete=function(t){var e=vi(this,t).delete(t);return this.size-=e?1:0,e},Ge.prototype.get=function(t){return vi(this,t).get(t)},Ge.prototype.has=function(t){return vi(this,t).has(t)},Ge.prototype.set=function(t,e){var n=vi(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Ke.prototype.add=Ke.prototype.push=function(t){return this.__data__.set(t,Z),this},Ke.prototype.has=function(t){return this.__data__.has(t)},Ve.prototype.clear=function(){this.__data__=new De,this.size=0},Ve.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Ve.prototype.get=function(t){return this.__data__.get(t)},Ve.prototype.has=function(t){return this.__data__.has(t)},Ve.prototype.set=function(t,e){var n=this.__data__;if(n instanceof De){var r=n.__data__;if(!Bo||r.length<z-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ge(r)}return n.set(t,e),this.size=n.size,this};var ea=jr(dn),na=jr(fn,!0),ra=Gr(),ia=Gr(!0),sa=Vo?function(t,e){return Vo.set(t,e),t}:Ms,oa=To?function(t,e){return To(t,"toString",{configurable:!0,enumerable:!1,value:Ps(e),writable:!0})}:Ms,aa=lr,la=So||function(t){return Pn.clearTimeout(t)},ua=jo&&1/G(new jo([,-0]))[1]==St?function(t){return new jo(t)}:Us,ca=Vo?function(t){return Vo.get(t)}:Us,ha=Ro?function(t){return null==t?[]:(t=Ys(t),c(Ro(t),(function(e){return mo.call(t,e)})))}:$s,da=Ro?function(t){for(var e=[];t;)p(e,ha(t)),t=po(t);return e}:$s,fa=vn;(Uo&&fa(new Uo(new ArrayBuffer(1)))!=Jt||Bo&&fa(new Bo)!=Bt||$o&&fa($o.resolve())!=Kt||jo&&fa(new jo)!=Wt||Go&&fa(new Go)!=Xt)&&(fa=function(t){var e=vn(t),n=e==Gt?t.constructor:Y,r=n?Ni(n):"";if(r)switch(r){case Wo:return Jt;case Yo:return Bt;case zo:return Kt;case qo:return Wt;case Xo:return Xt}return e});var pa=to?us:js,ga=Pi(sa),ma=wo||function(t,e){return Pn.setTimeout(t,e)},va=Pi(oa),ya=function(t){var e=rs(t,(function(t){return n.size===J&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Te,(function(t,n,r,i){e.push(r?i.replace(ke,"$1"):n||t)})),e})),ba=lr((function(t,e){return as(t)?an(t,hn(e,1,as,!0)):[]})),Ea=lr((function(t,e){var n=Vi(e);return as(n)&&(n=Y),as(t)?an(t,hn(e,1,as,!0),mi(n,2)):[]})),Ta=lr((function(t,e){var n=Vi(e);return as(n)&&(n=Y),as(t)?an(t,hn(e,1,as,!0),Y,n):[]})),Sa=lr((function(t){var e=f(t,Rr);return e.length&&e[0]===t[0]?_n(e):[]})),_a=lr((function(t){var e=Vi(t),n=f(t,Rr);return e===Vi(n)?e=Y:n.pop(),n.length&&n[0]===t[0]?_n(n,mi(e,2)):[]})),wa=lr((function(t){var e=Vi(t),n=f(t,Rr);return(e="function"==typeof e?e:Y)&&n.pop(),n.length&&n[0]===t[0]?_n(n,Y,e):[]})),Aa=lr(Hi),La=hi((function(t,e){var n=null==t?0:t.length,r=en(t,e);return sr(t,f(e,(function(t){return _i(t,n)?+t:t})).sort(Pr)),r})),Ra=lr((function(t){return Er(hn(t,1,as,!0))})),Ia=lr((function(t){var e=Vi(t);return as(e)&&(e=Y),Er(hn(t,1,as,!0),mi(e,2))})),Da=lr((function(t){var e=Vi(t);return e="function"==typeof e?e:Y,Er(hn(t,1,as,!0),Y,e)})),xa=lr((function(t,e){return as(t)?an(t,e):[]})),ka=lr((function(t){return Ar(c(t,as))})),Oa=lr((function(t){var e=Vi(t);return as(e)&&(e=Y),Ar(c(t,as),mi(e,2))})),Ca=lr((function(t){var e=Vi(t);return e="function"==typeof e?e:Y,Ar(c(t,as),Y,e)})),Pa=lr(Yi),Ma=lr((function(t){var e=t.length,n=e>1?t[e-1]:Y;return n="function"==typeof n?(t.pop(),n):Y,zi(t,n)})),Fa=hi((function(t){var e=t.length,n=e?t[0]:0,r=this.__wrapped__,s=function(e){return en(e,t)};return!(e>1||this.__actions__.length)&&r instanceof L&&_i(n)?((r=r.slice(n,+n+(e?1:0))).__actions__.push({func:Xi,args:[s],thisArg:Y}),new i(r,this.__chain__).thru((function(t){return e&&!t.length&&t.push(Y),t}))):this.thru(s)})),Na=Br((function(t,e,n){no.call(t,n)?++t[n]:tn(t,n,1)})),Ua=Yr($i),Ba=Yr(ji),$a=Br((function(t,e,n){no.call(t,n)?t[n].push(e):tn(t,n,[e])})),ja=lr((function(t,e,n){var r=-1,i="function"==typeof e,o=os(t)?Gs(t.length):[];return ea(t,(function(t){o[++r]=i?s(e,t,n):wn(t,e,n)})),o})),Ga=Br((function(t,e,n){tn(t,n,e)})),Ka=Br((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]})),Va=lr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&wi(t,e[0],e[1])?e=[]:n>2&&wi(e[0],e[1],e[2])&&(e=[e[0]]),nr(t,hn(e,1),[])})),Ha=_o||function(){return Pn.Date.now()},Wa=lr((function(t,e,n){var r=ot;if(n.length){var i=j(n,gi(Wa));r|=ht}return oi(t,r,e,n,i)})),Ya=lr((function(t,e,n){var r=ot|at;if(n.length){var i=j(n,gi(Ya));r|=ht}return oi(e,r,t,n,i)})),za=lr((function(t,e){return on(t,1,e)})),qa=lr((function(t,e,n){return on(t,Ss(e)||0,n)}));rs.Cache=Ge;var Xa=aa((function(t,e){var n=(e=1==e.length&&rl(e[0])?f(e[0],k(mi())):f(hn(e,1),k(mi()))).length;return lr((function(r){for(var i=-1,o=Co(r.length,n);++i<o;)r[i]=e[i].call(this,r[i]);return s(t,this,r)}))})),Qa=lr((function(t,e){return oi(t,ht,Y,e,j(e,gi(Qa)))})),Za=lr((function(t,e){return oi(t,dt,Y,e,j(e,gi(Za)))})),Ja=hi((function(t,e){return oi(t,pt,Y,Y,Y,e)})),tl=ni(yn),el=ni((function(t,e){return t>=e})),nl=Dn(function(){return arguments}())?Dn:function(t){return fs(t)&&no.call(t,"callee")&&!mo.call(t,"callee")},rl=Gs.isArray,il=$n?k($n):function(t){return fs(t)&&vn(t)==Zt},sl=Io||js,ol=jn?k(jn):function(t){return fs(t)&&vn(t)==Pt},al=Gn?k(Gn):function(t){return fs(t)&&fa(t)==Bt},ll=Kn?k(Kn):function(t){return fs(t)&&vn(t)==Ht},ul=Vn?k(Vn):function(t){return fs(t)&&fa(t)==Wt},cl=Hn?k(Hn):function(t){return fs(t)&&hs(t.length)&&!!Rn[vn(t)]},hl=ni(Wn),dl=ni((function(t,e){return t<=e})),fl=$r((function(t,e){if(Ri(e)||os(e))return Ur(e,Rs(e),t),Y;for(var n in e)no.call(e,n)&&Xe(t,n,e[n])})),pl=$r((function(t,e){Ur(e,Is(e),t)})),gl=$r((function(t,e,n,r){Ur(e,Is(e),t,r)})),ml=$r((function(t,e,n,r){Ur(e,Rs(e),t,r)})),vl=hi(en),yl=lr((function(t,e){t=Ys(t);var n=-1,r=e.length,i=r>2?e[2]:Y;for(i&&wi(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],o=Is(s),a=-1,l=o.length;++a<l;){var u=o[a],c=t[u];(c===Y||ss(c,Js[u])&&!no.call(t,u))&&(t[u]=s[u])}return t})),bl=lr((function(t){return t.push(Y,li),s(wl,Y,t)})),El=Xr((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=so.call(e)),t[e]=n}),Ps(Ms)),Tl=Xr((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=so.call(e)),no.call(t,e)?t[e].push(n):t[e]=[n]}),mi),Sl=lr(wn),_l=$r((function(t,e,n){tr(t,e,n)})),wl=$r((function(t,e,n,r){tr(t,e,n,r)})),Al=hi((function(t,e){var n={};if(null==t)return n;var r=!1;e=f(e,(function(e){return e=Dr(e,t),r||(r=e.length>1),e})),Ur(t,fi(t),n),r&&(n=rn(n,et|nt|rt,ui));for(var i=e.length;i--;)Tr(n,e[i]);return n})),Ll=hi((function(t,e){return null==t?{}:function(t,e){return rr(t,e,(function(e,n){return Ls(t,n)}))}(t,e)})),Rl=si(Rs),Il=si(Is),Dl=Vr((function(t,e,n){return e=e.toLowerCase(),t+(n?ks(e):e)})),xl=Vr((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),kl=Vr((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),Ol=Kr("toLowerCase"),Cl=Vr((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()})),Pl=Vr((function(t,e,n){return t+(n?" ":"")+Fl(e)})),Ml=Vr((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Fl=Kr("toUpperCase"),Nl=lr((function(t,e){try{return s(t,Y,e)}catch(t){return ls(t)?t:new Vs(t)}})),Ul=hi((function(t,e){return a(e,(function(e){e=Fi(e),tn(t,e,Wa(t[e],t))})),t})),Bl=zr(),$l=zr(!0),jl=lr((function(t,e){return function(n){return wn(n,t,e)}})),Gl=lr((function(t,e){return function(n){return wn(t,n,e)}})),Kl=Zr(f),Vl=Zr(u),Hl=Zr(v),Wl=ei(),Yl=ei(!0),zl=Qr((function(t,e){return t+e}),0),ql=ii("ceil"),Xl=Qr((function(t,e){return t/e}),1),Ql=ii("floor"),Zl=Qr((function(t,e){return t*e}),1),Jl=ii("round"),tu=Qr((function(t,e){return t-e}),0);return n.after=function(t,e){if("function"!=typeof e)throw new Xs(X);return t=Es(t),function(){if(--t<1)return e.apply(this,arguments)}},n.ary=ts,n.assign=fl,n.assignIn=pl,n.assignInWith=gl,n.assignWith=ml,n.at=vl,n.before=es,n.bind=Wa,n.bindAll=Ul,n.bindKey=Ya,n.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return rl(t)?t:[t]},n.chain=qi,n.chunk=function(t,e,n){e=(n?wi(t,e,n):e===Y)?1:Oo(Es(e),0);var r=null==t?0:t.length;if(!r||e<1)return[];for(var i=0,s=0,o=Gs(Ao(r/e));i<r;)o[s++]=fr(t,i,i+=e);return o},n.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i},n.concat=function(){var t=arguments.length;if(!t)return[];for(var e=Gs(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return p(rl(n)?Nr(n):[n],hn(e,1))},n.cond=function(t){var e=null==t?0:t.length,n=mi();return t=e?f(t,(function(t){if("function"!=typeof t[1])throw new Xs(X);return[n(t[0]),t[1]]})):[],lr((function(n){for(var r=-1;++r<e;){var i=t[r];if(s(i[0],this,n))return s(i[1],this,n)}}))},n.conforms=function(t){return function(t){var e=Rs(t);return function(n){return sn(n,t,e)}}(rn(t,et))},n.constant=Ps,n.countBy=Na,n.create=function(t,e){var n=ta(t);return null==e?n:Je(n,e)},n.curry=function t(e,n,r){var i=oi(e,ut,Y,Y,Y,Y,Y,n=r?Y:n);return i.placeholder=t.placeholder,i},n.curryRight=function t(e,n,r){var i=oi(e,ct,Y,Y,Y,Y,Y,n=r?Y:n);return i.placeholder=t.placeholder,i},n.debounce=ns,n.defaults=yl,n.defaultsDeep=bl,n.defer=za,n.delay=qa,n.difference=ba,n.differenceBy=Ea,n.differenceWith=Ta,n.drop=function(t,e,n){var r=null==t?0:t.length;return r?fr(t,(e=n||e===Y?1:Es(e))<0?0:e,r):[]},n.dropRight=function(t,e,n){var r=null==t?0:t.length;return r?fr(t,0,(e=r-(e=n||e===Y?1:Es(e)))<0?0:e):[]},n.dropRightWhile=function(t,e){return t&&t.length?_r(t,mi(e,3),!0,!0):[]},n.dropWhile=function(t,e){return t&&t.length?_r(t,mi(e,3),!0):[]},n.fill=function(t,e,n,r){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&wi(t,e,n)&&(n=0,r=i),function(t,e,n,r){var i=t.length;for((n=Es(n))<0&&(n=-n>i?0:i+n),(r=r===Y||r>i?i:Es(r))<0&&(r+=i),r=n>r?0:Ts(r);n<r;)t[n++]=e;return t}(t,e,n,r)):[]},n.filter=function(t,e){return(rl(t)?c:cn)(t,mi(e,3))},n.flatMap=function(t,e){return hn(Ji(t,e),1)},n.flatMapDeep=function(t,e){return hn(Ji(t,e),St)},n.flatMapDepth=function(t,e,n){return n=n===Y?1:Es(n),hn(Ji(t,e),n)},n.flatten=Gi,n.flattenDeep=function(t){return null!=t&&t.length?hn(t,St):[]},n.flattenDepth=function(t,e){return null!=t&&t.length?hn(t,e=e===Y?1:Es(e)):[]},n.flip=function(t){return oi(t,gt)},n.flow=Bl,n.flowRight=$l,n.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},n.functions=function(t){return null==t?[]:pn(t,Rs(t))},n.functionsIn=function(t){return null==t?[]:pn(t,Is(t))},n.groupBy=$a,n.initial=function(t){return null!=t&&t.length?fr(t,0,-1):[]},n.intersection=Sa,n.intersectionBy=_a,n.intersectionWith=wa,n.invert=El,n.invertBy=Tl,n.invokeMap=ja,n.iteratee=Fs,n.keyBy=Ga,n.keys=Rs,n.keysIn=Is,n.map=Ji,n.mapKeys=function(t,e){var n={};return e=mi(e,3),dn(t,(function(t,r,i){tn(n,e(t,r,i),t)})),n},n.mapValues=function(t,e){var n={};return e=mi(e,3),dn(t,(function(t,r,i){tn(n,r,e(t,r,i))})),n},n.matches=function(t){return Zn(rn(t,et))},n.matchesProperty=function(t,e){return Jn(t,rn(e,et))},n.memoize=rs,n.merge=_l,n.mergeWith=wl,n.method=jl,n.methodOf=Gl,n.mixin=Ns,n.negate=is,n.nthArg=function(t){return t=Es(t),lr((function(e){return er(e,t)}))},n.omit=Al,n.omitBy=function(t,e){return Ds(t,is(mi(e)))},n.once=function(t){return es(2,t)},n.orderBy=function(t,e,n,r){return null==t?[]:(rl(e)||(e=null==e?[]:[e]),rl(n=r?Y:n)||(n=null==n?[]:[n]),nr(t,e,n))},n.over=Kl,n.overArgs=Xa,n.overEvery=Vl,n.overSome=Hl,n.partial=Qa,n.partialRight=Za,n.partition=Ka,n.pick=Ll,n.pickBy=Ds,n.property=Bs,n.propertyOf=function(t){return function(e){return null==t?Y:gn(t,e)}},n.pull=Aa,n.pullAll=Hi,n.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?ir(t,e,mi(n,2)):t},n.pullAllWith=function(t,e,n){return t&&t.length&&e&&e.length?ir(t,e,Y,n):t},n.pullAt=La,n.range=Wl,n.rangeRight=Yl,n.rearg=Ja,n.reject=function(t,e){return(rl(t)?c:cn)(t,is(mi(e,3)))},n.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],s=t.length;for(e=mi(e,3);++r<s;){var o=t[r];e(o,r,t)&&(n.push(o),i.push(r))}return sr(t,i),n},n.rest=function(t,e){if("function"!=typeof t)throw new Xs(X);return lr(t,e=e===Y?e:Es(e))},n.reverse=Wi,n.sampleSize=function(t,e,n){return e=(n?wi(t,e,n):e===Y)?1:Es(e),(rl(t)?Ye:cr)(t,e)},n.set=function(t,e,n){return null==t?t:hr(t,e,n)},n.setWith=function(t,e,n,r){return r="function"==typeof r?r:Y,null==t?t:hr(t,e,n,r)},n.shuffle=function(t){return(rl(t)?ze:dr)(t)},n.slice=function(t,e,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&wi(t,e,n)?(e=0,n=r):(e=null==e?0:Es(e),n=n===Y?r:Es(n)),fr(t,e,n)):[]},n.sortBy=Va,n.sortedUniq=function(t){return t&&t.length?vr(t):[]},n.sortedUniqBy=function(t,e){return t&&t.length?vr(t,mi(e,2)):[]},n.split=function(t,e,n){return n&&"number"!=typeof n&&wi(t,e,n)&&(e=n=Y),(n=n===Y?Lt:n>>>0)?(t=ws(t))&&("string"==typeof e||null!=e&&!ll(e))&&(!(e=br(e))&&N(t))?xr(V(t),0,n):t.split(e,n):[]},n.spread=function(t,e){if("function"!=typeof t)throw new Xs(X);return e=null==e?0:Oo(Es(e),0),lr((function(n){var r=n[e],i=xr(n,0,e);return r&&p(i,r),s(t,this,i)}))},n.tail=function(t){var e=null==t?0:t.length;return e?fr(t,1,e):[]},n.take=function(t,e,n){return t&&t.length?fr(t,0,(e=n||e===Y?1:Es(e))<0?0:e):[]},n.takeRight=function(t,e,n){var r=null==t?0:t.length;return r?fr(t,(e=r-(e=n||e===Y?1:Es(e)))<0?0:e,r):[]},n.takeRightWhile=function(t,e){return t&&t.length?_r(t,mi(e,3),!1,!0):[]},n.takeWhile=function(t,e){return t&&t.length?_r(t,mi(e,3)):[]},n.tap=function(t,e){return e(t),t},n.throttle=function(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new Xs(X);return ds(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),ns(t,e,{leading:r,maxWait:e,trailing:i})},n.thru=Xi,n.toArray=ys,n.toPairs=Rl,n.toPairsIn=Il,n.toPath=function(t){return rl(t)?f(t,Fi):vs(t)?[t]:Nr(ya(ws(t)))},n.toPlainObject=_s,n.transform=function(t,e,n){var r=rl(t),i=r||sl(t)||cl(t);if(e=mi(e,4),null==n){var s=t&&t.constructor;n=i?r?new s:[]:ds(t)&&us(s)?ta(po(t)):{}}return(i?a:dn)(t,(function(t,r,i){return e(n,t,r,i)})),n},n.unary=function(t){return ts(t,1)},n.union=Ra,n.unionBy=Ia,n.unionWith=Da,n.uniq=function(t){return t&&t.length?Er(t):[]},n.uniqBy=function(t,e){return t&&t.length?Er(t,mi(e,2)):[]},n.uniqWith=function(t,e){return e="function"==typeof e?e:Y,t&&t.length?Er(t,Y,e):[]},n.unset=function(t,e){return null==t||Tr(t,e)},n.unzip=Yi,n.unzipWith=zi,n.update=function(t,e,n){return null==t?t:Sr(t,e,Ir(n))},n.updateWith=function(t,e,n,r){return r="function"==typeof r?r:Y,null==t?t:Sr(t,e,Ir(n),r)},n.values=xs,n.valuesIn=function(t){return null==t?[]:O(t,Is(t))},n.without=xa,n.words=Cs,n.wrap=function(t,e){return Qa(Ir(e),t)},n.xor=ka,n.xorBy=Oa,n.xorWith=Ca,n.zip=Pa,n.zipObject=function(t,e){return Lr(t||[],e||[],Xe)},n.zipObjectDeep=function(t,e){return Lr(t||[],e||[],hr)},n.zipWith=Ma,n.entries=Rl,n.entriesIn=Il,n.extend=pl,n.extendWith=gl,Ns(n,n),n.add=zl,n.attempt=Nl,n.camelCase=Dl,n.capitalize=ks,n.ceil=ql,n.clamp=function(t,e,n){return n===Y&&(n=e,e=Y),n!==Y&&(n=(n=Ss(n))==n?n:0),e!==Y&&(e=(e=Ss(e))==e?e:0),nn(Ss(t),e,n)},n.clone=function(t){return rn(t,rt)},n.cloneDeep=function(t){return rn(t,et|rt)},n.cloneDeepWith=function(t,e){return rn(t,et|rt,e="function"==typeof e?e:Y)},n.cloneWith=function(t,e){return rn(t,rt,e="function"==typeof e?e:Y)},n.conformsTo=function(t,e){return null==e||sn(t,e,Rs(e))},n.deburr=Os,n.defaultTo=function(t,e){return null==t||t!=t?e:t},n.divide=Xl,n.endsWith=function(t,e,n){t=ws(t),e=br(e);var r=t.length,i=n=n===Y?r:nn(Es(n),0,r);return(n-=e.length)>=0&&t.slice(n,i)==e},n.eq=ss,n.escape=function(t){return(t=ws(t))&&ge.test(t)?t.replace(fe,zn):t},n.escapeRegExp=function(t){return(t=ws(t))&&_e.test(t)?t.replace(Se,"\\$&"):t},n.every=function(t,e,n){var r=rl(t)?u:ln;return n&&wi(t,e,n)&&(e=Y),r(t,mi(e,3))},n.find=Ua,n.findIndex=$i,n.findKey=function(t,e){return b(t,mi(e,3),dn)},n.findLast=Ba,n.findLastIndex=ji,n.findLastKey=function(t,e){return b(t,mi(e,3),fn)},n.floor=Ql,n.forEach=Qi,n.forEachRight=Zi,n.forIn=function(t,e){return null==t?t:ra(t,mi(e,3),Is)},n.forInRight=function(t,e){return null==t?t:ia(t,mi(e,3),Is)},n.forOwn=function(t,e){return t&&dn(t,mi(e,3))},n.forOwnRight=function(t,e){return t&&fn(t,mi(e,3))},n.get=As,n.gt=tl,n.gte=el,n.has=function(t,e){return null!=t&&Ei(t,e,Tn)},n.hasIn=Ls,n.head=Ki,n.identity=Ms,n.includes=function(t,e,n,r){t=os(t)?t:xs(t),n=n&&!r?Es(n):0;var i=t.length;return n<0&&(n=Oo(i+n,0)),ms(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&T(t,e,n)>-1},n.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Es(n);return i<0&&(i=Oo(r+i,0)),T(t,e,i)},n.inRange=function(t,e,n){return e=bs(e),n===Y?(n=e,e=0):n=bs(n),function(t,e,n){return t>=Co(e,n)&&t<Oo(e,n)}(t=Ss(t),e,n)},n.invoke=Sl,n.isArguments=nl,n.isArray=rl,n.isArrayBuffer=il,n.isArrayLike=os,n.isArrayLikeObject=as,n.isBoolean=function(t){return!0===t||!1===t||fs(t)&&vn(t)==Ct},n.isBuffer=sl,n.isDate=ol,n.isElement=function(t){return fs(t)&&1===t.nodeType&&!gs(t)},n.isEmpty=function(t){if(null==t)return!0;if(os(t)&&(rl(t)||"string"==typeof t||"function"==typeof t.splice||sl(t)||cl(t)||nl(t)))return!t.length;var e=fa(t);if(e==Bt||e==Wt)return!t.size;if(Ri(t))return!Un(t).length;for(var n in t)if(no.call(t,n))return!1;return!0},n.isEqual=function(t,e){return On(t,e)},n.isEqualWith=function(t,e,n){var r=(n="function"==typeof n?n:Y)?n(t,e):Y;return r===Y?On(t,e,Y,n):!!r},n.isError=ls,n.isFinite=function(t){return"number"==typeof t&&Do(t)},n.isFunction=us,n.isInteger=cs,n.isLength=hs,n.isMap=al,n.isMatch=function(t,e){return t===e||Cn(t,e,yi(e))},n.isMatchWith=function(t,e,n){return n="function"==typeof n?n:Y,Cn(t,e,yi(e),n)},n.isNaN=function(t){return ps(t)&&t!=+t},n.isNative=function(t){if(pa(t))throw new Vs(q);return Mn(t)},n.isNil=function(t){return null==t},n.isNull=function(t){return null===t},n.isNumber=ps,n.isObject=ds,n.isObjectLike=fs,n.isPlainObject=gs,n.isRegExp=ll,n.isSafeInteger=function(t){return cs(t)&&t>=-_t&&t<=_t},n.isSet=ul,n.isString=ms,n.isSymbol=vs,n.isTypedArray=cl,n.isUndefined=function(t){return t===Y},n.isWeakMap=function(t){return fs(t)&&fa(t)==Xt},n.isWeakSet=function(t){return fs(t)&&vn(t)==Qt},n.join=function(t,e){return null==t?"":xo.call(t,e)},n.kebabCase=xl,n.last=Vi,n.lastIndexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r;return n!==Y&&(i=(i=Es(n))<0?Oo(r+i,0):Co(i,r-1)),e==e?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(t,e,i):E(t,_,i,!0)},n.lowerCase=kl,n.lowerFirst=Ol,n.lt=hl,n.lte=dl,n.max=function(t){return t&&t.length?un(t,Ms,yn):Y},n.maxBy=function(t,e){return t&&t.length?un(t,mi(e,2),yn):Y},n.mean=function(t){return w(t,Ms)},n.meanBy=function(t,e){return w(t,mi(e,2))},n.min=function(t){return t&&t.length?un(t,Ms,Wn):Y},n.minBy=function(t,e){return t&&t.length?un(t,mi(e,2),Wn):Y},n.stubArray=$s,n.stubFalse=js,n.stubObject=function(){return{}},n.stubString=function(){return""},n.stubTrue=function(){return!0},n.multiply=Zl,n.nth=function(t,e){return t&&t.length?er(t,Es(e)):Y},n.noConflict=function(){return Pn._===this&&(Pn._=ao),this},n.noop=Us,n.now=Ha,n.pad=function(t,e,n){t=ws(t);var r=(e=Es(e))?K(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Jr(Lo(i),n)+t+Jr(Ao(i),n)},n.padEnd=function(t,e,n){t=ws(t);var r=(e=Es(e))?K(t):0;return e&&r<e?t+Jr(e-r,n):t},n.padStart=function(t,e,n){t=ws(t);var r=(e=Es(e))?K(t):0;return e&&r<e?Jr(e-r,n)+t:t},n.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),Mo(ws(t).replace(we,""),e||0)},n.random=function(t,e,n){if(n&&"boolean"!=typeof n&&wi(t,e,n)&&(e=n=Y),n===Y&&("boolean"==typeof e?(n=e,e=Y):"boolean"==typeof t&&(n=t,t=Y)),t===Y&&e===Y?(t=0,e=1):(t=bs(t),e===Y?(e=t,t=0):e=bs(e)),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var i=Fo();return Co(t+i*(e-t+xn("1e-"+((i+"").length-1))),e)}return or(t,e)},n.reduce=function(t,e,n){var r=rl(t)?g:R,i=arguments.length<3;return r(t,mi(e,4),n,i,ea)},n.reduceRight=function(t,e,n){var r=rl(t)?m:R,i=arguments.length<3;return r(t,mi(e,4),n,i,na)},n.repeat=function(t,e,n){return e=(n?wi(t,e,n):e===Y)?1:Es(e),ar(ws(t),e)},n.replace=function(){var t=arguments,e=ws(t[0]);return t.length<3?e:e.replace(t[1],t[2])},n.result=function(t,e,n){var r=-1,i=(e=Dr(e,t)).length;for(i||(i=1,t=Y);++r<i;){var s=null==t?Y:t[Fi(e[r])];s===Y&&(r=i,s=n),t=us(s)?s.call(t):s}return t},n.round=Jl,n.runInContext=t,n.sample=function(t){return(rl(t)?We:ur)(t)},n.size=function(t){if(null==t)return 0;if(os(t))return ms(t)?K(t):t.length;var e=fa(t);return e==Bt||e==Wt?t.size:Un(t).length},n.snakeCase=Cl,n.some=function(t,e,n){var r=rl(t)?v:pr;return n&&wi(t,e,n)&&(e=Y),r(t,mi(e,3))},n.sortedIndex=function(t,e){return gr(t,e)},n.sortedIndexBy=function(t,e,n){return mr(t,e,mi(n,2))},n.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=gr(t,e);if(r<n&&ss(t[r],e))return r}return-1},n.sortedLastIndex=function(t,e){return gr(t,e,!0)},n.sortedLastIndexBy=function(t,e,n){return mr(t,e,mi(n,2),!0)},n.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var n=gr(t,e,!0)-1;if(ss(t[n],e))return n}return-1},n.startCase=Pl,n.startsWith=function(t,e,n){return t=ws(t),n=null==n?0:nn(Es(n),0,t.length),e=br(e),t.slice(n,n+e.length)==e},n.subtract=tu,n.sum=function(t){return t&&t.length?I(t,Ms):0},n.sumBy=function(t,e){return t&&t.length?I(t,mi(e,2)):0},n.template=function(t,e,r){var i=n.templateSettings;r&&wi(t,e,r)&&(e=Y),t=ws(t),e=gl({},e,i,ai);var s,o,a=gl({},e.imports,i.imports,ai),l=Rs(a),u=O(a,l),c=0,h=e.interpolate||$e,d="__p += '",f=zs((e.escape||$e).source+"|"+h.source+"|"+(h===ye?Oe:$e).source+"|"+(e.evaluate||$e).source+"|$","g"),p="//# sourceURL="+(no.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ln+"]")+"\n";t.replace(f,(function(e,n,r,i,a,l){return r||(r=i),d+=t.slice(c,l).replace(je,F),n&&(s=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=l+e.length,e})),d+="';\n";var g=no.call(e,"variable")&&e.variable;if(g){if(xe.test(g))throw new Vs(Q)}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(ue,""):d).replace(ce,"$1").replace(he,"$1;"),d="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var m=Nl((function(){return Hs(l,p+"return "+d).apply(Y,u)}));if(m.source=d,ls(m))throw m;return m},n.times=function(t,e){if((t=Es(t))<1||t>_t)return[];var n=Lt,r=Co(t,Lt);e=mi(e),t-=Lt;for(var i=D(r,e);++n<t;)e(n);return i},n.toFinite=bs,n.toInteger=Es,n.toLength=Ts,n.toLower=function(t){return ws(t).toLowerCase()},n.toNumber=Ss,n.toSafeInteger=function(t){return t?nn(Es(t),-_t,_t):0===t?t:0},n.toString=ws,n.toUpper=function(t){return ws(t).toUpperCase()},n.trim=function(t,e,n){if((t=ws(t))&&(n||e===Y))return x(t);if(!t||!(e=br(e)))return t;var r=V(t),i=V(e);return xr(r,P(r,i),M(r,i)+1).join("")},n.trimEnd=function(t,e,n){if((t=ws(t))&&(n||e===Y))return t.slice(0,H(t)+1);if(!t||!(e=br(e)))return t;var r=V(t);return xr(r,0,M(r,V(e))+1).join("")},n.trimStart=function(t,e,n){if((t=ws(t))&&(n||e===Y))return t.replace(we,"");if(!t||!(e=br(e)))return t;var r=V(t);return xr(r,P(r,V(e))).join("")},n.truncate=function(t,e){var n=mt,r=vt;if(ds(e)){var i="separator"in e?e.separator:i;n="length"in e?Es(e.length):n,r="omission"in e?br(e.omission):r}var s=(t=ws(t)).length;if(N(t)){var o=V(t);s=o.length}if(n>=s)return t;var a=n-K(r);if(a<1)return r;var l=o?xr(o,0,a).join(""):t.slice(0,a);if(i===Y)return l+r;if(o&&(a+=l.length-a),ll(i)){if(t.slice(a).search(i)){var u,c=l;for(i.global||(i=zs(i.source,ws(Ce.exec(i))+"g")),i.lastIndex=0;u=i.exec(c);)var h=u.index;l=l.slice(0,h===Y?a:h)}}else if(t.indexOf(br(i),a)!=a){var d=l.lastIndexOf(i);d>-1&&(l=l.slice(0,d))}return l+r},n.unescape=function(t){return(t=ws(t))&&pe.test(t)?t.replace(de,qn):t},n.uniqueId=function(t){var e=++ro;return ws(t)+e},n.upperCase=Ml,n.upperFirst=Fl,n.each=Qi,n.eachRight=Zi,n.first=Ki,Ns(n,function(){var t={};return dn(n,(function(e,r){no.call(n.prototype,r)||(t[r]=e)})),t}(),{chain:!1}),n.VERSION="4.17.21",a(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){n[t].placeholder=n})),a(["drop","take"],(function(t,e){L.prototype[t]=function(n){n=n===Y?1:Oo(Es(n),0);var r=this.__filtered__&&!e?new L(this):this.clone();return r.__filtered__?r.__takeCount__=Co(n,r.__takeCount__):r.__views__.push({size:Co(n,Lt),type:t+(r.__dir__<0?"Right":"")}),r},L.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),a(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=n==Et||3==n;L.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:mi(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),a(["head","last"],(function(t,e){var n="take"+(e?"Right":"");L.prototype[t]=function(){return this[n](1).value()[0]}})),a(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");L.prototype[t]=function(){return this.__filtered__?new L(this):this[n](1)}})),L.prototype.compact=function(){return this.filter(Ms)},L.prototype.find=function(t){return this.filter(t).head()},L.prototype.findLast=function(t){return this.reverse().find(t)},L.prototype.invokeMap=lr((function(t,e){return"function"==typeof t?new L(this):this.map((function(n){return wn(n,t,e)}))})),L.prototype.reject=function(t){return this.filter(is(mi(t)))},L.prototype.slice=function(t,e){t=Es(t);var n=this;return n.__filtered__&&(t>0||e<0)?new L(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==Y&&(n=(e=Es(e))<0?n.dropRight(-e):n.take(e-t)),n)},L.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},L.prototype.toArray=function(){return this.take(Lt)},dn(L.prototype,(function(t,e){var r=/^(?:filter|find|map|reject)|While$/.test(e),s=/^(?:head|last)$/.test(e),o=n[s?"take"+("last"==e?"Right":""):e],a=s||/^find/.test(e);o&&(n.prototype[e]=function(){var e=this.__wrapped__,l=s?[1]:arguments,u=e instanceof L,c=l[0],h=u||rl(e),d=function(t){var e=o.apply(n,p([t],l));return s&&f?e[0]:e};h&&r&&"function"==typeof c&&1!=c.length&&(u=h=!1);var f=this.__chain__,g=!!this.__actions__.length,m=a&&!f,v=u&&!g;if(!a&&h){e=v?e:new L(this);var y=t.apply(e,l);return y.__actions__.push({func:Xi,args:[d],thisArg:Y}),new i(y,f)}return m&&v?t.apply(this,l):(y=this.thru(d),m?s?y.value()[0]:y.value():y)})})),a(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Qs[t],r=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",i=/^(?:pop|shift)$/.test(t);n.prototype[t]=function(){var t=arguments;if(i&&!this.__chain__){var n=this.value();return e.apply(rl(n)?n:[],t)}return this[r]((function(n){return e.apply(rl(n)?n:[],t)}))}})),dn(L.prototype,(function(t,e){var r=n[e];if(r){var i=r.name+"";no.call(Ho,i)||(Ho[i]=[]),Ho[i].push({name:e,func:r})}})),Ho[qr(Y,at).name]=[{name:"wrapper",func:Y}],L.prototype.clone=function(){var t=new L(this.__wrapped__);return t.__actions__=Nr(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Nr(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Nr(this.__views__),t},L.prototype.reverse=function(){if(this.__filtered__){var t=new L(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},L.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=rl(t),r=e<0,i=n?t.length:0,s=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var s=n[r],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=Co(e,t+o);break;case"takeRight":t=Oo(t,e-o)}}return{start:t,end:e}}(0,i,this.__views__),o=s.start,a=s.end,l=a-o,u=r?a:o-1,c=this.__iteratees__,h=c.length,d=0,f=Co(l,this.__takeCount__);if(!n||!r&&i==l&&f==l)return wr(t,this.__actions__);var p=[];t:for(;l--&&d<f;){for(var g=-1,m=t[u+=e];++g<h;){var v=c[g],y=v.iteratee,b=v.type,E=y(m);if(b==Tt)m=E;else if(!E){if(b==Et)continue t;break t}}p[d++]=m}return p},n.prototype.at=Fa,n.prototype.chain=function(){return qi(this)},n.prototype.commit=function(){return new i(this.value(),this.__chain__)},n.prototype.next=function(){this.__values__===Y&&(this.__values__=ys(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?Y:this.__values__[this.__index__++]}},n.prototype.plant=function(t){for(var e,n=this;n instanceof r;){var i=Bi(n);i.__index__=0,i.__values__=Y,e?s.__wrapped__=i:e=i;var s=i;n=n.__wrapped__}return s.__wrapped__=t,e},n.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof L){var e=t;return this.__actions__.length&&(e=new L(this)),(e=e.reverse()).__actions__.push({func:Xi,args:[Wi],thisArg:Y}),new i(e,this.__chain__)}return this.thru(Wi)},n.prototype.toJSON=n.prototype.valueOf=n.prototype.value=function(){return wr(this.__wrapped__,this.__actions__)},n.prototype.first=n.prototype.head,bo&&(n.prototype[bo]=function(){return this}),n}();Pn._=Xn,void 0===(i=function(){return Xn}.call(e,n,e,r))||(r.exports=i)}).call(this)}).call(this,n("yLpj"),n("YuTi")(t))},lfgM:function(t,e,n){"use strict";n("Bn6e"),n("t9yM"),n("3cf4"),n("mT0p"),n("Z6su"),n("UcAE"),n("AN8w"),n("uk4h"),n("sT5T"),n("Q14B"),n("XOUN"),n("ULeP"),n("z2Ax"),n("Tei2"),n("f3ws"),n("WORc"),n("zp1X"),n("DzzY"),n("svpg"),n("kLJ4"),n("rGa6"),n("Xqcm"),n("kQVp")},mT0p:function(t,e,n){},myfl:function(t,e,n){var r=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof m?e:m,s=Object.create(i.prototype),o=new I(r||[]);return s._invoke=function(t,e,n){var r=h;return function(i,s){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw s;return x()}for(n.method=i,n.arg=s;;){var o=n.delegate;if(o){var a=A(o,n);if(a){if(a===g)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var l=c(t,e,n);if("normal"===l.type){if(r=n.done?p:d,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=p,n.method="throw",n.arg=l.arg)}}}(t,n,o),s}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var h="suspendedStart",d="suspendedYield",f="executing",p="completed",g={};function m(){}function v(){}function y(){}var b={};b[s]=function(){return this};var E=Object.getPrototypeOf,T=E&&E(E(D([])));T&&T!==n&&r.call(T,s)&&(b=T);var S=y.prototype=m.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var n;this._invoke=function(i,s){function o(){return new e((function(n,o){!function n(i,s,o,a){var l=c(t[i],t,s);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"==typeof h&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(h).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,a)}))}a(l.arg)}(i,s,n,o)}))}return n=n?n.then(o,o):o()}}function A(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method))return g;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=c(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var s=i.arg;return s?s.done?(n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function R(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function D(t){if(t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:x}}function x(){return{value:e,done:!0}}return v.prototype=S.constructor=y,y.constructor=v,v.displayName=l(y,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,l(t,a,"GeneratorFunction")),t.prototype=Object.create(S),t},t.awrap=function(t){return{__await:t}},_(w.prototype),w.prototype[o]=function(){return this},t.AsyncIterator=w,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var o=new w(u(e,n,r,i),s);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},_(S),l(S,a,"Generator"),S[s]=function(){return this},S.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=D,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return a.type="throw",a.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),R(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;R(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:D(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},"odD/":function(t,e,n){},"qF/U":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=(t,e)=>n=>{const r={value:t};return Object.defineProperties(n,{currentTarget:r,target:r}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)}},r7EE:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=(t,e,n,r,i,s,o,a)=>(class extends r{constructor(t={},e=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY){super();const{timingProviderSource:r,vector:a}=void 0===t.update?{timingProviderSource:null,vector:t}:{timingProviderSource:t,vector:{}};if(this._endPosition=null===r?n:r.endPosition,this._onchange=null,this._onerror=null,this._onreadystatechange=null,this._readyState=null===r?"open":r.readyState,this._skew=null===r?0:r.skew,this._startPosition=null===r?e:r.startPosition,this._timingProviderSource=r,this._timeoutId=null,this._vector=null===r?{acceleration:0,position:0,velocity:0,...i(a),timestamp:s.now()/1e3}:r.vector,n<this._vector.position&&(this._vector={...this._vector,acceleration:0,position:n,velocity:0}),e>this._vector.position&&(this._vector={...this._vector,acceleration:0,position:e,velocity:0}),this._setInternalTimeout(),null===r)o(()=>this.dispatchEvent(new Event("readystatechange")));else{const t=()=>{this._skew=r.skew},e=()=>this._setInternalVector(r.vector),n=()=>{this._isAllowedTransition(r.readyState)?this._readyState=r.readyState:(this._readyState="closed",r.removeEventListener("adjust",t),r.removeEventListener("change",e),r.removeEventListener("readystatechange",n)),null!==r.error&&o(()=>this.dispatchEvent(new Event("error"))),o(()=>this.dispatchEvent(new Event("readystatechange")))};r.addEventListener("adjust",t),r.addEventListener("change",e),r.addEventListener("readystatechange",n)}}get endPosition(){return this._endPosition}get onchange(){return null===this._onchange?this._onchange:this._onchange[0]}set onchange(t){if(null!==this._onchange&&this.removeEventListener("change",this._onchange[1]),"function"==typeof t){const e=t.bind(this);this.addEventListener("change",e),this._onchange=[t,e]}else this._onchange=null}get onerror(){return null===this._onerror?this._onerror:this._onerror[0]}set onerror(t){if(null!==this._onerror&&this.removeEventListener("error",this._onerror[1]),"function"==typeof t){const e=t.bind(this);this.addEventListener("error",e),this._onerror=[t,e]}else this._onerror=null}get onreadystatechange(){return null===this._onreadystatechange?this._onreadystatechange:this._onreadystatechange[0]}set onreadystatechange(t){if(null!==this._onreadystatechange&&this.removeEventListener("readystatechange",this._onreadystatechange[1]),"function"==typeof t){const e=t.bind(this);this.addEventListener("readystatechange",e),this._onreadystatechange=[t,e]}else this._onreadystatechange=null}get readyState(){return this._readyState}get startPosition(){return this._startPosition}get timingProviderSource(){return this._timingProviderSource}query(){if("open"!==this._readyState)throw n();const t=s.now()/1e3,e=null===this._timingProviderSource?t-this._vector.timestamp:t+this._skew-this._vector.timestamp,r=a(this._vector,e);return this._endPosition<r.position||this._startPosition>r.position?(this._setInternalVector({...r,acceleration:0,position:this._endPosition<r.position?this._endPosition:this._startPosition,velocity:0}),this.query()):r}update(t){if("open"!==this._readyState)return Promise.reject(n());if(null!==this._timingProviderSource){const e=this._timingProviderSource.update(t);return e instanceof Promise?e:Promise.reject(new TypeError("The timingProviderSource failed to return a promise."))}const r=i(t);if(0===Object.keys(r).length)return Promise.resolve();const s={...this.query(),...r},{position:o,velocity:a,acceleration:l}=s;return o<this._startPosition||o>this._endPosition||o===this._startPosition&&(a<0||0===a&&l<0)||o===this._endPosition&&(a>0||0===a&&l>0)?Promise.reject(e()):(this._setInternalVector(s),Promise.resolve())}_isAllowedTransition(t){return"closing"===this._readyState&&"closed"===t||"connecting"===this._readyState||"open"===this._readyState&&("closed"===t||"closing"===t)}_setInternalTimeout(){if(null!==this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null),this._endPosition===Number.POSITIVE_INFINITY&&this._startPosition===Number.NEGATIVE_INFINITY||0===this._vector.acceleration&&0===this._vector.velocity)return;const e=t(this._vector,this._startPosition,this._endPosition);null!==e&&(this._timeoutId=o(()=>this.query(),e))}_setInternalVector(t){this._vector=t,this._setInternalTimeout(),o(()=>this.dispatchEvent(new Event("change")))}})},rGa6:function(t,e,n){},s2lO:function(t,e,n){"use strict";var r=n("/RDW");function i(){}function s(){}s.resetWarningCache=i,t.exports=function(){function t(t,e,n,i,s,o){if(o!==r){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function e(){return t}t.isRequired=t;var n={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:s,resetWarningCache:i};return n.PropTypes=n,n}},sT5T:function(t,e,n){},svpg:function(t,e,n){},t9yM:function(t,e,n){},tU5a:function(t,e,n){"use strict";(function(t,r){n.d(e,"a",(function(){return L})),n.d(e,"b",(function(){return $t})),n.d(e,"c",(function(){return Et})),n.d(e,"d",(function(){return ft})),n.d(e,"e",(function(){return dt})),n.d(e,"f",(function(){return Qt})),n.d(e,"g",(function(){return te})),n.d(e,"h",(function(){return nt})),n.d(e,"i",(function(){return oe})),n.d(e,"j",(function(){return D})),n.d(e,"k",(function(){return ae})),n.d(e,"l",(function(){return ge})),n.d(e,"m",(function(){return he})),n.d(e,"n",(function(){return $e})),n.d(e,"o",(function(){return Ve})),n.d(e,"p",(function(){return tn})),n.d(e,"q",(function(){return X})),n.d(e,"r",(function(){return re})),n.d(e,"s",(function(){return Zt})),n.d(e,"t",(function(){return Yt})),n.d(e,"u",(function(){return Se})),n.d(e,"v",(function(){return _e})),n.d(e,"w",(function(){return ut}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var s=function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function o(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function l(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t}var u="An invariant failed, however the error is obfuscated because this is a production build.",c=[];Object.freeze(c);var h={};function d(){return++Ot.mobxGuid}function f(t){throw p(!1,t),"X"}function p(t,e){if(!t)throw new Error("[mobx] "+(e||u))}Object.freeze(h);function g(t){var e=!1;return function(){if(!e)return e=!0,t.apply(this,arguments)}}var m=function(){};function v(t){return null!==t&&"object"==typeof t}function y(t){if(null===t||"object"!=typeof t)return!1;var e=Object.getPrototypeOf(t);return e===Object.prototype||null===e}function b(t,e,n){Object.defineProperty(t,e,{enumerable:!1,writable:!0,configurable:!0,value:n})}function E(t,e){var n="isMobX"+t;return e.prototype[n]=!0,function(t){return v(t)&&!0===t[n]}}function T(t){return t instanceof Map}function S(t){return t instanceof Set}function _(t){var e=new Set;for(var n in t)e.add(n);return Object.getOwnPropertySymbols(t).forEach((function(n){Object.getOwnPropertyDescriptor(t,n).enumerable&&e.add(n)})),Array.from(e)}function w(t){return t&&t.toString?t.toString():new String(t).toString()}function A(t){return null===t?null:"object"==typeof t?""+t:t}var L=Symbol("mobx administration"),R=function(){function t(t){void 0===t&&(t="Atom@"+d()),this.name=t,this.isPendingUnobservation=!1,this.isBeingObserved=!1,this.observers=new Set,this.diffValue=0,this.lastAccessedBy=0,this.lowestObserverState=Z.NOT_TRACKING}return t.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach((function(t){return t()}))},t.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach((function(t){return t()}))},t.prototype.reportObserved=function(){return Ut(this)},t.prototype.reportChanged=function(){Ft(),function(t){if(t.lowestObserverState===Z.STALE)return;t.lowestObserverState=Z.STALE,t.observers.forEach((function(e){e.dependenciesState===Z.UP_TO_DATE&&(e.isTracing!==J.NONE&&Bt(e,t),e.onBecomeStale()),e.dependenciesState=Z.STALE}))}(this),Nt()},t.prototype.toString=function(){return this.name},t}(),I=E("Atom",R);function D(t,e,n){void 0===e&&(e=m),void 0===n&&(n=m);var r,i=new R(t);return e!==m&&se("onBecomeObserved",i,e,r),n!==m&&ie(i,n),i}var x={identity:function(t,e){return t===e},structural:function(t,e){return sn(t,e)},default:function(t,e){return Object.is(t,e)},shallow:function(t,e){return sn(t,e,1)}},k=Symbol("mobx did run lazy initializers"),O=Symbol("mobx pending decorators"),C={},P={};function M(t,e){var n=e?C:P;return n[t]||(n[t]={configurable:!0,enumerable:e,get:function(){return F(this),this[t]},set:function(e){F(this),this[t]=e}})}function F(t){var e,n;if(!0!==t[k]){var r=t[O];if(r){b(t,k,!0);var i=l(Object.getOwnPropertySymbols(r),Object.keys(r));try{for(var s=o(i),a=s.next();!a.done;a=s.next()){var u=r[a.value];u.propertyCreator(t,u.prop,u.descriptor,u.decoratorTarget,u.decoratorArguments)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}}}}function N(t,e){return function(){var n,r=function(r,i,o,a){if(!0===a)return e(r,i,o,r,n),null;if(!Object.prototype.hasOwnProperty.call(r,O)){var l=r[O];b(r,O,s({},l))}return r[O][i]={prop:i,propertyCreator:e,descriptor:o,decoratorTarget:r,decoratorArguments:n},M(i,t)};return U(arguments)?(n=c,r.apply(null,arguments)):(n=Array.prototype.slice.call(arguments),r)}}function U(t){return(2===t.length||3===t.length)&&("string"==typeof t[1]||"symbol"==typeof t[1])||4===t.length&&!0===t[3]}function B(t,e,n){return ye(t)?t:Array.isArray(t)?X.array(t,{name:n}):y(t)?X.object(t,void 0,{name:n}):T(t)?X.map(t,{name:n}):S(t)?X.set(t,{name:n}):t}function $(t){return t}function j(e){p(e);var n=N(!0,(function(t,n,r,i,s){var o=r?r.initializer?r.initializer.call(t):r.value:void 0;qe(t).addObservableProp(n,o,e)})),r=(void 0!==t&&t.env,n);return r.enhancer=e,r}var G={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};function K(t){return null==t?G:"string"==typeof t?{name:t,deep:!0,proxy:!0}:t}Object.freeze(G);var V=j(B),H=j((function(t,e,n){return null==t?t:tn(t)||$e(t)||Ve(t)||Ye(t)?t:Array.isArray(t)?X.array(t,{name:n,deep:!1}):y(t)?X.object(t,void 0,{name:n,deep:!1}):T(t)?X.map(t,{name:n,deep:!1}):S(t)?X.set(t,{name:n,deep:!1}):f(!1)})),W=j($),Y=j((function(t,e,n){return sn(t,e)?e:t}));function z(t){return t.defaultDecorator?t.defaultDecorator.enhancer:!1===t.deep?$:B}var q={box:function(t,e){arguments.length>2&&Q("box");var n=K(e);return new _t(t,z(n),n.name,!0,n.equals)},array:function(t,e){arguments.length>2&&Q("array");var n=K(e);return Me(t,z(n),n.name)},map:function(t,e){arguments.length>2&&Q("map");var n=K(e);return new Ke(t,z(n),n.name)},set:function(t,e){arguments.length>2&&Q("set");var n=K(e);return new We(t,z(n),n.name)},object:function(t,e,n){"string"==typeof arguments[1]&&Q("object");var r=K(n);if(!1===r.proxy)return le({},t,e,r);var i=ue(r),s=le({},void 0,void 0,r),o=Re(s);return ce(o,t,e,i),o},ref:W,shallow:H,deep:V,struct:Y},X=function(t,e,n){if("string"==typeof arguments[1]||"symbol"==typeof arguments[1])return V.apply(null,arguments);if(ye(t))return t;var r=y(t)?X.object(t,e,n):Array.isArray(t)?X.array(t,e):T(t)?X.map(t,e):S(t)?X.set(t,e):t;if(r!==t)return r;f(!1)};function Q(t){f("Expected one or two arguments to observable."+t+". Did you accidentally try to use observable."+t+" as decorator?")}Object.keys(q).forEach((function(t){return X[t]=q[t]}));var Z,J,tt=N(!1,(function(t,e,n,r,i){var o=n.get,a=n.set,l=i[0]||{};qe(t).addComputedProp(t,e,s({get:o,set:a,context:t},l))})),et=tt({equals:x.structural}),nt=function(t,e,n){if("string"==typeof e)return tt.apply(null,arguments);if(null!==t&&"object"==typeof t&&1===arguments.length)return tt.apply(null,arguments);var r="object"==typeof e?e:{};return r.get=t,r.set="function"==typeof e?e:r.set,r.name=r.name||t.name||"",new At(r)};nt.struct=et,function(t){t[t.NOT_TRACKING=-1]="NOT_TRACKING",t[t.UP_TO_DATE=0]="UP_TO_DATE",t[t.POSSIBLY_STALE=1]="POSSIBLY_STALE",t[t.STALE=2]="STALE"}(Z||(Z={})),function(t){t[t.NONE=0]="NONE",t[t.LOG=1]="LOG",t[t.BREAK=2]="BREAK"}(J||(J={}));var rt=function(t){this.cause=t};function it(t){return t instanceof rt}function st(t){switch(t.dependenciesState){case Z.UP_TO_DATE:return!1;case Z.NOT_TRACKING:case Z.STALE:return!0;case Z.POSSIBLY_STALE:for(var e=dt(!0),n=ct(),r=t.observing,i=r.length,s=0;s<i;s++){var o=r[s];if(Lt(o)){if(Ot.disableErrorBoundaries)o.get();else try{o.get()}catch(t){return ht(n),ft(e),!0}if(t.dependenciesState===Z.STALE)return ht(n),ft(e),!0}}return pt(t),ht(n),ft(e),!1}}function ot(t){var e=t.observers.size>0;Ot.computationDepth>0&&e&&f(!1),Ot.allowStateChanges||!e&&"strict"!==Ot.enforceActions||f(!1)}function at(t,e,n){var r=dt(!0);pt(t),t.newObserving=new Array(t.observing.length+100),t.unboundDepsCount=0,t.runId=++Ot.runId;var i,s=Ot.trackingDerivation;if(Ot.trackingDerivation=t,!0===Ot.disableErrorBoundaries)i=e.call(n);else try{i=e.call(n)}catch(t){i=new rt(t)}return Ot.trackingDerivation=s,function(t){for(var e=t.observing,n=t.observing=t.newObserving,r=Z.UP_TO_DATE,i=0,s=t.unboundDepsCount,o=0;o<s;o++){0===(a=n[o]).diffValue&&(a.diffValue=1,i!==o&&(n[i]=a),i++),a.dependenciesState>r&&(r=a.dependenciesState)}n.length=i,t.newObserving=null,s=e.length;for(;s--;){0===(a=e[s]).diffValue&&Pt(a,t),a.diffValue=0}for(;i--;){var a;1===(a=n[i]).diffValue&&(a.diffValue=0,Ct(a,t))}r!==Z.UP_TO_DATE&&(t.dependenciesState=r,t.onBecomeStale())}(t),ft(r),i}function lt(t){var e=t.observing;t.observing=[];for(var n=e.length;n--;)Pt(e[n],t);t.dependenciesState=Z.NOT_TRACKING}function ut(t){var e=ct();try{return t()}finally{ht(e)}}function ct(){var t=Ot.trackingDerivation;return Ot.trackingDerivation=null,t}function ht(t){Ot.trackingDerivation=t}function dt(t){var e=Ot.allowStateReads;return Ot.allowStateReads=t,e}function ft(t){Ot.allowStateReads=t}function pt(t){if(t.dependenciesState!==Z.UP_TO_DATE){t.dependenciesState=Z.UP_TO_DATE;for(var e=t.observing,n=e.length;n--;)e[n].lowestObserverState=Z.UP_TO_DATE}}var gt=0,mt=1,vt=Object.getOwnPropertyDescriptor((function(){}),"name");vt&&vt.configurable;function yt(t,e,n){var r=function(){return bt(t,e,n||this,arguments)};return r.isMobxAction=!0,r}function bt(t,e,n,r){var i=function(t,e,n){var r=0;var i=ct();Ft();var s=Tt(!0),o=dt(!0),a={prevDerivation:i,prevAllowStateChanges:s,prevAllowStateReads:o,notifySpy:!1,startTime:r,actionId:mt++,parentActionId:gt};return gt=a.actionId,a}();try{return e.apply(n,r)}catch(t){throw i.error=t,t}finally{!function(t){gt!==t.actionId&&f("invalid action stack. did you forget to finish an action?");gt=t.parentActionId,void 0!==t.error&&(Ot.suppressReactionErrors=!0);St(t.prevAllowStateChanges),ft(t.prevAllowStateReads),Nt(),ht(t.prevDerivation),t.notifySpy&&!1;Ot.suppressReactionErrors=!1}(i)}}function Et(t,e){var n,r=Tt(t);try{n=e()}finally{St(r)}return n}function Tt(t){var e=Ot.allowStateChanges;return Ot.allowStateChanges=t,e}function St(t){Ot.allowStateChanges=t}var _t=function(t){function e(e,n,r,i,s){void 0===r&&(r="ObservableValue@"+d()),void 0===i&&(i=!0),void 0===s&&(s=x.default);var o=t.call(this,r)||this;return o.enhancer=n,o.name=r,o.equals=s,o.hasUnreportedChange=!1,o.value=n(e,void 0,r),o}return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.dehanceValue=function(t){return void 0!==this.dehancer?this.dehancer(t):t},e.prototype.set=function(t){this.value;if((t=this.prepareNewValue(t))!==Ot.UNCHANGED){0,this.setNewValue(t)}},e.prototype.prepareNewValue=function(t){if(ot(this),Ie(this)){var e=xe(this,{object:this,type:"update",newValue:t});if(!e)return Ot.UNCHANGED;t=e.newValue}return t=this.enhancer(t,this.value,this.name),this.equals(this.value,t)?Ot.UNCHANGED:t},e.prototype.setNewValue=function(t){var e=this.value;this.value=t,this.reportChanged(),ke(this)&&Ce(this,{type:"update",object:this,newValue:t,oldValue:e})},e.prototype.get=function(){return this.reportObserved(),this.dehanceValue(this.value)},e.prototype.intercept=function(t){return De(this,t)},e.prototype.observe=function(t,e){return e&&t({object:this,type:"update",newValue:this.value,oldValue:void 0}),Oe(this,t)},e.prototype.toJSON=function(){return this.get()},e.prototype.toString=function(){return this.name+"["+this.value+"]"},e.prototype.valueOf=function(){return A(this.get())},e.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},e}(R),wt=E("ObservableValue",_t),At=function(){function t(t){this.dependenciesState=Z.NOT_TRACKING,this.observing=[],this.newObserving=null,this.isBeingObserved=!1,this.isPendingUnobservation=!1,this.observers=new Set,this.diffValue=0,this.runId=0,this.lastAccessedBy=0,this.lowestObserverState=Z.UP_TO_DATE,this.unboundDepsCount=0,this.__mapid="#"+d(),this.value=new rt(null),this.isComputing=!1,this.isRunningSetter=!1,this.isTracing=J.NONE,p(t.get,"missing option for computed: get"),this.derivation=t.get,this.name=t.name||"ComputedValue@"+d(),t.set&&(this.setter=yt(this.name+"-setter",t.set)),this.equals=t.equals||(t.compareStructural||t.struct?x.structural:x.default),this.scope=t.context,this.requiresReaction=!!t.requiresReaction,this.keepAlive=!!t.keepAlive}return t.prototype.onBecomeStale=function(){!function(t){if(t.lowestObserverState!==Z.UP_TO_DATE)return;t.lowestObserverState=Z.POSSIBLY_STALE,t.observers.forEach((function(e){e.dependenciesState===Z.UP_TO_DATE&&(e.dependenciesState=Z.POSSIBLY_STALE,e.isTracing!==J.NONE&&Bt(e,t),e.onBecomeStale())}))}(this)},t.prototype.onBecomeObserved=function(){this.onBecomeObservedListeners&&this.onBecomeObservedListeners.forEach((function(t){return t()}))},t.prototype.onBecomeUnobserved=function(){this.onBecomeUnobservedListeners&&this.onBecomeUnobservedListeners.forEach((function(t){return t()}))},t.prototype.get=function(){this.isComputing&&f("Cycle detected in computation "+this.name+": "+this.derivation),0!==Ot.inBatch||0!==this.observers.size||this.keepAlive?(Ut(this),st(this)&&this.trackAndCompute()&&function(t){if(t.lowestObserverState===Z.STALE)return;t.lowestObserverState=Z.STALE,t.observers.forEach((function(e){e.dependenciesState===Z.POSSIBLY_STALE?e.dependenciesState=Z.STALE:e.dependenciesState===Z.UP_TO_DATE&&(t.lowestObserverState=Z.UP_TO_DATE)}))}(this)):st(this)&&(this.warnAboutUntrackedRead(),Ft(),this.value=this.computeValue(!1),Nt());var t=this.value;if(it(t))throw t.cause;return t},t.prototype.peek=function(){var t=this.computeValue(!1);if(it(t))throw t.cause;return t},t.prototype.set=function(t){if(this.setter){p(!this.isRunningSetter,"The setter of computed value '"+this.name+"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?"),this.isRunningSetter=!0;try{this.setter.call(this.scope,t)}finally{this.isRunningSetter=!1}}else p(!1,!1)},t.prototype.trackAndCompute=function(){var t=this.value,e=this.dependenciesState===Z.NOT_TRACKING,n=this.computeValue(!0),r=e||it(t)||it(n)||!this.equals(t,n);return r&&(this.value=n),r},t.prototype.computeValue=function(t){var e;if(this.isComputing=!0,Ot.computationDepth++,t)e=at(this,this.derivation,this.scope);else if(!0===Ot.disableErrorBoundaries)e=this.derivation.call(this.scope);else try{e=this.derivation.call(this.scope)}catch(t){e=new rt(t)}return Ot.computationDepth--,this.isComputing=!1,e},t.prototype.suspend=function(){this.keepAlive||(lt(this),this.value=void 0)},t.prototype.observe=function(t,e){var n=this,r=!0,i=void 0;return te((function(){var s=n.get();if(!r||e){var o=ct();t({type:"update",object:n,newValue:s,oldValue:i}),ht(o)}r=!1,i=s}))},t.prototype.warnAboutUntrackedRead=function(){},t.prototype.toJSON=function(){return this.get()},t.prototype.toString=function(){return this.name+"["+this.derivation.toString()+"]"},t.prototype.valueOf=function(){return A(this.get())},t.prototype[Symbol.toPrimitive]=function(){return this.valueOf()},t}(),Lt=E("ComputedValue",At),Rt=function(){this.version=5,this.UNCHANGED={},this.trackingDerivation=null,this.computationDepth=0,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!0,this.allowStateReads=!0,this.enforceActions=!1,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.computedConfigurable=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1},It={};function Dt(){return"undefined"!=typeof window?window:void 0!==r?r:"undefined"!=typeof self?self:It}var xt=!0,kt=!1,Ot=function(){var t=Dt();return t.__mobxInstanceCount>0&&!t.__mobxGlobals&&(xt=!1),t.__mobxGlobals&&t.__mobxGlobals.version!==(new Rt).version&&(xt=!1),xt?t.__mobxGlobals?(t.__mobxInstanceCount+=1,t.__mobxGlobals.UNCHANGED||(t.__mobxGlobals.UNCHANGED={}),t.__mobxGlobals):(t.__mobxInstanceCount=1,t.__mobxGlobals=new Rt):(setTimeout((function(){kt||f("There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`")}),1),new Rt)}();function Ct(t,e){t.observers.add(e),t.lowestObserverState>e.dependenciesState&&(t.lowestObserverState=e.dependenciesState)}function Pt(t,e){t.observers.delete(e),0===t.observers.size&&Mt(t)}function Mt(t){!1===t.isPendingUnobservation&&(t.isPendingUnobservation=!0,Ot.pendingUnobservations.push(t))}function Ft(){Ot.inBatch++}function Nt(){if(0==--Ot.inBatch){Kt();for(var t=Ot.pendingUnobservations,e=0;e<t.length;e++){var n=t[e];n.isPendingUnobservation=!1,0===n.observers.size&&(n.isBeingObserved&&(n.isBeingObserved=!1,n.onBecomeUnobserved()),n instanceof At&&n.suspend())}Ot.pendingUnobservations=[]}}function Ut(t){var e=Ot.trackingDerivation;return null!==e?(e.runId!==t.lastAccessedBy&&(t.lastAccessedBy=e.runId,e.newObserving[e.unboundDepsCount++]=t,t.isBeingObserved||(t.isBeingObserved=!0,t.onBecomeObserved())),!0):(0===t.observers.size&&Ot.inBatch>0&&Mt(t),!1)}function Bt(t,e){if(console.log("[mobx.trace] '"+t.name+"' is invalidated due to a change in: '"+e.name+"'"),t.isTracing===J.BREAK){var n=[];!function t(e,n,r){if(n.length>=1e3)return void n.push("(and many more)");n.push(""+new Array(r).join("\t")+e.name),e.dependencies&&e.dependencies.forEach((function(e){return t(e,n,r+1)}))}(he(t),n,1),new Function("debugger;\n/*\nTracing '"+t.name+"'\n\nYou are entering this break point because derivation '"+t.name+"' is being traced and '"+e.name+"' is now forcing it to update.\nJust follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update\nThe stackframe you are looking for is at least ~6-8 stack-frames up.\n\n"+(t instanceof At?t.derivation.toString().replace(/[*]\//g,"/"):"")+"\n\nThe dependencies for this derivation are:\n\n"+n.join("\n")+"\n*/\n    ")()}}var $t=function(){function t(t,e,n,r){void 0===t&&(t="Reaction@"+d()),void 0===r&&(r=!1),this.name=t,this.onInvalidate=e,this.errorHandler=n,this.requiresObservable=r,this.observing=[],this.newObserving=[],this.dependenciesState=Z.NOT_TRACKING,this.diffValue=0,this.runId=0,this.unboundDepsCount=0,this.__mapid="#"+d(),this.isDisposed=!1,this._isScheduled=!1,this._isTrackPending=!1,this._isRunning=!1,this.isTracing=J.NONE}return t.prototype.onBecomeStale=function(){this.schedule()},t.prototype.schedule=function(){this._isScheduled||(this._isScheduled=!0,Ot.pendingReactions.push(this),Kt())},t.prototype.isScheduled=function(){return this._isScheduled},t.prototype.runReaction=function(){if(!this.isDisposed){if(Ft(),this._isScheduled=!1,st(this)){this._isTrackPending=!0;try{this.onInvalidate(),this._isTrackPending}catch(t){this.reportExceptionInDerivation(t)}}Nt()}},t.prototype.track=function(t){if(!this.isDisposed){Ft();0,this._isRunning=!0;var e=at(this,t,void 0);this._isRunning=!1,this._isTrackPending=!1,this.isDisposed&&lt(this),it(e)&&this.reportExceptionInDerivation(e.cause),Nt()}},t.prototype.reportExceptionInDerivation=function(t){var e=this;if(this.errorHandler)this.errorHandler(t,this);else{if(Ot.disableErrorBoundaries)throw t;var n="[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '"+this+"'";Ot.suppressReactionErrors?console.warn("[mobx] (error in reaction '"+this.name+"' suppressed, fix error of causing action below)"):console.error(n,t),Ot.globalReactionErrorHandlers.forEach((function(n){return n(t,e)}))}},t.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._isRunning||(Ft(),lt(this),Nt()))},t.prototype.getDisposer=function(){var t=this.dispose.bind(this);return t[L]=this,t},t.prototype.toString=function(){return"Reaction["+this.name+"]"},t.prototype.trace=function(t){void 0===t&&(t=!1),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=!1;"boolean"==typeof t[t.length-1]&&(n=t.pop());var r=function(t){switch(t.length){case 0:return Ot.trackingDerivation;case 1:return en(t[0]);case 2:return en(t[0],t[1])}}(t);if(!r)return f(!1);r.isTracing===J.NONE&&console.log("[mobx.trace] '"+r.name+"' tracing enabled");r.isTracing=n?J.BREAK:J.LOG}(this,t)},t}();var jt=100,Gt=function(t){return t()};function Kt(){Ot.inBatch>0||Ot.isRunningReactions||Gt(Vt)}function Vt(){Ot.isRunningReactions=!0;for(var t=Ot.pendingReactions,e=0;t.length>0;){++e===jt&&(console.error("Reaction doesn't converge to a stable state after "+jt+" iterations. Probably there is a cycle in the reactive function: "+t[0]),t.splice(0));for(var n=t.splice(0),r=0,i=n.length;r<i;r++)n[r].runReaction()}Ot.isRunningReactions=!1}var Ht=E("Reaction",$t);function Wt(t){var e=Gt;Gt=function(n){return t((function(){return e(n)}))}}function Yt(t){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}}function zt(){f(!1)}function qt(t){return function(e,n,r){if(r){if(r.value)return{value:yt(t,r.value),enumerable:!1,configurable:!0,writable:!0};var i=r.initializer;return{enumerable:!1,configurable:!0,writable:!0,initializer:function(){return yt(t,i.call(this))}}}return Xt(t).apply(this,arguments)}}function Xt(t){return function(e,n,r){Object.defineProperty(e,n,{configurable:!0,enumerable:!1,get:function(){},set:function(e){b(this,n,Qt(t,e))}})}}var Qt=function(t,e,n,r){return 1===arguments.length&&"function"==typeof t?yt(t.name||"<unnamed action>",t):2===arguments.length&&"function"==typeof e?yt(t,e):1===arguments.length&&"string"==typeof t?qt(t):!0!==r?qt(e).apply(null,arguments):void b(t,e,yt(t.name||e,n.value,this))};function Zt(t,e){"string"==typeof t||t.name;return bt(0,"function"==typeof t?t:e,this,void 0)}function Jt(t,e,n){b(t,e,yt(e,n.bind(t)))}function te(t,e){void 0===e&&(e=h);var n,r=e&&e.name||t.name||"Autorun@"+d();if(!e.scheduler&&!e.delay)n=new $t(r,(function(){this.track(o)}),e.onError,e.requiresObservable);else{var i=ne(e),s=!1;n=new $t(r,(function(){s||(s=!0,i((function(){s=!1,n.isDisposed||n.track(o)})))}),e.onError,e.requiresObservable)}function o(){t(n)}return n.schedule(),n.getDisposer()}Qt.bound=function(t,e,n,r){return!0===r?(Jt(t,e,n.value),null):n?{configurable:!0,enumerable:!1,get:function(){return Jt(this,e,n.value||n.initializer.call(this)),this[e]},set:zt}:{enumerable:!1,configurable:!0,set:function(t){Jt(this,e,t)},get:function(){}}};var ee=function(t){return t()};function ne(t){return t.scheduler?t.scheduler:t.delay?function(e){return setTimeout(e,t.delay)}:ee}function re(t,e,n){void 0===n&&(n=h);var r,i,s,o=n.name||"Reaction@"+d(),a=Qt(o,n.onError?(r=n.onError,i=e,function(){try{return i.apply(this,arguments)}catch(t){r.call(this,t)}}):e),l=!n.scheduler&&!n.delay,u=ne(n),c=!0,f=!1,p=n.compareStructural?x.structural:n.equals||x.default,g=new $t(o,(function(){c||l?m():f||(f=!0,u(m))}),n.onError,n.requiresObservable);function m(){if(f=!1,!g.isDisposed){var e=!1;g.track((function(){var n=t(g);e=c||!p(s,n),s=n})),c&&n.fireImmediately&&a(s,g),c||!0!==e||a(s,g),c&&(c=!1)}}return g.schedule(),g.getDisposer()}function ie(t,e,n){return se("onBecomeUnobserved",t,e,n)}function se(t,e,n,r){var i="function"==typeof r?en(e,n):en(e),s="function"==typeof r?r:n,o=t+"Listeners";return i[o]?i[o].add(s):i[o]=new Set([s]),"function"!=typeof i[t]?f(!1):function(){var t=i[o];t&&(t.delete(s),0===t.size&&delete i[o])}}function oe(t){var e=t.enforceActions,n=t.computedRequiresReaction,r=t.computedConfigurable,i=t.disableErrorBoundaries,s=t.reactionScheduler,o=t.reactionRequiresObservable,a=t.observableRequiresReaction;if(!0===t.isolateGlobalState&&((Ot.pendingReactions.length||Ot.inBatch||Ot.isRunningReactions)&&f("isolateGlobalState should be called before MobX is running any reactions"),kt=!0,xt&&(0==--Dt().__mobxInstanceCount&&(Dt().__mobxGlobals=void 0),Ot=new Rt)),void 0!==e){var l=void 0;switch(e){case!0:case"observed":l=!0;break;case!1:case"never":l=!1;break;case"strict":case"always":l="strict";break;default:f("Invalid value for 'enforceActions': '"+e+"', expected 'never', 'always' or 'observed'")}Ot.enforceActions=l,Ot.allowStateChanges=!0!==l&&"strict"!==l}void 0!==n&&(Ot.computedRequiresReaction=!!n),void 0!==o&&(Ot.reactionRequiresObservable=!!o),void 0!==a&&(Ot.observableRequiresReaction=!!a,Ot.allowStateReads=!Ot.observableRequiresReaction),void 0!==r&&(Ot.computedConfigurable=!!r),void 0!==i&&(!0===i&&console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled."),Ot.disableErrorBoundaries=!!i),s&&Wt(s)}function ae(t,e){var n="function"==typeof t?t.prototype:t,r=function(t){var r=e[t];Array.isArray(r)||(r=[r]);var i=Object.getOwnPropertyDescriptor(n,t),s=r.reduce((function(e,r){return r(n,t,e)}),i);s&&Object.defineProperty(n,t,s)};for(var i in e)r(i);return t}function le(t,e,n,r){var i=ue(r=K(r));return F(t),qe(t,r.name,i.enhancer),e&&ce(t,e,n,i),t}function ue(t){return t.defaultDecorator||(!1===t.deep?W:V)}function ce(t,e,n,r){var i,s;Ft();try{var a=_(e);try{for(var l=o(a),u=l.next();!u.done;u=l.next()){var c=u.value,h=Object.getOwnPropertyDescriptor(e,c);0;var d=(n&&c in n?n[c]:h.get?tt:r)(t,c,h,!0);d&&Object.defineProperty(t,c,d)}}catch(t){i={error:t}}finally{try{u&&!u.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}}finally{Nt()}}function he(t,e){return de(en(t,e))}function de(t){var e,n,r={name:t.name};return t.observing&&t.observing.length>0&&(r.dependencies=(e=t.observing,n=[],e.forEach((function(t){-1===n.indexOf(t)&&n.push(t)})),n).map(de)),r}var fe=0;function pe(){this.message="FLOW_CANCELLED"}function ge(t){1!==arguments.length&&f("Flow expects 1 argument and cannot be used as decorator");var e=t.name||"<unnamed flow>";return function(){var n,r=this,i=arguments,s=++fe,o=Qt(e+" - runid: "+s+" - init",t).apply(r,i),a=void 0,l=new Promise((function(t,r){var i=0;function l(t){var n;a=void 0;try{n=Qt(e+" - runid: "+s+" - yield "+i++,o.next).call(o,t)}catch(t){return r(t)}c(n)}function u(t){var n;a=void 0;try{n=Qt(e+" - runid: "+s+" - yield "+i++,o.throw).call(o,t)}catch(t){return r(t)}c(n)}function c(e){if(!e||"function"!=typeof e.then)return e.done?t(e.value):(a=Promise.resolve(e.value)).then(l,u);e.then(c,r)}n=r,l(void 0)}));return l.cancel=Qt(e+" - runid: "+s+" - cancel",(function(){try{a&&me(a);var t=o.return(void 0),e=Promise.resolve(t.value);e.then(m,m),me(e),n(new pe)}catch(t){n(t)}})),l}}function me(t){"function"==typeof t.cancel&&t.cancel()}function ve(t,e){return null!=t&&(void 0!==e?!!tn(t)&&t[L].values.has(e):tn(t)||!!t[L]||I(t)||Ht(t)||Lt(t))}function ye(t){return 1!==arguments.length&&f(!1),ve(t)}function be(t){return tn(t)?t[L].getKeys():Ve(t)?Array.from(t.keys()):Ye(t)?Array.from(t.keys()):$e(t)?t.map((function(t,e){return e})):f(!1)}pe.prototype=Object.create(Error.prototype);var Ee={detectCycles:!0,exportMapsAsObjects:!0,recurseEverything:!1};function Te(t,e,n,r){return r.detectCycles&&t.set(e,n),n}function Se(t,e){var n;return"boolean"==typeof e&&(e={detectCycles:e}),e||(e=Ee),e.detectCycles=void 0===e.detectCycles?!0===e.recurseEverything:!0===e.detectCycles,e.detectCycles&&(n=new Map),function t(e,n,r){if(!n.recurseEverything&&!ye(e))return e;if("object"!=typeof e)return e;if(null===e)return null;if(e instanceof Date)return e;if(wt(e))return t(e.get(),n,r);if(ye(e)&&be(e),!0===n.detectCycles&&null!==e&&r.has(e))return r.get(e);if($e(e)||Array.isArray(e)){var i=Te(r,e,[],n),s=e.map((function(e){return t(e,n,r)}));i.length=s.length;for(var o=0,a=s.length;o<a;o++)i[o]=s[o];return i}if(Ye(e)||Object.getPrototypeOf(e)===Set.prototype){if(!1===n.exportMapsAsObjects){var l=Te(r,e,new Set,n);return e.forEach((function(e){l.add(t(e,n,r))})),l}var u=Te(r,e,[],n);return e.forEach((function(e){u.push(t(e,n,r))})),u}if(Ve(e)||Object.getPrototypeOf(e)===Map.prototype){if(!1===n.exportMapsAsObjects){var c=Te(r,e,new Map,n);return e.forEach((function(e,i){c.set(i,t(e,n,r))})),c}var h=Te(r,e,{},n);return e.forEach((function(e,i){h[i]=t(e,n,r)})),h}var d=Te(r,e,{},n);return _(e).forEach((function(i){d[i]=t(e[i],n,r)})),d}(t,e,n)}function _e(t,e){void 0===e&&(e=void 0),Ft();try{return t.apply(e)}finally{Nt()}}function we(t){return t[L]}function Ae(t){return"string"==typeof t||"number"==typeof t||"symbol"==typeof t}var Le={has:function(t,e){if(e===L||"constructor"===e||e===k)return!0;var n=we(t);return Ae(e)?n.has(e):e in t},get:function(t,e){if(e===L||"constructor"===e||e===k)return t[e];var n=we(t),r=n.values.get(e);if(r instanceof R){var i=r.get();return void 0===i&&n.has(e),i}return Ae(e)&&n.has(e),t[e]},set:function(t,e,n){return!!Ae(e)&&(function t(e,n,r){if(2!==arguments.length||Ye(e))if(tn(e)){var i=e[L];i.values.get(n)?i.write(n,r):i.addObservableProp(n,r,i.defaultEnhancer)}else if(Ve(e))e.set(n,r);else if(Ye(e))e.add(n);else{if(!$e(e))return f(!1);"number"!=typeof n&&(n=parseInt(n,10)),p(n>=0,"Not a valid index: '"+n+"'"),Ft(),n>=e.length&&(e.length=n+1),e[n]=r,Nt()}else{Ft();var s=n;try{for(var o in s)t(e,o,s[o])}finally{Nt()}}}(t,e,n),!0)},deleteProperty:function(t,e){return!!Ae(e)&&(we(t).remove(e),!0)},ownKeys:function(t){return we(t).keysAtom.reportObserved(),Reflect.ownKeys(t)},preventExtensions:function(t){return f("Dynamic observable objects cannot be frozen"),!1}};function Re(t){var e=new Proxy(t,Le);return t[L].proxy=e,e}function Ie(t){return void 0!==t.interceptors&&t.interceptors.length>0}function De(t,e){var n=t.interceptors||(t.interceptors=[]);return n.push(e),g((function(){var t=n.indexOf(e);-1!==t&&n.splice(t,1)}))}function xe(t,e){var n=ct();try{for(var r=l(t.interceptors||[]),i=0,s=r.length;i<s&&(p(!(e=r[i](e))||e.type,"Intercept handlers should return nothing or a change object"),e);i++);return e}finally{ht(n)}}function ke(t){return void 0!==t.changeListeners&&t.changeListeners.length>0}function Oe(t,e){var n=t.changeListeners||(t.changeListeners=[]);return n.push(e),g((function(){var t=n.indexOf(e);-1!==t&&n.splice(t,1)}))}function Ce(t,e){var n=ct(),r=t.changeListeners;if(r){for(var i=0,s=(r=r.slice()).length;i<s;i++)r[i](e);ht(n)}}var Pe={get:function(t,e){return e===L?t[L]:"length"===e?t[L].getArrayLength():"number"==typeof e?Ne.get.call(t,e):"string"!=typeof e||isNaN(e)?Ne.hasOwnProperty(e)?Ne[e]:t[e]:Ne.get.call(t,parseInt(e))},set:function(t,e,n){return"length"===e&&t[L].setArrayLength(n),"number"==typeof e&&Ne.set.call(t,e,n),"symbol"==typeof e||isNaN(e)?t[e]=n:Ne.set.call(t,parseInt(e),n),!0},preventExtensions:function(t){return f("Observable arrays cannot be frozen"),!1}};function Me(t,e,n,r){void 0===n&&(n="ObservableArray@"+d()),void 0===r&&(r=!1);var i,s,o,a=new Fe(n,e,r);i=a.values,s=L,o=a,Object.defineProperty(i,s,{enumerable:!1,writable:!1,configurable:!0,value:o});var l=new Proxy(a.values,Pe);if(a.proxy=l,t&&t.length){var u=Tt(!0);a.spliceWithArray(0,0,t),St(u)}return l}var Fe=function(){function t(t,e,n){this.owned=n,this.values=[],this.proxy=void 0,this.lastKnownLength=0,this.atom=new R(t||"ObservableArray@"+d()),this.enhancer=function(n,r){return e(n,r,t+"[..]")}}return t.prototype.dehanceValue=function(t){return void 0!==this.dehancer?this.dehancer(t):t},t.prototype.dehanceValues=function(t){return void 0!==this.dehancer&&t.length>0?t.map(this.dehancer):t},t.prototype.intercept=function(t){return De(this,t)},t.prototype.observe=function(t,e){return void 0===e&&(e=!1),e&&t({object:this.proxy,type:"splice",index:0,added:this.values.slice(),addedCount:this.values.length,removed:[],removedCount:0}),Oe(this,t)},t.prototype.getArrayLength=function(){return this.atom.reportObserved(),this.values.length},t.prototype.setArrayLength=function(t){if("number"!=typeof t||t<0)throw new Error("[mobx.array] Out of range: "+t);var e=this.values.length;if(t!==e)if(t>e){for(var n=new Array(t-e),r=0;r<t-e;r++)n[r]=void 0;this.spliceWithArray(e,0,n)}else this.spliceWithArray(t,e-t)},t.prototype.updateArrayLength=function(t,e){if(t!==this.lastKnownLength)throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed.");this.lastKnownLength+=e},t.prototype.spliceWithArray=function(t,e,n){var r=this;ot(this.atom);var i=this.values.length;if(void 0===t?t=0:t>i?t=i:t<0&&(t=Math.max(0,i+t)),e=1===arguments.length?i-t:null==e?0:Math.max(0,Math.min(e,i-t)),void 0===n&&(n=c),Ie(this)){var s=xe(this,{object:this.proxy,type:"splice",index:t,removedCount:e,added:n});if(!s)return c;e=s.removedCount,n=s.added}n=0===n.length?n:n.map((function(t){return r.enhancer(t,void 0)}));var o=this.spliceItemsIntoValues(t,e,n);return 0===e&&0===n.length||this.notifyArraySplice(t,n,o),this.dehanceValues(o)},t.prototype.spliceItemsIntoValues=function(t,e,n){var r;if(n.length<1e4)return(r=this.values).splice.apply(r,l([t,e],n));var i=this.values.slice(t,t+e);return this.values=this.values.slice(0,t).concat(n,this.values.slice(t+e)),i},t.prototype.notifyArrayChildUpdate=function(t,e,n){var r=!this.owned&&!1,i=ke(this),s=i||r?{object:this.proxy,type:"update",index:t,newValue:e,oldValue:n}:null;this.atom.reportChanged(),i&&Ce(this,s)},t.prototype.notifyArraySplice=function(t,e,n){var r=!this.owned&&!1,i=ke(this),s=i||r?{object:this.proxy,type:"splice",index:t,removed:n,added:e,removedCount:n.length,addedCount:e.length}:null;this.atom.reportChanged(),i&&Ce(this,s)},t}(),Ne={intercept:function(t){return this[L].intercept(t)},observe:function(t,e){return void 0===e&&(e=!1),this[L].observe(t,e)},clear:function(){return this.splice(0)},replace:function(t){var e=this[L];return e.spliceWithArray(0,e.values.length,t)},toJS:function(){return this.slice()},toJSON:function(){return this.toJS()},splice:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this[L];switch(arguments.length){case 0:return[];case 1:return i.spliceWithArray(t);case 2:return i.spliceWithArray(t,e)}return i.spliceWithArray(t,e,n)},spliceWithArray:function(t,e,n){return this[L].spliceWithArray(t,e,n)},push:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this[L];return n.spliceWithArray(n.values.length,0,t),n.values.length},pop:function(){return this.splice(Math.max(this[L].values.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this[L];return n.spliceWithArray(0,0,t),n.values.length},reverse:function(){var t=this.slice();return t.reverse.apply(t,arguments)},sort:function(t){var e=this.slice();return e.sort.apply(e,arguments)},remove:function(t){var e=this[L],n=e.dehanceValues(e.values).indexOf(t);return n>-1&&(this.splice(n,1),!0)},get:function(t){var e=this[L];if(e){if(t<e.values.length)return e.atom.reportObserved(),e.dehanceValue(e.values[t]);console.warn("[mobx.array] Attempt to read an array index ("+t+") that is out of bounds ("+e.values.length+"). Please check length first. Out of bound indices will not be tracked by MobX")}},set:function(t,e){var n=this[L],r=n.values;if(t<r.length){ot(n.atom);var i=r[t];if(Ie(n)){var s=xe(n,{type:"update",object:n.proxy,index:t,newValue:e});if(!s)return;e=s.newValue}(e=n.enhancer(e,i))!==i&&(r[t]=e,n.notifyArrayChildUpdate(t,e,i))}else{if(t!==r.length)throw new Error("[mobx.array] Index out of bounds, "+t+" is larger than "+r.length);n.spliceWithArray(t,0,[e])}}};["concat","every","filter","forEach","indexOf","join","lastIndexOf","map","reduce","reduceRight","slice","some","toString","toLocaleString"].forEach((function(t){Ne[t]=function(){var e=this[L];e.atom.reportObserved();var n=e.dehanceValues(e.values);return n[t].apply(n,arguments)}}));var Ue,Be=E("ObservableArrayAdministration",Fe);function $e(t){return v(t)&&Be(t[L])}var je,Ge={},Ke=function(){function t(t,e,n){if(void 0===e&&(e=B),void 0===n&&(n="ObservableMap@"+d()),this.enhancer=e,this.name=n,this[Ue]=Ge,this._keysAtom=D(this.name+".keys()"),this[Symbol.toStringTag]="Map","function"!=typeof Map)throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js");this._data=new Map,this._hasMap=new Map,this.merge(t)}return t.prototype._has=function(t){return this._data.has(t)},t.prototype.has=function(t){var e=this;if(!Ot.trackingDerivation)return this._has(t);var n=this._hasMap.get(t);if(!n){var r=n=new _t(this._has(t),$,this.name+"."+w(t)+"?",!1);this._hasMap.set(t,r),ie(r,(function(){return e._hasMap.delete(t)}))}return n.get()},t.prototype.set=function(t,e){var n=this._has(t);if(Ie(this)){var r=xe(this,{type:n?"update":"add",object:this,newValue:e,name:t});if(!r)return this;e=r.newValue}return n?this._updateValue(t,e):this._addValue(t,e),this},t.prototype.delete=function(t){var e=this;if(Ie(this)&&!(r=xe(this,{type:"delete",object:this,name:t})))return!1;if(this._has(t)){var n=ke(this),r=n?{type:"delete",object:this,oldValue:this._data.get(t).value,name:t}:null;return _e((function(){e._keysAtom.reportChanged(),e._updateHasMapEntry(t,!1),e._data.get(t).setNewValue(void 0),e._data.delete(t)})),n&&Ce(this,r),!0}return!1},t.prototype._updateHasMapEntry=function(t,e){var n=this._hasMap.get(t);n&&n.setNewValue(e)},t.prototype._updateValue=function(t,e){var n=this._data.get(t);if((e=n.prepareNewValue(e))!==Ot.UNCHANGED){var r=ke(this),i=r?{type:"update",object:this,oldValue:n.value,name:t,newValue:e}:null;0,n.setNewValue(e),r&&Ce(this,i)}},t.prototype._addValue=function(t,e){var n=this;ot(this._keysAtom),_e((function(){var r=new _t(e,n.enhancer,n.name+"."+w(t),!1);n._data.set(t,r),e=r.value,n._updateHasMapEntry(t,!0),n._keysAtom.reportChanged()}));var r=ke(this),i=r?{type:"add",object:this,name:t,newValue:e}:null;r&&Ce(this,i)},t.prototype.get=function(t){return this.has(t)?this.dehanceValue(this._data.get(t).get()):this.dehanceValue(void 0)},t.prototype.dehanceValue=function(t){return void 0!==this.dehancer?this.dehancer(t):t},t.prototype.keys=function(){return this._keysAtom.reportObserved(),this._data.keys()},t.prototype.values=function(){var t=this,e=0,n=Array.from(this.keys());return ln({next:function(){return e<n.length?{value:t.get(n[e++]),done:!1}:{done:!0}}})},t.prototype.entries=function(){var t=this,e=0,n=Array.from(this.keys());return ln({next:function(){if(e<n.length){var r=n[e++];return{value:[r,t.get(r)],done:!1}}return{done:!0}}})},t.prototype[(Ue=L,Symbol.iterator)]=function(){return this.entries()},t.prototype.forEach=function(t,e){var n,r;try{for(var i=o(this),s=i.next();!s.done;s=i.next()){var l=a(s.value,2),u=l[0],c=l[1];t.call(e,c,u,this)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.merge=function(t){var e=this;return Ve(t)&&(t=t.toJS()),_e((function(){y(t)?_(t).forEach((function(n){return e.set(n,t[n])})):Array.isArray(t)?t.forEach((function(t){var n=a(t,2),r=n[0],i=n[1];return e.set(r,i)})):T(t)?(t.constructor!==Map&&f("Cannot initialize from classes that inherit from Map: "+t.constructor.name),t.forEach((function(t,n){return e.set(n,t)}))):null!=t&&f("Cannot initialize map from "+t)})),this},t.prototype.clear=function(){var t=this;_e((function(){ut((function(){var e,n;try{for(var r=o(t.keys()),i=r.next();!i.done;i=r.next()){var s=i.value;t.delete(s)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}))}))},t.prototype.replace=function(t){var e=this;return _e((function(){var n,r=y(n=t)?Object.keys(n):Array.isArray(n)?n.map((function(t){return a(t,1)[0]})):T(n)||Ve(n)?Array.from(n.keys()):f("Cannot get keys from '"+n+"'");Array.from(e.keys()).filter((function(t){return-1===r.indexOf(t)})).forEach((function(t){return e.delete(t)})),e.merge(t)})),this},Object.defineProperty(t.prototype,"size",{get:function(){return this._keysAtom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),t.prototype.toPOJO=function(){var t,e,n={};try{for(var r=o(this),i=r.next();!i.done;i=r.next()){var s=a(i.value,2),l=s[0],u=s[1];n["symbol"==typeof l?l:w(l)]=u}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},t.prototype.toJS=function(){return new Map(this)},t.prototype.toJSON=function(){return this.toPOJO()},t.prototype.toString=function(){var t=this;return this.name+"[{ "+Array.from(this.keys()).map((function(e){return w(e)+": "+t.get(e)})).join(", ")+" }]"},t.prototype.observe=function(t,e){return Oe(this,t)},t.prototype.intercept=function(t){return De(this,t)},t}(),Ve=E("ObservableMap",Ke),He={},We=function(){function t(t,e,n){if(void 0===e&&(e=B),void 0===n&&(n="ObservableSet@"+d()),this.name=n,this[je]=He,this._data=new Set,this._atom=D(this.name),this[Symbol.toStringTag]="Set","function"!=typeof Set)throw new Error("mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js");this.enhancer=function(t,r){return e(t,r,n)},t&&this.replace(t)}return t.prototype.dehanceValue=function(t){return void 0!==this.dehancer?this.dehancer(t):t},t.prototype.clear=function(){var t=this;_e((function(){ut((function(){var e,n;try{for(var r=o(t._data.values()),i=r.next();!i.done;i=r.next()){var s=i.value;t.delete(s)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}))}))},t.prototype.forEach=function(t,e){var n,r;try{for(var i=o(this),s=i.next();!s.done;s=i.next()){var a=s.value;t.call(e,a,a,this)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},Object.defineProperty(t.prototype,"size",{get:function(){return this._atom.reportObserved(),this._data.size},enumerable:!0,configurable:!0}),t.prototype.add=function(t){var e=this;if((ot(this._atom),Ie(this))&&!(r=xe(this,{type:"add",object:this,newValue:t})))return this;if(!this.has(t)){_e((function(){e._data.add(e.enhancer(t,void 0)),e._atom.reportChanged()}));var n=ke(this),r=n?{type:"add",object:this,newValue:t}:null;0,n&&Ce(this,r)}return this},t.prototype.delete=function(t){var e=this;if(Ie(this)&&!(r=xe(this,{type:"delete",object:this,oldValue:t})))return!1;if(this.has(t)){var n=ke(this),r=n?{type:"delete",object:this,oldValue:t}:null;return _e((function(){e._atom.reportChanged(),e._data.delete(t)})),n&&Ce(this,r),!0}return!1},t.prototype.has=function(t){return this._atom.reportObserved(),this._data.has(this.dehanceValue(t))},t.prototype.entries=function(){var t=0,e=Array.from(this.keys()),n=Array.from(this.values());return ln({next:function(){var r=t;return t+=1,r<n.length?{value:[e[r],n[r]],done:!1}:{done:!0}}})},t.prototype.keys=function(){return this.values()},t.prototype.values=function(){this._atom.reportObserved();var t=this,e=0,n=Array.from(this._data.values());return ln({next:function(){return e<n.length?{value:t.dehanceValue(n[e++]),done:!1}:{done:!0}}})},t.prototype.replace=function(t){var e=this;return Ye(t)&&(t=t.toJS()),_e((function(){Array.isArray(t)?(e.clear(),t.forEach((function(t){return e.add(t)}))):S(t)?(e.clear(),t.forEach((function(t){return e.add(t)}))):null!=t&&f("Cannot initialize set from "+t)})),this},t.prototype.observe=function(t,e){return Oe(this,t)},t.prototype.intercept=function(t){return De(this,t)},t.prototype.toJS=function(){return new Set(this)},t.prototype.toString=function(){return this.name+"[ "+Array.from(this).join(", ")+" ]"},t.prototype[(je=L,Symbol.iterator)]=function(){return this.values()},t}(),Ye=E("ObservableSet",We),ze=function(){function t(t,e,n,r){void 0===e&&(e=new Map),this.target=t,this.values=e,this.name=n,this.defaultEnhancer=r,this.keysAtom=new R(n+".keys")}return t.prototype.read=function(t){return this.values.get(t).get()},t.prototype.write=function(t,e){var n=this.target,r=this.values.get(t);if(r instanceof At)r.set(e);else{if(Ie(this)){if(!(s=xe(this,{type:"update",object:this.proxy||n,name:t,newValue:e})))return;e=s.newValue}if((e=r.prepareNewValue(e))!==Ot.UNCHANGED){var i=ke(this),s=i?{type:"update",object:this.proxy||n,oldValue:r.value,name:t,newValue:e}:null;0,r.setNewValue(e),i&&Ce(this,s)}}},t.prototype.has=function(t){var e=this.pendingKeys||(this.pendingKeys=new Map),n=e.get(t);if(n)return n.get();var r=!!this.values.get(t);return n=new _t(r,$,this.name+"."+w(t)+"?",!1),e.set(t,n),n.get()},t.prototype.addObservableProp=function(t,e,n){void 0===n&&(n=this.defaultEnhancer);var r=this.target;if(Ie(this)){var i=xe(this,{object:this.proxy||r,name:t,type:"add",newValue:e});if(!i)return;e=i.newValue}var s=new _t(e,n,this.name+"."+w(t),!1);this.values.set(t,s),e=s.value,Object.defineProperty(r,t,function(t){return Xe[t]||(Xe[t]={configurable:!0,enumerable:!0,get:function(){return this[L].read(t)},set:function(e){this[L].write(t,e)}})}(t)),this.notifyPropertyAddition(t,e)},t.prototype.addComputedProp=function(t,e,n){var r,i,s,o=this.target;n.name=n.name||this.name+"."+w(e),this.values.set(e,new At(n)),(t===o||(r=t,i=e,!(s=Object.getOwnPropertyDescriptor(r,i))||!1!==s.configurable&&!1!==s.writable))&&Object.defineProperty(t,e,function(t){return Qe[t]||(Qe[t]={configurable:Ot.computedConfigurable,enumerable:!1,get:function(){return Ze(this).read(t)},set:function(e){Ze(this).write(t,e)}})}(e))},t.prototype.remove=function(t){if(this.values.has(t)){var e=this.target;if(Ie(this))if(!(o=xe(this,{object:this.proxy||e,name:t,type:"remove"})))return;try{Ft();var n=ke(this),r=this.values.get(t),i=r&&r.get();if(r&&r.set(void 0),this.keysAtom.reportChanged(),this.values.delete(t),this.pendingKeys){var s=this.pendingKeys.get(t);s&&s.set(!1)}delete this.target[t];var o=n?{type:"remove",object:this.proxy||e,oldValue:i,name:t}:null;0,n&&Ce(this,o)}finally{Nt()}}},t.prototype.illegalAccess=function(t,e){console.warn("Property '"+e+"' of '"+t+"' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner")},t.prototype.observe=function(t,e){return Oe(this,t)},t.prototype.intercept=function(t){return De(this,t)},t.prototype.notifyPropertyAddition=function(t,e){var n=ke(this),r=n?{type:"add",object:this.proxy||this.target,name:t,newValue:e}:null;if(n&&Ce(this,r),this.pendingKeys){var i=this.pendingKeys.get(t);i&&i.set(!0)}this.keysAtom.reportChanged()},t.prototype.getKeys=function(){var t,e;this.keysAtom.reportObserved();var n=[];try{for(var r=o(this.values),i=r.next();!i.done;i=r.next()){var s=a(i.value,2),l=s[0];s[1]instanceof _t&&n.push(l)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},t}();function qe(t,e,n){if(void 0===e&&(e=""),void 0===n&&(n=B),Object.prototype.hasOwnProperty.call(t,L))return t[L];y(t)||(e=(t.constructor.name||"ObservableObject")+"@"+d()),e||(e="ObservableObject@"+d());var r=new ze(t,new Map,w(e),n);return b(t,L,r),r}var Xe=Object.create(null),Qe=Object.create(null);function Ze(t){var e=t[L];return e||(F(t),t[L])}var Je=E("ObservableObjectAdministration",ze);function tn(t){return!!v(t)&&(F(t),Je(t[L]))}function en(t,e){if("object"==typeof t&&null!==t){if($e(t))return void 0!==e&&f(!1),t[L].atom;if(Ye(t))return t[L];if(Ve(t)){var n=t;return void 0===e?n._keysAtom:((r=n._data.get(e)||n._hasMap.get(e))||f(!1),r)}var r;if(F(t),e&&!t[L]&&t[e],tn(t))return e?((r=t[L].values.get(e))||f(!1),r):f(!1);if(I(t)||Lt(t)||Ht(t))return t}else if("function"==typeof t&&Ht(t[L]))return t[L];return f(!1)}function nn(t,e){return t||f("Expecting some object"),void 0!==e?nn(en(t,e)):I(t)||Lt(t)||Ht(t)?t:Ve(t)||Ye(t)?t:(F(t),t[L]?t[L]:void f(!1))}var rn=Object.prototype.toString;function sn(t,e,n){return void 0===n&&(n=-1),function t(e,n,r,i,s){if(e===n)return 0!==e||1/e==1/n;if(null==e||null==n)return!1;if(e!=e)return n!=n;var o=typeof e;if("function"!==o&&"object"!==o&&"object"!=typeof n)return!1;var a=rn.call(e);if(a!==rn.call(n))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+e==""+n;case"[object Number]":return+e!=+e?+n!=+n:0==+e?1/+e==1/n:+e==+n;case"[object Date]":case"[object Boolean]":return+e==+n;case"[object Symbol]":return"undefined"!=typeof Symbol&&Symbol.valueOf.call(e)===Symbol.valueOf.call(n);case"[object Map]":case"[object Set]":r>=0&&r++}e=on(e),n=on(n);var l="[object Array]"===a;if(!l){if("object"!=typeof e||"object"!=typeof n)return!1;var u=e.constructor,c=n.constructor;if(u!==c&&!("function"==typeof u&&u instanceof u&&"function"==typeof c&&c instanceof c)&&"constructor"in e&&"constructor"in n)return!1}if(0===r)return!1;r<0&&(r=-1);s=s||[];var h=(i=i||[]).length;for(;h--;)if(i[h]===e)return s[h]===n;if(i.push(e),s.push(n),l){if((h=e.length)!==n.length)return!1;for(;h--;)if(!t(e[h],n[h],r-1,i,s))return!1}else{var d=Object.keys(e),f=void 0;if(h=d.length,Object.keys(n).length!==h)return!1;for(;h--;)if(f=d[h],!an(n,f)||!t(e[f],n[f],r-1,i,s))return!1}return i.pop(),s.pop(),!0}(t,e,n)}function on(t){return $e(t)?t.slice():T(t)||Ve(t)?Array.from(t.entries()):S(t)||Ye(t)?Array.from(t.entries()):t}function an(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ln(t){return t[Symbol.iterator]=un,t}function un(){return this}if("undefined"==typeof Proxy||"undefined"==typeof Symbol)throw new Error("[mobx] MobX 5+ requires Proxy and Symbol objects. If your environment doesn't support Symbol or Proxy objects, please downgrade to MobX 4. For React Native Android, consider upgrading JSCore.");"object"==typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:Yt,extras:{getDebugName:function(t,e){return(void 0!==e?en(t,e):tn(t)||Ve(t)||Ye(t)?nn(t):en(t)).name}},$mobx:L})}).call(this,n("8oxB"),n("yLpj"))},txOa:function(t,e,n){},u30h:function(t,e,n){var r=n("4shy"),i=n("8aHw"),s=n("P1Mu");t.exports=function(t){return t&&t.length?r(t,s,i):void 0}},uO9g:function(t,e,n){var r;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){"use strict";var n={}.hasOwnProperty;function i(){for(var t=[],e=0;e<arguments.length;e++){var r=arguments[e];if(r){var s=typeof r;if("string"===s||"number"===s)t.push(r);else if(Array.isArray(r)&&r.length){var o=i.apply(null,r);o&&t.push(o)}else if("object"===s)for(var a in r)n.call(r,a)&&r[a]&&t.push(a)}}return t.join(" ")}t.exports?(i.default=i,t.exports=i):void 0===(r=function(){return i}.apply(e,[]))||(t.exports=r)}()},uk4h:function(t,e,n){},ve1H:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));const r=t=>{if(void 0===t)return{};let e=null!==t.acceleration&&void 0!==t.acceleration?{acceleration:t.acceleration}:{};return null!==t.position&&void 0!==t.position&&(e={...e,position:t.position}),null!==t.velocity&&void 0!==t.velocity?{...e,velocity:t.velocity}:e}},xCRJ:function(t,e,n){"use strict";n.d(e,"a",(function(){return g}));var r=n("XNSo"),i=n("LXdD"),s=n("Oaut"),o=n("7Sz/"),a=n("W3E0"),l=n("SmkT"),u=n("dqmg"),c=n("r7EE"),h=n("gXvu"),d=n("ve1H"),f=n("RyO+"),p=n("qF/U");n("9haP"),n("lfgM");const g=Object(c.a)(Object(s.a)(Object(r.a)(Object(i.a)(h.a))),l.a,u.a,Object(o.a)(Object(a.a)(window),p.a),d.a,performance,setTimeout,f.a)},yZeT:function(t,e,n){t.exports=n("myfl")},z2Ax:function(t,e,n){},zp1X:function(t,e,n){}}]);
//# sourceMappingURL=docs~7ecba091.b039fc.chunk.js.map